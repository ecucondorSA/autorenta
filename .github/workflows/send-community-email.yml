name: Send Community Email

on:
  workflow_dispatch:
    inputs:
      to_email:
        description: 'Recipient email'
        required: true
        default: 'Reinamosquera2003@gmail.com'
      subject:
        description: 'Email subject'
        required: true
        default: 'ğŸ† PREMIOS COMUNIDAD ECUATORIANA 2026'

jobs:
  send-email:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Setup Bun
        uses: oven-sh/setup-bun@v1
        with:
          bun-version: latest

      - name: Install dependencies
        run: bun add nodemailer

      - name: Send Email
        env:
          GMAIL_USER: ${{ secrets.GMAIL_USER }}
          GMAIL_APP_PASSWORD: ${{ secrets.GMAIL_APP_PASSWORD }}
          TO_EMAIL: ${{ github.event.inputs.to_email }}
          SUBJECT: ${{ github.event.inputs.subject }}
        run: |
          cat > send-email.ts << 'SCRIPT'
          import nodemailer from 'nodemailer';

          const transporter = nodemailer.createTransport({
            service: 'gmail',
            auth: {
              user: process.env.GMAIL_USER,
              pass: process.env.GMAIL_APP_PASSWORD
            }
          });

          const mailOptions = {
            from: `ECUCÃ“NDOR ğŸ‡ªğŸ‡¨ğŸ‡¦ğŸ‡· <${process.env.GMAIL_USER}>`,
            to: process.env.TO_EMAIL,
            subject: process.env.SUBJECT,
            html: `
              <div style="font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto;">
                <div style="background: linear-gradient(90deg, #FFD700, #004990); padding: 20px; text-align: center; border-radius: 10px 10px 0 0;">
                  <h1 style="color: white; margin: 0;">ğŸ‡ªğŸ‡¨ ğŸ† ğŸ‡¦ğŸ‡·</h1>
                  <h2 style="color: white; margin: 10px 0;">PREMIOS COMUNIDAD ECUATORIANA</h2>
                </div>
                <div style="padding: 20px; background: #f8f9fa; border-radius: 0 0 10px 10px;">
                  <p>Â¡Hola!</p>
                  <p>Te compartimos los <strong>PREMIOS de nuestra Comunidad Ecuatoriana en Argentina</strong> - EdiciÃ³n 2026.</p>
                  <p>ğŸ“Š <strong>Datos destacados:</strong></p>
                  <ul>
                    <li>50,000+ mensajes analizados</li>
                    <li>5,000+ miembros activos</li>
                    <li>20+ grupos de la comunidad</li>
                  </ul>
                  <p>ğŸ† <strong>CategorÃ­as premiadas:</strong></p>
                  <ul>
                    <li>ğŸ² Chef Ecuatoriano del AÃ±o</li>
                    <li>ğŸ¤ Colaborador Solidario</li>
                    <li>â­ Influencer MÃ¡s Activo</li>
                    <li>ğŸ‘” Profesional Destacado</li>
                    <li>ğŸ† Comida MÃ¡s Pedida</li>
                    <li>ğŸ’¬ Grupo MÃ¡s Activo</li>
                  </ul>
                  <p>Â¡Descarga el PDF adjunto para ver todos los resultados! ğŸ“„</p>
                  <br>
                  <p style="color: #666;">Juntos somos mÃ¡s fuertes ğŸ‡ªğŸ‡¨â¤ï¸ğŸ‡¦ğŸ‡·</p>
                  <p><strong>ECUCÃ“NDOR</strong></p>
                </div>
              </div>
            `,
            attachments: [
              {
                filename: 'Premios-Comunidad-Ecuatoriana-2026.pdf',
                path: './tools/whatsapp-context/wa-market-analyzer/output/premios-comunidad-ecuatoriana-2026.pdf'
              }
            ]
          };

          try {
            const info = await transporter.sendMail(mailOptions);
            console.log('âœ… Email enviado exitosamente!');
            console.log('ğŸ“§ To:', process.env.TO_EMAIL);
            console.log('ğŸ“ Subject:', process.env.SUBJECT);
            console.log('ğŸ†” Message ID:', info.messageId);
          } catch (error) {
            console.error('âŒ Error:', error);
            process.exit(1);
          }
          SCRIPT

          bun send-email.ts

      - name: Success notification
        if: success()
        run: echo "ğŸ“§ Email sent successfully to ${{ github.event.inputs.to_email }}"
