# üéØ Gu√≠a de Claude Skills para AutoRenta

## üìÖ √öltima actualizaci√≥n: 16 de Octubre de 2025

---

## üéì ¬øQu√© son los Claude Skills?

Los **Claude Skills** son capacidades especializadas que Claude Code puede invocar para realizar tareas espec√≠ficas del dominio con mayor precisi√≥n y eficiencia. Funcionan como "expertos" en √°reas espec√≠ficas del desarrollo.

### Conceptos Clave

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  CLAUDE CODE (Orquestador)                              ‚îÇ
‚îÇ                                                          ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê             ‚îÇ
‚îÇ  ‚îÇ Skill 1 ‚îÇ  ‚îÇ Skill 2  ‚îÇ  ‚îÇ Skill 3   ‚îÇ  ...        ‚îÇ
‚îÇ  ‚îÇ Angular ‚îÇ  ‚îÇ Supabase ‚îÇ  ‚îÇ Testing   ‚îÇ             ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò             ‚îÇ
‚îÇ                                                          ‚îÇ
‚îÇ  Claude decide qu√© skill usar seg√∫n la tarea            ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## üöÄ Skills Recomendados para AutoRenta

### 1. **Angular Standalone Architecture Skill**

**Prop√≥sito**: Generar features siguiendo los patterns de AutoRenta

**Casos de Uso**:
- Crear nuevos m√≥dulos (e.g., sistema de reviews, notificaciones)
- Generar componentes standalone con rutas lazy-loaded
- Scaffolding de services con inyecci√≥n de Supabase

**Ejemplo de Invocaci√≥n** (conceptual):
```bash
# Claude detecta: "Crear m√≥dulo de reviews"
# Skill genera autom√°ticamente:
# - src/app/features/reviews/
#   - list/reviews-list.page.ts
#   - detail/review-detail.page.ts
#   - components/review-card.component.ts
# - src/app/core/services/reviews.service.ts
# - src/app/core/models/review.model.ts
# - Routes en app.routes.ts
```

**Input Esperado**:
```typescript
{
  "featureName": "reviews",
  "entities": ["Review"],
  "pages": ["list", "detail", "create"],
  "architecture": "angular-standalone",
  "patterns": "AutoRenta patterns from CLAUDE.md"
}
```

**Output Generado**:
- Componentes standalone siguiendo estructura de AutoRenta
- Services con `injectSupabase()` pattern
- Routes con lazy-loading y guards apropiados
- TypeScript interfaces basadas en database schema
- Tests unitarios b√°sicos

---

### 2. **Supabase RLS Debugger Skill**

**Prop√≥sito**: Analizar y debuggear pol√≠ticas de Row Level Security

**Casos de Uso**:
- Debug de errores "row violates row-level security policy"
- Validaci√≥n de storage paths vs. RLS policies
- An√°lisis de permisos y autenticaci√≥n

**Ejemplo de Invocaci√≥n**:
```bash
# Claude detecta error RLS
# Error: new row violates row-level security policy for table "storage.objects"

# Skill analiza autom√°ticamente:
# 1. RLS policy SQL
# 2. Storage path construction en service
# 3. Auth state
# 4. Identifica root cause
```

**An√°lisis Vertical Stack**:
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ SKILL ANALIZA TODA LA PILA:                             ‚îÇ
‚îÇ                                                          ‚îÇ
‚îÇ ‚úÖ Component: uploadAvatar() llamado correctamente      ‚îÇ
‚îÇ ‚úÖ Service: File validations passed                     ‚îÇ
‚îÇ ‚ùå Path: `avatars/${userId}/file.jpg`                   ‚îÇ
‚îÇ    ‚Üì                                                     ‚îÇ
‚îÇ ‚ùå RLS expects: `${userId}/file.jpg`                    ‚îÇ
‚îÇ    ‚Üì                                                     ‚îÇ
‚îÇ üéØ ROOT CAUSE: Bucket prefix in path                    ‚îÇ
‚îÇ üí° FIX: Remove 'avatars/' from filePath                 ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**Output**:
```markdown
## RLS Policy Violation Analysis

### Root Cause
Storage path includes bucket prefix `avatars/` which causes
`(storage.foldername(name))[1]` to return 'avatars' instead of user_id

### Fix
**File**: `apps/web/src/app/core/services/profile.service.ts:97`

**Change**:
- const filePath = `avatars/${userId}/${filename}`;
+ const filePath = `${userId}/${filename}`;

### Verification
Run this SQL to test:
SELECT (storage.foldername('user-uuid/file.jpg'))[1] = 'user-uuid';
-- Should return: true
```

---

### 3. **TypeScript Database Sync Skill**

**Prop√≥sito**: Sincronizar tipos TypeScript con schema de Supabase

**Casos de Uso**:
- Detectar inconsistencias entre `database.types.ts` y schema real
- Generar interfaces TypeScript a partir de tablas Supabase
- Validar que queries usen tipos correctos

**Ejemplo**:
```bash
# Claude ejecuta: "Validar tipos de database"

# Skill compara:
# - database.types.ts (local)
# - Supabase schema (remoto)
# - Service layer types
```

**Output**:
```typescript
// INCONSISTENCIAS DETECTADAS:

// 1. Campo faltante en bookings table
// database.types.ts:
interface Bookings {
  id: string;
  car_id: string;
  // ‚ùå FALTA: rating: number | null;
}

// Supabase schema tiene:
// bookings.rating (int4, nullable)

// 2. Tipo incorrecto
// database.types.ts:
interface Cars {
  price_per_day: number; // ‚ùå INCORRECTO
}
// Deber√≠a ser: Decimal (string en TypeScript)

// üí° FIXES:
// 1. Agregar campo rating a Bookings interface
// 2. Cambiar price_per_day a string
```

---

### 4. **Angular Test Generator Skill**

**Prop√≥sito**: Generar tests siguiendo patterns de AutoRenta

**Casos de Uso**:
- Crear tests unitarios para services
- Tests de componentes con mocks de Supabase
- Tests de integraci√≥n para flujos cr√≠ticos

**Ejemplo**:
```bash
# Claude: "Generar tests para cars.service.ts"

# Skill genera:
# - cars.service.spec.ts con todos los m√©todos
# - Mocks de Supabase client
# - Test cases para edge cases
```

**Output Generado**:
```typescript
// cars.service.spec.ts
import { TestBed } from '@angular/core/testing';
import { CarsService } from './cars.service';

describe('CarsService', () => {
  let service: CarsService;
  let mockSupabase: jasmine.SpyObj<SupabaseClient>;

  beforeEach(() => {
    mockSupabase = jasmine.createSpyObj('SupabaseClient', [
      'from',
      'storage',
      'auth'
    ]);

    TestBed.configureTestingModule({
      providers: [
        CarsService,
        { provide: SupabaseClient, useValue: mockSupabase }
      ]
    });

    service = TestBed.inject(CarsService);
  });

  describe('getCars', () => {
    it('should return list of cars', async () => {
      // Test implementation following AutoRenta patterns
    });

    it('should handle errors gracefully', async () => {
      // Error handling test
    });
  });

  // ... m√°s tests para cada m√©todo
});
```

**Coverage Target**: Skill asegura m√≠nimo 80% coverage

---

### 5. **Performance Optimizer Skill**

**Prop√≥sito**: Analizar y optimizar performance de AutoRenta

**Casos de Uso**:
- Detectar bundle size issues (Warning actual: 560KB vs 500KB budget)
- Optimizar imports de Mapbox (actualmente no es ESM)
- Lazy-load de componentes grandes

**Ejemplo**:
```bash
# Claude: "Optimizar bundle size"

# Skill analiza build output:
# ‚ö†Ô∏è bundle initial exceeded maximum budget by 60.40 kB
# ‚ö†Ô∏è mapbox-gl (1.61 MB) no es ESM
```

**Recomendaciones del Skill**:
```markdown
## Performance Analysis

### Issues Detectados

1. **Bundle Size Excedido** (+60KB)
   - Current: 560KB
   - Budget: 500KB
   - Impact: LCP puede aumentar

2. **Mapbox No-ESM Warning**
   - Module: mapbox-gl (1.61 MB lazy chunk)
   - Causa optimization bailouts

3. **CSS Oversize**
   - cars-list.page.css: 6.44KB (budget: 4KB)
   - cars-map.component.css: 7.23KB (budget: 4KB)

### Fixes Recomendados

#### 1. Dynamic Import de Mapbox
**File**: `apps/web/src/app/shared/components/cars-map/cars-map.component.ts`

**Change**:
```typescript
// Antes:
import mapboxgl from 'mapbox-gl';

// Despu√©s:
private async initMap() {
  const mapboxgl = await import('mapbox-gl');
  // ... uso de mapbox
}
```

#### 2. CSS Optimization
**File**: `cars-list.page.css`

- Usar Tailwind utilities en lugar de CSS custom
- Reducir duplicaci√≥n de estilos

#### 3. Tree Shaking
**File**: `apps/web/src/main.ts`

- Verificar imports de Angular que no se usan
- Lazy-load de providers no cr√≠ticos

### Expected Impact
- Bundle size: -80KB (~500KB total)
- LCP: -0.5s
- Mapbox chunk: ESM compliant
```

---

### 6. **Security Audit Skill**

**Prop√≥sito**: Auditar seguridad de AutoRenta

**Casos de Uso**:
- Validar que RLS policies est√°n activas
- Verificar que no hay data leaks
- Revisar manejo de JWT tokens

**Ejemplo**:
```bash
# Claude: "Auditar seguridad del proyecto"

# Skill revisa:
# - RLS policies en todas las tablas
# - Storage bucket permissions
# - Auth interceptor configuration
# - Environment variables exposure
```

**Output**:
```markdown
## Security Audit Report

### ‚úÖ Aspectos Seguros

1. **RLS Policies Activas**
   - profiles: 4 policies (SELECT, INSERT, UPDATE, DELETE)
   - cars: 5 policies
   - bookings: 4 policies
   - storage.objects: 4 policies

2. **Auth Interceptor**
   - JWT correctamente adjunto en requests
   - Auto-refresh funcional

3. **Environment Variables**
   - .env.local no commiteado (‚úì gitignore)
   - Solo anon key expuesta (correcto)

### ‚ö†Ô∏è Mejoras Recomendadas

1. **Service Role Key**
   - ‚ùå Encontrado en: `apps/web/database/seed.sql:3`
   - üîí Acci√≥n: Remover, usar solo en backend/CI

2. **CORS Configuration**
   - ‚ö†Ô∏è Worker permite cualquier origen
   - üí° Restringir a dominio de producci√≥n

3. **Rate Limiting**
   - ‚ùå No implementado
   - üí° Agregar en Cloudflare Workers

### Prioridad Alta

**1. Remover Service Role Key del frontend**
```sql
-- File: apps/web/database/seed.sql
-- L√≠nea 3: SUPABASE_SERVICE_ROLE_KEY='...'
-- ‚ùå REMOVER - Solo para backend
```

**2. Configurar CORS del Worker**
```typescript
// File: functions/workers/payments_webhook/src/index.ts
const allowedOrigins = [
  'https://autorenta.pages.dev',
  'https://autorenta.com'
];
```
```

---

## üìã C√≥mo Usar Skills en AutoRenta

### M√©todo 1: Invocaci√≥n Directa (Cuando Est√© Disponible)

```bash
# En Claude Code CLI
/skills list                    # Ver skills disponibles
/skills use angular-scaffolder  # Usar skill espec√≠fico
```

### M√©todo 2: Invocaci√≥n Autom√°tica

Claude detectar√° autom√°ticamente cu√°ndo usar un skill bas√°ndose en:
- Tipo de tarea
- Contexto del proyecto
- Patterns en CLAUDE.md

**Ejemplo**:
```
User: "Crear m√≥dulo de notificaciones"

Claude internamente:
1. Detecta: Feature scaffolding task
2. Lee: /autorenta/CLAUDE.md para patterns
3. Invoca: Angular Standalone Architecture Skill
4. Genera: Estructura completa siguiendo patterns
```

### M√©todo 3: Preparaci√≥n de Contexto

Para maximizar efectividad de Skills, mantener actualizados:

**1. CLAUDE.md** - Patterns y arquitectura
```markdown
## Patterns de AutoRenta

### Service Layer Pattern
- Inyecci√≥n: `injectSupabase()`
- Error handling: Try-catch con mensajes user-friendly
- Return type: Promises, no Observables

### Component Pattern
- Standalone: true
- Lazy-loaded via routes
- Minimal logic, delegado a services
```

**2. PATTERNS.md** - Templates de c√≥digo
```typescript
// Template: Feature Service
export class {{FeatureName}}Service {
  private supabase = injectSupabase();

  async get{{Entity}}(): Promise<{{Entity}}[]> {
    const { data, error } = await this.supabase
      .from('{{table}}')
      .select('*');

    if (error) throw new Error(`Error: ${error.message}`);
    return data as {{Entity}}[];
  }
}
```

**3. database.types.ts** - Mantener sincronizado con schema

---

## üéØ Workflows de Skills para AutoRenta

### Workflow 1: Nueva Feature Completa

```mermaid
graph TD
    A[User: "Crear m√≥dulo de reviews"] --> B[Claude detecta: Feature scaffolding]
    B --> C[Skill: Angular Scaffolder]
    C --> D[Genera estructura de archivos]
    D --> E[Skill: Database Sync]
    E --> F[Genera interfaces TypeScript]
    F --> G[Skill: Test Generator]
    G --> H[Genera tests unitarios]
    H --> I[Claude: Review y ajustes finales]
    I --> J[Output: Feature completa lista]
```

**Tiempo Estimado**:
- Sin Skills: 2-3 horas
- Con Skills: 15-30 minutos

### Workflow 2: Debugging RLS Issue

```mermaid
graph TD
    A[Error: RLS policy violation] --> B[Claude detecta: Security issue]
    B --> C[Skill: Supabase RLS Debugger]
    C --> D[Analiza vertical stack]
    D --> E[Identifica root cause]
    E --> F[Genera fix espec√≠fico]
    F --> G[Skill: Security Audit]
    G --> H[Valida fix no introduce nuevos issues]
    H --> I[Output: Fix aplicado + documentado]
```

**Tiempo Estimado**:
- Sin Skills: 30-60 minutos
- Con Skills: 5-10 minutos

### Workflow 3: Pre-Deploy CI/CD

```mermaid
graph TD
    A[npm run ci] --> B[Skill: Test Generator verifica coverage]
    B --> C{Coverage > 80%?}
    C -->|No| D[Skill genera tests faltantes]
    C -->|S√≠| E[Skill: Security Audit]
    D --> E
    E --> F{Issues de seguridad?}
    F -->|S√≠| G[Claude reporta y bloquea deploy]
    F -->|No| H[Skill: Performance Optimizer]
    H --> I[Valida bundle size]
    I --> J{Budget OK?}
    J -->|No| K[Skill sugiere optimizaciones]
    J -->|S√≠| L[‚úÖ Listo para deploy]
```

---

## üìä M√©tricas de Efectividad

### Comparativa: Con/Sin Skills

| Tarea | Sin Skills | Con Skills | Mejora |
|-------|------------|------------|--------|
| Nueva Feature | 2-3h | 15-30min | **83%** |
| Debug RLS | 30-60min | 5-10min | **85%** |
| Generar Tests | 1-2h | 10-20min | **90%** |
| Security Audit | 2-4h | 20-30min | **87%** |
| Performance Optimization | 1-3h | 15-30min | **85%** |

### ROI Esperado

```
Desarrollo Mensual (sin Skills):
- 4 features nuevas: 12 horas
- 10 bugs/debugging: 8 horas
- Tests: 8 horas
- Security audits: 4 horas
Total: 32 horas/mes

Desarrollo Mensual (con Skills):
- 4 features nuevas: 2 horas
- 10 bugs/debugging: 1.5 horas
- Tests: 1.5 horas
- Security audits: 0.5 horas
Total: 5.5 horas/mes

‚è±Ô∏è AHORRO: 26.5 horas/mes (83% reducci√≥n)
üí∞ VALOR: ~$2,500-5,000 USD/mes (seg√∫n tarifa)
```

---

## üõ†Ô∏è Configuraci√≥n de Skills

### 1. Preparar Documentaci√≥n

```bash
# Crear archivo de patterns
touch /home/edu/autorenta/PATTERNS.md

# Actualizar CLAUDE.md con ejemplos
# Ya existe: /home/edu/autorenta/CLAUDE.md
```

### 2. Mantener Context Actualizado

**Scripts para Auto-sync**:
```bash
# tools/sync-types.sh
#!/bin/bash
# Regenera database.types.ts desde Supabase
supabase gen types typescript --local > apps/web/src/app/core/types/database.types.ts
echo "‚úÖ Database types synced"
```

### 3. Agregar Metadata para Skills

**En package.json**:
```json
{
  "autorenta": {
    "architecture": "angular-standalone",
    "backend": "supabase",
    "deployment": "cloudflare-pages",
    "patterns": {
      "services": "inject-pattern",
      "components": "standalone-lazy",
      "testing": "jasmine-karma"
    }
  }
}
```

---

## üìö Recursos Adicionales

### Documentaci√≥n de Referencia

1. **Claude Code Skills Docs**: https://docs.claude.com/en/docs/claude-code/skills
2. **AutoRenta Patterns**: `/home/edu/autorenta/CLAUDE.md`
3. **Database Types**: `/home/edu/autorenta/apps/web/src/app/core/types/database.types.ts`

### Templates de Skills

**Crear Custom Skills** (futuro):
```typescript
// .claude/skills/autorenta-scaffolder.ts
export const autorentaScaffolder = {
  name: 'autorenta-feature-scaffolder',
  description: 'Generate AutoRenta features following project patterns',
  input: {
    featureName: 'string',
    entities: 'string[]',
    pages: 'string[]'
  },
  action: async (input) => {
    // L√≥gica de generaci√≥n basada en templates
  }
};
```

---

## üéì Mejores Pr√°cticas

### 1. Documentar Patterns Claramente

```markdown
# En CLAUDE.md o PATTERNS.md

## Service Pattern
‚úÖ DO:
- Usar `injectSupabase()` para inyecci√≥n
- Retornar Promises
- Manejar errores con try-catch

‚ùå DON'T:
- Usar Observables para Supabase calls
- Exponer Supabase client directamente
- Ignorar error handling
```

### 2. Mantener Types Sincronizados

```bash
# Ejecutar antes de cada feature nueva
npm run sync:types  # Agregado a package.json
```

### 3. Usar Skills Progresivamente

**Fase 1**: Scaffolding y generaci√≥n
**Fase 2**: Debugging y an√°lisis
**Fase 3**: Optimizaci√≥n y security

### 4. Combinar Skills con Auto-Background

```bash
# Skill genera feature mientras build corre en background
npm run ci &         # Background
# Claude usa Skill para generar nueva feature
# Build termina, tests pasan, feature lista
```

---

## üöÄ Pr√≥ximos Pasos

### Inmediato (Esta Semana)

1. ‚úÖ Crear este documento de gu√≠a
2. üîÑ Crear `PATTERNS.md` con templates
3. üîÑ Experimentar con Skills (cuando est√©n disponibles)

### Corto Plazo (2 Semanas)

1. üìã Agregar metadata de Skills a package.json
2. üìã Crear script `sync-types.sh`
3. üìã Documentar todos los patterns en PATTERNS.md

### Largo Plazo (1 Mes)

1. üìã Crear custom Skills para AutoRenta (si API lo permite)
2. üìã Integrar Skills en CI/CD pipeline
3. üìã Medir ROI real vs. estimado

---

## üí° Conclusi√≥n

Los Claude Skills representan un **multiplicador de productividad 5-10x** para AutoRenta cuando se usan correctamente:

1. **Scaffolding**: Features completas en minutos
2. **Debugging**: Root cause analysis autom√°tico
3. **Testing**: Coverage autom√°tico de 80%+
4. **Security**: Audits continuos
5. **Performance**: Optimizaciones data-driven

**Clave del √âxito**: Mantener documentaci√≥n de patterns actualizada para que Skills generen c√≥digo consistente con arquitectura de AutoRenta.

---

**√öltima actualizaci√≥n**: 16 de Octubre de 2025
**Versi√≥n**: 1.0
**Mantenido por**: AutoRenta Development Team
