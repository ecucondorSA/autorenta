🧪 TEST DE WEBHOOK CON PAYMENT ID REAL
======================================

📋 Payment ID a probar: 130635680108
   (Este payment ID falló con 502 en el panel de MercadoPago)

📡 Enviando webhook simulado...

Payload a enviar:
{
  "id": 123456789,
  "live_mode": true,
  "type": "payment",
  "date_created": "2025-10-20T18:00:00.000-04:00",
  "user_id": 202984680,
  "api_version": "v1",
  "action": "payment.created",
  "data": {
    "id": "130635680108"
  }
}

⏱️ Enviando request (puede tardar 5-30 segundos)...

📊 RESULTADO:
============

HTTP Status Code: 502
Tiempo total: 3.097539s (3s elapsed)

Respuesta del servidor:
{
  "success": false,
  "error": "Failed to fetch payment data from MercadoPago",
  "details": "f.headers.raw is not a function",
  "payment_id": "130635680108"
}

🔍 ANÁLISIS:
============

❌ Error 502 - Bad Gateway

Posibles causas:
  1. MercadoPago API tardó mucho en responder (timeout)
  2. MercadoPago API devolvió error o HTML en lugar de JSON
  3. Edge Function alcanzó timeout (>10 segundos)

Evidencia:
  - Tiempo total: 3.097539s


📝 RECOMENDACIONES:
==================

🔧 Fixes sugeridos:

1. Implementar cache de idempotencia (evitar procesar dos veces)
2. Retornar 200 OK inmediatamente y procesar async
3. Aumentar timeout de MercadoPago API call

Ver análisis completo en:
/home/edu/autorenta/debug-webhook-502.md


📖 Documentación:
================

- Análisis completo: /home/edu/autorenta/debug-webhook-502.md
- Guía de webhook: /home/edu/autorenta/CONFIGURAR_WEBHOOK_MERCADOPAGO.md
- Investigación real: /home/edu/autorenta/INVESTIGACION_REAL_MERCADOPAGO.md
