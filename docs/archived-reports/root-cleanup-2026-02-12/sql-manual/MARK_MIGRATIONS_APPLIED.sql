-- ============================================
-- MARK ALL MIGRATIONS AS APPLIED
-- Project: aceacpaockyxgogxsfyc
-- Date: 2026-02-03
--
-- This script marks all migrations as already applied
-- so that `supabase db push` won't try to re-run them.
--
-- Execute AFTER running APPLY_TO_NEW_PROJECT.sql
-- in SQL Editor:
-- https://supabase.com/dashboard/project/aceacpaockyxgogxsfyc/sql/new
-- ============================================

-- First, ensure the schema_migrations table exists
CREATE TABLE IF NOT EXISTS supabase_migrations.schema_migrations (
  version TEXT PRIMARY KEY,
  statements TEXT[],
  name TEXT
);

-- Clear any existing entries to avoid duplicates
DELETE FROM supabase_migrations.schema_migrations;

-- Insert all migration versions
INSERT INTO supabase_migrations.schema_migrations (version, name) VALUES
('20251130000000', '20251130000000_fix_user_documents_table'),
('20251201000000', '20251201000000_00_foundation'),
('20251201000001', '20251201000001_01_core'),
('20251201000002', '20251201000002_02_pricing'),
('20251201000003', '20251201000003_03_archive'),
('20251201000004', '20251201000004_04_archive_late'),
('20251202010000', '20251202010000_get_verification_progress'),
('20251202020000', '20251202020000_sync_email_verification'),
('20251203010000', '20251203010000_accounting_views'),
('20251203020000', '20251203020000_add_insurance_columns'),
('20251203030000', '20251203030000_admin_users'),
('20251203040000', '20251203040000_auto_exchange_rate_sync'),
('20251203050000', '20251203050000_convert_to_usd_base'),
('20251203060000', '20251203060000_fix_annual_improvement_function'),
('20251203070000', '20251203070000_fix_bonus_protector_function'),
('20251203080000', '20251203080000_fix_driver_score_on_claims'),
('20251203090000', '20251203090000_fix_verification_issues'),
('20251203100000', '20251203100000_renter_profile_badge_rpc'),
('20251203165500', '20251203165500_enable_pgcrypto'),
('20251203173000', '20251203173000_disable_message_encryption'),
('20251205010000', '20251205010000_fix_renter_badge_auth'),
('20251210010000', '20251210010000_add_wallet_record_rental_payment'),
('20251211034647', '20251211034647_add_notes_to_car_blocked_dates'),
('20251211050017', '20251211050017_wallet_lock_expiration_system'),
('20251211060000', '20251211060000_account_suspension_system'),
('20251211060001', '20251211060001_bonus_malus_system'),
('20251211060002', '20251211060002_renter_levels_and_owner_penalty'),
('20251211060003', '20251211060003_additional_cron_jobs'),
('20251211063259', '20251211063259_add_notes_to_car_blocked_dates'),
('20251211120000', '20251211120000_create_user_blocks'),
('20251211130000', '20251211130000_fraud_detection_system'),
('20251211140000', '20251211140000_create_booking_extension_requests_table'),
('20251214000000', '20251214000000_enhance_booking_contracts'),
('20251215000000', '20251215000000_auto_update_prices_from_fipe'),
('20251215093000', '20251215093000_mp_webhook_logs_event_id_idempotency'),
('20251215121500', '20251215121500_wallet_confirm_deposit_admin_allow_service_role'),
('20251216070001', '20251216070001_fix_unlock_wallet_locks_batch'),
('20251216080001', '20251216080001_atomic_split_payment_validation'),
('20251217190000', '20251217190000_create_car_stats_table'),
('20251217200000', '20251217200000_create_v_car_reviews_view'),
('20251217210000', '20251217210000_add_rental_restrictions_fields'),
('20251218000000', '20251218000000_fix_revenue_pipeline'),
('20251219080000', '20251219080000_prevent_self_booking'),
('20251220110000', '20251220110000_restore_missing_rpcs'),
('20251220120000', '20251220120000_fix_organization_member_policy'),
('20251221030500', '20251221030500_add_mileage_limit_extra_km_price'),
('20251221090000', '20251221090000_owner_renter_verification'),
('20251222090000', '20251222090000_add_car_rental_rules_fields'),
('20251228', '20251228_add_price_constraint'),
('20251230', '20251230_byoi_insurance_verification'),
('20260103120000', '20260103120000_add_verification_rpcs'),
('20260104000000', '20260104000000_fix_verification_sync'),
('20260104152321', '20260104152321_review_owner_to_renter_categories'),
('20260107190000', '20260107190000_remove_orphan_objects'),
('20260107220000', '20260107220000_restore_subscription_logic'),
('20260107233000', '20260107233000_ensure_subscription_schema'),
('20260107234500', '20260107234500_restore_wallet_tables'),
('20260108010000', '20260108010000_fix_subscription_wallet_tiers'),
('20260108020000', '20260108020000_booking_flow_v2'),
('20260108020500', '20260108020500_fix_rpc_create_subscription_with_wallet'),
('20260108030000', '20260108030000_fix_all_subscriptions_schema_refs'),
('20260108033000', '20260108033000_fix_booking_enums'),
('20260108033001', '20260108033001_implement_money_capture'),
('20260108040000', '20260108040000_schedule_cron_jobs'),
('20260108040001', '20260108040001_automation_timeouts_v2'),
('20260108040002', '20260108040002_schedule_v2_timeouts'),
('20260108042000', '20260108042000_add_upgrade_subscription_rpc'),
('20260108045000', '20260108045000_subscription_snapshot_and_preauth_renewal'),
('20260108050000', '20260108050000_optimize_get_available_cars'),
('20260108060000', '20260108060000_enable_earthdistance'),
('20260108070000', '20260108070000_fix_get_available_cars'),
('20260108080000', '20260108080000_hotfix_get_available_cars'),
('20260108090000', '20260108090000_fix_get_available_cars_types'),
('20260108100000', '20260108100000_fix_get_available_cars_casts'),
('20260108110000', '20260108110000_fix_porsche_price'),
('20260108120000', '20260108120000_robust_auth_schema_fix'),
('20260109010000', '20260109010000_async_approve_booking'),
('20260109020000', '20260109020000_optimize_booking_v2_rpc'),
('20260109030000', '20260109030000_optimize_start_rental'),
('20260110074835', '20260110074835_add_inspection_frames_storage_policy'),
('20260110080000', '20260110080000_comodato_community_model'),
('20260110080001', '20260110080001_update_usage_limits_comodato'),
('20260110225615', '20260110225615_booking_completion_fix'),
('20260111020420', '20260111020420_ai_visual_features_tables'),
('20260111050500', '20260111050500_fix_booking_b25f2723'),
('20260111052000', '20260111052000_fix_booking_returned_at'),
('20260111060000', '20260111060000_add_returned_at_to_views'),
('20260111090000', '20260111090000_update_preauthorization_5_percent'),
('20260111093000', '20260111093000_force_fipe_auto_price_no_override'),
('20260111123000', '20260111123000_add_cars_fipe_history'),
('20260111225642', '20260111225642_fix_booking_completion_accounting'),
('20260111230000', '20260111230000_disable_accounting_triggers'),
('20260112044903', '20260112044903_marketing_automation_tables'),
('20260114141552', '20260114141552_fix_marketing_rls_policies'),
('20260116160000', '20260116160000_create_social_credentials_table'),
('20260116161000', '20260116161000_setup_social_media_cron'),
('20260116163550', '20260116163550_add_marketing_campaigns_tables'),
('20260117000000', '20260117000000_email_marketing_system'),
('20260119024645', '20260119024645_security_improvements'),
('20260119100000', '20260119100000_fix_social_cron'),
('20260119120000', '20260119120000_schedule_daily_content_generation'),
('20260119140000', '20260119140000_enable_marketing_scheduler'),
('20260120032609', '20260120032609_allow_video_mp4_in_car_images_bucket'),
('20260120040300', '20260120040300_nosis_credit_verification'),
('20260120160000', '20260120160000_marketing_bio_links'),
('20260120160100', '20260120160100_marketing_ab_testing'),
('20260120160200', '20260120160200_marketing_seo_dashboard'),
('20260120180000', '20260120180000_remote_config_and_feature_flags'),
('20260120180100', '20260120180100_recommendations_tracking'),
('20260120190000', '20260120190000_sdui_and_contextual'),
('20260120200000', '20260120200000_vehicle_tracking_during_rental'),
('20260120230000', '20260120230000_instant_booking'),
('20260121030000', '20260121030000_smart_notifications'),
('20260121180000', '20260121180000_notification_cron_job'),
('20260121184927', '20260121184927_create_passkeys_table'),
('20260122194511', '20260122194511_suspend_tiktok_twitter_marketing'),
('20260122220757', '20260122220757_marketing_system_hardening'),
('20260122233034', '20260122233034_marketing_authority_concepts'),
('20260122234434', '20260122234434_authority_metrics_feedback_loop'),
('20260123025200', '20260123025200_content_mix_strategy'),
('20260123030500', '20260123030500_fix_authority_concept_function'),
('20260123051500', '20260123051500_update_survivorship_bias_concept'),
('20260123100000', '20260123100000_p1_geofences_alerts'),
('20260123100100', '20260123100100_p1_recovery_support'),
('20260123100200', '20260123100200_p1_evidence_pricing'),
('20260123100300', '20260123100300_p1_ev_telemetry_iot'),
('20260123100400', '20260123100400_p1_signed_traces_warranty'),
('20260123103223', '20260123103223_ev_clauses_and_kyc_blocking'),
('20260123103224', '20260123103224_ev_claim_types'),
('20260123103225', '20260123103225_ev_incident_protocol'),
('20260123120000', '20260123120000_marketing_settings_fallback_and_logging'),
('20260123201700', '20260123201700_cron_read_from_app_config'),
('20260124090000', '20260124090000_create_identity_documents_bucket'),
('20260124120000', '20260124120000_autorenta_defense_grid'),
('20260126090500', '20260126090500_edge_brain_memory'),
('20260126100000', '20260126100000_fix_booking_notification_trigger'),
('20260126130000', '20260126130000_fix_critical_sentry_errors'),
('20260126195227', '20260126195227_update_referral_rewards_to_usd'),
('20260126200000', '20260126200000_edge_brain_improvements'),
('20260126210000', '20260126210000_fix_bookings_missing_columns'),
('20260126220000', '20260126220000_fix_all_owner_id_triggers'),
('20260127020647', '20260127020647_add_booking_status_change_trigger'),
('20260127030100', '20260127030100_marketing_automation_tables'),
('20260127030200', '20260127030200_marketing_helper_functions'),
('20260127040000', '20260127040000_otp_delivery_logs'),
('20260127100000', '20260127100000_whatsapp_outreach_tables'),
('20260127100100', '20260127100100_outreach_dedup_index'),
('20260128150000', '20260128150000_outreach_whatsapp_columns'),
('20260128160000', '20260128160000_whatsapp_debounce_table'),
('20260128170000', '20260128170000_whatsapp_registration_state'),
('20260128180000', '20260128180000_fix_handle_new_user_trigger'),
('20260128180100', '20260128180100_fix_handle_new_user_v2'),
('20260128200000', '20260128200000_security_hardening'),
('20260128200100', '20260128200100_security_hardening_rls'),
('20260129034054', '20260129034054_payment_webhook_n8n_trigger'),
('20260129043446', '20260129043446_production_hardening'),
('20260130041500', '20260130041500_add_fipe_cache_table'),
('20260130100000', '20260130100000_beacon_mesh_tables'),
('20260130175029', '20260130175029_enable_rls_exposed_tables'),
('20260130180500', '20260130180500_fix_cron_jobs_auth'),
('20260130181500', '20260130181500_cleanup_duplicate_rls_policies'),
('20260131010000', '20260131010000_p0_restrict_write_to_service_role'),
('20260131020000', '20260131020000_p1_booking_subtables_service_role'),
('20260131033000', '20260131033000_fix_security_lints'),
('20260201000000', '20260201000000_email_automation_enhancements'),
('20260201120000', '20260201120000_seo_programmatic'),
('20260201123000', '20260201123000_seo_sitemap'),
('20260201130000', '20260201130000_referrals_v1'),
('20260201150000', '20260201150000_dispute_center_v1_core'),
('20260201160000', '20260201160000_secure_messaging_v1'),
('20260201170000', '20260201170000_fintech_wallet_core'),
('20260201180000', '20260201180000_subscription_plans_config'),
('20260201190000', '20260201190000_push_tokens_hardening'),
('20260201200000', '20260201200000_trust_engine_core'),
('20260201210000', '20260201210000_smart_subscriptions'),
('20260201220000', '20260201220000_chargebacks_system'),
('20260201230000', '20260201230000_payment_retry_queue'),
('20260202040220', '20260202040220_comodato_split_model'),
('20260202041655', '20260202041655_insurance_prelaunchi_nfrastructure'),
('20260202100000', '20260202100000_chat_notifications_trigger'),
('20260202150000', '20260202150000_create_user_stats_view'),
('20260202160000', '20260202160000_assign_default_region_to_cars'),
('20260202200000', '20260202200000_egress_optimization_p0'),
('20260203010237', '20260203010237_fix_get_available_cars_no_brands_table'),
('20260203020000', '20260203020000_fix_schema_views_functions');

-- Verification
DO $$
DECLARE
  v_count INTEGER;
BEGIN
  SELECT COUNT(*) INTO v_count FROM supabase_migrations.schema_migrations;
  RAISE NOTICE '============================================';
  RAISE NOTICE 'âœ… Marked % migrations as applied', v_count;
  RAISE NOTICE '============================================';
  RAISE NOTICE 'Next step: Run "supabase db push" or trigger Build & Deploy workflow';
END $$;
