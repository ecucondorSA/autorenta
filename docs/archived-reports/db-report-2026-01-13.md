# Supabase DB Report (2026-01-13)

**Fecha de generacion:** 2026-01-13 02:52:12 UTC
**Metodo:** consultas de solo lectura (pg_catalog / pg_stat_user_tables) via `psql` usando pooler de Supabase con SSL requerido.
**Alcance:** solo metadatos, tamanos y estadisticas. No se extrajo data de negocio ni se hicieron cambios.

## Resumen ejecutivo
- DB saludable en general (tamano reducido y extensiones estandar).
- Hallazgos a vigilar: RLS faltante en algunas tablas, porcentaje alto de tuplas muertas en varias, y varios seq scans elevados.

## Info general
- **DB:** `postgres`
- **Role:** `postgres`
- **PostgreSQL:** 17.6
- **Schemas:** 12
- **Tablas (no sistema):** 206
- **Tablas en `public`:** 160
- **Tamano total `public`:** ~33.0 MB

## Extensiones instaladas
`btree_gist`, `cube`, `earthdistance`, `http`, `hypopg`, `index_advisor`, `pg_cron`, `pg_graphql`, `pg_net`, `pg_stat_statements`, `pgcrypto`, `plpgsql`, `postgis`, `supabase_vault`, `uuid-ossp`

## Top tablas por tamano (estimado)
1. `conversion_events` — 8.6 MB, filas~20,674
2. `spatial_ref_sys` — 7.0 MB, filas~8,500
3. `monitoring_performance_metrics` — 4.6 MB, filas~18,612
4. `bookings` — 864 KB, filas~150
5. `pricing_cron_health` — 704 KB, filas~672
6. `vehicle_recognition_logs` — 616 KB, filas~1,091
7. `cars` — 528 KB, filas~29
8. `notifications` — 312 KB, filas~291

## RLS (Row Level Security)
- **RLS deshabilitado:**
  - `cars_fipe_history`
  - `spatial_ref_sys` (tabla de PostGIS, normalmente OK sin RLS)
- **Sin politicas definidas:**
  - `account_deletion_requests`
  - `cars_fipe_history`
  - `spatial_ref_sys`

## Mantenimiento (tuplas muertas altas)
- `p2p_orders`: 93.55% dead tuples
- `payment_captures_queue`: 76.92%
- `accounting_journal_entries`: 72.06%
- `driver_risk_profile`: 69.57%
- `user_bonus_malus`: 66.67%

## Seq scans altos (posibles indices o queries no selectivas)
- `bookings`: seq 344,657 / idx 857,109
- `cars`: seq 262,300 / idx 207,573
- `profiles`: seq 59,114 / idx 64,760
- `car_photos`: seq 39,321 / idx 230,515
- `user_bonus_malus`: seq 14,916 / idx 2,013

## Conclusiones
- **Estado general:** saludable, con oportunidades de optimizacion.
- **Riesgo inmediato:** bajo, salvo que `account_deletion_requests` deba estar protegido por RLS en produccion.

## Recomendaciones (siguientes pasos)
1. Revisar RLS para `account_deletion_requests` y `cars_fipe_history` si contienen datos sensibles.
2. Revisar queries mas comunes en `bookings`, `cars`, `profiles` y `user_bonus_malus` para validar indices.
3. Ejecutar analisis de bloat y autovacuum si el crecimiento de tuplas muertas se mantiene.

## Artefactos generados
- `/tmp/db_report/db_info.csv`
- `/tmp/db_report/schema_counts.csv`
- `/tmp/db_report/extensions.csv`
- `/tmp/db_report/public_table_sizes.csv`
- `/tmp/db_report/public_rls_policies.csv`
- `/tmp/db_report/public_dead_tuples.csv`
- `/tmp/db_report/public_seq_scans.csv`

> Nota: los CSVs estan en `/tmp/` y pueden borrarse al reiniciar o limpiar el entorno.
