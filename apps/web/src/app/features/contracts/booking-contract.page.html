<div class="contract-page-container">
  <!-- Header -->
  <div class="header">
    <a [routerLink]="['/bookings', bookingId()]" class="back-button">
      <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
      </svg>
      Volver al Booking
    </a>
    <h1 class="title font-bold font-satoshi">Contrato de Alquiler</h1>
    <p class="subtitle">Detalles del contrato para este booking</p>
  </div>

  <!-- Loading State -->
  @if (loading()) {
    <div class="loading-state">
      <div class="spinner"></div>
      <p>Cargando contrato...</p>
    </div>
  }

  <!-- Error State -->
  @if (error()) {
    <div class="alert alert-error">
      <svg class="alert-icon" fill="currentColor" viewBox="0 0 20 20">
        <path
          fill-rule="evenodd"
          d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z"
          clip-rule="evenodd"
          />
      </svg>
      {{ error() }}
    </div>
  }

  <!-- Main Content -->
  @if (!loading() && !error() && contract()) {
    <div class="content">
      <!-- Contract Status Card -->
      <div class="status-card">
        <div class="status-header">
          <div class="status-info">
            <h2 class="status-title font-bold font-satoshi">Estado del Contrato</h2>
            <span class="status-badge" [ngClass]="getStatusClass(contract()!.accepted_by_renter)">
              {{ getStatusText(contract()!.accepted_by_renter) }}
            </span>
          </div>
          @if (contract()!.accepted_by_renter) {
            <svg
              class="status-icon accepted"
              fill="currentColor"
              viewBox="0 0 20 20"
              >
              <path
                fill-rule="evenodd"
                d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z"
                clip-rule="evenodd"
                />
            </svg>
          }
          @if (!contract()!.accepted_by_renter) {
            <svg
              class="status-icon pending"
              fill="currentColor"
              viewBox="0 0 20 20"
              >
              <path
                fill-rule="evenodd"
                d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z"
                clip-rule="evenodd"
                />
            </svg>
          }
        </div>
        <div class="status-details">
          <div class="detail-row">
            <span class="detail-label">Booking ID:</span>
            <span class="detail-value">{{ bookingId().substring(0, 8) }}...</span>
          </div>
          <div class="detail-row">
            <span class="detail-label">Versión de Términos:</span>
            <span class="detail-value">{{ contract()!.terms_version }}</span>
          </div>
          <div class="detail-row">
            <span class="detail-label">Creado:</span>
            <span class="detail-value">{{ contract()!.created_at | date: 'dd/MM/yyyy HH:mm' }}</span>
          </div>
          @if (contract()!.accepted_at) {
            <div class="detail-row">
              <span class="detail-label">Aceptado:</span>
              <span class="detail-value">{{ contract()!.accepted_at | date: 'dd/MM/yyyy HH:mm' }}</span>
            </div>
          }
        </div>
        @if (!contract()!.accepted_by_renter) {
          <div class="status-notice">
            <svg class="notice-icon" fill="currentColor" viewBox="0 0 20 20">
              <path
                fill-rule="evenodd"
                d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z"
                clip-rule="evenodd"
                />
            </svg>
            <span>Este contrato debe ser firmado antes de confirmar el booking</span>
          </div>
        }
      </div>
      <!-- Booking Information -->
      @if (booking()) {
        <div class="booking-card">
          <h3 class="card-title font-bold font-satoshi">Información del Booking</h3>
          <div class="booking-details">
            <div class="detail-row">
              <span class="detail-label">Fecha de Inicio:</span>
              <span class="detail-value">{{ booking()!.start_date | date: 'dd/MM/yyyy' }}</span>
            </div>
            <div class="detail-row">
              <span class="detail-label">Fecha de Fin:</span>
              <span class="detail-value">{{ booking()!.end_date | date: 'dd/MM/yyyy' }}</span>
            </div>
            <div class="detail-row">
              <span class="detail-label">Precio Total:</span>
              <span class="detail-value">{{
                booking()!.total_price | currency: 'ARS' : 'symbol-narrow'
              }}</span>
            </div>
            <div class="detail-row">
              <span class="detail-label">Estado:</span>
              <span class="detail-value">{{ booking()!.status }}</span>
            </div>
          </div>
        </div>
      }
      <!-- PDF Viewer -->
      @if (contract()!.pdf_url) {
        <div class="pdf-section">
          <h3 class="section-title font-bold font-satoshi">Documento del Contrato</h3>
          <app-contract-pdf-viewer [pdfUrl]="contract()!.pdf_url || ''"></app-contract-pdf-viewer>
        </div>
      }
      <!-- No PDF Notice -->
      @if (!contract()!.pdf_url) {
        <div class="notice notice-info">
          <svg class="notice-icon" fill="currentColor" viewBox="0 0 20 20">
            <path
              fill-rule="evenodd"
              d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z"
              clip-rule="evenodd"
              />
          </svg>
          <div>
            <p class="notice-text">No hay documento PDF disponible</p>
            <p class="notice-hint">
              El contrato digital se generará automáticamente al confirmar el booking
            </p>
          </div>
        </div>
      }
      <!-- Actions -->
      <div class="actions">
        @if (contract()!.pdf_url) {
          <button
            type="button"
            class="btn-secondary"
            (click)="downloadContract()"
            >
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"
                />
            </svg>
            Descargar PDF
          </button>
        }
      </div>
    </div>
  }
</div>
