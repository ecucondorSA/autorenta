<div
  class="wallet-page min-h-screen bg-surface-base py-4 sm:py-6 md:py-section-sm"
>
  <div class="container-page px-3 sm:px-4 md:px-container space-y-6 sm:space-y-8 md:space-y-10">
    <!-- Error Alert -->
    @if (walletError(); as error) {
      <div
        class="bg-error-bg border border-error-border rounded-lg p-4 transition-colors duration-300"
      >
        <div class="flex items-start space-x-3">
          <svg class="w-6 h-6 text-error-text flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
            <path
              fill-rule="evenodd"
              d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z"
              clip-rule="evenodd"
            />
          </svg>
          <div class="flex-1">
            <p class="text-sm font-medium text-error-strong">Error al cargar el wallet</p>
            <p class="mt-1 text-sm text-error-strong">{{ error.message }}</p>
            <button
              type="button"
              (click)="refreshWalletData()"
              class="mt-2 text-sm font-medium text-error-strong hover:text-error-strong underline"
            >
              Reintentar
            </button>
          </div>
        </div>
      </div>
    }

    <!-- ============================================ -->
    <!-- SECCIÓN 1: HERO - TU ESTADO EN EL CLUB -->
    <!-- ============================================ -->
    <section class="rounded-2xl sm:rounded-3xl overflow-hidden">
      @if (subscriptionService.subscription(); as subscription) {
        <!-- MIEMBRO ACTIVO: Tarjeta Premium de Membresía -->
        <div class="relative bg-gradient-to-br from-amber-900 via-amber-800 to-yellow-900 p-6 sm:p-8 md:p-10">
          <!-- Patrón decorativo de fondo -->
          <div class="absolute inset-0 opacity-10">
            <svg class="w-full h-full" viewBox="0 0 400 400" preserveAspectRatio="xMidYMid slice">
              <defs>
                <pattern id="club-pattern" x="0" y="0" width="40" height="40" patternUnits="userSpaceOnUse">
                  <path d="M0 20h40M20 0v40" stroke="currentColor" stroke-width="0.5" fill="none"/>
                </pattern>
              </defs>
              <rect width="100%" height="100%" fill="url(#club-pattern)"/>
            </svg>
          </div>

          <div class="relative z-10">
            <!-- Header con Badge de Tier -->
            <div class="flex flex-col sm:flex-row sm:items-start sm:justify-between gap-4 mb-6">
              <div>
                <div class="flex items-center gap-3 mb-2">
                  <span class="inline-flex items-center gap-1.5 px-3 py-1.5 rounded-full text-xs font-bold uppercase tracking-wider"
                    [ngClass]="{
                      'bg-amber-400/20 text-amber-200 border border-amber-400/40': subscription.tier === 'club_standard',
                      'bg-slate-700/50 text-slate-100 border border-slate-400/40': subscription.tier === 'club_black'
                    }">
                    <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24">
                      <path d="M12 2L15.09 8.26L22 9.27L17 14.14L18.18 21.02L12 17.77L5.82 21.02L7 14.14L2 9.27L8.91 8.26L12 2Z"/>
                    </svg>
                    {{ subscription.tier === 'club_standard' ? 'Club Estándar' : 'Club Black' }}
                  </span>
                  <span class="inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-semibold bg-emerald-500/20 text-emerald-300 border border-emerald-500/30">
                    <span class="w-1.5 h-1.5 rounded-full bg-emerald-400 animate-pulse"></span>
                    Activo
                  </span>
                </div>
                <h1 class="text-2xl sm:text-3xl md:text-4xl font-bold text-amber-50 tracking-tight">
                  Autorentar Club
                </h1>
                <p class="text-amber-200/80 mt-1 text-sm sm:text-base">
                  Tu cobertura premium está activa
                </p>
              </div>
              <div class="flex gap-2">
                <button
                  type="button"
                  (click)="handleViewClubHistory()"
                  class="inline-flex items-center gap-1.5 px-4 py-2 rounded-lg text-sm font-medium bg-amber-50/10 text-amber-100 hover:bg-amber-50/20 border border-amber-400/30 transition"
                >
                  <app-icon name="clock" [size]="16" />
                  Historial
                </button>
              </div>
            </div>

            <!-- Métricas principales -->
            <div class="grid gap-4 sm:grid-cols-3 mb-6">
              <!-- Saldo de Cobertura -->
              <div class="bg-black/20 backdrop-blur-sm rounded-xl p-4 border border-amber-400/20">
                <p class="text-xs uppercase tracking-wider text-amber-300/70 font-semibold mb-1">
                  Saldo Cobertura
                </p>
                <p class="text-3xl sm:text-4xl font-bold text-amber-50">
                  ${{ (subscription.remaining_balance_cents / 100) | number:'1.0-0' }}
                </p>
                <div class="mt-3">
                  <div class="flex justify-between text-xs text-amber-200/60 mb-1">
                    <span>Disponible</span>
                    <span>{{ ((subscription.remaining_balance_cents / subscription.coverage_limit_cents) * 100) | number:'1.0-0' }}%</span>
                  </div>
                  <div class="w-full bg-amber-950/50 rounded-full h-2">
                    <div
                      class="bg-gradient-to-r from-amber-400 to-yellow-300 h-2 rounded-full transition-all"
                      [style.width.%]="(subscription.remaining_balance_cents / subscription.coverage_limit_cents) * 100"
                    ></div>
                  </div>
                </div>
              </div>

              <!-- Días Restantes -->
              <div class="bg-black/20 backdrop-blur-sm rounded-xl p-4 border border-amber-400/20">
                <p class="text-xs uppercase tracking-wider text-amber-300/70 font-semibold mb-1">
                  Vigencia
                </p>
                <p class="text-3xl sm:text-4xl font-bold text-amber-50">
                  {{ getDaysRemaining(subscription.expires_at) }}
                </p>
                <p class="text-sm text-amber-200/60 mt-1">días restantes</p>
                <p class="text-xs text-amber-300/50 mt-2">
                  Vence: {{ subscription.expires_at | date:'dd MMM yyyy' }}
                </p>
              </div>

              <!-- Límite Total -->
              <div class="bg-black/20 backdrop-blur-sm rounded-xl p-4 border border-amber-400/20">
                <p class="text-xs uppercase tracking-wider text-amber-300/70 font-semibold mb-1">
                  Límite de Plan
                </p>
                <p class="text-3xl sm:text-4xl font-bold text-amber-50">
                  ${{ (subscription.coverage_limit_cents / 100) | number:'1.0-0' }}
                </p>
                <p class="text-sm text-amber-200/60 mt-1">cobertura total</p>
                <p class="text-xs text-amber-300/50 mt-2">
                  Usado: ${{ ((subscription.coverage_limit_cents - subscription.remaining_balance_cents) / 100) | number:'1.0-0' }}
                </p>
              </div>
            </div>

            <!-- Acciones rápidas de membresía -->
            <div class="flex flex-wrap gap-3">
              @if (subscription.remaining_balance_cents < subscription.coverage_limit_cents * 0.3) {
                <button
                  type="button"
                  (click)="handleRechargeClub()"
                  class="inline-flex items-center gap-2 px-5 py-3 rounded-xl font-bold text-sm bg-amber-400 text-amber-950 hover:bg-amber-300 transition shadow-lg"
                >
                  <app-icon name="plus" [size]="18" />
                  Recargar Cobertura
                </button>
              }
              @if (getDaysRemaining(subscription.expires_at) <= 30) {
                <button
                  type="button"
                  (click)="handleRenewClub()"
                  class="inline-flex items-center gap-2 px-5 py-3 rounded-xl font-bold text-sm bg-emerald-500 text-white hover:bg-emerald-400 transition shadow-lg"
                >
                  <app-icon name="refresh-cw" [size]="18" />
                  Renovar Membresía
                </button>
              }
              <button
                type="button"
                (click)="handleViewClubPlans()"
                class="inline-flex items-center gap-2 px-5 py-3 rounded-xl font-medium text-sm border-2 border-amber-400/40 text-amber-100 hover:bg-amber-400/10 transition"
              >
                Ver Planes
                <app-icon name="chevron-right" [size]="16" />
              </button>
            </div>
          </div>
        </div>
      } @else {
        <!-- NO MIEMBRO: Banner Promocional -->
        <div class="relative bg-gradient-to-br from-cta-default/10 via-amber-500/5 to-yellow-500/10 p-6 sm:p-8 md:p-10 border-2 border-cta-default/30">
          <!-- Patrón decorativo -->
          <div class="absolute top-0 right-0 w-64 h-64 opacity-5">
            <svg viewBox="0 0 200 200" fill="currentColor" class="w-full h-full text-cta-default">
              <path d="M100 0L123.51 76.49L200 100L123.51 123.51L100 200L76.49 123.51L0 100L76.49 76.49L100 0Z"/>
            </svg>
          </div>

          <div class="relative z-10 grid gap-6 lg:grid-cols-5 items-center">
            <div class="lg:col-span-3 space-y-4">
              <div class="flex items-center gap-2 flex-wrap">
                <span class="inline-flex items-center gap-1.5 px-3 py-1.5 rounded-full text-xs font-bold uppercase tracking-wider bg-cta-default/20 text-cta-default border border-cta-default/40">
                  <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24">
                    <path d="M12 2L15.09 8.26L22 9.27L17 14.14L18.18 21.02L12 17.77L5.82 21.02L7 14.14L2 9.27L8.91 8.26L12 2Z"/>
                  </svg>
                  Nuevo
                </span>
                <span class="text-xs font-medium text-text-secondary">
                  Ahorra hasta 100% en depósitos
                </span>
              </div>

              <h1 class="text-2xl sm:text-3xl md:text-4xl font-bold text-text-primary tracking-tight">
                Autorentar Club
              </h1>
              <p class="text-base sm:text-lg text-text-secondary max-w-xl">
                Paga una membresía anual y <strong class="text-cta-default">olvídate de los depósitos</strong>.
                Tu cobertura cubre la franquicia automáticamente.
              </p>

              <!-- Beneficios rápidos -->
              <div class="flex flex-wrap gap-3 text-sm">
                <span class="inline-flex items-center gap-1.5 px-3 py-1.5 rounded-lg bg-emerald-500/10 text-emerald-700 border border-emerald-500/20">
                  <app-icon name="check" [size]="14" />
                  Depósito $0
                </span>
                <span class="inline-flex items-center gap-1.5 px-3 py-1.5 rounded-lg bg-blue-500/10 text-blue-700 border border-blue-500/20">
                  <app-icon name="check" [size]="14" />
                  Sin tarjeta internacional
                </span>
                <span class="inline-flex items-center gap-1.5 px-3 py-1.5 rounded-lg bg-purple-500/10 text-purple-700 border border-purple-500/20">
                  <app-icon name="check" [size]="14" />
                  Reservas ilimitadas
                </span>
              </div>
            </div>

            <div class="lg:col-span-2 space-y-4">
              <!-- Precios compactos -->
              <div class="grid gap-3 sm:grid-cols-2">
                <div class="bg-surface-raised rounded-xl p-4 border border-border-default/50">
                  <p class="text-xs font-semibold text-text-secondary uppercase tracking-wider mb-1">Estándar</p>
                  <p class="text-2xl font-bold text-text-primary">$300<span class="text-sm font-normal text-text-secondary">/año</span></p>
                  <p class="text-xs text-text-secondary mt-1">Cobertura: $500</p>
                </div>
                <div class="bg-gradient-to-br from-slate-800 to-slate-900 rounded-xl p-4 border border-slate-600/50">
                  <p class="text-xs font-semibold text-slate-300 uppercase tracking-wider mb-1">Black</p>
                  <p class="text-2xl font-bold text-white">$600<span class="text-sm font-normal text-slate-400">/año</span></p>
                  <p class="text-xs text-slate-400 mt-1">Cobertura: $1,000</p>
                </div>
              </div>

              <!-- CTA Principal -->
              <button
                type="button"
                (click)="handleViewClubPlans()"
                class="w-full inline-flex items-center justify-center gap-2 px-6 py-4 rounded-xl font-bold text-base bg-cta-default text-cta-text hover:bg-cta-default/90 transition shadow-lg hover:shadow-xl transform hover:scale-[1.02]"
              >
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                  <path d="M12 2L15.09 8.26L22 9.27L17 14.14L18.18 21.02L12 17.77L5.82 21.02L7 14.14L2 9.27L8.91 8.26L12 2Z"/>
                </svg>
                Unirse al Club
                <app-icon name="chevron-right" [size]="18" />
              </button>
              <p class="text-center text-xs text-text-secondary">
                Cancela cuando quieras. Sin compromisos.
              </p>
            </div>
          </div>
        </div>
      }
    </section>

    <!-- ============================================ -->
    <!-- SECCIÓN 2: SALDO CASH (SECUNDARIA) -->
    <!-- ============================================ -->
    <section class="rounded-2xl sm:rounded-3xl border border-border-default/50 bg-surface-raised p-4 sm:p-6 md:p-8">
      <!-- Header compacto -->
      <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 mb-6">
        <div>
          <div class="flex items-center gap-2 mb-1">
            <svg class="w-5 h-5 text-success-strong" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z" stroke-width="1.75" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            <p class="text-xs uppercase tracking-widest text-text-secondary font-semibold">
              Saldo Cash
            </p>
          </div>
          <h2 class="text-xl sm:text-2xl font-bold text-text-primary">
            Tu Billetera
          </h2>
        </div>
        <div class="flex gap-2">
          <button
            type="button"
            (click)="openDepositModal()"
            class="inline-flex items-center gap-1.5 px-4 py-2 rounded-lg text-sm font-semibold bg-cta-default text-cta-text hover:bg-cta-default/90 transition"
            data-testid="deposit-button-hero"
          >
            <app-icon name="plus" [size]="16" />
            Depositar
          </button>
          <button
            type="button"
            (click)="goToTransfer()"
            class="inline-flex items-center gap-1.5 px-4 py-2 rounded-lg text-sm font-semibold border border-border-default text-text-secondary hover:bg-surface-secondary/50 transition"
          >
            <app-icon name="arrow-right-left" [size]="16" />
            Transferir
          </button>
        </div>
      </div>

      <!-- Grid de balances compacto -->
      <div class="grid gap-4 sm:grid-cols-2 lg:grid-cols-4">
        <!-- Balance Total -->
        <div
          class="bg-gradient-to-br from-success-light/10 to-success-light/5 rounded-xl p-4 border border-success-light/30"
          data-tour-step="wallet-balance"
        >
          <p class="text-xs uppercase tracking-wider text-success-strong/80 font-semibold mb-1">Disponible</p>
          <p class="text-2xl sm:text-3xl font-bold text-success-strong">
            ${{ availableBalanceSummary() | number:'1.2-2' }}
          </p>
        </div>

        <!-- Crédito Protegido -->
        <div class="bg-gradient-to-br from-warning-bg/30 to-warning-bg/10 rounded-xl p-4 border border-warning-border/50">
          <div class="flex items-center justify-between mb-1">
            <p class="text-xs uppercase tracking-wider text-warning-strong/80 font-semibold">Protegido</p>
            <app-icon name="lock" [size]="14" cssClass="text-warning-strong/60" />
          </div>
          <p class="text-2xl sm:text-3xl font-bold text-warning-strong">
            ${{ protectedCreditBalance() | number:'1.2-2' }}
          </p>
          <div class="mt-2 w-full bg-warning-border/30 rounded-full h-1.5">
            <div
              class="bg-warning-strong h-1.5 rounded-full transition-all"
              [style.width.%]="protectedCreditProgress()"
            ></div>
          </div>
        </div>

        <!-- Transferible -->
        <div class="bg-surface-secondary/50 rounded-xl p-4 border border-border-default/50">
          <div class="flex items-center justify-between mb-1">
            <p class="text-xs uppercase tracking-wider text-text-secondary font-semibold">Transferible</p>
            <app-icon name="arrow-right-left" [size]="14" cssClass="text-text-secondary/60" />
          </div>
          <p class="text-2xl sm:text-3xl font-bold text-text-primary">
            ${{ transferableBalance() | number:'1.2-2' }}
          </p>
        </div>

        <!-- Retirable -->
        <div class="bg-surface-secondary/50 rounded-xl p-4 border border-border-default/50">
          <div class="flex items-center justify-between mb-1">
            <p class="text-xs uppercase tracking-wider text-text-secondary font-semibold">Retirable</p>
            <app-icon name="arrow-up" [size]="14" cssClass="text-text-secondary/60" />
          </div>
          <p class="text-2xl sm:text-3xl font-bold text-text-primary">
            ${{ withdrawableBalance() | number:'1.2-2' }}
          </p>
        </div>
      </div>

      <!-- Depósitos pendientes -->
      @if (pendingDepositsCount() > 0) {
        <div class="mt-4 flex items-center gap-2 text-sm text-warning-strong bg-warning-bg/30 rounded-lg px-4 py-3 border border-warning-border/50">
          <app-icon name="clock" [size]="16" cssClass="animate-pulse" />
          <span>{{ pendingDepositsCount() }} depósito(s) pendiente(s) de acreditación</span>
          <button
            type="button"
            (click)="refreshWalletData()"
            class="ml-auto text-xs font-semibold underline hover:no-underline"
          >
            Actualizar
          </button>
        </div>
      }

      <!-- WAN Card compacto -->
      @if (walletAccountNumber()) {
        <div class="mt-4 bg-surface-base rounded-lg p-4 border border-border-default/30">
          <div class="flex items-center justify-between">
            <div>
              <p class="text-xs text-text-secondary mb-0.5">Tu número de cuenta Autorentar</p>
              <p class="text-lg font-mono font-bold text-text-primary tracking-wider">
                {{ walletAccountNumber() }}
              </p>
            </div>
            <button
              type="button"
              (click)="copyWalletAccountNumber()"
              class="inline-flex items-center gap-1.5 px-3 py-1.5 rounded-lg text-xs font-medium bg-cta-default/10 text-cta-default hover:bg-cta-default/20 transition"
            >
              @if (copied()) {
                <app-icon name="check" [size]="14" />
                Copiado
              } @else {
                <app-icon name="copy" [size]="14" />
                Copiar
              }
            </button>
          </div>
        </div>
      }
    </section>

    <!-- ============================================ -->
    <!-- SECCIÓN 3: HISTORIAL UNIFICADO -->
    <!-- ============================================ -->
    <section class="rounded-2xl sm:rounded-3xl border border-border-default/50 bg-surface-raised p-4 sm:p-6 md:p-8">
      <!-- Header con Tabs -->
      <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4 pb-4 sm:pb-6 border-b border-border-default/30">
        <div>
          <h2 class="text-xl sm:text-2xl font-bold text-text-primary">
            Historial de Movimientos
          </h2>
          <p class="text-sm text-text-secondary mt-1 hidden sm:block">
            Todos tus movimientos en un solo lugar
          </p>
        </div>

        <!-- Tabs -->
        <div class="flex gap-1 p-1 bg-surface-base rounded-lg border border-border-default/50 overflow-x-auto">
          <button
            type="button"
            (click)="setActiveTab('transactions')"
            [ngClass]="{
              'bg-cta-default/15 text-cta-default border-cta-default/30': activeTab() === 'transactions',
              'text-text-secondary hover:text-text-primary hover:bg-surface-secondary/50 border-transparent': activeTab() !== 'transactions'
            }"
            class="px-4 py-2 text-sm font-medium rounded-md border transition whitespace-nowrap"
          >
            <app-icon name="list" [size]="14" cssClass="inline-block mr-1.5" />
            Transacciones
          </button>
          <button
            type="button"
            (click)="setActiveTab('transfers')"
            [ngClass]="{
              'bg-cta-default/15 text-cta-default border-cta-default/30': activeTab() === 'transfers',
              'text-text-secondary hover:text-text-primary hover:bg-surface-secondary/50 border-transparent': activeTab() !== 'transfers'
            }"
            class="px-4 py-2 text-sm font-medium rounded-md border transition whitespace-nowrap"
          >
            <app-icon name="arrow-right-left" [size]="14" cssClass="inline-block mr-1.5" />
            Transferencias
          </button>
          <button
            type="button"
            (click)="setActiveTab('withdrawals')"
            [ngClass]="{
              'bg-cta-default/15 text-cta-default border-cta-default/30': activeTab() === 'withdrawals',
              'text-text-secondary hover:text-text-primary hover:bg-surface-secondary/50 border-transparent': activeTab() !== 'withdrawals'
            }"
            class="px-4 py-2 text-sm font-medium rounded-md border transition whitespace-nowrap"
            data-tour-step="withdraw-button"
          >
            <app-icon name="arrow-up" [size]="14" cssClass="inline-block mr-1.5" />
            Retiros
          </button>
          @if (subscriptionService.subscription()) {
            <button
              type="button"
              (click)="setActiveTab('coverage')"
              [ngClass]="{
                'bg-amber-500/15 text-amber-600 border-amber-500/30': activeTab() === 'coverage',
                'text-text-secondary hover:text-text-primary hover:bg-surface-secondary/50 border-transparent': activeTab() !== 'coverage'
              }"
              class="px-4 py-2 text-sm font-medium rounded-md border transition whitespace-nowrap"
            >
              <app-icon name="shield" [size]="14" cssClass="inline-block mr-1.5" />
              Cobertura
            </button>
          }
        </div>
      </div>

      <!-- Tab Content -->
      <div class="mt-6">
        @if (activeTab() === 'transactions') {
          <app-transaction-history></app-transaction-history>
        }

        @if (activeTab() === 'transfers') {
          <app-wallet-transfers></app-wallet-transfers>
        }

        @if (activeTab() === 'withdrawals') {
          <div class="space-y-6">
            <div class="flex items-center justify-between mb-2">
              <h3 class="text-lg font-semibold text-text-primary font-satoshi">
                Gestión de Retiros
              </h3>
              <div class="flex gap-2">
                <button
                  type="button"
                  (click)="setWithdrawalMode('form')"
                  [ngClass]="{
                    'bg-cta-default text-cta-text': withdrawalMode() === 'form',
                    'text-text-secondary hover:bg-surface-secondary/50': withdrawalMode() !== 'form'
                  }"
                  class="px-3 py-2 text-sm font-medium rounded-lg transition"
                >
                  Solicitar retiro
                </button>
                <button
                  type="button"
                  (click)="setWithdrawalMode('accounts')"
                  [ngClass]="{
                    'bg-cta-default text-cta-text': withdrawalMode() === 'accounts',
                    'text-text-secondary hover:bg-surface-secondary/50': withdrawalMode() !== 'accounts'
                  }"
                  class="px-3 py-2 text-sm font-medium rounded-lg transition"
                >
                  Cuentas bancarias
                </button>
              </div>
            </div>

            @if (withdrawalMode() === 'form') {
              <div class="space-y-6">
                <app-withdrawal-request-form
                  [availableBalance]="availableBalanceSummary()"
                  [withdrawableBalance]="withdrawableBalance()"
                  [nonWithdrawableBalance]="protectedCreditBalance()"
                  [accounts]="activeBankAccounts()"
                  (submitWithdrawal)="handleWithdrawalRequest($event)"
                ></app-withdrawal-request-form>

                @if (activeBankAccounts().length === 0) {
                  <div class="bg-warning-bg/30 border border-warning-border/50 rounded-lg p-4">
                    <div class="flex items-start gap-3">
                      <app-icon name="alert-triangle" [size]="20" cssClass="text-warning-strong mt-0.5 flex-shrink-0" />
                      <div>
                        <p class="text-sm text-text-primary">
                          Aún no registraste cuentas bancarias.
                        </p>
                        <button
                          type="button"
                          (click)="setWithdrawalMode('accounts')"
                          class="mt-2 text-sm font-medium text-warning-strong underline hover:no-underline transition"
                        >
                          Agregar cuenta bancaria
                        </button>
                      </div>
                    </div>
                  </div>
                }

                <div class="border-t border-border-default pt-6">
                  <app-withdrawal-history
                    [requests]="withdrawalRequests()"
                    [loading]="loading().fetchingRequests"
                    (cancelRequest)="handleCancelWithdrawal($event)"
                    (refresh)="handleRefreshWithdrawals()"
                  ></app-withdrawal-history>
                </div>
              </div>
            }

            @if (withdrawalMode() === 'accounts') {
              <div class="space-y-6">
                <app-bank-accounts-list
                  [accounts]="bankAccounts()"
                  [loading]="loading().fetchingBankAccounts"
                  (setDefault)="handleSetDefaultAccount($event)"
                  (deleteAccount)="handleDeleteAccount($event)"
                ></app-bank-accounts-list>

                <div class="border-t border-border-default pt-6">
                  <h4 class="text-base font-semibold mb-4 font-satoshi">Agregar nueva cuenta</h4>
                  <app-bank-account-form
                    (submitAccount)="handleAddBankAccount($event)"
                  ></app-bank-account-form>
                </div>
              </div>
            }
          </div>
        }

        @if (activeTab() === 'coverage' && subscriptionService.subscription()) {
          <!-- Tab de Cobertura del Club -->
          <div class="space-y-6">
            <div class="bg-amber-50/50 rounded-xl p-6 border border-amber-200/50">
              <div class="flex items-start gap-4">
                <div class="flex-shrink-0 w-12 h-12 rounded-full bg-amber-100 flex items-center justify-center">
                  <app-icon name="shield" [size]="24" cssClass="text-amber-600" />
                </div>
                <div class="flex-1">
                  <h3 class="text-lg font-semibold text-amber-900">
                    Historial de uso de cobertura
                  </h3>
                  <p class="text-sm text-amber-700 mt-1">
                    Aquí verás las deducciones realizadas de tu saldo de cobertura por daños o claims.
                  </p>
                </div>
                <button
                  type="button"
                  (click)="handleViewClubHistory()"
                  class="inline-flex items-center gap-1.5 px-4 py-2 rounded-lg text-sm font-medium bg-amber-100 text-amber-700 hover:bg-amber-200 transition"
                >
                  Ver completo
                  <app-icon name="external-link" [size]="14" />
                </button>
              </div>
            </div>

            <!-- Placeholder para historial de cobertura -->
            <div class="text-center py-12 text-text-secondary">
              <app-icon name="shield-check" [size]="48" cssClass="mx-auto mb-4 text-success-strong/30" />
              <p class="text-lg font-medium">Sin deducciones registradas</p>
              <p class="text-sm mt-1">Tu cobertura no ha sido utilizada aún. ¡Excelente!</p>
            </div>
          </div>
        }
      </div>
    </section>

    <!-- ============================================ -->
    <!-- SECCIÓN AYUDA -->
    <!-- ============================================ -->
    <section>
      <app-wallet-faq></app-wallet-faq>
    </section>

    <section class="text-center pb-4">
      <p class="text-sm text-text-secondary">
        ¿Necesitas ayuda?
        <a
          href="mailto:autorentardev@gmail.com"
          class="text-cta-default hover:text-cta-default/80 font-semibold ml-1 transition"
        >Contacta a soporte</a>
      </p>
    </section>
  </div>
</div>
