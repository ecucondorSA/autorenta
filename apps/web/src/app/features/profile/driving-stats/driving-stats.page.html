<div class="driving-stats-page">
  <!-- Header -->
  <div class="page-header">
    <button class="back-button" (click)="goBack()">
      <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
      </svg>
    </button>
    <div>
      <h1 class="page-title">Estad√≠sticas de Conducci√≥n</h1>
      <p class="page-subtitle">Tu score y m√©tricas de manejo</p>
    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="loading()" class="loading-container">
    <div class="loading-spinner"></div>
    <p class="loading-text">Cargando estad√≠sticas...</p>
  </div>

  <!-- Empty State -->
  <div *ngIf="!loading() && !hasData()" class="empty-state">
    <svg class="empty-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path
        stroke-linecap="round"
        stroke-linejoin="round"
        stroke-width="2"
        d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"
      />
    </svg>
    <h3 class="empty-title">Sin datos de telemetr√≠a</h3>
    <p class="empty-description">
      Realiza tu primer viaje para empezar a recopilar estad√≠sticas de conducci√≥n
    </p>
  </div>

  <!-- Main Content -->
  <div *ngIf="!loading() && hasData()" class="stats-content">
    <!-- Score Card -->
    <div class="score-section">
      <div class="score-card" [ngClass]="scoreColor()">
        <div class="score-header">
          <h2 class="score-title">Tu Score de Conducci√≥n</h2>
          <div class="score-trend" [ngClass]="trendColor()">
            <span class="trend-icon">{{ trendIcon() }}</span>
            <span class="trend-label">{{ trendLabel() }}</span>
          </div>
        </div>

        <div class="score-display">
          <div class="score-circle">
            <svg class="score-ring" viewBox="0 0 120 120">
              <circle
                class="score-ring-bg"
                cx="60"
                cy="60"
                r="54"
                fill="none"
                stroke-width="8"
              ></circle>
              <circle
                class="score-ring-fill"
                cx="60"
                cy="60"
                r="54"
                fill="none"
                stroke-width="8"
                [attr.stroke-dasharray]="339.292"
                [attr.stroke-dashoffset]="339.292 - (339.292 * currentScore()) / 100"
              ></circle>
            </svg>
            <div class="score-value">
              <span class="score-number">{{ currentScore() }}</span>
              <span class="score-max">/100</span>
            </div>
          </div>

          <div class="score-info">
            <div class="score-label-large">{{ scoreLabel() }}</div>
            <p class="score-description">
              Basado en {{ summary()?.total_trips || 0 }} viajes en los √∫ltimos 3 meses
            </p>
          </div>
        </div>
      </div>
    </div>

    <!-- Metrics Grid -->
    <div class="metrics-section">
      <h3 class="section-title">M√©tricas Detalladas</h3>

      <div class="metrics-grid">
        <!-- Total KM -->
        <div class="metric-card">
          <div class="metric-icon">üìè</div>
          <div class="metric-content">
            <div class="metric-value">{{ summary()?.total_km?.toFixed(0) || 0 }}</div>
            <div class="metric-label">Kil√≥metros</div>
          </div>
        </div>

        <!-- Hard Brakes -->
        <div class="metric-card">
          <div class="metric-icon">üõë</div>
          <div class="metric-content">
            <div class="metric-value">{{ summary()?.total_hard_brakes || 0 }}</div>
            <div class="metric-label">Frenadas Bruscas</div>
          </div>
        </div>

        <!-- Speed Violations -->
        <div class="metric-card">
          <div class="metric-icon">‚ö°</div>
          <div class="metric-content">
            <div class="metric-value">{{ summary()?.total_speed_violations || 0 }}</div>
            <div class="metric-label">Excesos de Velocidad</div>
          </div>
        </div>

        <!-- Night Driving -->
        <div class="metric-card">
          <div class="metric-icon">üåô</div>
          <div class="metric-content">
            <div class="metric-value">{{ summary()?.total_night_hours?.toFixed(1) || 0 }}</div>
            <div class="metric-label">Horas Nocturnas</div>
          </div>
        </div>

        <!-- Risk Zones -->
        <div class="metric-card">
          <div class="metric-icon">‚ö†Ô∏è</div>
          <div class="metric-content">
            <div class="metric-value">{{ summary()?.total_risk_zones || 0 }}</div>
            <div class="metric-label">Zonas de Riesgo</div>
          </div>
        </div>

        <!-- Total Trips -->
        <div class="metric-card">
          <div class="metric-icon">üöó</div>
          <div class="metric-content">
            <div class="metric-value">{{ summary()?.total_trips || 0 }}</div>
            <div class="metric-label">Viajes Totales</div>
          </div>
        </div>
      </div>
    </div>

    <!-- Insights Section -->
    <div *ngIf="insights()" class="insights-section">
      <h3 class="section-title">Recomendaciones</h3>

      <div class="insights-card">
        <div class="insight-item">
          <div class="insight-icon">{{ getMainIssueIcon(insights()!.main_issue) }}</div>
          <div class="insight-content">
            <div class="insight-label">Principal √°rea de mejora</div>
            <div class="insight-value">{{ insights()!.main_issue }}</div>
          </div>
        </div>

        <div class="insight-item">
          <div class="insight-icon">üí°</div>
          <div class="insight-content">
            <div class="insight-label">Recomendaci√≥n</div>
            <div class="insight-value">{{ insights()!.recommendation }}</div>
          </div>
        </div>
      </div>
    </div>

    <!-- Trip History -->
    <div class="history-section">
      <h3 class="section-title">Historial de Viajes</h3>

      <div *ngIf="history().length === 0" class="empty-history">
        <p>No hay historial de viajes disponible</p>
      </div>

      <div class="history-list" *ngIf="history().length > 0">
        <div
          *ngFor="let trip of history()"
          class="trip-card"
          (click)="viewTripDetails(trip.booking_id)"
        >
          <div class="trip-header">
            <div class="trip-info">
              <div class="trip-car">
                {{ trip.car_brand }} {{ trip.car_model }}
              </div>
              <div class="trip-date">{{ formatDate(trip.trip_date) }}</div>
            </div>

            <div class="trip-score" [ngClass]="getTripScoreColor(trip.driver_score)">
              {{ trip.driver_score }}/100
            </div>
          </div>

          <div class="trip-metrics">
            <div class="trip-metric">
              <span class="metric-icon-small">üìè</span>
              {{ trip.total_km.toFixed(1) }} km
            </div>
            <div class="trip-metric" *ngIf="trip.hard_brakes > 0">
              <span class="metric-icon-small">üõë</span>
              {{ trip.hard_brakes }} frenadas
            </div>
            <div class="trip-metric" *ngIf="trip.speed_violations > 0">
              <span class="metric-icon-small">‚ö°</span>
              {{ trip.speed_violations }} excesos
            </div>
            <div class="trip-metric" *ngIf="trip.night_driving_hours > 0">
              <span class="metric-icon-small">üåô</span>
              {{ trip.night_driving_hours.toFixed(1) }} h
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
