<div class="settings-page">
  <!-- Header -->
  <div class="page-header">
    <button class="back-button" (click)="goBack()">
      <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
      </svg>
    </button>
    <div>
      <h1 class="page-title font-bold font-satoshi">Configuración de Notificaciones</h1>
      <p class="page-subtitle">Personaliza cómo y cuándo recibir notificaciones</p>
    </div>
  </div>

  <!-- Browser Push Notifications -->
  <div class="settings-section">
    <div class="section-header">
      <div>
        <h2 class="section-title font-bold font-satoshi">Notificaciones Push del Navegador</h2>
        <p class="section-description">
          Recibe notificaciones en tiempo real incluso cuando no estés en la app
        </p>
      </div>
    </div>

    <div class="setting-item">
      <div class="setting-info">
        <div class="setting-icon">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path
              d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"
              stroke-width="1.75"
              stroke-linecap="round"
              stroke-linejoin="round"
            />
            <path d="M13.73 21a2 2 0 0 1-3.46 0" stroke-width="1.75" />
          </svg>
        </div>
        <div>
          <h3 class="setting-title font-bold font-satoshi">Habilitar notificaciones push</h3>
          <p class="setting-description">
            Estado:
            <span
              [class]="
                settings().browserPushPermission === 'granted'
                  ? 'status-granted'
                  : settings().browserPushPermission === 'denied'
                    ? 'status-denied'
                    : 'status-default'
              "
            >
              {{
                settings().browserPushPermission === 'granted'
                  ? 'Permitido'
                  : settings().browserPushPermission === 'denied'
                    ? 'Bloqueado'
                    : 'Sin configurar'
              }}
            </span>
          </p>
        </div>
      </div>
      <label class="toggle-switch">
        <input
          type="checkbox"
          [checked]="settings().browserPushEnabled"
          [disabled]="settings().browserPushPermission === 'denied'"
          (change)="toggleBrowserPush()"
        />
        <span class="toggle-slider"></span>
      </label>
    </div>

    @if (settings().browserPushPermission === 'denied') {
      <div class="alert alert-warning">
        <svg class="alert-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"
          />
        </svg>
        <div>
          <p class="alert-text">
            Las notificaciones push están bloqueadas en tu navegador.
            <button class="alert-link" (click)="openBrowserSettings()">
              Ver cómo cambiar esto
            </button>
          </p>
        </div>
      </div>
    }
  </div>

  <!-- Notification Types -->
  <div class="settings-section">
    <div class="section-header">
      <h2 class="section-title font-bold font-satoshi">Tipos de Notificaciones</h2>
      <p class="section-description">Elige qué notificaciones quieres recibir</p>
    </div>

    <div class="setting-item">
      <div class="setting-info">
        <div class="setting-icon">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <rect x="3" y="4" width="18" height="18" rx="2" stroke-width="1.75" />
            <path d="M3 10h18M8 2v4M16 2v4" stroke-width="1.75" stroke-linecap="round" />
          </svg>
        </div>
        <div>
          <h3 class="setting-title font-bold font-satoshi">Actualizaciones de reservas</h3>
          <p class="setting-description">
            Nuevas reservas, aprobaciones, cancelaciones, recordatorios
          </p>
        </div>
      </div>
      <label class="toggle-switch">
        <input type="checkbox" [(ngModel)]="settings().bookingUpdates" (change)="saveSettings()" />
        <span class="toggle-slider"></span>
      </label>
    </div>

    <div class="setting-item">
      <div class="setting-info">
        <div class="setting-icon">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path
              d="M6 10c0-1 1-2 2-3l1-2h6l1 2c1 1 2 2 2 3v8a2 2 0 0 1-2 2H8a2 2 0 0 1-2-2v-8z"
              stroke-width="1.75"
              stroke-linejoin="round"
            />
            <path d="M9 5h6" stroke-width="1.5" stroke-linecap="round" />
          </svg>
        </div>
        <div>
          <h3 class="setting-title font-bold font-satoshi font-luxury">Notificaciones de pagos</h3>
          <p class="setting-description font-luxury">
            Pagos recibidos, retiros procesados, reembolsos
          </p>
        </div>
      </div>
      <label class="toggle-switch">
        <input
          type="checkbox"
          [(ngModel)]="settings().paymentNotifications"
          (change)="saveSettings()"
        />
        <span class="toggle-slider"></span>
      </label>
    </div>

    <div class="setting-item">
      <div class="setting-info">
        <div class="setting-icon">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path
              d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2v10z"
              stroke-width="1.75"
              stroke-linejoin="round"
            />
          </svg>
        </div>
        <div>
          <h3 class="setting-title font-bold font-satoshi">Mensajes nuevos</h3>
          <p class="setting-description">
            Notificaciones cuando recibas mensajes de otros usuarios
          </p>
        </div>
      </div>
      <label class="toggle-switch">
        <input
          type="checkbox"
          [(ngModel)]="settings().messageNotifications"
          (change)="saveSettings()"
        />
        <span class="toggle-slider"></span>
      </label>
    </div>

    <div class="setting-item">
      <div class="setting-info">
        <div class="setting-icon">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path
              d="M20 12v8a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2v-8M2 7h20M12 3v4M7.5 3l1 4M16.5 3l-1 4"
              stroke-width="1.75"
              stroke-linecap="round"
              stroke-linejoin="round"
            />
          </svg>
        </div>
        <div>
          <h3 class="setting-title font-bold font-satoshi">Promociones y ofertas</h3>
          <p class="setting-description font-luxury">
            Descuentos exclusivos, códigos promocionales
          </p>
        </div>
      </div>
      <label class="toggle-switch">
        <input
          type="checkbox"
          [(ngModel)]="settings().promotionsAndOffers"
          (change)="saveSettings()"
        />
        <span class="toggle-slider"></span>
      </label>
    </div>

    <div class="setting-item">
      <div class="setting-info">
        <div class="setting-icon">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path
              d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"
              stroke-width="1.75"
              stroke-linecap="round"
              stroke-linejoin="round"
            />
          </svg>
        </div>
        <div>
          <h3 class="setting-title font-bold font-satoshi">Actualizaciones del sistema</h3>
          <p class="setting-description">Nuevas funcionalidades, mantenimientos programados</p>
        </div>
      </div>
      <label class="toggle-switch">
        <input type="checkbox" [(ngModel)]="settings().systemUpdates" (change)="saveSettings()" />
        <span class="toggle-slider"></span>
      </label>
    </div>
  </div>

  <!-- Notification Channels -->
  <div class="settings-section">
    <div class="section-header">
      <h2 class="section-title font-bold font-satoshi">Canales de Notificación</h2>
      <p class="section-description">Dónde recibir las notificaciones</p>
    </div>

    <div class="setting-item">
      <div class="setting-info">
        <div class="setting-icon">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <rect x="5" y="2" width="14" height="20" rx="2" stroke-width="1.75" />
            <path d="M12 18h.01" stroke-width="2" stroke-linecap="round" />
          </svg>
        </div>
        <div>
          <h3 class="setting-title font-bold font-satoshi">Notificaciones en la app</h3>
          <p class="setting-description">Ver notificaciones dentro de AutoRenta</p>
        </div>
      </div>
      <label class="toggle-switch">
        <input
          type="checkbox"
          [(ngModel)]="settings().inAppNotifications"
          (change)="saveSettings()"
        />
        <span class="toggle-slider"></span>
      </label>
    </div>

    <div class="setting-item">
      <div class="setting-info">
        <div class="setting-icon">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <rect x="2" y="4" width="20" height="16" rx="2" stroke-width="1.75" />
            <path
              d="M22 6l-10 7L2 6"
              stroke-width="1.75"
              stroke-linecap="round"
              stroke-linejoin="round"
            />
          </svg>
        </div>
        <div>
          <h3 class="setting-title font-bold font-satoshi">Notificaciones por email</h3>
          <p class="setting-description">Recibir resúmenes diarios por correo electrónico</p>
        </div>
      </div>
      <label class="toggle-switch">
        <input
          type="checkbox"
          [(ngModel)]="settings().emailNotifications"
          (change)="saveSettings()"
        />
        <span class="toggle-slider"></span>
      </label>
    </div>
  </div>

  <!-- Sound Settings -->
  <div class="settings-section">
    <div class="section-header">
      <h2 class="section-title font-bold font-satoshi">Sonido</h2>
      <p class="section-description">Configuración de sonido para notificaciones</p>
    </div>

    <div class="setting-item">
      <div class="setting-info">
        <div class="setting-icon">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path
              d="M11 5L6 9H2v6h4l5 4V5zM15.54 8.46a5 5 0 0 1 0 7.07M19.07 4.93a10 10 0 0 1 0 14.14"
              stroke-width="1.75"
              stroke-linecap="round"
              stroke-linejoin="round"
            />
          </svg>
        </div>
        <div>
          <h3 class="setting-title font-bold font-satoshi">Reproducir sonido</h3>
          <p class="setting-description">Escuchar un sonido cuando llegue una notificación</p>
        </div>
      </div>
      <label class="toggle-switch">
        <input type="checkbox" [(ngModel)]="settings().soundEnabled" (change)="saveSettings()" />
        <span class="toggle-slider"></span>
      </label>
    </div>
  </div>

  <!-- Save Indicator -->
  @if (saving()) {
    <div class="save-indicator">
      <svg class="save-icon spinning" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="2"
          d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"
        />
      </svg>
      Guardando...
    </div>
  }
</div>
