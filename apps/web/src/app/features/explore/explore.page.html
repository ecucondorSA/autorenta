<ion-header [translucent]="true" class="md:block hidden">
  <ion-toolbar color="primary">
    <ion-searchbar
      [(ngModel)]="searchQuery"
      (ionChange)="onSearch()"
      placeholder="Buscar autos..."
      [animated]="true"
      class="search-bar-toolbar"
    ></ion-searchbar>
  </ion-toolbar>
</ion-header>

<!-- Mobile: Floating Search & Filters -->
<div class="md:hidden block absolute top-safe-top left-0 right-0 z-20 p-3">
  <div class="flex gap-2">
    <!-- Search Bar -->
    <div class="flex-1 bg-white dark:bg-slate-deep rounded-full shadow-lg">
      <ion-searchbar
        [(ngModel)]="searchQuery"
        (ionChange)="onSearch()"
        placeholder="¿A dónde vas?"
        [animated]="true"
        class="mobile-search"
      ></ion-searchbar>
    </div>
  </div>
</div>

<ion-content [fullscreen]="true" class="explore-content">
  <!-- Map View (Fullscreen) -->
  <div class="map-container">
    <app-cars-map
      [cars]="carMapLocations"
      [selectedCarId]="selectedCarId"
      (carSelected)="onMapCarSelected($event)"
      (userLocationChange)="onUserLocationChange($event)"
    ></app-cars-map>
  </div>

  <!-- Floating Action Buttons -->
  <div class="fab-container">
    <!-- Center on User Location -->
    <ion-fab vertical="top" horizontal="end" slot="fixed" class="fab-location">
      <ion-fab-button size="small" (click)="centerOnUser()">
        <ion-icon name="locate-outline"></ion-icon>
      </ion-fab-button>
    </ion-fab>
  </div>

  <!-- Bottom Carousel (Airbnb-style) -->
  <div 
    #carouselContainer
    class="map-carousel" 
    *ngIf="filteredCars.length > 0"
    (mouseenter)="onCarouselHover(true)"
    (mouseleave)="onCarouselHover(false)"
  >
    <div class="map-carousel-scroll">
      <div
        *ngFor="let car of filteredCars; let i = index"
        class="map-carousel-card-wrapper"
        role="listitem"
        [attr.data-car-id]="car.id"
        [class.selected]="car.id === selectedCarId"
      >
        <app-car-card
          [car]="car"
          [priority]="i === 0"
          [selected]="car.id === selectedCarId"
          (click)="onCarouselCardSelected(car.id)"
          class="map-carousel-card"
          [attr.aria-label]="'Ver más sobre ' + (car.title || 'este auto')"
        ></app-car-card>
      </div>
    </div>
  </div>
</ion-content>
