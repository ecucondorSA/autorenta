<ion-header [translucent]="true">
  <ion-toolbar color="primary">
    <ion-searchbar
      [(ngModel)]="searchQuery"
      (ionChange)="onSearch()"
      placeholder="Buscar autos..."
      [animated]="true"
      class="search-bar-toolbar"
    ></ion-searchbar>

    <ion-buttons slot="end">
      <ion-button (click)="toggleFilters()">
        <ion-icon slot="icon-only" name="options-outline"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>

  <!-- Filters Panel (Collapsible) -->
  <app-map-filters
    *ngIf="showFilters"
    (filtersChange)="onFiltersChange($event)"
    (filtersReset)="onFiltersReset()"
    class="filters-panel"
  ></app-map-filters>
</ion-header>

<ion-content [fullscreen]="true" class="explore-content">
  <!-- Map View (Fullscreen) -->
  <div class="map-container">
    <app-cars-map
      [cars]="carMapLocations"
      [selectedCarId]="selectedCarId"
      (carSelected)="onCarSelected($event)"
    ></app-cars-map>
  </div>

  <!-- Floating Action Buttons -->
  <div class="fab-container">
    <!-- Center on User Location -->
    <ion-fab vertical="top" horizontal="end" slot="fixed" class="fab-location">
      <ion-fab-button size="small" (click)="centerOnUser()">
        <ion-icon name="locate-outline"></ion-icon>
      </ion-fab-button>
    </ion-fab>
  </div>

  <!-- Bottom Carousel -->
  <div class="map-carousel" *ngIf="filteredCars.length > 0">
    <div class="map-carousel-scroll">
      <div
        *ngFor="let car of filteredCars; let i = index"
        class="map-carousel-card-wrapper"
        role="listitem"
      >
        <app-car-card
          [car]="car"
          [priority]="i === 0"
          [routerLink]="['/cars', car.id]"
          (click)="onCarSelected(car.id)"
          class="map-carousel-card--dynamic"
          [attr.aria-label]="'Ver mÃ¡s sobre ' + (car.title || 'este auto')"
        ></app-car-card>
      </div>
    </div>
  </div>
</ion-content>
