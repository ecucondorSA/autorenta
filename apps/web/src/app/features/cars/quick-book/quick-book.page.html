<div class="quick-book page container mx-auto p-4">
  @if (car(); as car) {
    <div>
      <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
        <div class="col-span-2">
          <img
            [src]="getCarPhotoUrl()"
            alt="{{ car.title }}"
            class="w-full h-64 object-cover rounded" width="400" height="256" />
          <h1 class="text-2xl font-semibold mt-3 font-satoshi">
            {{ car.title || car.brand + ' ' + car.model }}
          </h1>
          <p class="text-sm text-gray-600">{{ car.location_city }}</p>
          <div class="mt-4">
            <app-date-range-picker
              [carId]="car.id"
              [dailyPrice]="car.price_per_day"
              (rangeChange)="onRangeChange($event)"
            >
            </app-date-range-picker>
          </div>
          <div class="mt-4">
            <app-payment-method-buttons
              (methodSelected)="onPaymentMethodSelected($event)"
            ></app-payment-method-buttons>
          </div>
          <div class="mt-6 flex items-center gap-3">
            <button class="btn btn-primary" (click)="onBookNow()" [disabled]="loading()">
              Reservar ahora
            </button>
            <button class="btn btn-outline font-luxury" (click)="onContactOwner()">
              Contactar al dueño
            </button>
          </div>
          @if (error()) {
            <div class="mt-3 text-red-600">{{ error() }}</div>
          }
        </div>
        <aside class="col-span-1">
          <div class="p-3 bg-white rounded shadow">
            <h3 class="text-lg font-medium font-satoshi">Resumen</h3>
            <div class="mt-2">
              <div class="flex justify-between">
                <span>Precio</span>
                @if (car.price_per_day && car.price_per_day > 0) {
                  <span class="font-semibold">{{ car.price_per_day | money }}</span>
                } @else {
                  <span class="font-semibold text-primary-600">Consultar</span>
                }
              </div>
              <div class="flex justify-between mt-2">
                <span>Depósito</span>
                <span class="font-semibold">—</span>
              </div>
            </div>
          </div>
          <div class="mt-4">
            <!-- Car chat: requires carId and owner info -->
            <app-car-chat
              [carId]="car.id"
              [recipientId]="car.owner_id"
              [recipientName]="car.owner?.full_name"
            ></app-car-chat>
          </div>
        </aside>
      </div>
    </div>
  } @else {
    <div class="p-4">Cargando...</div>
  }
</div>
