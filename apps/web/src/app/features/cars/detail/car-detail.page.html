<ng-container *ngIf="car(); else loadingOrError">
  <section class="grid gap-4 sm:gap-6 lg:gap-8 lg:grid-cols-[2fr_1fr]">
    <div class="space-y-4 sm:space-y-6">
      <div
        class="card-premium car-gallery rounded-2xl border border-pearl-gray bg-white-pure p-4 sm:p-6 shadow-soft"
      >
        <div class="relative mb-4">
          <img
            *ngIf="currentPhoto(); else placeholderPremium"
            [src]="currentPhoto()!.url"
            [alt]="car()?.title ?? ''"
            class="h-80 w-full rounded-xl object-cover shadow-medium"
          />
          <ng-template #placeholderPremium>
            <div
              class="flex h-80 items-center justify-center rounded-xl bg-gradient-to-br from-accent-warm/10 to-accent-petrol/10"
            >
              <div class="text-center">
                <svg
                  class="mx-auto mb-4 h-24 w-24 text-accent-warm/40"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                >
                  <circle cx="7" cy="17" r="2" stroke-width="1.5" />
                  <circle cx="17" cy="17" r="2" stroke-width="1.5" />
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="1.5"
                    d="M5 15h14M8 12l1-4h6l1 4"
                  />
                </svg>
                <p class="text-sm font-medium text-charcoal-medium">Sin fotos disponibles</p>
              </div>
            </div>
          </ng-template>

          <div
            *ngIf="hasMultiplePhotos()"
            class="absolute inset-0 flex items-center justify-between px-4"
          >
            <button
              type="button"
              (click)="previousPhoto()"
              aria-label="Ver foto anterior"
              class="flex h-12 w-12 items-center justify-center rounded-full bg-white-pure/90 text-smoke-black shadow-medium backdrop-blur-sm transition-all hover:bg-white-pure hover:scale-110 focus:outline-none focus:ring-2 focus:ring-accent-petrol focus:ring-offset-2"
            >
              <svg
                class="h-6 w-6"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
                aria-hidden="true"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M15 19l-7-7 7-7"
                />
              </svg>
            </button>
            <button
              type="button"
              (click)="nextPhoto()"
              aria-label="Ver foto siguiente"
              class="flex h-12 w-12 items-center justify-center rounded-full bg-white-pure/90 text-smoke-black shadow-medium backdrop-blur-sm transition-all hover:bg-white-pure hover:scale-110 focus:outline-none focus:ring-2 focus:ring-accent-petrol focus:ring-offset-2"
            >
              <svg
                class="h-6 w-6"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
                aria-hidden="true"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M9 5l7 7-7 7"
                />
              </svg>
            </button>
          </div>

          <div
            *ngIf="hasMultiplePhotos()"
            class="absolute bottom-4 right-4 rounded-full bg-smoke-black/70 px-3 py-1 text-xs font-medium text-white-pure backdrop-blur-sm"
          >
            {{ currentPhotoIndex() + 1 }} / {{ allPhotos().length }}
          </div>
        </div>

        <div *ngIf="hasMultiplePhotos()" class="grid grid-cols-4 gap-2 md:grid-cols-6">
          <button
            *ngFor="let photo of allPhotos(); let i = index"
            type="button"
            (click)="goToPhoto(i)"
            [class.ring-2]="currentPhotoIndex() === i"
            [class.ring-accent-petrol]="currentPhotoIndex() === i"
            [class.opacity-50]="currentPhotoIndex() !== i"
            class="aspect-square overflow-hidden rounded-lg transition-all hover:opacity-100"
          >
            <img
              [src]="photo.url"
              [alt]="'Foto ' + (i + 1)"
              loading="lazy"
              decoding="async"
              width="100"
              height="100"
              class="h-full w-full object-cover"
            />
          </button>
        </div>
      </div>

      <div class="space-y-3">
        <div class="flex items-start justify-between gap-4">
          <h1 class="text-2xl sm:text-3xl lg:text-4xl font-bold tracking-tight text-smoke-black">
            {{ car()?.title }}
          </h1>
          <app-share-menu
            [title]="car()?.title || 'Auto en Autorentar'"
            [text]="'Mir√° este auto incre√≠ble en Autorentar: ' + (car()?.title || '')"
            [url]="'https://autorenta-web.pages.dev/cars/' + car()?.id"
          ></app-share-menu>
        </div>

        <div class="space-y-2">
          <div class="flex items-start gap-2 text-charcoal-medium dark:text-pearl-light/70">
            <svg
              class="mt-0.5 h-5 w-5 flex-shrink-0"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"
              />
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"
              />
            </svg>
            <p class="text-base">
              <ng-container *ngIf="car()?.location_formatted_address; else oldLocation">
                {{ car()?.location_formatted_address }}
              </ng-container>
              <ng-template #oldLocation>
                {{ car()?.location_city }}, {{ car()?.location_state }}
              </ng-template>
            </p>
          </div>
        </div>

        <div class="flex items-center gap-4">
          <div class="flex items-center gap-1">
            <svg class="h-5 w-5 text-accent-warm" fill="currentColor" viewBox="0 0 20 20">
              <path
                d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"
              />
            </svg>
            <span class="font-semibold text-smoke-black">{{ car()?.rating_avg || 'Nuevo' }}</span>
          </div>
          <span class="text-sm text-ash-gray"
            >{{ car()?.rating_count || 0 }} {{ 'carDetail.reviews' | translate }}</span
          >
        </div>
      </div>

      <div
        class="card-premium rounded-2xl border border-pearl-gray bg-white-pure p-4 sm:p-6 shadow-soft"
      >
        <h2 class="h4 mb-4">Especificaciones</h2>
        <div class="grid grid-cols-2 gap-4 md:grid-cols-3">
          <div class="flex items-center gap-3">
            <div class="flex h-10 w-10 items-center justify-center rounded-lg bg-sand-light">
              <svg
                class="h-5 w-5 text-accent-petrol"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4"
                />
              </svg>
            </div>
            <div>
              <p class="text-xs text-ash-gray">Transmisi√≥n</p>
              <p class="font-semibold text-smoke-black">{{ car()?.transmission | titlecase }}</p>
            </div>
          </div>

          <div class="flex items-center gap-3">
            <div class="flex h-10 w-10 items-center justify-center rounded-lg bg-sand-light">
              <svg
                class="h-5 w-5 text-accent-petrol"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M13 10V3L4 14h7v7l9-11h-7z"
                />
              </svg>
            </div>
            <div>
              <p class="text-xs text-ash-gray">Combustible</p>
              <p class="font-semibold text-smoke-black">{{ car()?.fuel_type | titlecase }}</p>
            </div>
          </div>

          <div class="flex items-center gap-3">
            <div class="flex h-10 w-10 items-center justify-center rounded-lg bg-sand-light">
              <svg
                class="h-5 w-5 text-accent-petrol"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"
                />
              </svg>
            </div>
            <div>
              <p class="text-xs text-ash-gray">Asientos</p>
              <p class="font-semibold text-smoke-black">{{ car()?.seats }} personas</p>
            </div>
          </div>

          <div class="flex items-center gap-3">
            <div class="flex h-10 w-10 items-center justify-center rounded-lg bg-sand-light">
              <svg
                class="h-5 w-5 text-accent-petrol"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"
                />
              </svg>
            </div>
            <div>
              <p class="text-xs text-ash-gray">A√±o</p>
              <p class="font-semibold text-smoke-black">{{ car()?.year }}</p>
            </div>
          </div>

          <div class="flex items-center gap-3">
            <div class="flex h-10 w-10 items-center justify-center rounded-lg bg-sand-light">
              <svg
                class="h-5 w-5 text-accent-petrol"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M7 21a4 4 0 01-4-4V5a2 2 0 012-2h4a2 2 0 012 2v12a4 4 0 01-4 4zm0 0h12a2 2 0 002-2v-4a2 2 0 00-2-2h-2.343M11 7.343l1.657-1.657a2 2 0 012.828 0l2.829 2.829a2 2 0 010 2.828l-8.486 8.485M7 17h.01"
                />
              </svg>
            </div>
            <div>
              <p class="text-xs text-ash-gray">Color</p>
              <p class="font-semibold text-smoke-black">{{ car()?.color | titlecase }}</p>
            </div>
          </div>

          <div class="flex items-center gap-3">
            <div class="flex h-10 w-10 items-center justify-center rounded-lg bg-sand-light">
              <svg
                class="h-5 w-5 text-accent-petrol"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M4 7v10c0 2.21 3.582 4 8 4s8-1.79 8-4V7M4 7c0 2.21 3.582 4 8 4s8-1.79 8-4M4 7c0-2.21 3.582-4 8-4s8 1.79 8 4"
                />
              </svg>
            </div>
            <div>
              <p class="text-xs text-ash-gray">Puertas</p>
              <p class="font-semibold text-smoke-black">{{ car()?.doors }}</p>
            </div>
          </div>
        </div>
      </div>

      <div
        class="card-premium rounded-2xl border border-pearl-gray bg-white-pure p-4 sm:p-6 shadow-soft"
      >
        <h2 class="h4 mb-3">Descripci√≥n</h2>
        <p class="leading-relaxed text-charcoal-medium">
          {{ car()?.description || 'Sin descripci√≥n disponible' }}
        </p>
      </div>

      <div
        id="reviews"
        class="card-premium reviews-section rounded-2xl border border-pearl-gray bg-white-pure p-4 sm:p-6 shadow-soft"
      >
        <div class="mb-4 sm:mb-6">
          <h2 class="h3 mb-2">‚≠ê Calificaciones y Rese√±as</h2>

          <div
            *ngIf="carStats() as stats"
            class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6 p-4 bg-sand-light rounded-xl"
          >
            <div class="text-center">
              <div class="text-3xl font-bold text-accent-petrol">
                {{ stats.rating_avg | number: '1.1-1' }}
              </div>
              <div class="text-xs text-ash-gray">Calificaci√≥n</div>
            </div>
            <div class="text-center">
              <div class="text-3xl font-bold text-smoke-black">{{ stats.reviews_count }}</div>
              <div class="text-xs text-ash-gray">Rese√±as</div>
            </div>
            <div class="text-center">
              <div class="text-3xl font-bold text-smoke-black">{{ stats.completed_bookings }}</div>
              <div class="text-xs text-ash-gray">Viajes</div>
            </div>
            <div class="text-center">
              <div class="text-3xl font-bold text-accent-petrol">
                {{ (1 - stats.cancellation_rate) * 100 | number: '1.0-0' }}%
              </div>
              <div class="text-xs text-ash-gray">√âxito</div>
            </div>
          </div>

          <div
            *ngIf="carStats() && carStats()!.reviews_count > 0"
            class="grid grid-cols-2 md:grid-cols-3 gap-3 mb-6"
          >
            <div
              class="flex items-center justify-between p-3 bg-white-pure rounded-lg border border-pearl-gray"
            >
              <span class="text-sm text-charcoal-medium">üßº Limpieza</span>
              <span class="font-semibold text-smoke-black">{{
                carStats()!.rating_cleanliness_avg | number: '1.1-1'
              }}</span>
            </div>
            <div
              class="flex items-center justify-between p-3 bg-white-pure rounded-lg border border-pearl-gray"
            >
              <span class="text-sm text-charcoal-medium">üí¨ Comunicaci√≥n</span>
              <span class="font-semibold text-smoke-black">{{
                carStats()!.rating_communication_avg | number: '1.1-1'
              }}</span>
            </div>
            <div
              class="flex items-center justify-between p-3 bg-white-pure rounded-lg border border-pearl-gray"
            >
              <span class="text-sm text-charcoal-medium">‚úì Precisi√≥n</span>
              <span class="font-semibold text-smoke-black">{{
                carStats()!.rating_accuracy_avg | number: '1.1-1'
              }}</span>
            </div>
            <div
              class="flex items-center justify-between p-3 bg-white-pure rounded-lg border border-pearl-gray"
            >
              <span class="text-sm text-charcoal-medium">üìç Ubicaci√≥n</span>
              <span class="font-semibold text-smoke-black">{{
                carStats()!.rating_location_avg | number: '1.1-1'
              }}</span>
            </div>
            <div
              class="flex items-center justify-between p-3 bg-white-pure rounded-lg border border-pearl-gray"
            >
              <span class="text-sm text-charcoal-medium">üîë Check-in</span>
              <span class="font-semibold text-smoke-black">{{
                carStats()!.rating_checkin_avg | number: '1.1-1'
              }}</span>
            </div>
            <div
              class="flex items-center justify-between p-3 bg-white-pure rounded-lg border border-pearl-gray"
            >
              <span class="text-sm text-charcoal-medium">üí∞ Valor</span>
              <span class="font-semibold text-smoke-black">{{
                carStats()!.rating_value_avg | number: '1.1-1'
              }}</span>
            </div>
          </div>
        </div>

        <div *ngIf="loading()" class="text-center py-8">
          <p class="text-ash-gray">Cargando rese√±as...</p>
        </div>

        <div *ngIf="!loading() && reviews().length === 0" class="text-center py-8">
          <p class="text-ash-gray">Este auto a√∫n no tiene rese√±as. ¬°S√© el primero en reservarlo!</p>
        </div>

        <div *ngIf="!loading() && reviews().length > 0" class="space-y-4">
          <app-review-card
            *ngFor="let review of reviews()"
            [review]="review"
            [showCarTitle]="false"
          ></app-review-card>
        </div>
      </div>

      <a
        routerLink="/cars"
        class="inline-flex items-center gap-2 text-sm font-medium text-accent-petrol hover:text-accent-petrol/80"
      >
        <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M10 19l-7-7m0 0l7-7m-7 7h18"
          />
        </svg>
        Volver a buscar
      </a>
    </div>

    <aside class="space-y-4">
      <div
        class="mb-4 rounded-xl border-2 p-4"
        [class.border-green-500]="car()?.status === 'active'"
        [class.bg-green-50]="car()?.status === 'active'"
        [class.border-yellow-500]="car()?.status !== 'active'"
        [class.bg-yellow-50]="car()?.status !== 'active'"
      >
        <div class="flex items-center gap-3">
          <div
            class="flex h-10 w-10 items-center justify-center rounded-full"
            [class.bg-green-100]="car()?.status === 'active'"
            [class.bg-yellow-100]="car()?.status !== 'active'"
          >
            <svg
              *ngIf="car()?.status === 'active'"
              class="h-6 w-6 text-green-600"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"
              />
            </svg>
            <svg
              *ngIf="car()?.status !== 'active'"
              class="h-6 w-6 text-yellow-600"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"
              />
            </svg>
          </div>
          <div>
            <p
              class="text-sm font-semibold"
              [class.text-green-900]="car()?.status === 'active'"
              [class.text-yellow-900]="car()?.status !== 'active'"
            >
              {{
                car()?.status === 'active' ? '‚úì Disponible para reservar' : 'Revisar disponibilidad'
              }}
            </p>
            <p
              class="text-xs"
              [class.text-green-700]="car()?.status === 'active'"
              [class.text-yellow-700]="car()?.status !== 'active'"
            >
              {{
                car()?.status === 'active'
                  ? 'Este auto est√° listo para tu viaje'
                  : 'Consult√° con el propietario'
              }}
            </p>
          </div>
        </div>
      </div>

      <div
        class="card-premium lg:sticky lg:top-24 rounded-2xl border border-pearl-gray bg-white-pure p-4 sm:p-6 shadow-elevated"
      >
        <div class="mb-6">
          <p class="text-3xl font-bold text-smoke-black">
            {{ car()?.price_per_day | money }}
          </p>
          <p class="text-sm text-charcoal-medium">por d√≠a</p>
        </div>

        <div class="mb-6" id="tour-date-picker">
          <app-date-range-picker
            label="Fechas de alquiler"
            (rangeChange)="onRangeChange($event)"
          ></app-date-range-picker>

          <div
            *ngIf="dateRange().from && dateRange().to"
            class="mt-3 rounded-lg bg-accent-petrol/10 border border-accent-petrol/20 p-3"
          >
            <div class="flex items-start gap-2">
              <svg
                class="h-5 w-5 flex-shrink-0 text-accent-petrol mt-0.5"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"
                />
              </svg>
              <div class="flex-1">
                <p class="text-sm font-semibold text-smoke-black">Fechas seleccionadas:</p>
                <p class="text-sm text-charcoal-medium">
                  <span class="font-medium">{{ dateRange().from | date: 'dd/MM/yyyy' }}</span>
                  <span class="mx-2">‚Üí</span>
                  <span class="font-medium">{{ dateRange().to | date: 'dd/MM/yyyy' }}</span>
                  <span class="ml-2 text-accent-petrol font-semibold"
                    >({{ daysCount() }} d√≠as)</span
                  >
                </p>
              </div>
            </div>
          </div>

          <div
            *ngIf="!dateRange().from || !dateRange().to"
            class="mt-3 rounded-lg bg-amber-50 border border-amber-200 p-3"
          >
            <div class="flex items-start gap-2">
              <svg
                class="h-5 w-5 flex-shrink-0 text-amber-600 mt-0.5"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"
                />
              </svg>
              <p class="text-sm text-amber-800">
                <span class="font-semibold">Seleccion√° las fechas</span> para calcular el precio
                total
              </p>
            </div>
          </div>
        </div>

        <div *ngIf="totalPrice() as total" class="mb-6 space-y-3">
          <div class="rounded-xl bg-sand-light p-4" id="tour-price-summary">
            <h3 class="mb-3 text-sm font-semibold text-smoke-black">Resumen de Precios</h3>
            <div class="space-y-2 text-sm">
              <div class="flex justify-between">
                <span class="text-charcoal-medium"
                  >{{ car()?.price_per_day | money }} x {{ daysCount() }} d√≠as</span
                >
                <span class="font-semibold text-smoke-black">{{ total | money }}</span>
              </div>
              <div
                *ngIf="car()?.deposit_required && car()?.deposit_amount"
                class="flex justify-between"
              >
                <span class="text-charcoal-medium">Dep√≥sito de seguridad</span>
                <span class="font-semibold text-smoke-black">{{
                  car()?.deposit_amount | money
                }}</span>
              </div>
              <div class="border-t border-pearl-gray pt-2">
                <div class="flex justify-between">
                  <span class="font-semibold text-smoke-black">Total</span>
                  <span class="text-xl font-bold text-smoke-black">{{ total | money }}</span>
                </div>
              </div>
            </div>
          </div>

          <div
            *ngIf="car()?.deposit_required"
            class="rounded-lg bg-accent-petrol/10 p-3 insurance-info"
          >
            <p class="text-xs text-accent-petrol">
              <svg
                class="mb-1 inline h-4 w-4"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"
                />
              </svg>
              El dep√≥sito de seguridad se devolver√° al finalizar el alquiler
            </p>
          </div>
        </div>

        <div
          *ngIf="bookingError()"
          class="mb-4 rounded-lg border-2 border-red-300 bg-red-50 p-4 text-sm text-red-800"
        >
          <div class="flex items-start gap-2">
            <svg
              class="h-5 w-5 flex-shrink-0 text-red-600 mt-0.5"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"
              />
            </svg>
            <div class="flex-1">
              <p class="font-semibold">Error</p>
              <p>{{ bookingError() }}</p>
            </div>
          </div>
        </div>

        <div
          *ngIf="!totalPrice() && (dateRange().from || dateRange().to)"
          class="mb-4 rounded-lg border-2 border-amber-300 bg-amber-50 p-4 text-sm text-amber-800"
        >
          <div class="flex items-start gap-2">
            <svg
              class="h-5 w-5 flex-shrink-0 text-amber-600 mt-0.5"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"
              />
            </svg>
            <div class="flex-1">
              <p class="font-semibold mb-1">No se pudo calcular el precio</p>
              <p class="text-xs">
                Por favor, verific√° que hayas seleccionado correctamente las fechas de inicio y fin
                del alquiler.
              </p>
            </div>
          </div>
        </div>

        <button
          id="book-now"
          *ngIf="authService.isAuthenticated()"
          (click)="onBookClick()"
          [disabled]="!canBook() || bookingInProgress()"
          [class.opacity-50]="!canBook() || bookingInProgress()"
          [class.cursor-not-allowed]="!canBook() || bookingInProgress()"
          class="btn-primary w-full py-3 text-base font-semibold disabled:hover:bg-smoke-black"
        >
          <span *ngIf="!bookingInProgress()" class="flex items-center justify-center gap-2">
            <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M5 13l4 4L19 7"
              />
            </svg>
            Solicitar reserva
          </span>
          <span *ngIf="bookingInProgress()" class="flex items-center justify-center gap-2">
            <svg class="animate-spin h-5 w-5" fill="none" viewBox="0 0 24 24">
              <circle
                class="opacity-25"
                cx="12"
                cy="12"
                r="10"
                stroke="currentColor"
                stroke-width="4"
              ></circle>
              <path
                class="opacity-75"
                fill="currentColor"
                d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"
              ></path>
            </svg>
            Procesando...
          </span>
        </button>

        <a
          *ngIf="!authService.isAuthenticated()"
          routerLink="/auth/login"
          [queryParams]="{ returnUrl: router.url }"
          class="btn-primary w-full py-3 text-base font-semibold flex items-center justify-center gap-2"
        >
          <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M11 16l-4-4m0 0l4-4m-4 4h14m-5 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h7a3 3 0 013 3v1"
            />
          </svg>
          Inicia sesi√≥n para reservar
        </a>

        <div class="mt-4 space-y-2 text-xs text-ash-gray">
          <p class="flex items-center gap-2">
            <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"
              />
            </svg>
            Cancelaci√≥n gratuita hasta 24hs antes
          </p>
          <p class="flex items-center gap-2">
            <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"
              />
            </svg>
            Pago seguro con Mercado Pago
          </p>
        </div>
      </div>
    </aside>
  </section>
</ng-container>

<ng-template #loadingOrError>
  <p *ngIf="loading(); else errorTpl" class="text-center text-sm text-slate-500">
    Cargando auto...
  </p>
</ng-template>

<ng-template #errorTpl>
  <p class="text-center text-sm text-red-600">{{ error() ?? 'No pudimos cargar el auto.' }}</p>
</ng-template>
