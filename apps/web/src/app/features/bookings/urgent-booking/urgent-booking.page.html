<div class="container mx-auto px-4 py-8">
  <div class="mb-6">
    <h1 class="text-2xl font-bold text-text-primary">Alquiler Urgente</h1>
    <p class="mt-2 text-sm text-text-secondary">
      Reserva un auto disponible inmediatamente cerca de tu ubicación.
    </p>
  </div>

  @if (loading()) {
    <div class="flex items-center justify-center py-12">
      <div
        class="h-8 w-8 animate-spin rounded-full border-4 border-cta-default border-t-transparent"
      ></div>
    </div>
  } @else if (car(); as c) {
    <div class="space-y-6">
      <!-- Información del auto -->
      <div class="rounded-lg border border-border-default bg-surface-raised p-6 shadow-sm">
        <h2 class="mb-4 text-xl font-semibold text-text-primary">{{ c.brand }} {{ c.model }}</h2>
        <div class="grid grid-cols-2 gap-4 text-sm">
          <div>
            <p class="text-text-secondary">Año</p>
            <p class="font-medium text-text-primary">{{ c.year }}</p>
          </div>
          <div>
            <p class="text-text-secondary">Precio por hora</p>
            <p class="font-medium text-text-primary">
              @if (quote()?.hourlyRate !== undefined && quote()?.hourlyRate !== null) {
                ${{ quote()!.hourlyRate! | number: '1.2-2' }}
              } @else {
                ...
              }
            </p>
          </div>
        </div>
      </div>

      <!-- Disponibilidad -->
      @if (availability(); as a) {
        <div
          class="rounded-lg border p-4"
          [class.bg-success-light/10]="a.available"
          [class.bg-error-bg]="!a.available">
          @if (a.available) {
            <div class="flex items-center gap-2">
              <svg class="h-5 w-5 text-success-light" fill="currentColor" viewBox="0 0 20 20">
                <path
                  fill-rule="evenodd"
                  d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z"
                  clip-rule="evenodd"
                />
              </svg>
              <div>
                <p class="font-medium text-success-light">Disponible ahora</p>
                @if (a.distance) {
                  <p class="text-sm text-success-light">
                    A {{ a.distance | number: '1.1-1' }} km de tu ubicación
                  </p>
                }
                @if (a.eta) {
                  <p class="text-sm text-success-light">ETA: {{ a.eta }} minutos</p>
                }
              </div>
            </div>
          } @else {
            <p class="text-error-strong">{{ a.reason || 'No disponible' }}</p>
          }
        </div>
      }

      <!-- Configuración de alquiler -->
      <div class="rounded-lg border border-border-default bg-surface-raised p-6 shadow-sm">
        <h3 class="mb-4 text-lg font-semibold text-text-primary">Configuración</h3>
        <div class="space-y-4">
          <div>
            <label class="block text-sm font-medium text-text-primary"> Duración (horas) </label>
            <input
              type="number"
              [(ngModel)]="durationHours"
              min="1"
              max="24"
              (change)="updateQuote()"
              class="mt-1 block w-full rounded-md border border-border-muted px-3 py-2 shadow-sm focus:border-cta-default focus:outline-none focus:ring-cta-default"
            />
          </div>

          <!-- Cotización -->
          @if (quote(); as q) {
            <div class="rounded-lg bg-cta-default/10 p-4">
              <div class="mb-2 flex items-center justify-between">
                <span class="text-sm font-medium text-cta-default">Total</span>
                <span class="text-xl font-bold text-cta-default">
                  ${{ q.totalPrice | number: '1.2-2' }}
                </span>
              </div>
              @if (q.surgeFactor && q.surgeFactor > 1) {
                <p class="text-xs text-cta-default">
                  Incluye recargo por demanda: {{ (q.surgeFactor - 1) * 100 | number: '1.0-0' }}%
                </p>
              }
            </div>
          }
        </div>
      </div>

      <!-- Botón de confirmación -->
      <button
        (click)="createBooking()"
        [disabled]="!canCreateBooking() || creating()"
        class="w-full rounded-lg bg-cta-default text-cta-text hover:bg-cta-default disabled:opacity-50"
      >
        @if (creating()) {
          <span class="flex items-center justify-center gap-2">
            <span
              class="h-5 w-5 animate-spin rounded-full border-2 border-white border-t-transparent"
            ></span>
            Creando reserva...
          </span>
        } @else {
          Confirmar Alquiler Urgente
        }
      </button>

      @if (error()) {
        <div class="rounded-lg bg-error-bg p-4 text-error-strong">
          {{ error() }}
        </div>
      }
    </div>
  }
</div>
