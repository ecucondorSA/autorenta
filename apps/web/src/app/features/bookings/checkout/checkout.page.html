<section
  class="mx-auto max-w-4xl space-y-6 py-8 px-4"
>
  <!-- Header -->
  <header class="mb-6">
    <h1 class="text-3xl font-bold text-slate-900 mb-2">Checkout</h1>
    <p class="text-slate-600">Completa el pago de tu reserva</p>
  </header>

  <!-- Booking Summary Card -->
  <div class="bg-white rounded-xl border border-slate-200 p-6 shadow-sm">
    <h2 class="text-lg font-semibold text-slate-900 mb-4">Resumen de la Reserva</h2>
    <div class="space-y-2 text-sm text-slate-600">
      <div class="flex justify-between">
        <span>Reserva ID:</span>
        <span class="font-medium text-slate-900">{{ bookingId() }}</span>
      </div>
      <div class="flex justify-between">
        <span>Estado:</span>
        <span class="font-medium text-slate-900">{{ status() }}</span>
      </div>
      <div *ngIf="booking() as current" class="flex justify-between pt-2 border-t border-slate-200">
        <span class="font-semibold text-slate-900">Total a Pagar:</span>
        <span class="text-xl font-bold text-slate-900">{{ current.total_amount | money: current.currency }}</span>
      </div>
    </div>
  </div>

  <!-- Payment Method Selector -->
  <div *ngIf="booking() as current" class="bg-white rounded-xl border border-slate-200 p-6 shadow-sm">
    <app-payment-method-selector
      [totalAmount]="current.total_amount"
      (paymentMethodChange)="onPaymentMethodChange($event)"
    ></app-payment-method-selector>
  </div>

  <!-- Action Button -->
  <div class="bg-white rounded-xl border border-slate-200 p-6 shadow-sm">
    <button
      type="button"
      class="w-full rounded-lg bg-blue-600 px-6 py-4 text-lg font-semibold text-white hover:bg-blue-700 disabled:cursor-not-allowed disabled:bg-slate-300 disabled:text-slate-500 transition-colors"
      (click)="processPayment()"
      [disabled]="loading() || !bookingId() || !booking()"
    >
      <span *ngIf="!loading()">
        <span *ngIf="selectedPaymentMethod() === 'wallet'">Pagar con Wallet</span>
        <span *ngIf="selectedPaymentMethod() === 'credit_card'">Pagar con Tarjeta</span>
        <span *ngIf="selectedPaymentMethod() === 'partial_wallet'">Procesar Pago Mixto</span>
      </span>
      <span *ngIf="loading()" class="flex items-center justify-center">
        <svg class="animate-spin h-5 w-5 mr-3" fill="none" viewBox="0 0 24 24">
          <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
          <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
        </svg>
        Procesando...
      </span>
    </button>
  </div>

  <!-- Status Message -->
  <div *ngIf="message()" class="rounded-lg p-4" [class.bg-green-50]="status() === 'paid_with_wallet' || status() === 'paid_partial'" [class.bg-blue-50]="status() !== 'paid_with_wallet' && status() !== 'paid_partial'">
    <p class="text-sm font-medium" [class.text-green-800]="status() === 'paid_with_wallet' || status() === 'paid_partial'" [class.text-blue-800]="status() !== 'paid_with_wallet' && status() !== 'paid_partial'">
      {{ message() }}
    </p>
  </div>

  <!-- Debug Section (Development Only) -->
  <details class="bg-slate-50 rounded-lg border border-slate-200 p-4">
    <summary class="cursor-pointer text-sm font-medium text-slate-700 hover:text-slate-900">
      Opciones de Desarrollo (Click para expandir)
    </summary>
    <div class="mt-4 space-y-3">
      <button
        type="button"
        class="w-full rounded bg-slate-600 px-4 py-2 text-sm font-semibold text-white hover:bg-slate-700 disabled:cursor-not-allowed disabled:bg-slate-300"
        (click)="createIntent()"
        [disabled]="loading() || !bookingId()"
      >
        {{ loading() ? 'Procesando...' : 'Generar intento de pago (Mock)' }}
      </button>

      <button
        type="button"
        class="w-full rounded border border-slate-600 px-4 py-2 text-sm font-semibold text-slate-600 hover:bg-slate-50 disabled:cursor-not-allowed disabled:border-slate-300 disabled:text-slate-400"
        (click)="simulatePayment()"
        [disabled]="loading() || !intentId()"
      >
        Simular pago aprobado (Mock)
      </button>

      <div *ngIf="intentId()" class="text-xs text-slate-600 p-2 bg-white rounded">
        <p><strong>Intent ID:</strong> {{ intentId() }}</p>
      </div>
    </div>
  </details>
</section>
