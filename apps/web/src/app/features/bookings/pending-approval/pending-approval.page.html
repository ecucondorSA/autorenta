<div class="pending-approval-page">
  <div class="header">
    <h1>{{ 'PENDING_APPROVALS.TITLE' | translate }}</h1>
    <p class="subtitle">{{ 'PENDING_APPROVALS.SUBTITLE' | translate }}</p>
  </div>

  <!-- Loading State - Skeleton List -->
  <div *ngIf="loading()" class="bookings-list">
    <app-skeleton-loader type="list" [count]="3"></app-skeleton-loader>
  </div>

  <!-- Empty State -->
  <div *ngIf="!loading() && !hasBookings()" class="empty-state">
    <div class="empty-icon">‚úÖ</div>
    <h2>{{ 'PENDING_APPROVALS.NO_PENDING' | translate }}</h2>
    <p>{{ 'PENDING_APPROVALS.NO_PENDING_DESC' | translate }}</p>
    <button class="btn-primary" routerLink="/cars/my">
      {{ 'PENDING_APPROVALS.VIEW_MY_CARS' | translate }}
    </button>
  </div>

  <!-- Bookings List -->
  <div *ngIf="!loading() && hasBookings()" class="bookings-list">
    <div
      *ngFor="let booking of pendingBookings()"
      class="booking-card"
      [class.processing]="processingBookingId() === booking.booking_id"
      [class.urgent]="getUrgencyClass(booking.hours_remaining) === 'urgent'"
      [class.warning]="getUrgencyClass(booking.hours_remaining) === 'warning'"
    >
      <!-- Urgency Badge -->
      <div class="urgency-badge" [class]="getUrgencyClass(booking.hours_remaining)">
        <span class="icon">‚è∞</span>
        <span class="time">{{ formatTimeRemaining(booking.hours_remaining) }}</span>
        <span class="label">restantes</span>
      </div>

      <!-- Car Info -->
      <div class="car-info">
        <h3>{{ booking.car_name }} ({{ booking.car_year }})</h3>
        <div class="booking-dates">
          <span class="date-range">
            üìÖ {{ formatDate(booking.start_at) }} ‚Üí {{ formatDate(booking.end_at) }}
          </span>
          <span class="days-count">{{ booking.days_count }} d√≠as</span>
        </div>
      </div>

      <!-- Renter Profile Badge -->
      <div class="renter-info">
        <span class="renter-label">Solicitante:</span>
        <app-renter-profile-badge [renterId]="booking.renter_id"></app-renter-profile-badge>
      </div>

      <!-- Booking Details -->
      <div class="booking-details">
        <div class="detail-item">
          <span class="label">Total:</span>
          <span class="value amount"
            >{{ booking.total_amount | number: '1.2-2' }} {{ booking.currency }}</span
          >
        </div>
        <div class="detail-item">
          <span class="label">Solicitud:</span>
          <span class="value">{{ formatDate(booking.booking_created_at) }}</span>
        </div>
        <div class="detail-item">
          <span class="label">Expira:</span>
          <span class="value expires">{{ formatDate(booking.approval_expires_at) }}</span>
        </div>
      </div>

      <!-- Actions -->
      <div class="booking-actions">
        <button
          class="btn-approve"
          (click)="onApprove(booking.booking_id)"
          [disabled]="processingBookingId() !== null"
        >
          <span *ngIf="processingBookingId() !== booking.booking_id">‚úÖ Aprobar</span>
          <span *ngIf="processingBookingId() === booking.booking_id" class="processing">
            <div class="spinner-small"></div>
            Procesando...
          </span>
        </button>

        <button
          class="btn-reject"
          (click)="onRejectClick(booking.booking_id)"
          [disabled]="processingBookingId() !== null"
        >
          ‚ùå Rechazar
        </button>

        <button class="btn-view" (click)="navigateToBooking(booking.booking_id)">
          üëÅÔ∏è Ver Detalles
        </button>
      </div>
    </div>
  </div>

  <!-- Info Banner -->
  <div *ngIf="hasBookings()" class="info-banner">
    <div class="info-icon">‚ÑπÔ∏è</div>
    <div class="info-content">
      <p><strong>Importante:</strong></p>
      <ul>
        <li>Al aprobar, el pago se procesar√° autom√°ticamente y la reserva quedar√° confirmada.</li>
        <li>Al rechazar, los fondos se liberar√°n y el cliente recibir√° una notificaci√≥n.</li>
        <li>
          Si no respondes antes de que expire el tiempo, la reserva se cancelar√° autom√°ticamente.
        </li>
      </ul>
    </div>
  </div>
</div>

<!-- Reject Modal -->
<div *ngIf="showRejectModal()" class="modal-overlay" (click)="onCancelReject()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>Rechazar Reserva</h2>
      <button class="close-btn" (click)="onCancelReject()">√ó</button>
    </div>

    <div class="modal-body">
      <p>Selecciona la raz√≥n por la cual rechazas esta solicitud:</p>

      <div class="reason-options">
        <label *ngFor="let reason of rejectionReasons" class="reason-option">
          <input
            type="radio"
            name="rejection-reason"
            [value]="reason.value"
            [(ngModel)]="rejectionReason"
          />
          <span>{{ reason.label }}</span>
        </label>
      </div>

      <div *ngIf="rejectionReason() === 'other'" class="custom-reason">
        <label>Especifica la raz√≥n:</label>
        <textarea [(ngModel)]="rejectionReason" placeholder="Escribe aqu√≠..." rows="3"></textarea>
      </div>
    </div>

    <div class="modal-footer">
      <button class="btn-secondary" (click)="onCancelReject()">Cancelar</button>
      <button class="btn-danger" (click)="onConfirmReject()" [disabled]="!rejectionReason()">
        Confirmar Rechazo
      </button>
    </div>
  </div>
</div>
