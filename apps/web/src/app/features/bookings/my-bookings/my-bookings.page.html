<section class="bookings-page min-h-screen bg-gradient-to-b from-slate-50 via-white to-slate-50/50 pb-20 sm:pb-0">
  <!-- Hero Header - Premium Glass -->
  <header class="sticky top-0 z-20 backdrop-blur-xl bg-white/80 border-b border-slate-200/50 px-4 py-4 sm:px-6 mb-6">
    <div class="container-page flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">
      <div>
        <div class="flex items-center gap-2 mb-1.5">
          <span class="inline-flex items-center gap-1.5 px-2.5 py-1 rounded-full text-xs font-semibold
                       bg-gradient-to-r from-emerald-500/10 to-teal-500/10 text-emerald-700
                       border border-emerald-200/50">
            <span class="w-1.5 h-1.5 rounded-full bg-emerald-500"></span>
            Mis reservas
          </span>
        </div>
        <h1 class="text-2xl sm:text-3xl font-bold text-slate-900 tracking-tight">
          Tu panel de viajes
        </h1>
        <p class="text-sm text-slate-500 mt-1 hidden sm:block max-w-md">
          Seguimiento claro de cada reserva, con estados y acciones en un solo lugar.
        </p>
      </div>
      <a
        routerLink="/cars"
        appPressScale
        class="group inline-flex items-center gap-2 px-5 py-3 rounded-xl
               bg-slate-900 text-white font-semibold text-sm
               shadow-lg shadow-slate-900/20
               hover:bg-slate-800 hover:shadow-xl hover:shadow-slate-900/25
               active:scale-[0.98] transition-all duration-200"
      >
        <app-icon name="car-outline" [size]="18" class="transition-transform group-hover:scale-110"></app-icon>
        <span>Buscar autos</span>
      </a>
    </div>
  </header>

  <!-- Filter Pills - Premium with counters -->
  <nav class="container-page px-4 sm:px-6 mb-6" role="tablist" aria-label="Filtrar reservas">
    <div class="flex gap-2 overflow-x-auto pb-2 scrollbar-hide -mx-4 px-4 sm:mx-0 sm:px-0 sm:flex-wrap snap-x snap-mandatory">
      @for (filter of statusFilters; track filter) {
        <button
          role="tab"
          [attr.aria-selected]="statusFilter() === filter"
          (click)="setStatusFilter(filter)"
          appPressScale
          class="group inline-flex items-center gap-2 px-4 py-2.5 rounded-full text-sm font-medium
                 whitespace-nowrap transition-all duration-200 ease-out
                 flex-shrink-0 min-h-[44px] snap-start
                 focus:outline-none focus:ring-2 focus:ring-slate-900/10 focus:ring-offset-2"
          [class]="
            statusFilter() === filter
              ? 'bg-slate-900 text-white shadow-md shadow-slate-900/20'
              : 'bg-white text-slate-600 border border-slate-200 hover:bg-slate-50 hover:text-slate-900 hover:border-slate-300'
          "
        >
          <span>{{ getFilterLabel(filter) }}</span>
          @if (statusCounts()[filter] > 0) {
            <span
              class="inline-flex items-center justify-center min-w-[20px] h-5 px-1.5 rounded-full text-xs font-bold transition-colors"
              [class]="
                statusFilter() === filter
                  ? 'bg-white/20 text-white'
                  : 'bg-slate-100 text-slate-500 group-hover:bg-slate-200'
              "
            >
              {{ statusCounts()[filter] }}
            </span>
          }
        </button>
      }
    </div>
  </nav>

  <div class="container-page px-4 sm:px-6 space-y-6">
    <!-- Loading state (Premium Skeletons) -->
    @if (loading() && !error()) {
      <!-- Summary Cards Skeleton -->
      <div class="grid grid-cols-2 sm:grid-cols-3 gap-3 sm:gap-4 mb-6">
        @for (_ of [1, 2, 3]; track _) {
          <div class="relative overflow-hidden rounded-2xl bg-white border border-slate-100 p-4 min-h-[100px]">
            <div class="skeleton h-8 w-8 rounded-xl mb-3"></div>
            <div class="skeleton h-7 w-12 rounded-lg mb-2"></div>
            <div class="skeleton h-4 w-20 rounded-md"></div>
          </div>
        }
      </div>
      <!-- Booking Cards Skeleton -->
      <div class="space-y-4">
        @for (_ of [1, 2]; track _) {
          <div class="rounded-2xl bg-white border border-slate-100 overflow-hidden">
            <!-- Section Header Skeleton -->
            <div class="p-4 flex items-center gap-3 border-b border-slate-50">
              <div class="skeleton h-6 w-6 rounded-lg"></div>
              <div class="skeleton h-5 w-32 rounded-md"></div>
            </div>
            <!-- Cards Skeleton -->
            <div class="p-3 space-y-3">
              @for (__ of [1, 2]; track __) {
                <div class="flex gap-3 p-3 rounded-xl bg-slate-50/50">
                  <div class="skeleton w-20 h-20 sm:w-24 sm:h-24 rounded-xl flex-shrink-0"></div>
                  <div class="flex-1 space-y-2">
                    <div class="skeleton h-5 w-3/4 rounded-md"></div>
                    <div class="skeleton h-4 w-1/2 rounded-md"></div>
                    <div class="skeleton h-4 w-1/3 rounded-md"></div>
                    <div class="flex justify-between items-center mt-3">
                      <div class="skeleton h-5 w-20 rounded-md"></div>
                      <div class="skeleton h-4 w-24 rounded-md"></div>
                    </div>
                  </div>
                </div>
              }
            </div>
          </div>
        }
      </div>
    }

    <!-- Error message - Premium Style -->
    @if (error()) {
      <div class="relative overflow-hidden rounded-2xl bg-gradient-to-br from-amber-50 to-orange-50
                  border border-amber-200/60 p-6 shadow-sm">
        <div class="absolute top-0 right-0 w-32 h-32 bg-gradient-to-br from-amber-200/30 to-transparent rounded-bl-full"></div>
        <div class="relative">
          <div class="flex items-center gap-3 mb-3">
            <div class="w-10 h-10 rounded-xl bg-amber-100 flex items-center justify-center">
              <span class="text-xl">⚠️</span>
            </div>
            <h3 class="font-semibold text-slate-900">Error al cargar reservas</h3>
          </div>
          <p class="text-sm text-slate-600 mb-4">{{ error() }}</p>
          <button
            (click)="loadBookings()"
            appPressScale
            class="inline-flex items-center gap-2 px-4 py-2.5 rounded-xl
                   bg-slate-900 text-white text-sm font-semibold
                   hover:bg-slate-800 active:scale-[0.98] transition-all duration-200"
          >
            <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
            </svg>
            Reintentar
          </button>
        </div>
      </div>
    }

    <!-- Empty state - Premium with Animation -->
    @if (!loading() && !error() && bookings().length === 0) {
      <div class="flex flex-col items-center justify-center py-16 px-6 text-center">
        <!-- Animated Illustration -->
        <div class="relative w-40 h-40 mb-8">
          <!-- Background circles -->
          <div class="absolute inset-0 bg-gradient-to-br from-emerald-100 to-teal-100 rounded-full opacity-60 animate-pulse"></div>
          <div class="absolute inset-4 bg-gradient-to-br from-emerald-50 to-white rounded-full"></div>
          <!-- Car illustration -->
          <svg class="absolute inset-0 w-full h-full p-8 text-emerald-600" viewBox="0 0 100 100" fill="none">
            <!-- Road path -->
            <path d="M10,70 Q30,50 50,55 Q70,60 90,45"
                  stroke="currentColor"
                  stroke-width="3"
                  stroke-linecap="round"
                  stroke-dasharray="8 4"
                  class="animate-dash" />
            <!-- Car body -->
            <g class="animate-car">
              <rect x="35" y="45" width="30" height="15" rx="3" fill="currentColor" opacity="0.9"/>
              <rect x="40" y="38" width="20" height="10" rx="2" fill="currentColor" opacity="0.7"/>
              <!-- Wheels -->
              <circle cx="42" cy="60" r="5" fill="currentColor"/>
              <circle cx="58" cy="60" r="5" fill="currentColor"/>
              <!-- Window -->
              <rect x="43" y="40" width="14" height="6" rx="1" fill="white" opacity="0.5"/>
            </g>
          </svg>
        </div>

        <!-- Copy -->
        <h3 class="text-xl font-bold text-slate-900 mb-2 tracking-tight">
          Tu próxima aventura te espera
        </h3>
        <p class="text-slate-500 max-w-sm mb-8 text-sm leading-relaxed">
          Explorá miles de autos cerca de ti y reservá tu próximo viaje en minutos. ¡Es fácil y seguro!
        </p>

        <!-- CTA Button -->
        <a
          routerLink="/cars"
          appPressScale
          class="group inline-flex items-center gap-2.5 px-6 py-3.5 rounded-xl
                 bg-slate-900 text-white font-semibold
                 shadow-lg shadow-slate-900/20
                 hover:bg-slate-800 hover:shadow-xl hover:shadow-slate-900/25
                 active:scale-[0.98] transition-all duration-200"
        >
          <svg class="w-5 h-5 transition-transform group-hover:scale-110" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
          </svg>
          <span>Explorar autos</span>
        </a>

        <!-- Secondary action -->
        <p class="mt-6 text-xs text-slate-400">
          ¿Tenés un auto? <a routerLink="/dashboard/cars/new" class="text-emerald-600 hover:text-emerald-700 font-medium">Publicalo y ganá dinero</a>
        </p>
      </div>
    }

    <!-- Main Content (when bookings exist) -->
    @if (!loading() && !error() && bookings().length > 0) {
      <!-- ===== DASHBOARD SUMMARY (Premium Bento Grid) ===== -->
      <div class="grid grid-cols-2 sm:grid-cols-3 gap-3 sm:gap-4">
        <!-- Action Required Card - Highlighted -->
        <button
          (click)="dashboardStats().actionRequired > 0 && focusSection('action-required')"
          [disabled]="dashboardStats().actionRequired === 0"
          class="group relative col-span-2 sm:col-span-1 p-4 rounded-2xl text-left
                 transition-all duration-300 ease-out overflow-hidden
                 focus:outline-none focus:ring-2 focus:ring-amber-500/30 focus:ring-offset-2"
          [class]="dashboardStats().actionRequired > 0
            ? 'bg-gradient-to-br from-amber-50 to-orange-50 border border-amber-200/60 shadow-sm hover:shadow-md hover:border-amber-300/80 cursor-pointer'
            : 'bg-white border border-slate-200/60 opacity-60 cursor-not-allowed'"
        >
          <!-- Decorative gradient -->
          @if (dashboardStats().actionRequired > 0) {
            <div class="absolute top-0 right-0 w-24 h-24 bg-gradient-to-bl from-amber-200/40 to-transparent rounded-bl-full transition-opacity group-hover:opacity-80"></div>
          }

          <div class="relative">
            <div class="w-10 h-10 rounded-xl flex items-center justify-center mb-3 transition-transform group-hover:scale-105"
                 [class]="dashboardStats().actionRequired > 0 ? 'bg-amber-100' : 'bg-slate-100'">
              <span class="text-xl">⚠️</span>
            </div>
            <p class="text-3xl font-bold tracking-tight"
               [class]="dashboardStats().actionRequired > 0 ? 'text-amber-900' : 'text-slate-400'">
              {{ dashboardStats().actionRequired }}
            </p>
            <p class="text-xs font-medium mt-1"
               [class]="dashboardStats().actionRequired > 0 ? 'text-amber-700' : 'text-slate-400'">
              Requieren acción
            </p>
          </div>

          <!-- Notification dot -->
          @if (dashboardStats().actionRequired > 0) {
            <span class="absolute top-3 right-3 flex h-3 w-3">
              <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-amber-400 opacity-75"></span>
              <span class="relative inline-flex rounded-full h-3 w-3 bg-amber-500 shadow-lg shadow-amber-500/50"></span>
            </span>
          }
        </button>

        <!-- Active Card -->
        <button
          (click)="dashboardStats().active > 0 && focusSection('active')"
          [disabled]="dashboardStats().active === 0"
          class="group relative p-4 rounded-2xl text-left
                 transition-all duration-300 ease-out overflow-hidden
                 focus:outline-none focus:ring-2 focus:ring-emerald-500/30 focus:ring-offset-2"
          [class]="dashboardStats().active > 0
            ? 'bg-gradient-to-br from-emerald-50 to-teal-50 border border-emerald-200/60 shadow-sm hover:shadow-md hover:border-emerald-300/80 cursor-pointer'
            : 'bg-white border border-slate-200/60 opacity-60 cursor-not-allowed'"
        >
          @if (dashboardStats().active > 0) {
            <div class="absolute top-0 right-0 w-20 h-20 bg-gradient-to-bl from-emerald-200/40 to-transparent rounded-bl-full transition-opacity group-hover:opacity-80"></div>
          }

          <div class="relative">
            <div class="w-10 h-10 rounded-xl flex items-center justify-center mb-3 transition-transform group-hover:scale-105"
                 [class]="dashboardStats().active > 0 ? 'bg-emerald-100' : 'bg-slate-100'">
              <svg class="w-5 h-5" [class]="dashboardStats().active > 0 ? 'text-emerald-600' : 'text-slate-400'"
                   fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path d="M20 6L9 17l-5-5" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
            </div>
            <p class="text-3xl font-bold tracking-tight"
               [class]="dashboardStats().active > 0 ? 'text-emerald-900' : 'text-slate-400'">
              {{ dashboardStats().active }}
            </p>
            <p class="text-xs font-medium mt-1"
               [class]="dashboardStats().active > 0 ? 'text-emerald-700' : 'text-slate-400'">
              Activas hoy
            </p>
          </div>
        </button>

        <!-- History Card -->
        <button
          (click)="dashboardStats().history > 0 && focusSection('history')"
          [disabled]="dashboardStats().history === 0"
          class="group relative p-4 rounded-2xl text-left
                 bg-white border border-slate-200/60
                 transition-all duration-300 ease-out overflow-hidden
                 focus:outline-none focus:ring-2 focus:ring-slate-500/20 focus:ring-offset-2"
          [class]="dashboardStats().history > 0
            ? 'shadow-sm hover:shadow-md hover:border-slate-300/80 cursor-pointer'
            : 'opacity-60 cursor-not-allowed'"
        >
          <div class="relative">
            <div class="w-10 h-10 rounded-xl bg-slate-100 flex items-center justify-center mb-3 transition-transform group-hover:scale-105">
              <svg class="w-5 h-5 text-slate-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2" stroke-width="1.75"/>
                <rect x="8" y="2" width="8" height="4" rx="1" stroke-width="1.75"/>
                <path d="M8 10h8M8 14h8M8 18h5" stroke-width="1.5" stroke-linecap="round"/>
              </svg>
            </div>
            <p class="text-3xl font-bold text-slate-900 tracking-tight">{{ dashboardStats().history }}</p>
            <p class="text-xs text-slate-500 font-medium mt-1">Historial</p>
          </div>
        </button>
      </div>
      <!-- ===== COLLAPSIBLE SECTIONS (Premium) ===== -->
      <div class="space-y-4">
        @for (section of bookingsBySection(); track section.id; let i = $index) {
          @if (section.count > 0) {
            <div class="bg-white rounded-2xl border border-slate-200/60 shadow-sm overflow-hidden
                        transition-shadow duration-300 hover:shadow-md">
              <!-- Section Header -->
              <button
                (click)="toggleSection(section.id)"
                class="w-full flex items-center justify-between p-4 text-left transition-all duration-200
                       focus:outline-none focus:bg-slate-50"
                [class]="section.id === 'action-required'
                  ? 'bg-gradient-to-r from-amber-50/80 to-transparent hover:from-amber-50'
                  : section.id === 'active'
                    ? 'bg-gradient-to-r from-emerald-50/80 to-transparent hover:from-emerald-50'
                    : 'hover:bg-slate-50/80'"
              >
                <div class="flex items-center gap-3">
                  <div class="w-10 h-10 rounded-xl flex items-center justify-center transition-transform"
                       [class]="section.id === 'action-required'
                         ? 'bg-amber-100'
                         : section.id === 'active'
                           ? 'bg-emerald-100'
                           : 'bg-slate-100'"
                       [class.scale-105]="section.expanded">
                    <span class="text-lg">{{ section.icon }}</span>
                  </div>
                  <div>
                    <h3 class="text-base font-semibold text-slate-900 tracking-tight">
                      {{ section.title }}
                    </h3>
                    <p class="text-xs text-slate-500 font-medium">
                      {{ section.count }} {{ section.count === 1 ? 'reserva' : 'reservas' }}
                    </p>
                  </div>
                </div>

                <div class="flex items-center gap-3">
                  @if (section.id === 'action-required' && section.count > 0) {
                    <span class="px-2.5 py-1 rounded-full text-xs font-semibold
                                 bg-amber-500 text-white shadow-sm shadow-amber-500/30">
                      Acción
                    </span>
                  }
                  <div class="w-8 h-8 rounded-lg bg-slate-100 flex items-center justify-center
                              transition-all duration-300"
                       [class.bg-slate-200]="section.expanded"
                       [class.rotate-180]="section.expanded">
                    <svg class="w-4 h-4 text-slate-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
                    </svg>
                  </div>
                </div>
              </button>

              <!-- Section Content -->
              @if (section.expanded) {
                <div class="px-3 pb-3 space-y-2 border-t border-slate-100">
                  @if (section.id === 'history' && section.count > 10) {
                    <cdk-virtual-scroll-viewport itemSize="100" class="h-[400px] pt-3">
                      <div class="space-y-2">
                        <ng-container *cdkVirtualFor="let booking of section.bookings">
                          <ng-container *ngTemplateOutlet="bookingCard; context: { $implicit: booking }"></ng-container>
                        </ng-container>
                      </div>
                    </cdk-virtual-scroll-viewport>
                  } @else {
                    <div class="space-y-2 pt-3">
                      @for (booking of section.bookings; track booking.id) {
                        <ng-container *ngTemplateOutlet="bookingCard; context: { $implicit: booking }"></ng-container>
                      }
                    </div>
                  }
                </div>
              }
            </div>
          }
        }
      </div>
      <!-- Show All Button (when using filters) -->
      @if (statusFilter() !== 'all') {
        <div class="text-center pt-4">
          <button
            (click)="setStatusFilter('all'); expandAllSections()"
            appPressScale
            class="inline-flex items-center gap-2 px-6 py-3 rounded-xl bg-surface-secondary text-text-primary font-medium text-sm hover:bg-surface-raised transition-colors"
          >
            Ver todas las reservas ({{ dashboardStats().total }})
          </button>
        </div>
      }
    }
  </div>
</section>

<!-- ===== BOOKING CARD TEMPLATE (PREMIUM) ===== -->
<ng-template #bookingCard let-booking>
  <article
    class="group relative rounded-xl overflow-hidden
           bg-white border border-slate-200/60
           transition-all duration-300 ease-out
           hover:shadow-lg hover:shadow-slate-900/5 hover:border-slate-300/80
           hover:-translate-y-0.5"
    [class.border-l-4]="true"
    [ngClass]="statusBorderClass(booking)"
    data-testid="booking-card"
  >
    <a [routerLink]="['/bookings', booking.id]" class="flex gap-3 p-3">
      <!-- Thumbnail with overlay -->
      <div class="relative w-20 h-20 sm:w-24 sm:h-24 flex-shrink-0 rounded-xl overflow-hidden bg-slate-100">
        @if (booking.main_photo_url) {
          <img
            [src]="booking.main_photo_url"
            [alt]="booking.car_title"
            loading="lazy"
            class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-105"
            width="96"
            height="96"
          />
          <!-- Subtle gradient overlay -->
          <div class="absolute inset-0 bg-gradient-to-t from-black/20 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>
        } @else {
          <div class="w-full h-full flex items-center justify-center bg-gradient-to-br from-slate-100 to-slate-50">
            <svg class="w-8 h-8 text-slate-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path d="M5 17h14v-5l-2-4H7l-2 4v5z" stroke-width="1.75" stroke-linejoin="round"/>
              <circle cx="7.5" cy="17" r="1.5" stroke-width="1.5"/>
              <circle cx="16.5" cy="17" r="1.5" stroke-width="1.5"/>
            </svg>
          </div>
        }
        <!-- Status Icon Badge -->
        <div class="absolute bottom-1.5 right-1.5 w-6 h-6 rounded-lg flex items-center justify-center text-xs
                    shadow-md backdrop-blur-sm border border-white/20"
             [ngClass]="statusIconBgClass(booking)">
          {{ statusIcon(booking) }}
        </div>
      </div>

      <!-- Content -->
      <div class="flex-1 min-w-0 flex flex-col justify-between py-0.5">
        <!-- Top: Car info + Status badge -->
        <div class="flex items-start justify-between gap-2">
          <div class="min-w-0 flex-1">
            <h3 class="text-sm font-semibold text-slate-900 truncate leading-tight">
              {{ booking.car_title || 'Auto' }}
            </h3>
            <p class="text-xs text-slate-500 mt-0.5 flex items-center gap-1">
              <svg class="w-3 h-3 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                      d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
              </svg>
              {{ rangeLabel(booking) }}
            </p>
            @if (booking.car_city || booking.car_province) {
              <p class="text-xs text-slate-400 truncate mt-0.5 flex items-center gap-1">
                <svg class="w-3 h-3 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/>
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"/>
                </svg>
                {{ booking.car_city || '' }}{{ booking.car_city && booking.car_province ? ', ' : '' }}{{ booking.car_province || '' }}
              </p>
            }
          </div>
          <!-- Status Badge - Premium -->
          <span class="flex-shrink-0 inline-flex items-center gap-1 px-2.5 py-1 rounded-full text-xs font-semibold
                       transition-all duration-200"
                [ngClass]="statusBadgeCompactClass(booking)">
            @if (getEffectiveStatus(booking) === 'in_progress' || getEffectiveStatus(booking) === 'confirmed') {
              <span class="w-1.5 h-1.5 rounded-full bg-current opacity-70"></span>
            }
            {{ statusLabelShort(booking) }}
          </span>
        </div>

        <!-- Bottom: Price + Action hint -->
        <div class="flex items-center justify-between mt-auto pt-2">
          <p class="text-base font-bold text-slate-900 tracking-tight">
            {{ booking.total_amount | money }}
          </p>
          <!-- Action hints with arrow -->
          <span class="text-xs font-medium flex items-center gap-1 transition-transform group-hover:translate-x-0.5"
                [class]="isPendingApproval(booking) || canCompletePay(booking)
                  ? 'text-amber-600'
                  : isPendingReview(booking)
                    ? 'text-blue-600'
                    : getEffectiveStatus(booking) === 'expired'
                      ? 'text-red-500'
                      : 'text-slate-400'">
            @if (isPendingApproval(booking)) {
              Esperando respuesta
            } @else if (canCompletePay(booking)) {
              Pago pendiente
            } @else if (isPendingReview(booking)) {
              Confirmar devolución
            } @else if (getEffectiveStatus(booking) === 'expired') {
              Vencida
            } @else {
              Ver detalle
            }
            <svg class="w-3.5 h-3.5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
            </svg>
          </span>
        </div>
      </div>
    </a>

    <!-- Quick Pay Button - Premium Style -->
    @if (canCompletePay(booking)) {
      <div class="px-3 pb-3 pt-0">
        <a
          [routerLink]="['/bookings/request']"
          [queryParams]="{ bookingId: booking.id }"
          (click)="$event.stopPropagation()"
          appPressScale
          class="w-full inline-flex items-center justify-center gap-2 px-4 py-3 rounded-xl
                 bg-slate-900 text-white text-sm font-semibold
                 shadow-md shadow-slate-900/20
                 hover:bg-slate-800 hover:shadow-lg
                 active:scale-[0.98] transition-all duration-200"
        >
          <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"/>
          </svg>
          Completar Pago
        </a>
      </div>
    }

    <!-- P2P Status Indicator - Premium -->
    @if (isPendingApproval(booking)) {
      <div class="px-3 pb-3 pt-0">
        <div class="flex items-center gap-2.5 text-xs font-medium text-amber-700
                    bg-gradient-to-r from-amber-50 to-orange-50
                    border border-amber-200/60 rounded-xl px-3 py-2.5">
          <span class="relative flex h-2 w-2">
            <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-amber-400 opacity-75"></span>
            <span class="relative inline-flex rounded-full h-2 w-2 bg-amber-500"></span>
          </span>
          <span>El propietario está revisando tu solicitud</span>
        </div>
      </div>
    }
  </article>
</ng-template>
