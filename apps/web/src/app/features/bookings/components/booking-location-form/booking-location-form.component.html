<div
  class="booking-location-form bg-surface-raised dark:bg-surface-raised rounded-lg shadow-lg p-6"
>
  <!-- Header -->
  <div class="mb-6">
    <h2 class="text-2xl font-bold text-text-primary dark:text-text-inverse mb-2">
      ¬øD√≥nde es el retiro y devoluci√≥n del auto?
    </h2>
    <p class="text-text-secondary dark:text-text-muted">
      Selecciona ubicaciones para calcular la tarifa de delivery si es necesario
    </p>
  </div>

  <!-- Pickup Location -->
  <div class="mb-8">
    <h3 class="text-lg font-semibold text-text-primary dark:text-text-inverse mb-4">
      üìç Lugar de retiro
    </h3>
    <div class="location-input-group">
      <!-- Address Input -->
      <input
        type="text"
        id="search-location"
        [(ngModel)]="pickupAddress"
        placeholder="Ej: Av. Corrientes 1234, Buenos Aires"
        class="w-full px-4 py-2 border border-border-muted dark:border-border-default rounded-lg focus:ring-2 focus:ring-cta-default dark:bg-surface-base dark:text-text-inverse"
        (input)="onPickupAddressChange()"
        [disabled]="loading()"
      />
      @if (pickupSuggestions().length > 0) {
        <div
          class="mt-2 border border-border-default dark:border-border-muted rounded-lg overflow-hidden"
        >
          @for (suggestion of pickupSuggestions(); track suggestion.address) {
            <button
              type="button"
              (click)="selectPickupSuggestion(suggestion)"
              class="w-full text-left px-4 py-2 hover:bg-surface-raised dark:hover:bg-surface-base border-b border-border-default dark:border-border-muted last:border-b-0"
            >
              <div class="font-medium text-text-primary dark:text-text-inverse">
                {{ suggestion.address }}
              </div>
              <div class="text-sm text-text-secondary">{{ suggestion.city }}</div>
            </button>
          }
        </div>
      }
      @if (pickupCoordinates()) {
        <div class="mt-2 text-sm text-success-light dark:text-success-light">
          ‚úì Ubicaci√≥n: {{ pickupCoordinates()!.lat.toFixed(4) }},
          {{ pickupCoordinates()!.lng.toFixed(4) }}
        </div>
      }
    </div>
  </div>

  <!-- Dropoff Location -->
  <div class="mb-8">
    <h3 class="text-lg font-semibold text-text-primary dark:text-text-inverse mb-4">
      üìç Lugar de devoluci√≥n
    </h3>
    <div class="location-input-group">
      <!-- Address Input -->
      <input
        type="text"
        [(ngModel)]="dropoffAddress"
        placeholder="Ej: Av. Rivadavia 5678, Buenos Aires"
        class="w-full px-4 py-2 border border-border-muted dark:border-border-default rounded-lg focus:ring-2 focus:ring-cta-default dark:bg-surface-base dark:text-text-inverse"
        (input)="onDropoffAddressChange()"
        [disabled]="loading()"
      />
      @if (dropoffSuggestions().length > 0) {
        <div
          class="mt-2 border border-border-default dark:border-border-muted rounded-lg overflow-hidden"
        >
          @for (suggestion of dropoffSuggestions(); track suggestion.address) {
            <button
              type="button"
              (click)="selectDropoffSuggestion(suggestion)"
              class="w-full text-left px-4 py-2 hover:bg-surface-raised dark:hover:bg-surface-base border-b border-border-default dark:border-border-muted last:border-b-0"
            >
              <div class="font-medium text-text-primary dark:text-text-inverse">
                {{ suggestion.address }}
              </div>
              <div class="text-sm text-text-secondary">{{ suggestion.city }}</div>
            </button>
          }
        </div>
      }
      @if (dropoffCoordinates()) {
        <div class="mt-2 text-sm text-success-light dark:text-success-light">
          ‚úì Ubicaci√≥n: {{ dropoffCoordinates()!.lat.toFixed(4) }},
          {{ dropoffCoordinates()!.lng.toFixed(4) }}
        </div>
      }
    </div>
  </div>

  <!-- Distance Display -->
  @if (distanceKm() !== null) {
    <div
      class="mb-8 p-4 bg-cta-default/10 dark:bg-cta-default rounded-lg border border-cta-default/40 dark:border-cta-default"
    >
      <div class="text-lg font-semibold text-cta-default dark:text-cta-default">
        Distancia: {{ distanceKm()! | number: '1.0-2' }} km
      </div>
      <div class="text-sm text-cta-default dark:text-cta-default">
        Categor√≠a:
        {{
          distanceTier() === 'local'
            ? 'Local'
            : distanceTier() === 'regional'
              ? 'Regional'
              : 'Larga distancia'
        }}
      </div>
    </div>
  }

  <!-- Delivery Toggle -->
  <div class="mb-8 p-4 bg-surface-base dark:bg-surface-base rounded-lg">
    <label class="flex items-center cursor-pointer">
      <input
        type="checkbox"
        [(ngModel)]="deliveryRequired"
        (change)="onDeliveryToggle()"
        [disabled]="loading() || !isWithinDeliveryRange()"
        class="w-5 h-5 text-cta-default rounded focus:ring-2 focus:ring-cta-default"
      />
      <div class="ml-3 flex-1">
        <div class="font-semibold text-text-primary dark:text-text-inverse">
          ¬øNecesitas delivery del auto?
        </div>
        <div class="text-sm text-text-secondary dark:text-text-muted">
          Entrega del auto en tu ubicaci√≥n de retiro
        </div>
        @if (!isWithinDeliveryRange()) {
          <div class="text-xs text-warning-light dark:text-warning-light mt-1">
            ‚ö†Ô∏è La distancia excede el rango de delivery (m√°x. 50 km)
          </div>
        }
      </div>
    </label>

    <!-- Delivery Fee Display -->
    @if (deliveryRequired() && deliveryFeeCents() > 0) {
      <div class="mt-4 pt-4 border-t border-border-default dark:border-border-muted">
        <div class="text-lg font-semibold text-text-primary dark:text-text-inverse">
          Tarifa de delivery: ARS ${{ deliveryFeeCents() / 100 | number: '1.2-2' }}
        </div>
        <div class="text-sm text-text-secondary dark:text-text-muted mt-1">
          Se agregar√° al precio total del alquiler
        </div>
      </div>
    }
  </div>

  <!-- Error Messages -->
  @if (errorMessage()) {
    <div
      class="mb-6 p-4 bg-error-bg dark:bg-error-900 rounded-lg border border-error-border dark:border-error-700"
    >
      <div class="text-error-strong">{{ errorMessage() }}</div>
    </div>
  }

  <!-- Action Buttons -->
  <div class="flex gap-3">
    <button
      type="button"
      (click)="onCancel()"
      [disabled]="loading()"
      class="flex-1 px-4 py-2 bg-surface-hover dark:bg-surface-base text-text-primary dark:text-text-inverse rounded-lg hover:bg-surface-pressed dark:hover:bg-gray-600 disabled:opacity-50 font-semibold"
    >
      Cancelar
    </button>
    <button
      type="button"
      (click)="onSubmit()"
      [disabled]="loading() || !isValid()"
      class="flex-1 px-4 py-2 bg-cta-default text-cta-text rounded-lg hover:bg-cta-default disabled:opacity-50 font-semibold flex items-center justify-center gap-2"
    >
      @if (loading()) {
        <span class="inline-block animate-spin">‚è≥</span>
      }
      Continuar
    </button>
  </div>
</div>
