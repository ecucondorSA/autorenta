<div class="booking-location-form bg-surface-raised rounded-lg shadow-lg p-6">
  <!-- Header -->
  <div class="mb-6">
    <h2 class="text-2xl font-bold text-text-primary mb-2 font-satoshi">
      Donde es el retiro y devolucion del auto?
    </h2>
    <p class="text-text-secondary">
      Selecciona ubicaciones para calcular la tarifa de delivery si es necesario
    </p>
  </div>

  <!-- Pickup Location -->
  <div class="mb-8">
    <h3 class="text-lg font-semibold text-text-primary mb-4 font-satoshi">Lugar de retiro</h3>
    <div class="location-input-group">
      <!-- Address Input -->
      <input
        type="text"
        id="search-location"
        [(ngModel)]="pickupAddress"
        placeholder="Ej: Av. Corrientes 1234, Buenos Aires"
        class="w-full px-4 py-2 border border-border-muted rounded-lg focus:ring-2 focus:ring-cta-default"
        (input)="onPickupAddressChange()"
        [disabled]="loading()"
      />
      @if (pickupSuggestions().length > 0) {
        <div class="mt-2 border border-border-default rounded-lg overflow-hidden">
          @for (suggestion of pickupSuggestions(); track suggestion.address) {
            <button
              type="button"
              (click)="selectPickupSuggestion(suggestion)"
              class="w-full text-left px-4 py-2 hover:bg-surface-raised border-b border-border-default last:border-b-0"
            >
              <div class="font-medium text-text-primary">
                {{ suggestion.address }}
              </div>
              <div class="text-sm text-text-secondary">{{ suggestion.city }}</div>
            </button>
          }
        </div>
      }
      @if (pickupCoordinates()) {
        <div class="mt-2 text-sm text-success-700">
          Ubicacion: {{ pickupCoordinates()!.lat.toFixed(4) }},
          {{ pickupCoordinates()!.lng.toFixed(4) }}
        </div>
      }
    </div>
  </div>

  <!-- Dropoff Location -->
  <div class="mb-8">
    <h3 class="text-lg font-semibold text-text-primary mb-4 font-satoshi">Lugar de devolucion</h3>
    <div class="location-input-group">
      <!-- Address Input -->
      <input
        type="text"
        [(ngModel)]="dropoffAddress"
        placeholder="Ej: Av. Rivadavia 5678, Buenos Aires"
        class="w-full px-4 py-2 border border-border-muted rounded-lg focus:ring-2 focus:ring-cta-default"
        (input)="onDropoffAddressChange()"
        [disabled]="loading()"
      />
      @if (dropoffSuggestions().length > 0) {
        <div class="mt-2 border border-border-default rounded-lg overflow-hidden">
          @for (suggestion of dropoffSuggestions(); track suggestion.address) {
            <button
              type="button"
              (click)="selectDropoffSuggestion(suggestion)"
              class="w-full text-left px-4 py-2 hover:bg-surface-raised border-b border-border-default last:border-b-0"
            >
              <div class="font-medium text-text-primary">
                {{ suggestion.address }}
              </div>
              <div class="text-sm text-text-secondary">{{ suggestion.city }}</div>
            </button>
          }
        </div>
      }
      @if (dropoffCoordinates()) {
        <div class="mt-2 text-sm text-success-700">
          Ubicacion: {{ dropoffCoordinates()!.lat.toFixed(4) }},
          {{ dropoffCoordinates()!.lng.toFixed(4) }}
        </div>
      }
    </div>
  </div>

  <!-- Distance Display -->
  @if (distanceKm() !== null) {
    <div class="mb-8 p-4 bg-cta-default/10 rounded-lg border border-cta-default/40">
      <div class="text-lg font-semibold text-cta-default">
        Distancia: {{ distanceKm()! | number: '1.0-2' }} km
      </div>
      <div class="text-sm text-cta-default">
        Categoria:
        {{
          distanceTier() === 'local'
            ? 'Local'
            : distanceTier() === 'regional'
              ? 'Regional'
              : 'Larga distancia'
        }}
      </div>
    </div>
  }

  <!-- Delivery Toggle -->
  <div class="mb-8 p-4 bg-surface-base rounded-lg">
    <label class="flex items-center cursor-pointer">
      <input
        type="checkbox"
        [(ngModel)]="deliveryRequired"
        (change)="onDeliveryToggle()"
        [disabled]="loading() || !isWithinDeliveryRange()"
        class="w-5 h-5 text-cta-default rounded focus:ring-2 focus:ring-cta-default"
      />
      <div class="ml-3 flex-1">
        <div class="font-semibold text-text-primary">Necesitas delivery del auto?</div>
        <div class="text-sm text-text-secondary">Entrega del auto en tu ubicacion de retiro</div>
        @if (!isWithinDeliveryRange()) {
          <div class="text-xs text-warning-700 mt-1">
            La distancia excede el rango de delivery (max. 50 km)
          </div>
        }
      </div>
    </label>

    <!-- Delivery Fee Display -->
    @if (deliveryRequired() && deliveryFeeCents() > 0) {
      <div class="mt-4 pt-4 border-t border-border-default">
        <div class="text-lg font-semibold text-text-primary">
          Tarifa de delivery: ARS ${{ deliveryFeeCents() / 100 | number: '1.2-2' }}
        </div>
        <div class="text-sm text-text-secondary mt-1">
          Se agregara al precio total de la reserva
        </div>
      </div>
    }
  </div>

  <!-- Error Messages -->
  @if (errorMessage()) {
    <div class="mb-6 p-4 bg-error-bg rounded-lg border border-error-border">
      <div class="text-error-strong">{{ errorMessage() }}</div>
    </div>
  }

  <!-- Action Buttons -->
  <div class="flex gap-3">
    <button
      type="button"
      (click)="onCancel()"
      [disabled]="loading()"
      class="flex-1 px-4 py-2 bg-surface-hover text-text-primary rounded-lg hover:bg-surface-pressed disabled:opacity-50 font-semibold"
    >
      Cancelar
    </button>
    <button
      type="button"
      (click)="onSubmit()"
      [disabled]="loading() || !isValid()"
      class="flex-1 px-4 py-2 bg-cta-default text-cta-text rounded-lg hover:bg-cta-default disabled:opacity-50 font-semibold flex items-center justify-center gap-2"
    >
      @if (loading()) {
        <span class="inline-block animate-spin">...</span>
      }
      Continuar
    </button>
  </div>
</div>
