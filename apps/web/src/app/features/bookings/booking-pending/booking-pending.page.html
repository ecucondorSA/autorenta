<div class="min-h-screen bg-surface-default flex items-center justify-center px-4">
  <!-- Loading State -->
  @if (loading()) {
    <app-loading-state />
  }

  <!-- Main Content -->
  @if (!loading()) {
    <div class="max-w-md w-full">
      <div class="bg-surface-raised rounded-xl p-8 text-center">
        <!-- Animated Icon -->
        <div class="mb-6 relative">
          <div
            class="w-24 h-24 mx-auto rounded-full bg-warning-light/20 flex items-center justify-center animate-pulse"
          >
            <svg
              class="w-12 h-12 text-warning-strong"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"
              />
            </svg>
          </div>
          <div class="absolute inset-0 flex items-center justify-center">
            <div class="w-24 h-24 rounded-full border-4 border-warning-light/40 animate-ping"></div>
          </div>
        </div>
        <!-- Title -->
        <h1 class="text-2xl font-bold text-text-primary mb-2 font-satoshi">Procesando tu Pago</h1>
        <!-- Description -->
        <p class="text-text-secondary mb-6">
          Estamos verificando tu pago con MercadoPago. Esto puede tardar unos momentos.
        </p>
        <!-- Progress Indicator -->
        <div class="mb-6">
          <div class="flex items-center justify-center gap-2 mb-2">
            <div
              class="w-3 h-3 bg-warning-light rounded-full animate-bounce"
              style="animation-delay: 0s"
            ></div>
            <div
              class="w-3 h-3 bg-warning-light rounded-full animate-bounce"
              style="animation-delay: 0.2s"
            ></div>
            <div
              class="w-3 h-3 bg-warning-light rounded-full animate-bounce"
              style="animation-delay: 0.4s"
            ></div>
          </div>
          <p class="text-xs text-text-secondary">Verificación {{ checkCount() }}/{{ maxChecks }}</p>
        </div>
        <!-- Booking Info -->
        @if (booking()) {
          <div class="bg-surface-default rounded-lg p-4 mb-6 text-left">
            <h3 class="text-sm font-semibold text-text-primary mb-2 font-satoshi">
              Detalles de la Reserva
            </h3>
            <div class="space-y-1 text-xs text-text-secondary">
              <div class="flex justify-between">
                <span>ID de Reserva:</span>
                @if (booking()?.id) {
                  <span class="font-mono">{{ booking()!.id!.slice(0, 8) }}</span>
                }
              </div>
              @if (car()) {
                <div class="flex justify-between">
                  <span>Vehículo:</span>
                  <span>{{ car()!.title }}</span>
                </div>
              }
              <div class="flex justify-between">
                <span>Monto Total:</span>
                <span class="font-semibold">
                  {{
                    (booking()!.total_amount ?? 0) | money
                  }}
                </span>
              </div>
            </div>
          </div>
        }
        <!-- Info Message -->
        <div class="bg-info-light/10 border border-info-light/20 rounded-lg p-4 mb-6">
          <div class="flex items-start gap-2">
            <svg
              class="w-5 h-5 text-info-strong mt-0.5 flex-shrink-0"
              fill="currentColor"
              viewBox="0 0 20 20"
            >
              <path
                fill-rule="evenodd"
                d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z"
                clip-rule="evenodd"
              />
            </svg>
            <div class="text-left text-sm text-info-strong">
              <p class="font-semibold mb-1">No cierres esta ventana</p>
              <p class="text-info-text">
                El proceso de verificación puede tardar hasta 5 minutos. Te notificaremos cuando el
                pago sea confirmado.
              </p>
            </div>
          </div>
        </div>
        <!-- Actions -->
        <div class="space-y-3">
          <!-- View Booking Details -->
          <app-button [fullWidth]="true" variant="secondary" (onClick)="goToBookingDetail()">
            Ver Detalles de la Reserva
          </app-button>
          <!-- Contact Support (appears after some time) -->
          @if (checkCount() > 10) {
            <button
              (click)="contactSupport()"
              class="w-full text-sm text-text-secondary hover:text-cta-default transition-colors"
            >
              ¿Necesitas ayuda? Contacta soporte
            </button>
          }
        </div>
        <!-- Timeout Message -->
        @if (checkCount() >= maxChecks) {
          <div class="mt-6">
            <div class="bg-warning-light/10 border border-warning-light/20 rounded-lg p-4">
              <p class="text-sm text-warning-strong mb-3">
                La verificación está tardando más de lo esperado
              </p>
              <div class="space-y-2">
                <app-button [fullWidth]="true" size="sm" (onClick)="retryPayment()">
                  Intentar Nuevo Pago
                </app-button>
                <button
                  (click)="contactSupport()"
                  class="w-full text-xs text-text-secondary hover:text-cta-default transition-colors"
                >
                  Contactar Soporte
                </button>
              </div>
            </div>
          </div>
        }
      </div>
      <!-- Additional Help Text -->
      <p class="text-center text-xs text-text-secondary mt-4">
        Si el pago fue debitado de tu cuenta pero no se refleja aquí,
        <button (click)="contactSupport()" class="text-cta-default hover:underline">
          contacta a nuestro equipo
        </button>
      </p>
    </div>
  }
</div>
