<div class="inspection-uploader">
  <!-- Header -->
  <div class="header">
    <h2>{{ stageLabel() }} del Veh√≠culo</h2>
    <button class="close-btn" (click)="cancel()" [disabled]="saving()">‚úï</button>
  </div>

  <!-- Error message -->
  @if (error()) {
    <div class="error-message">‚ö†Ô∏è {{ error() }}</div>
  }

  <!-- Photo upload section -->
  <div class="photo-section">
    <h3>Fotos del Veh√≠culo</h3>
    <p class="hint">
      Sub√≠ al menos 8 fotos claras del veh√≠culo: exterior (4 √°ngulos), interior, od√≥metro, nivel de
      combustible, y cualquier da√±o existente.
    </p>

    <!-- Upload button -->
    <div class="upload-btn-wrapper">
      <label for="photo-input" class="upload-btn" [class.disabled]="uploading()">
        @if (uploading()) {
          <span class="spinner"></span>
          Subiendo...
        } @else {
          üì∏ Subir Fotos
        }
      </label>
      <input
        id="photo-input"
        type="file"
        multiple
        accept="image/*"
        (change)="onPhotosSelected($event)"
        [disabled]="uploading() || saving()"
      />
    </div>

    <!-- Photo count indicator -->
    <div class="photo-count">
      @if (photoCount() >= 8) {
        <span class="success">‚úÖ {{ photoCount() }} fotos subidas</span>
      } @else {
        <span class="warning">
          ‚ö†Ô∏è {{ photoCount() }} / 8 fotos (faltan {{ missingPhotos() }})
        </span>
      }
    </div>

    <!-- Photo grid -->
    @if (photos().length > 0) {
      <div class="photo-grid">
        @for (photo of photos(); track photo.url; let i = $index) {
          <div class="photo-item">
            <img [src]="photo.url" [alt]="'Foto ' + (i + 1)" />
            <button class="remove-photo" (click)="removePhoto(i)" [disabled]="saving()">üóëÔ∏è</button>
          </div>
        }
      </div>
    }
  </div>

  <!-- Vehicle data section -->
  <div class="data-section">
    <h3>Datos del Veh√≠culo</h3>

    <!-- Odometer -->
    <div class="form-group">
      <label for="odometer">Kilometraje</label>
      <input
        id="odometer"
        type="number"
        [(ngModel)]="odometer"
        min="0"
        step="1"
        placeholder="Ej: 45000"
        [disabled]="saving()"
      />
      @if (odometer <= 0) {
        <span class="field-hint error">‚ö†Ô∏è Ingrese el kilometraje</span>
      }
    </div>

    <!-- Fuel level -->
    <div class="form-group">
      <label for="fuel-level">Nivel de Combustible (%)</label>
      <div class="fuel-input-wrapper">
        <input
          id="fuel-level"
          type="range"
          [(ngModel)]="fuelLevel"
          min="0"
          max="100"
          step="5"
          [disabled]="saving()"
        />
        <span class="fuel-value">{{ fuelLevel }}%</span>
      </div>
      <div class="fuel-indicator">
        <div class="fuel-bar" [style.width.%]="fuelLevel"></div>
      </div>
    </div>
  </div>

  <!-- Actions -->
  <div class="actions">
    <button class="btn btn-secondary" (click)="cancel()" [disabled]="saving()">Cancelar</button>

    <button class="btn btn-primary" (click)="save()" [disabled]="!isValid() || saving()">
      @if (saving()) {
        <span class="spinner"></span>
        Guardando...
      } @else {
        ‚úÖ Guardar y Firmar
      }
    </button>
  </div>

  <!-- Validation hints -->
  @if (!isValid()) {
    <div class="validation-hints">
      <h4>Para continuar necesit√°s:</h4>
      <ul>
        @if (photoCount() < 8) {
          <li>‚ùå Subir al menos 8 fotos (ten√©s {{ photoCount() }})</li>
        } @else {
          <li>‚úÖ Fotos completas</li>
        }

        @if (odometer <= 0) {
          <li>‚ùå Ingresar el kilometraje</li>
        } @else {
          <li>‚úÖ Kilometraje registrado</li>
        }

        <li>‚úÖ Nivel de combustible: {{ fuelLevel }}%</li>
      </ul>
    </div>
  }
</div>
