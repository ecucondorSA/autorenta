<div class="bonus-protector-simulator">
  <ion-card>
    <ion-card-header>
      <ion-card-title>Simulador de Protector de Bonus</ion-card-title>
      <ion-card-subtitle> Simula el impacto de un siniestro con y sin protector </ion-card-subtitle>
    </ion-card-header>
    <ion-card-content>
      <!-- Current Status -->
      <div class="mb-6">
        <h3 class="text-lg font-semibold mb-3">Estado Actual</h3>
        <div class="grid grid-cols-2 gap-4">
          <div>
            <p class="text-sm text-text-secondary">Clase Actual</p>
            <ion-badge [color]="getClassColor(currentClass())" class="text-xl">
              Clase {{ currentClass() }}
            </ion-badge>
          </div>
          <div>
            <p class="text-sm text-text-secondary">Nivel Recomendado</p>
            <ion-badge color="primary" class="text-xl"> Nivel {{ recommendedLevel() }} </ion-badge>
          </div>
        </div>
      </div>

      <!-- Protection Level Selection -->
      <div class="mb-6">
        <h3 class="text-lg font-semibold mb-3">Nivel de Protección</h3>
        <ion-segment [(ngModel)]="protectionLevel">
          <ion-segment-button value="1">
            <ion-label>Nivel 1</ion-label>
          </ion-segment-button>
          <ion-segment-button value="2">
            <ion-label>Nivel 2</ion-label>
          </ion-segment-button>
          <ion-segment-button value="3">
            <ion-label>Nivel 3</ion-label>
          </ion-segment-button>
        </ion-segment>
        <div class="mt-3 p-3 bg-cta-default/10 rounded">
          <p class="text-sm text-cta-default">
            {{ protectionCapacity().description }}
          </p>
        </div>
      </div>

      <!-- Claim Severity -->
      <div class="mb-6">
        <h3 class="text-lg font-semibold mb-3">Severidad del Siniestro</h3>
        <ion-segment [(ngModel)]="claimSeverity">
          <ion-segment-button value="1">
            <ion-label>Leve</ion-label>
          </ion-segment-button>
          <ion-segment-button value="2">
            <ion-label>Moderado</ion-label>
          </ion-segment-button>
          <ion-segment-button value="3">
            <ion-label>Grave</ion-label>
          </ion-segment-button>
        </ion-segment>
      </div>

      <!-- Simulate Button -->
      <ion-button expand="block" (click)="simulateImpact()" class="mb-4">
        <ion-icon name="calculator" slot="start"></ion-icon>
        Simular Impacto
      </ion-button>

      <!-- Simulation Results -->
      <div *ngIf="simulationResult()" class="mt-6">
        <h3 class="text-lg font-semibold mb-3">Resultados de la Simulación</h3>

        <!-- Without Protector -->
        <ion-card color="danger" class="mb-4">
          <ion-card-header>
            <ion-card-title class="text-base">Sin Protector</ion-card-title>
          </ion-card-header>
          <ion-card-content>
            <div class="space-y-2">
              <p class="text-sm">
                Clase inicial:
                <strong>Clase {{ simulationResult()!.withoutProtector.oldClass }}</strong>
              </p>
              <p class="text-sm">
                Clase final:
                <strong>Clase {{ simulationResult()!.withoutProtector.newClass }}</strong>
              </p>
              <p class="text-sm font-semibold">
                Aumento: +{{ simulationResult()!.withoutProtector.increase }} clase(s)
              </p>
            </div>
          </ion-card-content>
        </ion-card>

        <!-- With Protector -->
        <ion-card
          [color]="simulationResult()!.withProtector.protected ? 'success' : 'warning'"
          class="mb-4"
        >
          <ion-card-header>
            <ion-card-title class="text-base">
              Con Protector Nivel {{ protectionLevel() }}
            </ion-card-title>
          </ion-card-header>
          <ion-card-content>
            <div class="space-y-2">
              <p class="text-sm">
                Clase inicial:
                <strong>Clase {{ simulationResult()!.withProtector.oldClass }}</strong>
              </p>
              <p class="text-sm">
                Clase final: <strong>Clase {{ simulationResult()!.withProtector.newClass }}</strong>
              </p>
              <p class="text-sm font-semibold">
                Aumento: +{{ simulationResult()!.withProtector.increase }} clase(s)
              </p>
              <p
                *ngIf="simulationResult()!.withProtector.protected"
                class="text-sm text-success-light flex items-center gap-1"
              >
                <app-icon name="check-circle" [size]="16" /> Protegido
              </p>
            </div>
          </ion-card-content>
        </ion-card>

        <!-- Savings -->
        <ion-card color="primary" class="mb-4">
          <ion-card-header>
            <ion-card-title class="text-base">Ahorro</ion-card-title>
          </ion-card-header>
          <ion-card-content>
            <div class="space-y-2">
              <p class="text-sm">
                Evitaste aumento de:
                <strong>{{ simulationResult()!.savings.classIncrease }} clase(s)</strong>
              </p>
              <p class="text-sm">
                Impacto en tarifa: <strong>{{ simulationResult()!.savings.feeImpact }}</strong>
              </p>
              <p class="text-sm">
                Impacto en garantía:
                <strong>{{ simulationResult()!.savings.guaranteeImpact }}</strong>
              </p>
            </div>
          </ion-card-content>
        </ion-card>
      </div>

      <!-- Potential Savings Calculator -->
      <div class="mt-6">
        <h3 class="text-lg font-semibold mb-3">Calculadora de Ahorro Potencial</h3>
        <ion-button expand="block" fill="outline" (click)="calculateSavings()" class="mb-4">
          <ion-icon name="trending-up" slot="start"></ion-icon>
          Calcular Ahorro Anual
        </ion-button>

        <ion-card
          *ngIf="potentialSavings()"
          [color]="potentialSavings()!.isWorthIt ? 'success' : 'warning'"
        >
          <ion-card-header>
            <ion-card-title class="text-base">Ahorro Potencial</ion-card-title>
          </ion-card-header>
          <ion-card-content>
            <div class="space-y-2">
              <p class="text-sm">
                Aumento en tarifa evitado:
                <strong>${{ potentialSavings()!.feeIncrease.toFixed(2) }} USD</strong>
              </p>
              <p class="text-sm">
                Aumento en garantía evitado:
                <strong>${{ potentialSavings()!.guaranteeIncrease.toFixed(2) }} USD</strong>
              </p>
              <p class="text-sm font-semibold text-lg">
                Ahorro total anual:
                <strong>${{ potentialSavings()!.totalSavings.toFixed(2) }} USD</strong>
              </p>
              <p
                class="text-sm flex items-center gap-1"
                [class.text-success-light]="potentialSavings()!.isWorthIt"
                [class.text-warning-text]="!potentialSavings()!.isWorthIt"
              >
                @if (potentialSavings()!.isWorthIt) {
                  <app-icon name="check-circle" [size]="16" /> Vale la pena comprar
                } @else {
                  <app-icon name="alert-circle" [size]="16" /> Considera si realmente lo necesitas
                }
              </p>
            </div>
          </ion-card-content>
        </ion-card>
      </div>
    </ion-card-content>
  </ion-card>
</div>
