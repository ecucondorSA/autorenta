<div class="payment-provider-selector">
  <!-- Header -->
  <div class="mb-4">
    <h3 class="text-lg font-semibold text-text-primary mb-1 font-satoshi font-luxury">
      Proveedor de Pago
    </h3>
    <p class="text-sm text-text-secondary">Selecciona tu método de pago preferido</p>
  </div>

  <!-- Loading State -->
  @if (isLoading()) {
  <div class="py-8 text-center">
    <div class="inline-block animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-cta-default"></div>
    <p class="text-sm text-text-secondary mt-2">Cargando opciones de pago...</p>
  </div>
  }

  <!-- Provider Options -->
  @if (!isLoading()) {
  <div class="space-y-3">
    <!-- Option 1: MercadoPago (ARS) -->
    @if (isProviderAvailable('mercadopago')) {
    <div class="provider-option border rounded-lg p-4 cursor-pointer transition-all"
      [class.border-cta-default]="selectedProvider() === 'mercadopago'"
      [class.bg-cta-default/10]="selectedProvider() === 'mercadopago'"
      [class.ring-2]="selectedProvider() === 'mercadopago'" [class.ring-blue-600]="selectedProvider() === 'mercadopago'"
      [class.border-border-default]="selectedProvider() !== 'mercadopago'"
      [class.hover:border-border-muted]="selectedProvider() !== 'mercadopago'" (click)="selectProvider('mercadopago')">
      <div class="flex items-start">
        <input type="radio" name="paymentProvider" value="mercadopago" [checked]="selectedProvider() === 'mercadopago'"
          class="mt-1 mr-3 text-cta-default focus:ring-cta-default" />
        <div class="flex-1">
          <div class="flex items-center justify-between mb-1">
            <div class="flex items-center gap-2">
              <span class="font-medium text-text-primary font-luxury">MercadoPago</span>
              <span class="text-xs px-2 py-1 bg-cta-default/20 text-cta-default rounded-full font-semibold">ARS</span>
            </div>
            <svg class="w-5 h-5 text-success-strong" fill="currentColor" viewBox="0 0 24 24">
              <path d="M12 2L2 7v10c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V7l-10-5z" />
            </svg>
          </div>
          <p class="text-sm text-text-secondary mb-2">
            {{ getProviderDescription('mercadopago') }}
          </p>
          <div class="flex items-center gap-2 flex-wrap">
            <span class="text-xs px-2 py-1 bg-surface-raised text-text-primary rounded">Débito</span>
            <span class="text-xs px-2 py-1 bg-surface-raised text-text-primary rounded">Crédito</span>
            <span class="text-xs px-2 py-1 bg-surface-raised text-text-primary rounded">Efectivo</span>
            <span class="text-xs px-2 py-1 bg-surface-raised text-text-primary rounded">Saldo MP</span>
          </div>
          @if (selectedProvider() === 'mercadopago') {
          <div class="mt-3 p-3 bg-surface-raised rounded border border-cta-default/40">
            <p class="text-sm font-medium text-text-primary">Total a pagar:</p>
            <p class="h4 text-cta-default">
              {{
              currency === 'USD'
              ? formatCurrency(amount, 'USD')
              : formatCurrency(amountARS(), 'ARS')
              }}
            </p>
            @if (currency === 'USD') {
            <p class="text-xs text-text-secondary mt-1">
              Se cobrará en MercadoPago como {{ formatCurrency(amountARS(), 'ARS') }} (≈
              {{ formatCurrency(amount, 'USD') }} × {{ exchangeRate() | number: '1.2-2' }})
            </p>
            }
          </div>
          }
        </div>
      </div>
    </div>
    }
    <!-- Option 2: PayPal (USD) -->
    @if (isProviderAvailable('paypal')) {
    <div class="provider-option border rounded-lg p-4 cursor-pointer transition-all"
      [class.border-cta-default]="selectedProvider() === 'paypal'"
      [class.bg-cta-default-10]="selectedProvider() === 'paypal'" [class.ring-2]="selectedProvider() === 'paypal'"
      [class.ring-blue-600]="selectedProvider() === 'paypal'"
      [class.border-border-default]="selectedProvider() !== 'paypal'"
      [class.hover:border-border-muted]="selectedProvider() !== 'paypal'" (click)="selectProvider('paypal')">
      <div class="flex items-start">
        <input type="radio" name="paymentProvider" value="paypal" [checked]="selectedProvider() === 'paypal'"
          class="mt-1 mr-3 text-cta-default focus:ring-cta-default" />
        <div class="flex-1">
          <div class="flex items-center justify-between mb-1">
            <div class="flex items-center gap-2">
              <span class="font-medium text-text-primary">PayPal</span>
              <span class="text-xs px-2 py-1 bg-cta-default/20 text-cta-default rounded-full font-semibold">USD</span>
            </div>
            <svg class="w-6 h-6 text-cta-default" fill="currentColor" viewBox="0 0 24 24">
              <path
                d="M20.067 8.478c.492.88.556 2.014.3 3.327-.74 3.806-3.276 5.12-6.514 5.12h-.5a.805.805 0 00-.794.68l-.04.22-.63 3.993-.032.17a.804.804 0 01-.794.679H7.72a.483.483 0 01-.477-.558L9.22 8.005a.964.964 0 01.952-.805h2.962c1.017 0 1.97.044 2.85.16 1.308.172 2.271.568 2.864 1.182.09.094.176.192.258.294.302.375.525.803.676 1.287z" />
            </svg>
          </div>
          <p class="text-sm text-text-secondary mb-2">
            {{ getProviderDescription('paypal') }}
          </p>
          <div class="flex items-center gap-2 flex-wrap">
            <span class="text-xs px-2 py-1 bg-surface-raised text-text-primary rounded">Visa</span>
            <span class="text-xs px-2 py-1 bg-surface-raised text-text-primary rounded">Mastercard</span>
            <span class="text-xs px-2 py-1 bg-surface-raised text-text-primary rounded">Amex</span>
            <span class="text-xs px-2 py-1 bg-surface-raised text-text-primary rounded">PayPal</span>
          </div>
          @if (selectedProvider() === 'paypal') {
          <div class="mt-3 p-3 bg-surface-raised rounded border border-cta-default/40">
            <p class="text-sm font-medium text-text-primary">Total a pagar:</p>
            <p class="h4 text-cta-default">
              {{ formatCurrency(amountUSD(), 'USD') }}
            </p>
            @if (currency === 'ARS') {
            <p class="text-xs text-text-secondary mt-1">
              ≈ {{ formatCurrency(amount, 'ARS') }} ÷ {{ exchangeRate() | number: '1.2-2' }}
            </p>
            }
          </div>
          }
        </div>
      </div>
    </div>
    }
    <!-- Option 3: AutoRenta Wallet -->
    @if (isProviderAvailable('wallet')) {
    <div class="provider-option border rounded-lg p-4 cursor-pointer transition-all"
      [class.border-cta-default]="selectedProvider() === 'wallet'"
      [class.bg-cta-default/10]="selectedProvider() === 'wallet'" [class.ring-2]="selectedProvider() === 'wallet'"
      [class.ring-emerald-500]="selectedProvider() === 'wallet'"
      [class.border-border-default]="selectedProvider() !== 'wallet'"
      [class.hover:border-border-muted]="selectedProvider() !== 'wallet'" (click)="selectProvider('wallet')">
      <div class="flex items-start">
        <input type="radio" name="paymentProvider" value="wallet" [checked]="selectedProvider() === 'wallet'"
          class="mt-1 mr-3 text-cta-default focus:ring-emerald-500" />
        <div class="flex-1">
          <div class="flex items-center justify-between mb-1">
            <div class="flex items-center gap-2">
              <span class="font-medium text-text-primary">AutoRenta Wallet</span>
              <span class="text-xs px-2 py-1 bg-emerald-100 text-emerald-700 rounded-full font-semibold">USD</span>
            </div>
            <svg class="w-6 h-6 text-emerald-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z" />
            </svg>
          </div>
          <p class="text-sm text-text-secondary mb-2">
            {{ getProviderDescription('wallet') }}
          </p>
          <div class="flex items-center gap-2 flex-wrap">
            <span class="text-xs px-2 py-1 bg-surface-raised text-text-primary rounded">Saldo Disponible</span>
            <span class="text-xs px-2 py-1 bg-surface-raised text-text-primary rounded">Créditos</span>
          </div>
          @if (selectedProvider() === 'wallet') {
          <div class="mt-3 p-3 bg-surface-raised rounded border border-cta-default/40">
            <p class="text-sm font-medium text-text-primary">Total a pagar:</p>
            <p class="h4 text-cta-default">
              {{ formatCurrency(amountUSD(), 'USD') }}
            </p>
            @if (currency === 'ARS') {
            <p class="text-xs text-text-secondary mt-1">
              ≈ {{ formatCurrency(amount, 'ARS') }} ÷ {{ exchangeRate() | number: '1.2-2' }}
            </p>
            }
          </div>
          }
        </div>
      </div>
    </div>
    }
  </div>
  }

  <!-- Info Banner -->
  @if (!isLoading()) {
  <div class="mt-4 p-3 bg-surface-base rounded-lg border border-border-default">
    <div class="flex items-start gap-2">
      <svg class="w-5 h-5 text-text-secondary flex-shrink-0 mt-0.5" fill="none" stroke="currentColor"
        viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
          d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
      </svg>
      <div class="text-xs text-text-secondary">
        <p class="font-medium mb-1">Información sobre monedas:</p>
        <ul class="list-disc list-inside space-y-1">
          <li><strong>MercadoPago:</strong> Procesa en pesos argentinos (ARS)</li>
          <li><strong>PayPal:</strong> Procesa en dólares estadounidenses (USD)</li>
          <li>Tipo de cambio actualizado: 1 USD = {{ exchangeRate() | number: '1.2-2' }} ARS</li>
        </ul>
      </div>
    </div>
  </div>
  }
</div>