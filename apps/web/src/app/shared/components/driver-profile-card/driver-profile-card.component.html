<div class="bg-surface-raised rounded-lg shadow-md p-6" [class.p-4]="compact">
  <!-- Loading State -->
  <div *ngIf="loading()" class="flex items-center justify-center py-8">
    <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-cta-default"></div>
  </div>

  <!-- Error State -->
  <div *ngIf="error() && !loading()" class="bg-error-bg border border-error-border rounded-lg p-4">
    <p class="text-error-text text-sm">{{ error()?.message }}</p>
    <button
      (click)="refresh()"
      class="mt-2 text-error-text hover:text-error-strong text-sm font-medium"
    >
      Reintentar
    </button>
  </div>

  <!-- Profile Content -->
  <div *ngIf="profile() && !loading()">
    <!-- Header -->
    <div class="flex items-center justify-between mb-4">
      <div class="flex items-center space-x-3">
        <div
          [class]="getClassBadgeColor(driverClass())"
          class="w-12 h-12 rounded-full flex items-center justify-center"
        >
          <span class="text-text-inverse text-xl font-bold">{{ driverClass() }}</span>
        </div>
        <div>
          <h3 class="text-lg font-semibold text-text-primary" [class.text-base]="compact">
            Clase {{ driverClass() }}
          </h3>
          <p class="text-sm text-text-secondary dark:text-text-secondary">
            {{ classDescription() }}
          </p>
        </div>
      </div>

      <!-- View Benefits Button -->
      <button
        *ngIf="!compact"
        (click)="onViewBenefits()"
        class="text-cta-default hover:text-cta-default text-sm font-medium"
      >
        Ver beneficios
      </button>
    </div>

    <!-- Progress Bar -->
    <div class="mb-4" *ngIf="!compact">
      <div class="flex justify-between text-xs text-text-secondary dark:text-text-secondary mb-1">
        <span>Clase 10 (Inicial)</span>
        <span>Clase 0 (Mejor)</span>
      </div>
      <div class="w-full bg-surface-hover rounded-full h-2">
        <div
          [style.width]="getProgressBarWidth()"
          [class]="getClassBadgeColor(driverClass())"
          class="h-2 rounded-full transition-all duration-500"
        ></div>
      </div>
    </div>

    <!-- Stats Grid -->
    <div *ngIf="showDetails" class="grid grid-cols-2 gap-4" [class.grid-cols-1]="compact">
      <!-- Driver Score -->
      <div class="bg-surface-base rounded-lg p-3">
        <div class="flex items-center justify-between">
          <span class="text-xs text-text-secondary dark:text-text-secondary"
            >Score de Conducción</span
          >
          <span [class]="getScoreColor(driverScore())" class="text-sm font-semibold">
            {{ driverScore() }}/100
          </span>
        </div>
        <p class="text-xs text-text-secondary dark:text-text-secondary mt-1">
          {{ getScoreLabel(driverScore()) }}
        </p>
      </div>

      <!-- Clean Bookings Percentage -->
      <div class="bg-surface-base rounded-lg p-3">
        <div class="flex items-center justify-between">
          <span class="text-xs text-text-secondary dark:text-text-secondary"
            >Reservas Sin Daños</span
          >
          <span class="text-sm font-semibold text-success-strong"> {{ cleanPercentage() }}% </span>
        </div>
        <p class="text-xs text-text-secondary dark:text-text-secondary mt-1">
          {{ profile()?.clean_bookings || 0 }} de {{ profile()?.total_bookings || 0 }} reservas
        </p>
      </div>

      <!-- Fee Multiplier -->
      <div class="bg-surface-base rounded-lg p-3">
        <div class="flex items-center justify-between">
          <span class="text-xs text-text-secondary dark:text-text-secondary"
            >Ajuste en Tarifas</span
          >
          <span
            [class]="
              feeMultiplier() < 1
                ? 'text-success-strong'
                : feeMultiplier() > 1
                  ? 'text-error-text'
                  : 'text-text-secondary dark:text-text-secondary'
            "
            class="text-sm font-semibold"
          >
            {{ getFeeMultiplierLabel(feeMultiplier()) }}
          </span>
        </div>
        <p class="text-xs text-text-secondary dark:text-text-secondary mt-1">
          Multiplicador: {{ feeMultiplier() }}
        </p>
      </div>

      <!-- Guarantee Multiplier -->
      <div class="bg-surface-base rounded-lg p-3">
        <div class="flex items-center justify-between">
          <span class="text-xs text-text-secondary dark:text-text-secondary"
            >Ajuste en Garantía</span
          >
          <span
            [class]="
              guaranteeMultiplier() < 1
                ? 'text-success-strong'
                : guaranteeMultiplier() > 1
                  ? 'text-error-text'
                  : 'text-text-secondary dark:text-text-secondary'
            "
            class="text-sm font-semibold"
          >
            {{ getGuaranteeMultiplierLabel(guaranteeMultiplier()) }}
          </span>
        </div>
        <p class="text-xs text-text-secondary dark:text-text-secondary mt-1">
          Multiplicador: {{ guaranteeMultiplier() }}
        </p>
      </div>
    </div>

    <!-- Compact Stats -->
    <div *ngIf="!showDetails && compact" class="mt-2 text-center">
      <p class="text-sm text-text-secondary dark:text-text-secondary">
        Score:
        <span [class]="getScoreColor(driverScore())" class="font-semibold">{{
          driverScore()
        }}</span>
        • Clean: <span class="font-semibold text-success-strong">{{ cleanPercentage() }}%</span>
      </p>
    </div>

    <!-- Call to Action -->
    <div
      *ngIf="!compact && driverClass() > 2"
      class="mt-4 bg-cta-default/10 border border-cta-default/40 rounded-lg p-3"
    >
      <p class="text-sm text-cta-default">
        <strong>¡Mejora tu clase!</strong> Completa reservas sin daños para obtener mejores tarifas
        y garantías más bajas.
      </p>
    </div>
  </div>
</div>
