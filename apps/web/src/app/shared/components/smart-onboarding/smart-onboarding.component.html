<div class="smart-onboarding">
  <!-- Header con progreso -->
  <div class="onboarding-header">
    <div class="progress-container">
      <div class="progress-bar">
        <div
          class="progress-fill"
          [style.width.%]="getProgressPercentage()"
        ></div>
      </div>
      <span class="progress-text">
        {{ currentStep() + 1 }} de {{ filteredQuestions().length }}
      </span>
    </div>

    <button
      class="skip-button"
      (click)="skipOnboarding()"
      [disabled]="loading()"
    >
      Omitir
    </button>
  </div>

  <!-- Contenido principal -->
  <div class="onboarding-content">
    <!-- Loading state -->
    <div *ngIf="loading()" class="loading-state">
      <div class="spinner"></div>
      <p>Configurando tu experiencia...</p>
    </div>

    <!-- Question content -->
    <div *ngIf="!loading() && getCurrentQuestion() as question" class="question-container">
      <!-- Question header -->
      <div class="question-header">
        <h1 class="question-title">{{ question.title }}</h1>
        <p *ngIf="question.subtitle" class="question-subtitle">{{ question.subtitle }}</p>
      </div>

      <!-- Options -->
      <div class="options-container">
        <!-- Single/Radio selection -->
        <div *ngIf="question.type === 'single' || question.type === 'role'" class="options-grid">
          <button
            *ngFor="let option of question.options"
            class="option-card"
            [class.selected]="answers()[question.id] === option.value"
            (click)="selectAnswer(question.id, option.value)"
          >
            <div class="option-icon">{{ option.icon }}</div>
            <div class="option-content">
              <div class="option-label">{{ option.label }}</div>
              <div *ngIf="option.description" class="option-description">{{ option.description }}</div>
            </div>
          </button>
        </div>

        <!-- Multiple selection -->
        <div *ngIf="question.type === 'multiple'" class="options-grid">
          <button
            *ngFor="let option of question.options"
            class="option-card multiple"
            [class.selected]="(answers()[question.id] || []).includes(option.value)"
            (click)="toggleMultipleAnswer(question.id, option.value)"
          >
            <div class="option-icon">{{ option.icon }}</div>
            <div class="option-content">
              <div class="option-label">{{ option.label }}</div>
              <div *ngIf="option.description" class="option-description">{{ option.description }}</div>
            </div>
            <div class="checkmark" *ngIf="(answers()[question.id] || []).includes(option.value)">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>
              </svg>
            </div>
          </button>
        </div>

        <!-- Location selection -->
        <div *ngIf="question.type === 'location'" class="options-grid">
          <button
            *ngFor="let option of question.options"
            class="location-option"
            [class.selected]="answers()[question.id] === option.value"
            (click)="selectAnswer(question.id, option.value)"
          >
            <div class="location-icon">{{ option.icon }}</div>
            <div class="location-label">{{ option.label }}</div>
          </button>
        </div>
      </div>

      <!-- Error message -->
      <div *ngIf="question.required && !isAnswered(question.id)" class="error-message">
        Esta pregunta es obligatoria
      </div>
    </div>
  </div>

  <!-- Navigation footer -->
  <div *ngIf="!loading()" class="onboarding-footer">
    <button
      class="nav-button secondary"
      (click)="previousStep()"
      [disabled]="currentStep() === 0"
    >
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
      </svg>
      Anterior
    </button>

    <button
      class="nav-button primary"
      (click)="nextStep()"
      [disabled]="getCurrentQuestion()?.required && !isAnswered(getCurrentQuestion()!.id)"
    >
      <span *ngIf="currentStep() < filteredQuestions().length - 1">Siguiente</span>
      <span *ngIf="currentStep() >= filteredQuestions().length - 1">Completar</span>
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
      </svg>
    </button>
  </div>
</div>
