<div class="rounded-lg border border-border-default bg-surface-raised p-6 shadow-sm">
  <h3 class="mb-4 text-lg font-semibold text-text-primary font-satoshi">
    Simulador de Liquidación
  </h3>

  <div class="mb-4 space-y-4">
    <div>
      <label class="block text-sm font-medium text-text-primary"> Monto del Siniestro (USD) </label>
      <input
        type="number"
        [(ngModel)]="claimAmountUsd"
        min="0"
        step="0.01"
        class="mt-1 block w-full rounded-md border border-border-muted px-3 py-2 shadow-sm focus:border-cta-default focus:outline-none focus:ring-cta-default"
        aria-label="Campo de entrada"
      />
    </div>

    <button
      (click)="simulate()"
      [disabled]="simulating()"
      class="rounded-lg bg-cta-default text-cta-text hover:bg-cta-default disabled:opacity-50"
    >
      @if (simulating()) {
        <span class="flex items-center gap-2">
          <span
            class="h-4 w-4 animate-spin rounded-full border-2 border-white border-t-transparent"
          ></span>
          Simulando...
        </span>
      } @else {
        Simular Waterfall
      }
    </button>
  </div>

  @if (simulationResult(); as result) {
    <div class="mt-6 space-y-4">
      @if (result.eligibility) {
        <div
          class="rounded-lg border p-4"
          [class.bg-success-light/10]="result.eligibility.eligible"
          [class.bg-error-bg]="!result.eligibility.eligible"
        >
          <h4 class="mb-2 font-semibold font-satoshi">
            Elegibilidad: {{ result.eligibility.eligible ? 'Elegible' : 'No Elegible' }}
          </h4>
          @if (result.eligibility.reasons.length > 0) {
            <ul class="list-disc pl-5 text-sm">
              @for (reason of result.eligibility.reasons; track reason) {
                <li>{{ reason }}</li>
              }
            </ul>
          }
          @if (result.eligibility.eligible) {
            <p class="mt-2 text-sm">
              Cobertura máxima: ${{ formatCurrency(result.eligibility.maxCoverCents / 100) }}
            </p>
          }
        </div>
      }

      @if (result.estimatedBreakdown) {
        <div class="rounded-lg border border-border-default bg-surface-base p-4">
          <h4 class="mb-3 font-semibold font-satoshi">Desglose Estimado</h4>
          <div class="space-y-2 text-sm">
            @if (result.estimatedBreakdown && (result.estimatedBreakdown.holdCaptured ?? 0) > 0) {
              <div class="flex justify-between">
                <span>Hold Capturado:</span>
                <span class="font-medium"
                  >${{ formatCurrency((result.estimatedBreakdown.holdCaptured ?? 0) / 100) }}</span
                >
              </div>
            }
            @if (result.estimatedBreakdown && (result.estimatedBreakdown.walletDebited ?? 0) > 0) {
              <div class="flex justify-between">
                <span>Wallet Debitado:</span>
                <span class="font-medium"
                  >${{ formatCurrency((result.estimatedBreakdown.walletDebited ?? 0) / 100) }}</span
                >
              </div>
            }
            @if (result.estimatedBreakdown && (result.estimatedBreakdown.extraCharged ?? 0) > 0) {
              <div class="flex justify-between">
                <span>Adicional:</span>
                <span class="font-medium"
                  >${{ formatCurrency((result.estimatedBreakdown.extraCharged ?? 0) / 100) }}</span
                >
              </div>
            }
            @if (result.estimatedBreakdown && (result.estimatedBreakdown.fgoPaid ?? 0) > 0) {
              <div class="flex justify-between">
                <span>FGO Pagado:</span>
                <span class="font-medium"
                  >${{ formatCurrency((result.estimatedBreakdown.fgoPaid ?? 0) / 100) }}</span
                >
              </div>
            }
            @if (
              result.estimatedBreakdown && (result.estimatedBreakdown.remainingUncovered ?? 0) > 0
            ) {
              <div class="flex justify-between border-t pt-2 font-semibold text-error-text">
                <span>Sin Cubrir:</span>
                <span
                  >${{
                    formatCurrency((result.estimatedBreakdown.remainingUncovered ?? 0) / 100)
                  }}</span
                >
              </div>
            }
          </div>
        </div>
      }
    </div>
  }

  @if (error()) {
    <div class="mt-4 rounded-lg bg-error-bg p-4 text-error-strong">
      <p class="text-sm">{{ error() }}</p>
    </div>
  }
</div>
