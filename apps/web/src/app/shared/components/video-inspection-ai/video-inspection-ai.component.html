<div class="video-inspection-ai min-h-screen bg-gray-50" data-testid="video-inspection-ai">
  <!-- Header -->
  <div class="bg-gradient-to-r from-blue-600 to-blue-700 text-white px-4 py-4">
    <div class="flex items-center justify-between">
      <h2 class="text-lg font-semibold">{{ stageLabel() }} con Video IA</h2>
      <button
        class="p-2 hover:bg-white/20 rounded-full transition-colors"
        (click)="cancel()"
        [disabled]="saving()"
      >
        <app-icon name="close" [size]="24" cssClass="text-white" />
      </button>
    </div>
  </div>

  <!-- Error Banner -->
  @if (error()) {
    <div class="bg-red-50 border-l-4 border-red-500 p-4 mx-4 mt-4 rounded">
      <div class="flex items-start gap-3">
        <app-icon name="alert-circle" [size]="20" cssClass="text-red-500 flex-shrink-0 mt-0.5" />
        <div class="flex-1">
          <p class="text-red-800">{{ error() }}</p>
        </div>
      </div>
    </div>
  }

  <!-- RECORDING VIEW -->
  @if (viewState() === 'recording') {
    <div class="flex flex-col h-[calc(100vh-80px)]">
      <!-- Camera Preview -->
      <div class="relative flex-1 bg-black">
        <video
          #videoElement
          class="w-full h-full object-cover"
          autoplay
          playsinline
          muted
        ></video>

        <!-- Recording Indicator -->
        @if (isRecording()) {
          <div class="absolute top-4 left-4 flex items-center gap-2 bg-black/60 text-white px-3 py-2 rounded-full">
            <div class="w-3 h-3 bg-red-500 rounded-full animate-pulse"></div>
            <span class="font-mono font-semibold">{{ recordingTimeFormatted() }}</span>
          </div>
        }

        <!-- Recording Guide Overlay - Car Diagram (like face recognition) -->
        @if (!isRecording()) {
          <div class="absolute inset-0 flex items-center justify-center bg-black/40">
            <div class="text-center text-white p-4 max-w-md w-full">
              <!-- Car Diagram SVG -->
              <div class="relative mx-auto mb-4" style="width: 280px; height: 200px;">
                <!-- Car body outline (top view) -->
                <svg viewBox="0 0 280 200" class="w-full h-full">
                  <!-- Car body -->
                  <path
                    d="M140 30 L180 40 L200 60 L205 80 L205 120 L200 140 L180 160 L140 170 L100 160 L80 140 L75 120 L75 80 L80 60 L100 40 Z"
                    fill="none"
                    stroke="white"
                    stroke-width="3"
                    stroke-dasharray="8,4"
                    class="animate-pulse"
                  />
                  <!-- Windshield -->
                  <ellipse cx="140" cy="65" rx="35" ry="15" fill="none" stroke="rgba(255,255,255,0.5)" stroke-width="2"/>
                  <!-- Rear window -->
                  <ellipse cx="140" cy="135" rx="30" ry="12" fill="none" stroke="rgba(255,255,255,0.5)" stroke-width="2"/>
                  <!-- Wheels -->
                  <circle cx="95" cy="70" r="12" fill="rgba(255,255,255,0.3)" stroke="white" stroke-width="2"/>
                  <circle cx="185" cy="70" r="12" fill="rgba(255,255,255,0.3)" stroke="white" stroke-width="2"/>
                  <circle cx="95" cy="130" r="12" fill="rgba(255,255,255,0.3)" stroke="white" stroke-width="2"/>
                  <circle cx="185" cy="130" r="12" fill="rgba(255,255,255,0.3)" stroke="white" stroke-width="2"/>
                </svg>

                <!-- Area labels around car -->
                <div class="absolute -top-2 left-1/2 -translate-x-1/2 px-3 py-1 bg-blue-500 text-white text-xs font-bold rounded-full">
                  FRENTE
                </div>
                <div class="absolute top-1/2 -left-2 -translate-y-1/2 px-2 py-1 bg-blue-500 text-white text-xs font-bold rounded-full -rotate-90 origin-center">
                  IZQUIERDO
                </div>
                <div class="absolute top-1/2 -right-2 -translate-y-1/2 px-2 py-1 bg-blue-500 text-white text-xs font-bold rounded-full rotate-90 origin-center">
                  DERECHO
                </div>
                <div class="absolute -bottom-2 left-1/2 -translate-x-1/2 px-3 py-1 bg-blue-500 text-white text-xs font-bold rounded-full">
                  TRASERA
                </div>
                <div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 px-2 py-1 bg-green-500 text-white text-xs font-bold rounded">
                  INTERIOR
                </div>
              </div>

              <h3 class="text-xl font-semibold mb-2">Grab√° el veh√≠culo</h3>
              <p class="text-sm opacity-90 mb-3">
                Camin√° lentamente alrededor del auto siguiendo las indicaciones
              </p>

              <!-- Recording steps preview -->
              <div class="flex justify-center gap-1 mb-3">
                <div class="flex items-center gap-1 text-xs bg-white/20 px-2 py-1 rounded">
                  <span class="w-4 h-4 rounded-full bg-blue-500 text-white text-xs flex items-center justify-center">1</span>
                  Frente
                </div>
                <div class="flex items-center gap-1 text-xs bg-white/20 px-2 py-1 rounded">
                  <span class="w-4 h-4 rounded-full bg-blue-500 text-white text-xs flex items-center justify-center">2</span>
                  Laterales
                </div>
                <div class="flex items-center gap-1 text-xs bg-white/20 px-2 py-1 rounded">
                  <span class="w-4 h-4 rounded-full bg-blue-500 text-white text-xs flex items-center justify-center">3</span>
                  Trasera
                </div>
                <div class="flex items-center gap-1 text-xs bg-white/20 px-2 py-1 rounded">
                  <span class="w-4 h-4 rounded-full bg-green-500 text-white text-xs flex items-center justify-center">4</span>
                  Interior
                </div>
              </div>

              <p class="text-xs opacity-75">
                M√≠nimo {{ minVideoSeconds() }}s, recomendado {{ recommendedVideoSeconds() }}s
              </p>
            </div>
          </div>
        }

        <!-- Areas Guide with Car Diagram (while recording) -->
        @if (isRecording()) {
          <div class="absolute bottom-20 left-0 right-0 px-4">
            <div class="bg-black/70 backdrop-blur-sm rounded-xl p-4 text-white">
              <!-- Mini car diagram with progress -->
              <div class="flex items-center gap-4">
                <!-- Mini car SVG -->
                <div class="relative flex-shrink-0" style="width: 80px; height: 60px;">
                  <svg viewBox="0 0 80 60" class="w-full h-full">
                    <!-- Simplified car outline -->
                    <path
                      d="M40 8 L55 12 L62 20 L62 40 L55 48 L40 52 L25 48 L18 40 L18 20 L25 12 Z"
                      fill="none"
                      stroke="white"
                      stroke-width="2"
                    />
                    <!-- Wheels -->
                    <circle cx="26" cy="22" r="5" fill="rgba(255,255,255,0.4)"/>
                    <circle cx="54" cy="22" r="5" fill="rgba(255,255,255,0.4)"/>
                    <circle cx="26" cy="38" r="5" fill="rgba(255,255,255,0.4)"/>
                    <circle cx="54" cy="38" r="5" fill="rgba(255,255,255,0.4)"/>
                  </svg>
                  <!-- Animated recording indicator -->
                  <div class="absolute top-0 left-1/2 -translate-x-1/2 w-2 h-2 bg-red-500 rounded-full animate-ping"></div>
                </div>

                <!-- Recording checklist -->
                <div class="flex-1">
                  <p class="text-xs font-medium mb-2 opacity-80">Checklist de grabaci√≥n:</p>
                  <div class="grid grid-cols-3 gap-1 text-xs">
                    <div class="flex items-center gap-1" [class.opacity-50]="recordingTime() < 10">
                      <div class="w-3 h-3 rounded-full border border-white flex items-center justify-center"
                           [class.bg-green-500]="recordingTime() >= 10" [class.border-green-500]="recordingTime() >= 10">
                        @if (recordingTime() >= 10) {
                          <app-icon name="check" [size]="8" cssClass="text-white" />
                        }
                      </div>
                      <span>Frente</span>
                    </div>
                    <div class="flex items-center gap-1" [class.opacity-50]="recordingTime() < 20">
                      <div class="w-3 h-3 rounded-full border border-white flex items-center justify-center"
                           [class.bg-green-500]="recordingTime() >= 20" [class.border-green-500]="recordingTime() >= 20">
                        @if (recordingTime() >= 20) {
                          <app-icon name="check" [size]="8" cssClass="text-white" />
                        }
                      </div>
                      <span>Lat. Izq.</span>
                    </div>
                    <div class="flex items-center gap-1" [class.opacity-50]="recordingTime() < 30">
                      <div class="w-3 h-3 rounded-full border border-white flex items-center justify-center"
                           [class.bg-green-500]="recordingTime() >= 30" [class.border-green-500]="recordingTime() >= 30">
                        @if (recordingTime() >= 30) {
                          <app-icon name="check" [size]="8" cssClass="text-white" />
                        }
                      </div>
                      <span>Trasera</span>
                    </div>
                    <div class="flex items-center gap-1" [class.opacity-50]="recordingTime() < 40">
                      <div class="w-3 h-3 rounded-full border border-white flex items-center justify-center"
                           [class.bg-green-500]="recordingTime() >= 40" [class.border-green-500]="recordingTime() >= 40">
                        @if (recordingTime() >= 40) {
                          <app-icon name="check" [size]="8" cssClass="text-white" />
                        }
                      </div>
                      <span>Lat. Der.</span>
                    </div>
                    <div class="flex items-center gap-1" [class.opacity-50]="recordingTime() < 50">
                      <div class="w-3 h-3 rounded-full border border-white flex items-center justify-center"
                           [class.bg-green-500]="recordingTime() >= 50" [class.border-green-500]="recordingTime() >= 50">
                        @if (recordingTime() >= 50) {
                          <app-icon name="check" [size]="8" cssClass="text-white" />
                        }
                      </div>
                      <span>Tablero</span>
                    </div>
                    <div class="flex items-center gap-1" [class.opacity-50]="recordingTime() < 60">
                      <div class="w-3 h-3 rounded-full border border-white flex items-center justify-center"
                           [class.bg-green-500]="recordingTime() >= 60" [class.border-green-500]="recordingTime() >= 60">
                        @if (recordingTime() >= 60) {
                          <app-icon name="check" [size]="8" cssClass="text-white" />
                        }
                      </div>
                      <span>Interior</span>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Current step indicator -->
              <div class="mt-3 pt-3 border-t border-white/20 text-center">
                @if (recordingTime() < 10) {
                  <p class="text-sm font-medium">
                    <span class="animate-pulse">üëâ</span> Grab√° el <span class="text-blue-400 font-bold">FRENTE</span> del veh√≠culo
                  </p>
                } @else if (recordingTime() < 20) {
                  <p class="text-sm font-medium">
                    <span class="animate-pulse">üëâ</span> Ahora el <span class="text-blue-400 font-bold">LATERAL IZQUIERDO</span>
                  </p>
                } @else if (recordingTime() < 30) {
                  <p class="text-sm font-medium">
                    <span class="animate-pulse">üëâ</span> Ahora la <span class="text-blue-400 font-bold">PARTE TRASERA</span>
                  </p>
                } @else if (recordingTime() < 40) {
                  <p class="text-sm font-medium">
                    <span class="animate-pulse">üëâ</span> Ahora el <span class="text-blue-400 font-bold">LATERAL DERECHO</span>
                  </p>
                } @else if (recordingTime() < 50) {
                  <p class="text-sm font-medium">
                    <span class="animate-pulse">üëâ</span> Abr√≠ la puerta y grab√° el <span class="text-green-400 font-bold">TABLERO</span>
                  </p>
                } @else if (recordingTime() < 60) {
                  <p class="text-sm font-medium">
                    <span class="animate-pulse">üëâ</span> Grab√° el <span class="text-green-400 font-bold">INTERIOR</span> (asientos)
                  </p>
                } @else {
                  <p class="text-sm font-medium text-green-400">
                    ‚úÖ ¬°Excelente! Pod√©s detener o seguir grabando detalles
                  </p>
                }
              </div>
            </div>
          </div>
        }
      </div>

      <!-- Recording Controls -->
      <div class="bg-white border-t p-4 safe-area-bottom">
        @if (!isRecording()) {
          <div class="flex gap-3">
            <button
              class="flex-1 py-3 px-4 bg-gray-100 text-gray-700 rounded-lg font-medium hover:bg-gray-200 transition-colors"
              (click)="switchToPhotos.emit()"
            >
              <app-icon name="camera" [size]="18" cssClass="inline-block mr-2" />
              Usar Fotos
            </button>
            <button
              class="flex-1 py-3 px-4 bg-red-500 text-white rounded-lg font-medium hover:bg-red-600 transition-colors flex items-center justify-center gap-2"
              (click)="startRecording()"
            >
              <div class="w-4 h-4 bg-white rounded-full"></div>
              Iniciar Grabaci√≥n
            </button>
          </div>
        } @else {
          <button
            class="w-full py-3 px-4 rounded-lg font-medium transition-colors flex items-center justify-center gap-2"
            [class]="canStopRecording() ? 'bg-blue-600 text-white hover:bg-blue-700' : 'bg-gray-300 text-gray-500 cursor-not-allowed'"
            [disabled]="!canStopRecording()"
            (click)="stopRecording()"
          >
            @if (canStopRecording()) {
              <div class="w-4 h-4 bg-white rounded"></div>
              Detener y Analizar
            } @else {
              <span>Grabando... ({{ minVideoSeconds() - recordingTime() }}s restantes)</span>
            }
          </button>
        }
      </div>
    </div>

    <!-- Video Preview (after recording, before processing) -->
    @if (recordedVideo() && !isRecording()) {
      <div class="fixed inset-0 bg-black/80 z-50 flex flex-col">
        <div class="flex-1 flex items-center justify-center p-4">
          <video
            #previewVideo
            [src]="recordedVideoUrl()"
            class="max-h-full max-w-full rounded-lg"
            controls
          ></video>
        </div>
        <div class="bg-white p-4 safe-area-bottom">
          <div class="flex gap-3">
            <button
              class="flex-1 py-3 px-4 bg-gray-100 text-gray-700 rounded-lg font-medium hover:bg-gray-200"
              (click)="retryRecording()"
            >
              Grabar de nuevo
            </button>
            <button
              class="flex-1 py-3 px-4 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700"
              (click)="processVideo()"
            >
              Analizar con IA
            </button>
          </div>
        </div>
      </div>
    }
  }

  <!-- PROCESSING VIEW -->
  @if (viewState() === 'processing') {
    <div class="flex flex-col items-center justify-center min-h-[60vh] p-6">
      <div class="w-20 h-20 mb-6 relative">
        <svg class="animate-spin w-20 h-20 text-blue-600" viewBox="0 0 24 24">
          <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4" fill="none"></circle>
          <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
        </svg>
      </div>

      <h3 class="text-xl font-semibold text-gray-800 mb-2">Analizando con IA</h3>
      <p class="text-gray-600 mb-6 text-center">{{ processingStep() }}</p>

      <!-- Progress Bar -->
      <div class="w-full max-w-xs bg-gray-200 rounded-full h-2.5 mb-2">
        <div
          class="bg-blue-600 h-2.5 rounded-full transition-all duration-300"
          [style.width.%]="processingProgress()"
        ></div>
      </div>
      <p class="text-sm text-gray-500">{{ processingProgress() }}%</p>
    </div>
  }

  <!-- RESULTS VIEW -->
  @if (viewState() === 'results') {
    <div class="p-4 pb-32">
      <!-- Summary Card -->
      <div class="bg-white rounded-xl shadow-sm border p-4 mb-4">
        <h3 class="text-lg font-semibold text-gray-800 mb-3 flex items-center gap-2">
          <app-icon name="analytics" [size]="20" cssClass="text-blue-600" />
          Resultados del An√°lisis
        </h3>

        <p class="text-gray-600 text-sm">{{ analysisResult()?.summary }}</p>

        <!-- Warnings -->
        @if (analysisResult()?.warnings?.length) {
          <div class="mt-3 space-y-2">
            @for (warning of analysisResult()?.warnings; track warning) {
              <div class="flex items-start gap-2 text-amber-700 bg-amber-50 p-2 rounded text-sm">
                <app-icon name="alert-triangle" [size]="16" cssClass="flex-shrink-0 mt-0.5" />
                <span>{{ warning }}</span>
              </div>
            }
          </div>
        }
      </div>

      <!-- Odometer & Fuel -->
      <div class="bg-white rounded-xl shadow-sm border p-4 mb-4">
        <h3 class="text-lg font-semibold text-gray-800 mb-4">Datos del Veh√≠culo</h3>

        <!-- Odometer -->
        <div class="mb-4">
          <label class="block text-sm font-medium text-gray-700 mb-1">
            Kilometraje
            @if (analysisResult()?.odometer) {
              <span class="text-xs text-gray-500 ml-2">
                (IA: {{ getConfidencePercentage(analysisResult()?.odometer?.confidence || 0) }} confianza)
              </span>
            }
          </label>
          <div class="flex items-center gap-2">
            <input
              type="number"
              [ngModel]="editableOdometer()"
              (ngModelChange)="editableOdometer.set($event)"
              class="flex-1 px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
              min="0"
              placeholder="Ej: 45000"
            aria-label="Ej: 45000" />
            <span class="text-gray-500">km</span>
          </div>
          @if (editableOdometer() <= 0) {
            <p class="text-red-500 text-xs mt-1">
              <app-icon name="alert-circle" [size]="12" cssClass="inline-block mr-1" />
              Ingres√° el kilometraje
            </p>
          }
        </div>

        <!-- Fuel Level -->
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">
            Nivel de Combustible
            @if (analysisResult()?.fuel_level) {
              <span class="text-xs text-gray-500 ml-2">
                (IA: {{ getConfidencePercentage(analysisResult()?.fuel_level?.confidence || 0) }} confianza)
              </span>
            }
          </label>
          <div class="flex items-center gap-3">
            <input
              type="range"
              [ngModel]="editableFuelLevel()"
              (ngModelChange)="editableFuelLevel.set($event)"
              min="0"
              max="100"
              step="5"
              class="flex-1"
            />
            <span class="font-semibold text-gray-800 w-12 text-right">{{ editableFuelLevel() }}%</span>
          </div>
          <div class="mt-2 h-3 bg-gray-200 rounded-full overflow-hidden">
            <div
              class="h-full transition-all duration-300"
              [class]="editableFuelLevel() > 25 ? 'bg-green-500' : editableFuelLevel() > 10 ? 'bg-yellow-500' : 'bg-red-500'"
              [style.width.%]="editableFuelLevel()"
            ></div>
          </div>
        </div>
      </div>

      <!-- Areas Detected -->
      <div class="bg-white rounded-xl shadow-sm border p-4 mb-4">
        <h3 class="text-lg font-semibold text-gray-800 mb-3">√Åreas Detectadas</h3>
        <div class="flex flex-wrap gap-2">
          @for (area of ['front', 'rear', 'left_side', 'right_side', 'interior', 'dashboard', 'trunk']; track area) {
            @if (analysisResult()?.areas_detected) {
              <span
                class="px-3 py-1 rounded-full text-sm font-medium"
                [class]="$any(analysisResult()?.areas_detected)?.[area] ? 'bg-green-100 text-green-800' : 'bg-gray-100 text-gray-500'"
              >
                @if ($any(analysisResult()?.areas_detected)?.[area]) {
                  <app-icon name="check" [size]="14" cssClass="inline-block mr-1" />
                }
                {{ getAreaLabel($any(area)) }}
              </span>
            }
          }
        </div>
        @if (missingAreas().length > 0) {
          <p class="text-amber-600 text-sm mt-3">
            <app-icon name="alert-triangle" [size]="14" cssClass="inline-block mr-1" />
            √Åreas no detectadas: {{ missingAreas().join(', ') }}
          </p>
        }
      </div>

      <!-- Detected Damages -->
      <div class="bg-white rounded-xl shadow-sm border p-4 mb-4">
        <div class="flex items-center justify-between mb-4">
          <h3 class="text-lg font-semibold text-gray-800">
            Da√±os Detectados
            <span class="text-sm font-normal text-gray-500 ml-2">
              ({{ confirmedDamagesCount() }} de {{ damages().length }})
            </span>
          </h3>
        </div>

        @if (damages().length === 0) {
          <div class="text-center py-6 text-gray-500">
            <app-icon name="check-circle" [size]="40" cssClass="mx-auto mb-2 text-green-500" />
            <p>No se detectaron da√±os en el veh√≠culo</p>
          </div>
        } @else {
          <div class="space-y-4">
            @for (damage of damages(); track damage.frame_url; let i = $index) {
              <div
                class="border rounded-lg overflow-hidden"
                [class]="damage.discarded ? 'opacity-50 bg-gray-50' : ''"
              >
                <div class="flex">
                  <!-- Thumbnail -->
                  <div class="w-24 h-24 flex-shrink-0">
                    <img
                      [src]="damage.frame_url"
                      alt="Da√±o detectado"
                      class="w-full h-full object-cover" width="96" height="96" />
                  </div>

                  <!-- Info -->
                  <div class="flex-1 p-3">
                    <div class="flex items-start justify-between">
                      <div>
                        <h4 class="font-medium text-gray-800">
                          {{ DAMAGE_LABELS[damage.type] }}
                        </h4>
                        <p class="text-sm text-gray-600">{{ damage.description }}</p>
                        <p class="text-xs text-gray-500 mt-1">
                          {{ damage.location }}
                        </p>
                      </div>
                      <span
                        class="px-2 py-1 rounded text-xs font-medium"
                        [class]="getSeverityClass(damage.severity)"
                      >
                        {{ SEVERITY_LABELS[damage.severity] }}
                      </span>
                    </div>

                    <!-- Confidence -->
                    <div class="flex items-center gap-2 mt-2 text-xs text-gray-500">
                      <span>Confianza: {{ getConfidencePercentage(damage.confidence) }}</span>
                    </div>

                    <!-- Actions -->
                    <div class="flex gap-2 mt-2">
                      @if (!damage.discarded) {
                        <button
                          class="text-xs px-3 py-1 bg-red-100 text-red-700 rounded hover:bg-red-200"
                          (click)="discardDamage(i)"
                        >
                          Descartar
                        </button>
                        @if (!damage.confirmed) {
                          <button
                            class="text-xs px-3 py-1 bg-green-100 text-green-700 rounded hover:bg-green-200"
                            (click)="confirmDamage(i)"
                          >
                            Confirmar
                          </button>
                        } @else {
                          <span class="text-xs px-3 py-1 bg-green-500 text-white rounded">
                            Confirmado
                          </span>
                        }
                      } @else {
                        <button
                          class="text-xs px-3 py-1 bg-gray-200 text-gray-700 rounded hover:bg-gray-300"
                          (click)="restoreDamage(i)"
                        >
                          Restaurar
                        </button>
                        <span class="text-xs text-gray-500">Descartado</span>
                      }
                    </div>
                  </div>
                </div>
              </div>
            }
          </div>
        }
      </div>
    </div>

    <!-- Fixed Bottom Actions -->
    <div class="fixed bottom-0 left-0 right-0 bg-white border-t p-4 safe-area-bottom">
      <div class="flex gap-3">
        <button
          class="flex-1 py-3 px-4 bg-gray-100 text-gray-700 rounded-lg font-medium hover:bg-gray-200"
          (click)="retryRecording()"
          [disabled]="saving()"
        >
          Grabar de nuevo
        </button>
        <button
          class="flex-1 py-3 px-4 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2"
          (click)="saveInspection()"
          [disabled]="!isValid() || saving()"
        >
          @if (saving()) {
            <div class="w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"></div>
            Guardando...
          } @else {
            <app-icon name="check" [size]="18" />
            Guardar Inspecci√≥n
          }
        </button>
      </div>
    </div>
  }

  <!-- ERROR VIEW -->
  @if (viewState() === 'error') {
    <div class="flex flex-col items-center justify-center min-h-[60vh] p-6 text-center">
      <div class="w-16 h-16 mb-4 rounded-full bg-red-100 flex items-center justify-center">
        <app-icon name="alert-circle" [size]="32" cssClass="text-red-500" />
      </div>
      <h3 class="text-xl font-semibold text-gray-800 mb-2">Error</h3>
      <p class="text-gray-600 mb-6">{{ error() }}</p>

      <div class="flex gap-3">
        <button
          class="py-3 px-6 bg-gray-100 text-gray-700 rounded-lg font-medium hover:bg-gray-200"
          (click)="switchToPhotos.emit()"
        >
          Usar Fotos
        </button>
        <button
          class="py-3 px-6 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700"
          (click)="retryRecording()"
        >
          Reintentar
        </button>
      </div>
    </div>
  }
</div>
