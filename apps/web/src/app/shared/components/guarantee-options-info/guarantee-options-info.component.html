<div
  class="rounded-2xl border border-cta-default/30 bg-gradient-to-br from-cta-default/15 via-white-pure to-white-pure shadow-soft p-6 space-y-4"
  >
  <div class="flex flex-col gap-4 md:flex-row md:items-start md:justify-between">
    <div class="flex items-start gap-3 md:max-w-xl">
      <svg
        class="w-6 h-6 text-cta-default mt-0.5 flex-shrink-0"
        fill="none"
        stroke="currentColor"
        viewBox="0 0 24 24"
        >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="2"
          d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"
        ></path>
      </svg>
      <div class="flex-1 space-y-2">
        <p
          class="text-xs uppercase tracking-wide text-cta-default font-semibold"
          >
          Opciones para garantizar tu reserva
        </p>
        <div class="flex flex-col gap-2 sm:flex-row sm:items-center sm:gap-3">
          <h3 class="text-lg font-semibold text-text-primary font-satoshi">
            Eleg√≠ c√≥mo activar tu protecci√≥n
          </h3>
          <span
            class="inline-flex items-center gap-1 px-3 py-1 text-xs font-semibold rounded-full"
            [ngClass]="{
              'bg-success-bg-hover text-success-strong': protectedCreditStatus === 'active',
              'bg-warning-bg-hover text-warning-strong': protectedCreditStatus === 'partial',
              'bg-surface-secondary text-text-secondary':
                protectedCreditStatus === 'pending',
            }"
            >
            <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M12 11V7m0 8h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"
              ></path>
            </svg>
            @switch (protectedCreditStatus) {
              @case ('active') {
                Activo
              }
              @case ('partial') {
                En progreso
              }
              @default {
                Pendiente
              }
            }
          </span>
        </div>
        <!-- Comparison Table -->
        <div class="space-y-4">
          <!-- Option Headers -->
          <div class="grid gap-3 sm:grid-cols-2">
            <div
              class="rounded-xl border border-border-default/70 bg-surface-raised p-4"
              >
              <p class="text-base font-bold text-text-secondary">
                1. Tarjeta de cr√©dito
              </p>
              <p
                class="text-xs text-text-secondary mt-1"
                >
                M√©todo tradicional
              </p>
            </div>
            <div
              class="rounded-xl border-2 border-warning-300 bg-warning-bg p-4 relative"
              >
              <div
                class="absolute -top-2 -right-2 px-2 py-1 rounded-lg bg-cta-default text-cta-text text-xs font-bold shadow-soft"
                >
                Recomendado
              </div>
              <p class="text-base font-bold text-warning-strong">
                2. Cr√©dito Autorentar
              </p>
              <p class="text-xs text-warning-strong mt-1">
                Sin tarjeta internacional
              </p>
            </div>
          </div>

          <!-- Comparison Rows -->
          <div class="space-y-2">
            <!-- Row: Requiere tarjeta internacional -->
            <div
              class="grid gap-3 sm:grid-cols-2 items-center p-3 rounded-lg bg-border-default/30"
              >
              <div class="sm:col-span-2">
                <p
                  class="text-xs uppercase tracking-wide font-semibold text-text-secondary"
                  >
                  Requiere tarjeta internacional
                </p>
              </div>
              <div class="flex items-center gap-2 justify-center sm:justify-start">
                <svg
                  class="w-5 h-5 text-error-500"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                  >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M6 18L18 6M6 6l12 12"
                    />
                </svg>
                <span class="text-sm font-medium text-error-text">S√≠</span>
              </div>
              <div class="flex items-center gap-2 justify-center sm:justify-start">
                <svg
                  class="w-5 h-5 text-success-500"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                  >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M5 13l4 4L19 7"
                    />
                </svg>
                <span class="text-sm font-medium text-success-text">No</span>
              </div>
            </div>

            <!-- Row: Monto bloqueado -->
            <div
              class="grid gap-3 sm:grid-cols-2 items-center p-3 rounded-lg bg-surface-raised"
              >
              <div class="sm:col-span-2">
                <p
                  class="text-xs uppercase tracking-wide font-semibold text-text-secondary"
                  >
                  Monto bloqueado por reserva
                </p>
              </div>
              <div class="text-center sm:text-left">
                <p class="text-sm font-semibold text-text-secondary">
                  USD 500 - 1.200
                </p>
                <p
                  class="text-xs text-text-secondary"
                  >
                  Variable
                </p>
              </div>
              <div class="text-center sm:text-left">
                <p class="text-sm font-semibold text-warning-strong">
                  USD 300 - 900
                </p>
                <p class="text-xs text-warning-text/70">Fijo una vez</p>
              </div>
            </div>

            <!-- Row: Reembolsable -->
            <div
              class="grid gap-3 sm:grid-cols-2 items-center p-3 rounded-lg bg-border-default/30"
              >
              <div class="sm:col-span-2">
                <p
                  class="text-xs uppercase tracking-wide font-semibold text-text-secondary"
                  >
                  Reembolsable a cuenta bancaria
                </p>
              </div>
              <div class="flex items-center gap-2 justify-center sm:justify-start">
                <svg
                  class="w-5 h-5 text-success-500"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                  >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M5 13l4 4L19 7"
                    />
                </svg>
                <span class="text-sm font-medium text-success-text"
                  >S√≠, autom√°tico</span
                  >
                </div>
                <div class="flex items-center gap-2 justify-center sm:justify-start">
                  <svg
                    class="w-5 h-5 text-warning-500"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                    >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M6 18L18 6M6 6l12 12"
                      />
                  </svg>
                  <span class="text-sm font-medium text-warning-strong"
                    >No, se reutiliza</span
                    >
                  </div>
                </div>

                <!-- Row: Configuraci√≥n -->
                <div
                  class="grid gap-3 sm:grid-cols-2 items-center p-3 rounded-lg bg-surface-raised"
                  >
                  <div class="sm:col-span-2">
                    <p
                      class="text-xs uppercase tracking-wide font-semibold text-text-secondary"
                      >
                      Configuraci√≥n requerida
                    </p>
                  </div>
                  <div class="text-center sm:text-left">
                    <p class="text-sm font-semibold text-text-secondary">
                      Cada reserva
                    </p>
                    <p
                      class="text-xs text-text-secondary"
                      >
                      Ingresar datos
                    </p>
                  </div>
                  <div class="text-center sm:text-left">
                    <p class="text-sm font-semibold text-success-strong">
                      Una sola vez
                    </p>
                    <p class="text-xs text-success-text/70">Uso autom√°tico</p>
                  </div>
                </div>

                <!-- Row: Tiempo de liberaci√≥n -->
                <div
                  class="grid gap-3 sm:grid-cols-2 items-center p-3 rounded-lg bg-border-default/30"
                  >
                  <div class="sm:col-span-2">
                    <p
                      class="text-xs uppercase tracking-wide font-semibold text-text-secondary"
                      >
                      Liberaci√≥n de fondos
                    </p>
                  </div>
                  <div class="text-center sm:text-left">
                    <p class="text-sm font-semibold text-text-secondary">
                      5-10 d√≠as h√°biles
                    </p>
                    <p
                      class="text-xs text-text-secondary"
                      >
                      Post-viaje
                    </p>
                  </div>
                  <div class="text-center sm:text-left">
                    <p class="text-sm font-semibold text-success-strong">
                      Inmediato
                    </p>
                    <p class="text-xs text-success-text/70 font-friendly">Post-viaje</p>
                  </div>
                </div>

                <!-- Row: Ideal para -->
                <div
                  class="grid gap-3 sm:grid-cols-2 items-center p-3 rounded-lg bg-surface-raised"
                  >
                  <div class="sm:col-span-2">
                    <p
                      class="text-xs uppercase tracking-wide font-semibold text-text-secondary"
                      >
                      Ideal para
                    </p>
                  </div>
                  <div class="text-center sm:text-left">
                    <p class="text-xs text-text-secondary leading-relaxed">
                      Usuarios con tarjeta internacional habilitada
                    </p>
                  </div>
                  <div class="text-center sm:text-left">
                    <p class="text-xs text-warning-strong leading-relaxed">
                      Viajeros del exterior o sin tarjeta internacional
                    </p>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="flex flex-col items-stretch gap-3">
          <button
            type="button"
            (click)="openDepositModal.emit()"
            class="inline-flex items-center justify-center gap-2 rounded-xl bg-cta-default text-cta-text shadow-soft hover:bg-cta-default/90 transition-base"
            >
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M12 4v16m8-8H4"
              ></path>
            </svg>
            Configurar Cr√©dito Autorentar
          </button>
          <div
            class="rounded-xl bg-gradient-to-br from-white to-cta-default/5 border-2 border-cta-default/30 px-4 py-4 space-y-3 shadow-soft"
            >
            <div class="flex items-start justify-between gap-2">
              <p class="font-bold text-sm text-text-primary">
                Progreso cr√©dito protegido
              </p>
              <!-- Celebration icon when near completion (>= 80%) -->
              @if (protectedCreditProgress >= 80) {
                <span class="text-lg" title="¬°Casi listo!">üéâ</span>
              }
            </div>

            <!-- Amount Display -->
            <div class="flex items-baseline justify-between gap-2">
              <div class="flex items-baseline gap-2">
                <span class="text-xl font-bold text-cta-default">
                  USD {{ protectedCreditBalance | number: '1.2-2' }}
                </span>
                <span
                  class="text-xs text-text-secondary"
                  >
                  / USD {{ protectedCreditTarget | number: '1.0-0' }}
                </span>
              </div>
              <span
                class="text-sm font-semibold px-2 py-1 rounded-lg"
            [ngClass]="{
              'bg-success-bg-hover text-success-strong': protectedCreditProgress === 100,
              'bg-warning-bg-hover text-warning-strong':
                protectedCreditProgress >= 80 && protectedCreditProgress < 100,
              'bg-primary-50 text-primary-700': protectedCreditProgress < 80,
            }"
                >
                {{ protectedCreditProgress | number: '1.0-0' }}%
              </span>
            </div>

            <!-- Amount Remaining (only if not complete) -->
            @if (protectedCreditProgress < 100) {
              <p class="text-xs font-medium text-text-secondary">
                <span class="text-warning-strong">
                  Te faltan USD
                  {{ (protectedCreditTarget - protectedCreditBalance) | number: '1.2-2' }}
                </span>
                para completar tu cr√©dito protegido
              </p>
            }

            <!-- Progress Bar (larger and more prominent) -->
            <div
              class="relative h-3 rounded-full bg-surface-secondary overflow-hidden shadow-inner"
              title="Una vez completes USD 300, podr√°s reservar sin tarjeta"
              >
              <div
                class="h-full rounded-full transition-all duration-500 ease-out"
            [ngClass]="{
              'bg-gradient-to-r from-success-500 to-success-600': protectedCreditProgress === 100,
              'bg-gradient-to-r from-warning-500 to-cta-default':
                protectedCreditProgress >= 50 && protectedCreditProgress < 100,
              'bg-cta-default': protectedCreditProgress < 50,
            }"
                [style.width.%]="protectedCreditProgress"
              ></div>
            </div>

            <!-- Completion Message -->
            @if (protectedCreditProgress === 100) {
              <div
                class="flex items-center gap-2 px-3 py-2 rounded-lg bg-success-bg border border-success-border"
                >
                <svg
                  class="w-4 h-4 text-success-text flex-shrink-0"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                  >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M5 13l4 4L19 7"
                    />
                </svg>
                <p class="text-xs font-semibold text-success-strong">
                  ¬°Cr√©dito protegido activado! Ya puedes reservar sin tarjeta.
                </p>
              </div>
            }

            <!-- Tooltip/Help Text -->
            <p
              class="text-xs text-text-secondary flex items-start gap-1.5"
              >
              <svg
                class="w-3.5 h-3.5 flex-shrink-0 mt-0.5"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
                >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"
                  />
              </svg>
              <span>
                Este monto se reutiliza en cada reserva y se libera despu√©s de cada viaje completado.
              </span>
            </p>
          </div>
        </div>
      </div>
    </div>
