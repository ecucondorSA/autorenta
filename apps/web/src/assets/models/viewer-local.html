<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Autorenta - Visor 3D</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        .container {
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            padding: 30px;
            max-width: 1000px;
            width: 100%;
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        .header h1 { font-size: 2.5em; color: #333; }
        .header p { color: #666; margin-top: 10px; }
        .content {
            display: grid;
            grid-template-columns: 1fr 250px;
            gap: 20px;
        }
        canvas {
            border-radius: 10px;
            background: linear-gradient(180deg, #e0e7ff 0%, #f3e7ff 100%);
            display: block;
            width: 100%;
            min-height: 500px;
        }
        .sidebar {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
        }
        .sidebar h3 {
            color: #333;
            margin-bottom: 15px;
            font-size: 1em;
        }
        .color-btn {
            display: block;
            width: 100%;
            padding: 10px;
            margin-bottom: 10px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            color: white;
            font-weight: 600;
            transition: all 0.2s;
        }
        .color-btn:hover { transform: translateY(-2px); box-shadow: 0 4px 8px rgba(0,0,0,0.2); }
        .color-btn.rojo { background: #FF0000; }
        .color-btn.azul { background: #0033FF; }
        .color-btn.blanco { background: #FFFFFF; color: #333; border: 2px solid #ddd; }
        .color-btn.negro { background: #1A1A1A; }
        .info { margin-top: 20px; padding: 15px; background: #e7f5ff; border-radius: 8px; border-left: 4px solid #4DABF7; }
        .info p { color: #1971C2; font-size: 0.85em; }
        .loading { text-align: center; padding: 50px; color: #667eea; }
        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        @media (max-width: 768px) {
            .content { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üöó Autorenta</h1>
            <p>Visor 3D de Autos - Selector de Colores</p>
        </div>

        <div class="content">
            <canvas id="canvas"></canvas>

            <div class="sidebar">
                <h3>üé® Colores</h3>
                <button class="color-btn rojo" onclick="changeColor(0xFF0000)">Rojo</button>
                <button class="color-btn azul" onclick="changeColor(0x0033FF)">Azul</button>
                <button class="color-btn blanco" onclick="changeColor(0xFFFFFF)">Blanco</button>
                <button class="color-btn negro" onclick="changeColor(0x1A1A1A)">Negro</button>

                <div class="info">
                    <p><strong>üí° Controles:</strong></p>
                    <p>üñ±Ô∏è Arrastra para rotar<br>üîÑ Scroll para zoom</p>
                </div>
            </div>
        </div>
    </div>

    <script src="../lib/three.min.js"></script>
    <script>
        let scene, camera, renderer, car;

        function init() {
            // Scene
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0xe0e7ff);

            // Camera
            const canvas = document.getElementById('canvas');
            camera = new THREE.PerspectiveCamera(75, canvas.clientWidth / canvas.clientHeight, 0.1, 1000);
            camera.position.set(5, 3, 5);

            // Renderer
            renderer = new THREE.WebGLRenderer({ antialias: true, canvas });
            renderer.setSize(canvas.clientWidth, canvas.clientHeight);
            renderer.setPixelRatio(window.devicePixelRatio);

            // Lights
            const ambient = new THREE.AmbientLight(0xffffff, 0.6);
            scene.add(ambient);

            const directional = new THREE.DirectionalLight(0xffffff, 0.8);
            directional.position.set(10, 15, 10);
            scene.add(directional);

            // Controles b√°sicos
            let isDragging = false;
            let previousMousePosition = { x: 0, y: 0 };

            canvas.addEventListener('mousedown', (e) => { isDragging = true; previousMousePosition = { x: e.clientX, y: e.clientY }; });
            canvas.addEventListener('mousemove', (e) => {
                if (isDragging && car) {
                    const deltaX = e.clientX - previousMousePosition.x;
                    const deltaY = e.clientY - previousMousePosition.y;
                    car.rotation.y += deltaX * 0.005;
                    car.rotation.x += deltaY * 0.005;
                    previousMousePosition = { x: e.clientX, y: e.clientY };
                }
            });
            canvas.addEventListener('mouseup', () => { isDragging = false; });

            canvas.addEventListener('wheel', (e) => {
                e.preventDefault();
                camera.position.z += e.deltaY * 0.01;
                camera.position.z = Math.max(2, Math.min(20, camera.position.z));
            });

            // Cargar modelo
            loadModel();

            // Resize
            window.addEventListener('resize', () => {
                const w = canvas.clientWidth;
                const h = canvas.clientHeight;
                camera.aspect = w / h;
                camera.updateProjectionMatrix();
                renderer.setSize(w, h);
            });

            // Animaci√≥n
            animate();
        }

        function loadModel() {
            const loader = new THREE.GLTFLoader();
            loader.load('./car-3d-model-pbr-optimized.glb', (gltf) => {
                car = gltf.scene;
                car.scale.set(1, 1, 1);
                car.position.set(0, 0, 0);

                car.traverse((node) => {
                    if (node.isMesh) {
                        node.castShadow = true;
                        node.receiveShadow = true;
                    }
                });

                scene.add(car);
                console.log('‚úì Modelo cargado');
            }, undefined, (error) => {
                console.error('Error:', error);
                alert('Error cargando modelo. Verifica la consola.');
            });
        }

        function changeColor(hex) {
            if (!car) return;
            car.traverse((child) => {
                if (child.isMesh && child.material) {
                    child.material.color.setHex(hex);
                }
            });
        }

        function animate() {
            requestAnimationFrame(animate);
            if (car) {
                car.rotation.y += 0.005; // Rotaci√≥n autom√°tica
            }
            renderer.render(scene, camera);
        }

        window.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
