<!doctype html>
<html lang="es">

<head>
  <meta charset="utf-8" />
  <title>Autorentar - Comparte tu auto, encuentra el tuyo</title>
  <base href="/" />
  <meta name="viewport"
    content="width=device-width, initial-scale=1, maximum-scale=5, viewport-fit=cover" />

  <!-- SEO Meta Tags -->
  <meta name="robots" content="index, follow" />
  <meta name="description"
    content="Comparte tu auto cuando no lo usas y gana beneficios. Encuentra el auto perfecto para tu viaje. Reserva f√°cil, r√°pida y segura." />
  <meta name="keywords"
    content="autos compartidos, carsharing, compartir auto, uruguay, autorentar, comunidad autos" />
  <meta name="author" content="Autorentar" />
  <meta name="tiktok-developers-site-verification" content="GRIz5qjvcGDIOvq4kx7mriQCMVbR4g1r" />

  <!-- Favicon -->
  <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <link rel="apple-touch-icon" href="/assets/images/autorentar-logo.png" />

  <!-- Preconnect for external APIs (performance optimization) -->
  <link rel="preconnect" href="https://api.mapbox.com" crossorigin />
  <link rel="preconnect" href="https://sdk.mercadopago.com" crossorigin />
  <link rel="preconnect" href="https://pisqjmoklivzpwufhscx.supabase.co" crossorigin />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link rel="dns-prefetch" href="https://api.mapbox.com" />
  <link rel="dns-prefetch" href="https://sdk.mercadopago.com" />
  <link rel="dns-prefetch" href="https://events.mapbox.com" />
  <link rel="dns-prefetch" href="https://pisqjmoklivzpwufhscx.supabase.co" />

  <!-- Mapbox GL CSS -->
  <link href="https://api.mapbox.com/mapbox-gl-js/v3.16.0/mapbox-gl.css" rel="stylesheet" />

  <!-- Google Analytics 4 -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-WV2PWTKG2E"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag() {
      dataLayer.push(arguments);
    }
    gtag('js', new Date());
    gtag('config', 'G-WV2PWTKG2E', {
      send_page_view: true,
      cookie_flags: 'SameSite=None;Secure',
    });
  </script>

  <!-- Ionicons - Loaded async to not block LCP -->
  <script type="module" async
    src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.esm.js"></script>
  <script nomodule async src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.js"></script>

  <!-- Open Graph / Facebook -->
  <meta property="og:type" content="website" />
  <meta property="og:url" content="https://autorentar.com/" />
  <meta property="og:title" content="Autorentar - Comparte tu auto, encuentra el tuyo" />
  <meta property="og:description"
    content="Comparte tu auto cuando no lo usas y gana beneficios. Encuentra el auto perfecto para tu viaje." />
  <meta property="og:image" content="/assets/images/autorentar-logo.png" />

  <!-- Twitter -->
  <meta property="twitter:card" content="summary_large_image" />
  <meta property="twitter:url" content="https://autorentar.com/" />
  <meta property="twitter:title" content="Autorentar - Comparte tu auto, encuentra el tuyo" />
  <meta property="twitter:description"
    content="Comparte tu auto cuando no lo usas y gana beneficios. Encuentra el auto perfecto para tu viaje." />
  <meta property="twitter:image" content="/assets/images/autorentar-logo.png" />

  <!-- Theme Color -->
  <meta name="theme-color" content="#ffffff" />

  <!-- Content Security Policy -->
  <!-- NOTE: This meta tag is overridden by _headers file in production -->
  <!-- Keep in sync with apps/web/public/_headers and apps/web/scripts/create-cloudflare-config.js -->
  <meta http-equiv="Content-Security-Policy"
    content="default-src 'self'; script-src 'self' 'unsafe-inline' 'unsafe-eval' https://*.googletagmanager.com https://www.googletagmanager.com https://*.google-analytics.com https://sdk.mercadopago.com https://*.mercadopago.com https://*.mercadolibre.com https://*.mlstatic.com https://api.mapbox.com https://unpkg.com https://www.gstatic.com https://ajax.googleapis.com https://static.cloudflareinsights.com https://connect.facebook.net; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com https://api.mapbox.com https://unpkg.com https://*.mlstatic.com https://api.fontshare.com; img-src 'self' data: https: blob: https://i.pravatar.cc https://*.facebook.com https://platform-lookaside.fbsbx.com; font-src 'self' data: https://fonts.gstatic.com https://unpkg.com https://*.mlstatic.com https://cdn.fontshare.com; media-src 'self' blob:; connect-src 'self' blob: data: http://localhost:8787 https://*.supabase.co wss://*.supabase.co https://*.mercadopago.com https://api.mercadopago.com https://events.mercadopago.com https://*.mercadolibre.com https://*.mlstatic.com https://*.workers.dev https://*.run.app wss://*.run.app https://api.mapbox.com https://events.mapbox.com https://*.mapbox.com https://sql.mapbox.com https://*.googletagmanager.com https://www.googletagmanager.com https://*.google-analytics.com https://www.google-analytics.com https://*.analytics.google.com https://region1.google-analytics.com https://stats.g.doubleclick.net https://www.googleapis.com https://generativelanguage.googleapis.com wss://generativelanguage.googleapis.com https://api.binance.com https://data-api.binance.vision https://parallelum.com.br https://unpkg.com https://www.gstatic.com https://fonts.gstatic.com https://api.unsplash.com https://images.unsplash.com https://ui-avatars.com https://ipapi.co https://placehold.co https://api.fontshare.com https://cdn.fontshare.com https://cloudflareinsights.com https://static.cloudflareinsights.com https://graph.facebook.com; frame-src 'self' https://*.mercadopago.com https://*.mercadopago.com.ar https://mercadopago.com.ar https://*.mercadolibre.com https://sdk.mercadopago.com https://calendar.google.com https://*.facebook.com https://web.facebook.com; worker-src 'self' blob: https://www.gstatic.com; object-src 'none'; base-uri 'self'; form-action 'self' https://*.mercadopago.com https://facebook.com;" />

  <!-- PWA Configuration -->
  <meta name="mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <link rel="apple-touch-icon" href="/icons/apple-touch-icon-180.png" />
  <link rel="apple-touch-startup-image" href="/icons/apple-splash-2048x2732.png"
    media="(device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)" />
  <link rel="apple-touch-startup-image" href="/icons/apple-splash-1284x2778.png"
    media="(device-width: 428px) and (device-height: 926px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)" />

  <!-- Preload critical fonts for instant text rendering -->
  <link rel="preload" href="/assets/fonts/inter-var.woff2" as="font" type="font/woff2" crossorigin
    fetchpriority="high" />
  <link rel="preload" href="/assets/fonts/satoshi/satoshi-variable.woff2" as="font"
    type="font/woff2" crossorigin fetchpriority="high" />
  <link rel="preload" href="/assets/fonts/clash-display/clash-display-variable.woff2" as="font"
    type="font/woff2" crossorigin fetchpriority="high" />
  <link rel="preload" href="/assets/fonts/plus-jakarta-sans/plus-jakarta-sans-variable.ttf"
    as="font" type="font/ttf" crossorigin fetchpriority="high" />

  <!-- Mapbox GL JS is loaded lazily by MapboxPreloaderService when needed -->
  <!-- Removed preload to avoid "not used within a few seconds" warning -->

  <!-- PWA Manifests -->
  <link rel="manifest" href="manifest.webmanifest" />
  <link rel="manifest" href="manifest-v2.webmanifest" />
</head>

<body>
  <!-- Facebook SDK for Web -->
  <script>
    window.fbAsyncInit = function () {
      FB.init({
        appId: '4435998730015502',
        cookie: true,
        xfbml: true,
        version: 'v22.0'
      });
      FB.AppEvents.logPageView();
    };
  </script>
  <script async defer crossorigin="anonymous"
    src="https://connect.facebook.net/en_US/sdk.js"></script>

  <!-- Skip Link - Accessibility (WCAG 2.4.1) -->
  <a href="#main-content" class="skip-link"> Saltar al contenido principal </a>

  <!-- Runtime environment configuration (loaded before Angular) -->
  <!-- __ENV_CONFIG__ -->
  <script>
    if (!window.__env) {
      (function () {
        // Detect if running in Capacitor
        var isCapacitor = window.Capacitor !== undefined ||
          (window.location.protocol === 'https:' && window.location.hostname === 'localhost');

        try {
          var xhr = new XMLHttpRequest();
          // Use simple path without cache-busting query for better Capacitor compatibility
          var envPath = isCapacitor ? '/env.js' : '/env.js?v=' + Date.now();
          console.log('[ENV] üîÑ Loading environment from:', envPath);
          xhr.open('GET', envPath, false); // Synchronous

          xhr.send();
          console.log('[ENV] üì° XHR status:', xhr.status);
          if (xhr.status === 200 && xhr.responseText) {
            console.log('[ENV] üìÑ Response (first 100 chars):', xhr.responseText.substring(0, 100));
            eval(xhr.responseText);
            if (window.__env) {
              console.log('[ENV] ‚úÖ Successfully loaded window.__env with', Object.keys(window.__env).length, 'variables');
              console.log('[ENV] üîë Mapbox token loaded:', window.__env.NG_APP_MAPBOX_ACCESS_TOKEN ? 'YES (' + window.__env.NG_APP_MAPBOX_ACCESS_TOKEN.substring(0, 15) + '...)' : 'NO');
            } else {
              console.error('[ENV] ‚ùå eval() ran but window.__env is still undefined');
            }
          } else {
            console.warn('[ENV] ‚ö†Ô∏è env.js returned status:', xhr.status);
          }
        } catch (e) {
          console.error('[ENV] ‚ùå Failed to load env.js:', e.message || e);
          // Initialize empty env to prevent app from breaking
          window.__env = window.__env || {};
        }
      })();
    } else {
      console.log('[ENV] ‚ÑπÔ∏è window.__env already exists (preloaded)');
    }
  </script>

  <!-- Debug API stub for e2e tests - populated by DebugService -->
  <script>
    // Early stub for e2e tests - DebugService will replace this with full implementation
    if (
      new URLSearchParams(window.location.search).get('debug') === '1' ||
      localStorage.getItem('autorentar_debug') === 'true'
    ) {
      window.__AR_DEBUG__ = window.__AR_DEBUG__ || {
        _logs: [],
        _httpLogs: [],
        _isEnabled: true,
        getLogs: function () {
          return this._logs;
        },
        getHttpLogs: function () {
          return this._httpLogs;
        },
        getLogsByContext: function (ctx) {
          return this._logs.filter(function (l) {
            return l.context && l.context.toLowerCase().includes(ctx.toLowerCase());
          });
        },
        getLogsByLevel: function (level) {
          return this._logs.filter(function (l) {
            return l.level === level;
          });
        },
        getErrorCount: function () {
          return this._logs.filter(function (l) {
            return l.level === 'ERROR' || l.level === 'CRITICAL';
          }).length;
        },
        getWarnCount: function () {
          return this._logs.filter(function (l) {
            return l.level === 'WARN';
          }).length;
        },
        isEnabled: function () {
          return this._isEnabled;
        },
        enable: function () {
          this._isEnabled = true;
          localStorage.setItem('autorentar_debug', 'true');
        },
        disable: function () {
          this._isEnabled = false;
          localStorage.removeItem('autorentar_debug');
        },
        clear: function () {
          this._logs = [];
          this._httpLogs = [];
        },
        exportLogs: function () {
          return JSON.stringify(
            {
              exportTime: new Date().toISOString(),
              logs: this._logs,
              httpLogs: this._httpLogs,
            },
            null,
            2,
          );
        },
        // Stub method - DebugService will add entries via _addLog
        _addLog: function (entry) {
          this._logs.push(entry);
        },
        _addHttpLog: function (entry) {
          this._httpLogs.push(entry);
        },
        sessionInfo: {
          startTime: new Date(),
          userAgent: navigator.userAgent,
          platform: navigator.platform,
          language: navigator.language,
          screenSize: window.innerWidth + 'x' + window.innerHeight,
          environment: 'development',
        },
      };
      console.log('[AR] Debug API stub initialized');
    }
  </script>

  <app-root></app-root>
  <noscript>Please enable JavaScript to continue using this application.</noscript>

  <!-- Service Worker Registration -->
  <!-- DISABLED: Angular ngsw-worker.js not being generated in build -->
  <!-- TODO: Enable Angular Service Worker in angular.json if offline support needed -->
  <script>
    // Service Worker temporarily disabled due to build configuration
    // Service Worker temporarily disabled due to build configuration
    // console.log('‚ö†Ô∏è Service Worker disabled - enable in angular.json if needed');

    // Install prompt for PWA
    let deferredPrompt;
    window.addEventListener('beforeinstallprompt', (e) => {
      e.preventDefault();
      deferredPrompt = e;
      // console.log('üí° PWA install prompt ready');

      // Dispatch custom event for app to show install button
      window.dispatchEvent(new CustomEvent('pwa-install-available', { detail: e }));
    });

    // Track PWA installation
    window.addEventListener('appinstalled', () => {
      // console.log('‚úÖ PWA installed successfully');
      deferredPrompt = null;
    });

    // Show PWA install banner on iOS Safari
    if (
      /iPhone|iPad|iPod/.test(navigator.userAgent) &&
      !window.navigator.standalone &&
      !window.matchMedia('(display-mode: standalone)').matches
    ) {
      // console.log('üí° iOS: Show "Add to Home Screen" hint');
      window.dispatchEvent(new CustomEvent('ios-install-hint'));
    }
  </script>

  <!-- Network status monitoring -->
  <script>
    window.addEventListener('online', () => {
      console.log('üåê Online');
      window.dispatchEvent(
        new CustomEvent('network-status-change', {
          detail: { online: true },
        }),
      );
    });

    window.addEventListener('offline', () => {
      console.log('üì¥ Offline');
      window.dispatchEvent(
        new CustomEvent('network-status-change', {
          detail: { online: false },
        }),
      );
    });
  </script>
</body>

</html>
