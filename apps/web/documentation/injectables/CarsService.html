<!doctype html>
<html class="no-js" lang="">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <title>autorenta-web documentation</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <link rel="icon" type="image/x-icon" href="../images/favicon.ico">
	   <link rel="stylesheet" href="../styles/style.css">
        <link rel="stylesheet" href="../styles/dark.css">
    </head>
    <body>
          <script>
               // Blocking script to avoid flickering dark mode
               // Dark mode toggle button
               var useDark = window.matchMedia('(prefers-color-scheme: dark)');
               var darkModeState = useDark.matches;
               var $darkModeToggleSwitchers = document.querySelectorAll('.dark-mode-switch input');
               var $darkModeToggles = document.querySelectorAll('.dark-mode-switch');
               var darkModeStateLocal = localStorage.getItem('compodoc_darkmode-state');

               function checkToggle(check) {
                    for (var i = 0; i < $darkModeToggleSwitchers.length; i++) {
                         $darkModeToggleSwitchers[i].checked = check;
                    }
               }

               function toggleDarkMode(state) {
                    if (window.localStorage) {
                         localStorage.setItem('compodoc_darkmode-state', state);
                    }

                    checkToggle(state);

                    const hasClass = document.body.classList.contains('dark');

                    if (state) {
                         for (var i = 0; i < $darkModeToggles.length; i++) {
                              $darkModeToggles[i].classList.add('dark');
                         }
                         if (!hasClass) {
                              document.body.classList.add('dark');
                         }
                    } else {
                         for (var i = 0; i < $darkModeToggles.length; i++) {
                              $darkModeToggles[i].classList.remove('dark');
                         }
                         if (hasClass) {
                              document.body.classList.remove('dark');
                         }
                    }
               }

               useDark.addEventListener('change', function (evt) {
                    toggleDarkMode(evt.matches);
               });
               if (darkModeStateLocal) {
                    darkModeState = darkModeStateLocal === 'true';
               }
               toggleDarkMode(darkModeState);
          </script>
          <script>
              // --- Iframe navigation tracking for Template Playground ---
              function sendCurrentUrlToParent() {
                  if (window.parent && window.parent !== window) {
                      window.parent.postMessage({
                          type: 'compodoc-iframe-navigate',
                          url: window.location.pathname + window.location.hash
                      }, '*');
                  }
              }
              window.addEventListener('hashchange', sendCurrentUrlToParent, false);
              window.addEventListener('popstate', sendCurrentUrlToParent, false);
              window.addEventListener('DOMContentLoaded', sendCurrentUrlToParent, false);
          </script>

        <div class="navbar navbar-default navbar-fixed-top d-md-none p-0">
               <div class="d-flex">
                    <a href="../" class="navbar-brand">autorenta-web documentation</a>
                    <button type="button" class="btn btn-default btn-menu ion-ios-menu" id="btn-menu"></button>
               </div>
        </div>

        <div class="xs-menu menu" id="mobile-menu">
                <div id="book-search-input" role="search"><input type="text" placeholder="Type to search"></div>            <compodoc-menu></compodoc-menu>
        </div>

        <div class="container-fluid main">
           <div class="row main">
               <div class="d-none d-md-block menu">
                   <compodoc-menu mode="normal"></compodoc-menu>
               </div>
               <!-- START CONTENT -->
               <div class="content injectable">
                   <div class="content-data">












<ol class="breadcrumb">
  <li class="breadcrumb-item">Injectables</li>
  <li class="breadcrumb-item" >CarsService</li>
</ol>

<ul class="nav nav-tabs" role="tablist">
        <li class="nav-item">
            <a href="#info" 
                class="nav-link"
                class="nav-link active"
                role="tab" id="info-tab" data-bs-toggle="tab" data-link="info">Info</a>
        </li>
        <li class="nav-item">
            <a href="#source" 
                class="nav-link"
                
                role="tab" id="source-tab" data-bs-toggle="tab" data-link="source">Source</a>
        </li>
</ul>

<div class="tab-content">
    <div class="tab-pane fade active in" id="info">
        <p class="comment">
            <h3>File</h3>
        </p>
        <p class="comment">
            <code>src/app/core/services/cars.service.ts</code>
        </p>





            <section data-compodoc="block-index">
    <h3 id="index">Index</h3>
    <table class="table table-sm table-bordered index-table">
        <tbody>
                <tr>
                    <td class="col-md-4">
                        <h6><b>Properties</b></h6>
                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                        <ul class="index-list">
                            <li>
                                    <span class="modifier">Private</span>
                                    <span class="modifier">Readonly</span>
                                <a href="#carAvailabilityService" >carAvailabilityService</a>
                            </li>
                            <li>
                                    <span class="modifier">Private</span>
                                    <span class="modifier">Readonly</span>
                                <a href="#defaultValuationConfig" >defaultValuationConfig</a>
                            </li>
                            <li>
                                    <span class="modifier">Private</span>
                                    <span class="modifier">Readonly</span>
                                <a href="#supabase" >supabase</a>
                            </li>
                        </ul>
                    </td>
                </tr>

                <tr>
                    <td class="col-md-4">
                        <h6><b>Methods</b></h6>
                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                        <ul class="index-list">
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#createCar" >createCar</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#deleteCar" >deleteCar</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#getAllCarModels" >getAllCarModels</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#getAvailableCars" class="deprecated-name">getAvailableCars</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#getAvailableCarsWithDistance" >getAvailableCarsWithDistance</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#getBlockedDateRanges" class="deprecated-name">getBlockedDateRanges</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#getCarBrands" >getCarBrands</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#getCarById" >getCarById</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#getCarModels" >getCarModels</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#getCarPhotos" >getCarPhotos</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#getCarsByOwner" >getCarsByOwner</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#getCarsWithinRadius" >getCarsWithinRadius</a>
                            </li>
                            <li>
                                <a href="#getDefaultAverageRentalDays" >getDefaultAverageRentalDays</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#getMyCars" >getMyCars</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#getNextAvailableRange" class="deprecated-name">getNextAvailableRange</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#getUserLastCar" >getUserLastCar</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#hasActiveBookings" class="deprecated-name">hasActiveBookings</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#isCarAvailable" class="deprecated-name">isCarAvailable</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#listActiveCars" >listActiveCars</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#listMyCars" >listMyCars</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#listPendingCars" >listPendingCars</a>
                            </li>
                            <li>
                                <a href="#suggestVehicleValueUsd" >suggestVehicleValueUsd</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#updateCar" >updateCar</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#updateCarStatus" >updateCarStatus</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#uploadPhoto" >uploadPhoto</a>
                            </li>
                        </ul>
                    </td>
                </tr>





        </tbody>
    </table>
</section>


            <section data-compodoc="block-methods">
    
    <h3 id="methods">
        Methods
    </h3>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="createCar"></a>
                    <span class="name">
                            <span class="modifier">Async</span>
                        <span ><b>createCar</b></span>
                        <a href="#createCar"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>createCar(input: Partial<Car>)</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="24"
                                    class="link-to-prism">src/app/core/services/cars.service.ts:24</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>input</td>
                                            <td>
                                                        <code>Partial&lt;Car&gt;</code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>    <code>Promise&lt;Car&gt;</code>

                        </div>
                            <div class="io-description">
                                
                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="deleteCar"></a>
                    <span class="name">
                            <span class="modifier">Async</span>
                        <span ><b>deleteCar</b></span>
                        <a href="#deleteCar"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>deleteCar(carId: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>)</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="328"
                                    class="link-to-prism">src/app/core/services/cars.service.ts:328</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>carId</td>
                                            <td>
                                                            <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>    <code>Promise&lt;void&gt;</code>

                        </div>
                            <div class="io-description">
                                
                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="getAllCarModels"></a>
                    <span class="name">
                            <span class="modifier">Async</span>
                        <span ><b>getAllCarModels</b></span>
                        <a href="#getAllCarModels"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>getAllCarModels()</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="426"
                                    class="link-to-prism">src/app/core/services/cars.service.ts:426</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">

                        <div class="io-description">
                            <b>Returns : </b>    <code>Promise&lt;Array&lt;literal type&gt;&gt;</code>

                        </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="getAvailableCars"></a>
                    <span class="name">
                            <span class="modifier">Async</span>
                        <span class="deprecated-name"><b>getAvailableCars</b></span>
                        <a href="#getAvailableCars"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4 deprecated">
                    Use CarAvailabilityService.getAvailableCars instead
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>getAvailableCars(startDate: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>, endDate: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>, options: literal type)</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="481"
                                    class="link-to-prism">src/app/core/services/cars.service.ts:481</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                                <td>Default value</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>startDate</td>
                                            <td>
                                                            <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>

                                            <td>
                                            </td>

                                        </tr>
                                        <tr>
                                                <td>endDate</td>
                                            <td>
                                                            <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>

                                            <td>
                                            </td>

                                        </tr>
                                        <tr>
                                                <td>options</td>
                                            <td>
                                                        <code>literal type</code>
                                            </td>

                                            <td>
                                                    No
                                            </td>

                                            <td>
                                                    <code>{}</code>
                                            </td>

                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>    <code>Promise&lt;Car[]&gt;</code>

                        </div>
                            <div class="io-description">
                                
                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="getAvailableCarsWithDistance"></a>
                    <span class="name">
                            <span class="modifier">Async</span>
                        <span ><b>getAvailableCarsWithDistance</b></span>
                        <a href="#getAvailableCarsWithDistance"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>getAvailableCarsWithDistance(startDate: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>, endDate: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>, options: literal type)</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="543"
                                    class="link-to-prism">src/app/core/services/cars.service.ts:543</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">
                        <div class="io-description"><p>Get available cars using server-side RPC with PostGIS distance scoring.
This method uses the <code>get_available_cars</code> Postgres function which:</p>
<ul>
<li>Filters by availability (no overlapping bookings)</li>
<li>Calculates distance from user location using ST_DistanceSphere</li>
<li>Applies smart scoring (distance, rating, price, auto_approval)</li>
<li>Returns cars sorted by score (distance prioritized for nearby cars)</li>
</ul>
</div>

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                                <td>Default value</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>startDate</td>
                                            <td>
                                                            <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>

                                            <td>
                                            </td>

                                        </tr>
                                        <tr>
                                                <td>endDate</td>
                                            <td>
                                                            <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>

                                            <td>
                                            </td>

                                        </tr>
                                        <tr>
                                                <td>options</td>
                                            <td>
                                                        <code>literal type</code>
                                            </td>

                                            <td>
                                                    No
                                            </td>

                                            <td>
                                                    <code>{}</code>
                                            </td>

                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>    <code>Promise&lt;CarWithScore[]&gt;</code>

                        </div>
                            <div class="io-description">
                                
                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="getBlockedDateRanges"></a>
                    <span class="name">
                            <span class="modifier">Async</span>
                        <span class="deprecated-name"><b>getBlockedDateRanges</b></span>
                        <a href="#getBlockedDateRanges"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4 deprecated">
                    Use CarAvailabilityService.getBlockedDateRanges instead
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>getBlockedDateRanges(carId: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>)</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="323"
                                    class="link-to-prism">src/app/core/services/cars.service.ts:323</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>carId</td>
                                            <td>
                                                            <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>    <code>Promise&lt;Array&lt;literal type&gt;&gt;</code>

                        </div>
                            <div class="io-description">
                                
                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="getCarBrands"></a>
                    <span class="name">
                            <span class="modifier">Async</span>
                        <span ><b>getCarBrands</b></span>
                        <a href="#getCarBrands"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>getCarBrands()</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="408"
                                    class="link-to-prism">src/app/core/services/cars.service.ts:408</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">

                        <div class="io-description">
                            <b>Returns : </b>    <code>Promise&lt;Array&lt;literal type&gt;&gt;</code>

                        </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="getCarById"></a>
                    <span class="name">
                            <span class="modifier">Async</span>
                        <span ><b>getCarById</b></span>
                        <a href="#getCarById"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>getCarById(id: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>)</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="246"
                                    class="link-to-prism">src/app/core/services/cars.service.ts:246</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>id</td>
                                            <td>
                                                            <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>    <code>Promise&lt;Car | null&gt;</code>

                        </div>
                            <div class="io-description">
                                
                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="getCarModels"></a>
                    <span class="name">
                            <span class="modifier">Async</span>
                        <span ><b>getCarModels</b></span>
                        <a href="#getCarModels"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>getCarModels(brandId: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>)</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="414"
                                    class="link-to-prism">src/app/core/services/cars.service.ts:414</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>brandId</td>
                                            <td>
                                                            <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>    <code>Promise&lt;Array&lt;literal type&gt;&gt;</code>

                        </div>
                            <div class="io-description">
                                
                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="getCarPhotos"></a>
                    <span class="name">
                            <span class="modifier">Async</span>
                        <span ><b>getCarPhotos</b></span>
                        <a href="#getCarPhotos"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>getCarPhotos(carId: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>)</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="155"
                                    class="link-to-prism">src/app/core/services/cars.service.ts:155</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>carId</td>
                                            <td>
                                                            <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>    <code>Promise&lt;CarPhoto[]&gt;</code>

                        </div>
                            <div class="io-description">
                                
                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="getCarsByOwner"></a>
                    <span class="name">
                            <span class="modifier">Async</span>
                        <span ><b>getCarsByOwner</b></span>
                        <a href="#getCarsByOwner"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>getCarsByOwner(ownerId: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>)</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="464"
                                    class="link-to-prism">src/app/core/services/cars.service.ts:464</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>ownerId</td>
                                            <td>
                                                            <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>    <code>Promise&lt;Car[]&gt;</code>

                        </div>
                            <div class="io-description">
                                
                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="getCarsWithinRadius"></a>
                    <span class="name">
                            <span class="modifier">Async</span>
                        <span ><b>getCarsWithinRadius</b></span>
                        <a href="#getCarsWithinRadius"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>getCarsWithinRadius(userLat: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank">number</a>, userLng: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank">number</a>, radiusKm: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank">number</a>, options: literal type)</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="576"
                                    class="link-to-prism">src/app/core/services/cars.service.ts:576</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">
                        <div class="io-description"><p>Get cars within a specific radius from user location.
Uses the <code>get_cars_within_radius</code> Postgres function.</p>
</div>

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                                <td>Default value</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>userLat</td>
                                            <td>
                                                            <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>

                                            <td>
                                            </td>

                                        </tr>
                                        <tr>
                                                <td>userLng</td>
                                            <td>
                                                            <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>

                                            <td>
                                            </td>

                                        </tr>
                                        <tr>
                                                <td>radiusKm</td>
                                            <td>
                                                            <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>

                                            <td>
                                            </td>

                                        </tr>
                                        <tr>
                                                <td>options</td>
                                            <td>
                                                        <code>literal type</code>
                                            </td>

                                            <td>
                                                    No
                                            </td>

                                            <td>
                                                    <code>{}</code>
                                            </td>

                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>    <code>Promise&lt;CarWithDistance[]&gt;</code>

                        </div>
                            <div class="io-description">
                                
                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="getDefaultAverageRentalDays"></a>
                    <span class="name">
                        <span ><b>getDefaultAverageRentalDays</b></span>
                        <a href="#getDefaultAverageRentalDays"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
<code>getDefaultAverageRentalDays()</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="179"
                                    class="link-to-prism">src/app/core/services/cars.service.ts:179</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">

                        <div class="io-description">
                            <b>Returns : </b>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>

                        </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="getMyCars"></a>
                    <span class="name">
                            <span class="modifier">Async</span>
                        <span ><b>getMyCars</b></span>
                        <a href="#getMyCars"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>getMyCars()</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="316"
                                    class="link-to-prism">src/app/core/services/cars.service.ts:316</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">
                        <div class="io-description"><p>Alias for listMyCars for backward compatibility</p>
</div>

                        <div class="io-description">
                            <b>Returns : </b>    <code>Promise&lt;Car[]&gt;</code>

                        </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="getNextAvailableRange"></a>
                    <span class="name">
                            <span class="modifier">Async</span>
                        <span class="deprecated-name"><b>getNextAvailableRange</b></span>
                        <a href="#getNextAvailableRange"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4 deprecated">
                    Use CarAvailabilityService.getNextAvailableRange instead
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>getNextAvailableRange(carId: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>, startDate: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>, endDate: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>, maxOptions: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank">number</a>)</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="520"
                                    class="link-to-prism">src/app/core/services/cars.service.ts:520</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                                <td>Default value</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>carId</td>
                                            <td>
                                                            <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>

                                            <td>
                                            </td>

                                        </tr>
                                        <tr>
                                                <td>startDate</td>
                                            <td>
                                                            <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>

                                            <td>
                                            </td>

                                        </tr>
                                        <tr>
                                                <td>endDate</td>
                                            <td>
                                                            <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>

                                            <td>
                                            </td>

                                        </tr>
                                        <tr>
                                                <td>maxOptions</td>
                                            <td>
                                                            <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>

                                            <td>
                                                    <code>3</code>
                                            </td>

                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>    <code>Promise&lt;Array&lt;literal type&gt;&gt;</code>

                        </div>
                            <div class="io-description">
                                
                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="getUserLastCar"></a>
                    <span class="name">
                            <span class="modifier">Async</span>
                        <span ><b>getUserLastCar</b></span>
                        <a href="#getUserLastCar"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>getUserLastCar()</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="444"
                                    class="link-to-prism">src/app/core/services/cars.service.ts:444</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">

                        <div class="io-description">
                            <b>Returns : </b>    <code>Promise&lt;Car | null&gt;</code>

                        </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="hasActiveBookings"></a>
                    <span class="name">
                            <span class="modifier">Async</span>
                        <span class="deprecated-name"><b>hasActiveBookings</b></span>
                        <a href="#hasActiveBookings"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4 deprecated">
                    Use CarAvailabilityService.hasActiveBookings instead
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>hasActiveBookings(carId: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>)</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="509"
                                    class="link-to-prism">src/app/core/services/cars.service.ts:509</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>carId</td>
                                            <td>
                                                            <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>    <code>Promise&lt;literal type&gt;</code>

                        </div>
                            <div class="io-description">
                                
                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="isCarAvailable"></a>
                    <span class="name">
                            <span class="modifier">Async</span>
                        <span class="deprecated-name"><b>isCarAvailable</b></span>
                        <a href="#isCarAvailable"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4 deprecated">
                    Use CarAvailabilityService.isCarAvailable instead
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>isCarAvailable(carId: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>, startDate: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>, endDate: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>)</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="502"
                                    class="link-to-prism">src/app/core/services/cars.service.ts:502</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>carId</td>
                                            <td>
                                                            <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                        </tr>
                                        <tr>
                                                <td>startDate</td>
                                            <td>
                                                            <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                        </tr>
                                        <tr>
                                                <td>endDate</td>
                                            <td>
                                                            <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>    <code>Promise&lt;boolean&gt;</code>

                        </div>
                            <div class="io-description">
                                
                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="listActiveCars"></a>
                    <span class="name">
                            <span class="modifier">Async</span>
                        <span ><b>listActiveCars</b></span>
                        <a href="#listActiveCars"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>listActiveCars(filters: <a href="../interfaces/CarFilters.html" target="_self">CarFilters</a>)</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="183"
                                    class="link-to-prism">src/app/core/services/cars.service.ts:183</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>filters</td>
                                            <td>
                                                            <code><a href="../interfaces/CarFilters.html" target="_self" >CarFilters</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>    <code>Promise&lt;Car[]&gt;</code>

                        </div>
                            <div class="io-description">
                                
                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="listMyCars"></a>
                    <span class="name">
                            <span class="modifier">Async</span>
                        <span ><b>listMyCars</b></span>
                        <a href="#listMyCars"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>listMyCars()</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="276"
                                    class="link-to-prism">src/app/core/services/cars.service.ts:276</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">

                        <div class="io-description">
                            <b>Returns : </b>    <code>Promise&lt;Car[]&gt;</code>

                        </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="listPendingCars"></a>
                    <span class="name">
                            <span class="modifier">Async</span>
                        <span ><b>listPendingCars</b></span>
                        <a href="#listPendingCars"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>listPendingCars()</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="394"
                                    class="link-to-prism">src/app/core/services/cars.service.ts:394</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">

                        <div class="io-description">
                            <b>Returns : </b>    <code>Promise&lt;Car[]&gt;</code>

                        </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="suggestVehicleValueUsd"></a>
                    <span class="name">
                        <span ><b>suggestVehicleValueUsd</b></span>
                        <a href="#suggestVehicleValueUsd"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
<code>suggestVehicleValueUsd(pricePerDay: number | null | undefined, options?: literal type)</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="167"
                                    class="link-to-prism">src/app/core/services/cars.service.ts:167</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>pricePerDay</td>
                                            <td>
                                                        <code>number | null | undefined</code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                        </tr>
                                        <tr>
                                                <td>options</td>
                                            <td>
                                                        <code>literal type</code>
                                            </td>

                                            <td>
                                                    Yes
                                            </td>


                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>

                        </div>
                            <div class="io-description">
                                
                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="updateCar"></a>
                    <span class="name">
                            <span class="modifier">Async</span>
                        <span ><b>updateCar</b></span>
                        <a href="#updateCar"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>updateCar(carId: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>, input: Partial<Car>)</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="355"
                                    class="link-to-prism">src/app/core/services/cars.service.ts:355</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>carId</td>
                                            <td>
                                                            <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                        </tr>
                                        <tr>
                                                <td>input</td>
                                            <td>
                                                        <code>Partial&lt;Car&gt;</code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>    <code>Promise&lt;Car&gt;</code>

                        </div>
                            <div class="io-description">
                                
                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="updateCarStatus"></a>
                    <span class="name">
                            <span class="modifier">Async</span>
                        <span ><b>updateCarStatus</b></span>
                        <a href="#updateCarStatus"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>updateCarStatus(carId: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>, status: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>)</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="342"
                                    class="link-to-prism">src/app/core/services/cars.service.ts:342</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">
                        <div class="io-description"><p> NUEVO: Actualizar solo el status del auto</p>
</div>

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>carId</td>
                                            <td>
                                                            <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                        </tr>
                                        <tr>
                                                <td>status</td>
                                            <td>
                                                            <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>    <code>Promise&lt;void&gt;</code>

                        </div>
                            <div class="io-description">
                                
                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="uploadPhoto"></a>
                    <span class="name">
                            <span class="modifier">Async</span>
                        <span ><b>uploadPhoto</b></span>
                        <a href="#uploadPhoto"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>uploadPhoto(file: File, carId: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>, position: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank">number</a>)</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="115"
                                    class="link-to-prism">src/app/core/services/cars.service.ts:115</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                                <td>Default value</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>file</td>
                                            <td>
                                                        <code>File</code>
                                            </td>

                                            <td>
                                                    No
                                            </td>

                                            <td>
                                            </td>

                                        </tr>
                                        <tr>
                                                <td>carId</td>
                                            <td>
                                                            <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>

                                            <td>
                                            </td>

                                        </tr>
                                        <tr>
                                                <td>position</td>
                                            <td>
                                                            <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>

                                            <td>
                                                    <code>0</code>
                                            </td>

                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>    <code>Promise&lt;CarPhoto&gt;</code>

                        </div>
                            <div class="io-description">
                                
                            </div>
                </td>
            </tr>
        </tbody>
    </table>
</section>
            <section data-compodoc="block-properties">
    
    <h3 id="inputs">
        Properties
    </h3>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="carAvailabilityService"></a>
                    <span class="name">
                            <span class="modifier">Private</span>
                            <span class="modifier">Readonly</span>
                        <span ><b>carAvailabilityService</b></span>
                        <a href="#carAvailabilityService"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
                <tr>
                    <td class="col-md-4">
                        <i>Type : </i>    <code>unknown</code>

                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                        <i>Default value : </i><code>inject(CarAvailabilityService)</code>
                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                                <div class="io-line">Defined in <a href="" data-line="19" class="link-to-prism">src/app/core/services/cars.service.ts:19</a></div>
                        </td>
                    </tr>


        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="defaultValuationConfig"></a>
                    <span class="name">
                            <span class="modifier">Private</span>
                            <span class="modifier">Readonly</span>
                        <span ><b>defaultValuationConfig</b></span>
                        <a href="#defaultValuationConfig"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
                <tr>
                    <td class="col-md-4">
                        <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/object" target="_blank" >object</a></code>

                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                        <i>Default value : </i><code>{
    averageRentalDays: 300,
  }</code>
                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                                <div class="io-line">Defined in <a href="" data-line="20" class="link-to-prism">src/app/core/services/cars.service.ts:20</a></div>
                        </td>
                    </tr>


        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="supabase"></a>
                    <span class="name">
                            <span class="modifier">Private</span>
                            <span class="modifier">Readonly</span>
                        <span ><b>supabase</b></span>
                        <a href="#supabase"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
                <tr>
                    <td class="col-md-4">
                        <i>Type : </i>    <code>unknown</code>

                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                        <i>Default value : </i><code>injectSupabase()</code>
                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                                <div class="io-line">Defined in <a href="" data-line="18" class="link-to-prism">src/app/core/services/cars.service.ts:18</a></div>
                        </td>
                    </tr>


        </tbody>
    </table>
</section>

    </div>


    <div class="tab-pane fade  tab-source-code" id="source">
        <pre class="line-numbers compodoc-sourcecode"><code class="language-typescript">import { Injectable, inject } from &#x27;@angular/core&#x27;;
import { v4 as uuidv4 } from &#x27;uuid&#x27;;
import { Car, CarFilters, CarPhoto } from &#x27;../models&#x27;;
import { optimizeImage } from &#x27;../utils/image.utils&#x27;;
import { CarAvailabilityService } from &#x27;./car-availability.service&#x27;;
import { injectSupabase } from &#x27;./supabase-client.service&#x27;;

// Type for raw car data from Supabase with photos joined
type CarWithPhotosRaw &#x3D; Record&lt;string, unknown&gt; &amp; {
  car_photos?: unknown[];
  owner?: unknown | unknown[];
};

@Injectable({
  providedIn: &#x27;root&#x27;,
})
export class CarsService {
  private readonly supabase &#x3D; injectSupabase();
  private readonly carAvailabilityService &#x3D; inject(CarAvailabilityService);
  private readonly defaultValuationConfig &#x3D; {
    averageRentalDays: 300,
  };

  async createCar(input: Partial&lt;Car&gt;): Promise&lt;Car&gt; {
    const userId &#x3D; (await this.supabase.auth.getUser()).data.user?.id;
    if (!userId) {
      throw new Error(&#x27;Usuario no autenticado&#x27;);
    }

    // Validate required fields
    //  CRITICAL: brand_id/model_id son UUIDs (pueden ser null si usamos FIPE)
    // Si no hay UUIDs, debemos tener brand_text_backup y model_text_backup
    const hasBrandId &#x3D; !!input.brand_id;
    const hasModelId &#x3D; !!input.model_id;
    const hasBrandText &#x3D; !!input.brand_text_backup;
    const hasModelText &#x3D; !!input.model_text_backup;

    if (!hasBrandId &amp;&amp; !hasBrandText) {
      throw new Error(&#x27;Marca es requerida (brand_id o brand_text_backup)&#x27;);
    }
    if (!hasModelId &amp;&amp; !hasModelText) {
      throw new Error(&#x27;Modelo es requerido (model_id o model_text_backup)&#x27;);
    }
    if (!input.price_per_day || input.price_per_day &lt;&#x3D; 0) {
      throw new Error(&#x27;Precio por da debe ser mayor a 0&#x27;);
    }

    // Check for coordinates (using type assertion since location_lat/location_lng come from form)
    const carInput &#x3D; input as Record&lt;string, unknown&gt;;

    //  CRITICAL: Las coordenadas son OBLIGATORIAS para que el auto aparezca en bsquedas
    // Si no hay coordenadas, el auto ser invisible en el mapa y en bsquedas espaciales
    if (!carInput.location_lat || !carInput.location_lng) {
      throw new Error(
        &#x27;Ubicacin del vehculo requerida. Por favor selecciona una ubicacin en el mapa o usa tu ubicacin actual.&#x27;,
      );
    }

    const cleanInput &#x3D; { ...input };

    //  CRITICAL: Mapear campos de ubicacin legacy (city, province, country)
    // La base de datos requiere city/province/country (NOT NULL)
    // pero el formulario enva location_city/location_state/location_country
    const city &#x3D;
      (input as Record&lt;string, unknown&gt;).city ||
      (input as Record&lt;string, unknown&gt;).location_city ||
      &#x27;&#x27;;
    const province &#x3D;
      (input as Record&lt;string, unknown&gt;).province ||
      (input as Record&lt;string, unknown&gt;).location_state ||
      (input as Record&lt;string, unknown&gt;).location_province ||
      &#x27;&#x27;;
    const country &#x3D;
      (input as Record&lt;string, unknown&gt;).country ||
      (input as Record&lt;string, unknown&gt;).location_country ||
      &#x27;AR&#x27;;

    // Prepare clean data for insert
    const carData &#x3D; {
      ...cleanInput,
      //  Mapear campos legacy requeridos por la base de datos
      city: city || &#x27;Buenos Aires&#x27;, // Default si est vaco
      province: province || &#x27;Buenos Aires&#x27;, // Default si est vaco
      country: country || &#x27;AR&#x27;,
      owner_id: userId,
      status: input.status || &#x27;active&#x27;, // Default to active if not specified
      created_at: new Date().toISOString(),
    };

    console.log(&#x27; Creating car with data:&#x27;, {
      ...carData,
      // Redact sensitive fields for logging
      owner_id: &#x27;***&#x27;,
    });

    const { data, error } &#x3D; await this.supabase
      .from(&#x27;cars&#x27;)
      .insert(carData)
      .select(&#x27;*, car_photos(*)&#x27;)
      .single();

    if (error) {
      console.error(&#x27; Error creating car:&#x27;, error);
      throw error;
    }

    console.log(&#x27; Car created successfully:&#x27;, data.id);

    return {
      ...data,
      photos: data.car_photos || [],
    } as Car;
  }

  async uploadPhoto(file: File, carId: string, position &#x3D; 0): Promise&lt;CarPhoto&gt; {
    const userId &#x3D; (await this.supabase.auth.getUser()).data.user?.id;
    if (!userId) throw new Error(&#x27;Usuario no autenticado&#x27;);

    const optimizedFile &#x3D; await optimizeImage(file, {
      maxWidth: 1200,
      maxHeight: 900,
      quality: 0.85,
      format: &#x27;webp&#x27;,
    });

    const extension &#x3D; &#x27;webp&#x27;;
    const filePath &#x3D; &#x60;${userId}/${carId}/${uuidv4()}.${extension}&#x60;;
    const { error } &#x3D; await this.supabase.storage
      .from(&#x27;car-images&#x27;)
      .upload(filePath, optimizedFile, {
        cacheControl: &#x27;3600&#x27;,
        upsert: false,
      });
    if (error) throw error;
    const { data } &#x3D; this.supabase.storage.from(&#x27;car-images&#x27;).getPublicUrl(filePath);

    const photoId &#x3D; uuidv4();
    const { data: photoData, error: photoError } &#x3D; await this.supabase
      .from(&#x27;car_photos&#x27;)
      .insert({
        id: photoId,
        car_id: carId,
        stored_path: filePath,
        url: data.publicUrl,
        position,
        sort_order: position,
      })
      .select()
      .single();

    if (photoError) throw photoError;
    return photoData as CarPhoto;
  }

  async getCarPhotos(carId: string): Promise&lt;CarPhoto[]&gt; {
    const { data, error } &#x3D; await this.supabase
      .from(&#x27;car_photos&#x27;)
      .select(&#x27;*&#x27;)
      .eq(&#x27;car_id&#x27;, carId)
      .order(&#x27;sort_order&#x27;, { ascending: true })
      .order(&#x27;position&#x27;, { ascending: true });

    if (error) throw error;
    return (data ?? []) as CarPhoto[];
  }

  suggestVehicleValueUsd(
    pricePerDay: number | null | undefined,
    options?: { averageRentalDays?: number },
  ): number {
    if (!pricePerDay || pricePerDay &lt;&#x3D; 0) {
      return 0;
    }

    const days &#x3D; options?.averageRentalDays ?? this.defaultValuationConfig.averageRentalDays;
    return Math.round(pricePerDay * days);
  }

  getDefaultAverageRentalDays(): number {
    return this.defaultValuationConfig.averageRentalDays;
  }

  async listActiveCars(filters: CarFilters): Promise&lt;Car[]&gt; {
    let query &#x3D; this.supabase
      .from(&#x27;cars&#x27;)
      .select(
        &#x60;
        *,
        car_photos(*),
        owner:profiles!cars_owner_id_fkey(
          id,
          full_name,
          avatar_url,
          rating_avg,
          rating_count,
          created_at
        )
      &#x60;,
      )
      .eq(&#x27;status&#x27;, &#x27;active&#x27;)
      .order(&#x27;created_at&#x27;, { ascending: false });

    if (filters.city) {
      query &#x3D; query.ilike(&#x27;location_city&#x27;, &#x60;%${filters.city}%&#x60;);
    }

    //  FIX P0.3: Filtrar por coordenadas (bounding box)
    if (filters.bounds) {
      query &#x3D; query
        .lte(&#x27;location_lat&#x27;, filters.bounds.north)
        .gte(&#x27;location_lat&#x27;, filters.bounds.south)
        .lte(&#x27;location_lng&#x27;, filters.bounds.east)
        .gte(&#x27;location_lng&#x27;, filters.bounds.west);
    }

    const { data, error } &#x3D; await query;
    if (error) throw error;

    // Data loaded successfully

    //  FIX P0.2: Filtrar por disponibilidad si hay fechas
    if (filters.from &amp;&amp; filters.to &amp;&amp; data) {
      const availableCars &#x3D; await this.carAvailabilityService.filterByAvailability(
        data as Car[],
        filters.from,
        filters.to,
        filters.blockedCarIds || [],
      );
      return (availableCars as unknown[]).map((car) &#x3D;&gt; {
        const typedCar &#x3D; car as CarWithPhotosRaw;
        return {
          ...typedCar,
          photos: typedCar.car_photos || [],
          owner: Array.isArray(typedCar.owner) ? typedCar.owner[0] : typedCar.owner,
        };
      }) as Car[];
    }

    return (data ?? []).map((car: CarWithPhotosRaw) &#x3D;&gt; ({
      ...car,
      photos: car.car_photos || [],
      owner: Array.isArray(car.owner) ? car.owner[0] : car.owner,
    })) as Car[];
  }

  async getCarById(id: string): Promise&lt;Car | null&gt; {
    const { data, error } &#x3D; await this.supabase
      .from(&#x27;cars&#x27;)
      .select(
        &#x60;
        *,
        car_photos(*),
        owner:profiles!cars_owner_id_fkey(
          id,
          full_name,
          avatar_url,
          rating_avg,
          rating_count,
          created_at
        )
      &#x60;,
      )
      .eq(&#x27;id&#x27;, id)
      .single();
    if (error) {
      if (error.code &#x3D;&#x3D;&#x3D; &#x27;PGRST116&#x27;) return null;
      throw error;
    }

    return {
      ...data,
      photos: data.car_photos || [],
    } as Car;
  }

  async listMyCars(): Promise&lt;Car[]&gt; {
    const userId &#x3D; (await this.supabase.auth.getUser()).data.user?.id;
    if (!userId) throw new Error(&#x27;Usuario no autenticado&#x27;);

    // 1. Get my orgs IDs (to include fleet cars)
    const { data: orgs } &#x3D; await this.supabase
      .from(&#x27;organization_members&#x27;)
      .select(&#x27;organization_id&#x27;)
      .eq(&#x27;user_id&#x27;, userId);

    const orgIds &#x3D; orgs?.map((o) &#x3D;&gt; o.organization_id) || [];

    // 2. Build query
    let query &#x3D; this.supabase
      .from(&#x27;cars&#x27;)
      .select(&#x27;*, car_photos(*)&#x27;)
      .order(&#x27;created_at&#x27;, { ascending: false });

    if (orgIds.length &gt; 0) {
      // Fetch cars where:
      // A) I am the owner (owner_id &#x3D; me)
      // B) OR the car belongs to an organization I am a member of
      query &#x3D; query.or(&#x60;owner_id.eq.${userId},organization_id.in.(${orgIds.join(&#x27;,&#x27;)})&#x60;);
    } else {
      // Fallback for individuals with no orgs
      query &#x3D; query.eq(&#x27;owner_id&#x27;, userId);
    }

    const { data, error } &#x3D; await query;
    if (error) throw error;

    return (data ?? []).map((car: CarWithPhotosRaw) &#x3D;&gt; ({
      ...car,
      photos: car.car_photos || [],
    })) as Car[];
  }

  /**
   * Alias for listMyCars for backward compatibility
   */
  async getMyCars(): Promise&lt;Car[]&gt; {
    return this.listMyCars();
  }

  /**
   * @deprecated Use CarAvailabilityService.getBlockedDateRanges instead
   */
  async getBlockedDateRanges(carId: string): Promise&lt;Array&lt;{ from: string; to: string }&gt;&gt; {
    const ranges &#x3D; await this.carAvailabilityService.getBlockedDates(carId);
    return ranges.map((r) &#x3D;&gt; ({ from: r.from, to: r.to }));
  }

  async deleteCar(carId: string): Promise&lt;void&gt; {
    const userId &#x3D; (await this.supabase.auth.getUser()).data.user?.id;
    if (!userId) throw new Error(&#x27;Usuario no autenticado&#x27;);
    const { error } &#x3D; await this.supabase
      .from(&#x27;cars&#x27;)
      .delete()
      .eq(&#x27;id&#x27;, carId)
      .eq(&#x27;owner_id&#x27;, userId);
    if (error) throw error;
  }

  /**
   *  NUEVO: Actualizar solo el status del auto
   */
  async updateCarStatus(carId: string, status: string): Promise&lt;void&gt; {
    const userId &#x3D; (await this.supabase.auth.getUser()).data.user?.id;
    if (!userId) throw new Error(&#x27;Usuario no autenticado&#x27;);

    const { error } &#x3D; await this.supabase
      .from(&#x27;cars&#x27;)
      .update({ status, updated_at: new Date().toISOString() })
      .eq(&#x27;id&#x27;, carId)
      .eq(&#x27;owner_id&#x27;, userId);

    if (error) throw error;
  }

  async updateCar(carId: string, input: Partial&lt;Car&gt;): Promise&lt;Car&gt; {
    const userId &#x3D; (await this.supabase.auth.getUser()).data.user?.id;
    if (!userId) throw new Error(&#x27;Usuario no autenticado&#x27;);

    //  CRITICAL: Mapear campos de ubicacin legacy (city, province, country)
    // La base de datos requiere city/province/country (NOT NULL)
    // pero el formulario enva location_city/location_state/location_country
    const inputRecord &#x3D; input as Record&lt;string, unknown&gt;;
    const updateData: Record&lt;string, unknown&gt; &#x3D; { ...input };

    // Mapear location_city a city si existe
    if (inputRecord.location_city &amp;&amp; !inputRecord.city) {
      updateData.city &#x3D; inputRecord.location_city;
    }
    // Mapear location_state/location_province a province si existe
    if ((inputRecord.location_state || inputRecord.location_province) &amp;&amp; !inputRecord.province) {
      updateData.province &#x3D; inputRecord.location_state || inputRecord.location_province;
    }
    // Mapear location_country a country si existe
    if (inputRecord.location_country &amp;&amp; !inputRecord.country) {
      updateData.country &#x3D; inputRecord.location_country;
    }

    const { data, error } &#x3D; await this.supabase
      .from(&#x27;cars&#x27;)
      .update(updateData)
      .eq(&#x27;id&#x27;, carId)
      .eq(&#x27;owner_id&#x27;, userId)
      .select(&#x27;*, car_photos(*)&#x27;)
      .single();

    if (error) throw error;

    return {
      ...data,
      photos: data.car_photos || [],
    } as Car;
  }

  async listPendingCars(): Promise&lt;Car[]&gt; {
    const { data, error } &#x3D; await this.supabase
      .from(&#x27;cars&#x27;)
      .select(&#x27;*, car_photos(*)&#x27;)
      .eq(&#x27;status&#x27;, &#x27;draft&#x27;)
      .order(&#x27;created_at&#x27;, { ascending: false });
    if (error) throw error;

    return (data ?? []).map((car: CarWithPhotosRaw) &#x3D;&gt; ({
      ...car,
      photos: car.car_photos || [],
    })) as Car[];
  }

  async getCarBrands(): Promise&lt;Array&lt;{ id: string; name: string }&gt;&gt; {
    const { data, error } &#x3D; await this.supabase.from(&#x27;car_brands&#x27;).select(&#x27;id, name&#x27;).order(&#x27;name&#x27;);
    if (error) throw error;
    return data ?? [];
  }

  async getCarModels(
    brandId: string,
  ): Promise&lt;Array&lt;{ id: string; name: string; category: string; seats: number; doors: number }&gt;&gt; {
    const { data, error } &#x3D; await this.supabase
      .from(&#x27;car_models&#x27;)
      .select(&#x27;id, name, category, seats, doors&#x27;)
      .eq(&#x27;brand_id&#x27;, brandId)
      .order(&#x27;name&#x27;);
    if (error) throw error;
    return data ?? [];
  }

  async getAllCarModels(): Promise&lt;
    Array&lt;{
      id: string;
      brand_id: string;
      name: string;
      category: string;
      seats: number;
      doors: number;
    }&gt;
  &gt; {
    const { data, error } &#x3D; await this.supabase
      .from(&#x27;car_models&#x27;)
      .select(&#x27;id, brand_id, name, category, seats, doors&#x27;)
      .order(&#x27;name&#x27;);
    if (error) throw error;
    return data ?? [];
  }

  async getUserLastCar(): Promise&lt;Car | null&gt; {
    const userId &#x3D; (await this.supabase.auth.getUser()).data.user?.id;
    if (!userId) return null;

    const { data, error } &#x3D; await this.supabase
      .from(&#x27;cars&#x27;)
      .select(&#x27;*&#x27;)
      .eq(&#x27;owner_id&#x27;, userId)
      .order(&#x27;created_at&#x27;, { ascending: false })
      .limit(1)
      .single();

    if (error) {
      if (error.code &#x3D;&#x3D;&#x3D; &#x27;PGRST116&#x27;) return null; // No rows found
      throw error;
    }

    return data as Car;
  }

  async getCarsByOwner(ownerId: string): Promise&lt;Car[]&gt; {
    const { data, error } &#x3D; await this.supabase
      .from(&#x27;cars&#x27;)
      .select(&#x27;*&#x27;)
      .eq(&#x27;owner_id&#x27;, ownerId)
      .order(&#x27;created_at&#x27;, { ascending: false });

    if (error) {
      throw error;
    }

    return (data as Car[]) ?? [];
  }

  /**
   * @deprecated Use CarAvailabilityService.getAvailableCars instead
   */
  async getAvailableCars(
    startDate: string,
    endDate: string,
    options: {
      limit?: number;
      offset?: number;
      city?: string;
    } &#x3D; {},
  ): Promise&lt;Car[]&gt; {
    const available &#x3D; await this.carAvailabilityService.getAvailableCars(
      startDate,
      endDate,
      options,
    );
    // Map to Car model if needed (Supabase returns &#x60;cars&#x60; rows already compatible with &#x60;Car&#x60;).
    return available as Car[];
  }

  /**
   * @deprecated Use CarAvailabilityService.isCarAvailable instead
   */
  async isCarAvailable(carId: string, startDate: string, endDate: string): Promise&lt;boolean&gt; {
    return this.carAvailabilityService.checkAvailability(carId, startDate, endDate);
  }

  /**
   * @deprecated Use CarAvailabilityService.hasActiveBookings instead
   */
  async hasActiveBookings(carId: string): Promise&lt;{
    hasActive: boolean;
    count: number;
    bookings?: Array&lt;{ id: string; status: string; start_date: string; end_date: string }&gt;;
  }&gt; {
    return this.carAvailabilityService.hasActiveBookings(carId);
  }

  /**
   * @deprecated Use CarAvailabilityService.getNextAvailableRange instead
   */
  async getNextAvailableRange(
    carId: string,
    startDate: string,
    endDate: string,
    maxOptions &#x3D; 3,
  ): Promise&lt;
    Array&lt;{
      startDate: string;
      endDate: string;
      daysCount: number;
    }&gt;
  &gt; {
    return this.carAvailabilityService.getNextAvailableRange(carId, startDate, endDate, maxOptions);
  }

  /**
   * Get available cars using server-side RPC with PostGIS distance scoring.
   * This method uses the &#x60;get_available_cars&#x60; Postgres function which:
   * - Filters by availability (no overlapping bookings)
   * - Calculates distance from user location using ST_DistanceSphere
   * - Applies smart scoring (distance, rating, price, auto_approval)
   * - Returns cars sorted by score (distance prioritized for nearby cars)
   */
  async getAvailableCarsWithDistance(
    startDate: string,
    endDate: string,
    options: {
      lat?: number;
      lng?: number;
      limit?: number;
      offset?: number;
    } &#x3D; {},
  ): Promise&lt;CarWithScore[]&gt; {
    const { lat, lng, limit &#x3D; 12, offset &#x3D; 0 } &#x3D; options;

    const { data, error } &#x3D; await this.supabase.rpc(&#x27;get_available_cars&#x27;, {
      p_start_date: startDate,
      p_end_date: endDate,
      p_lat: lat ?? null,
      p_lng: lng ?? null,
      p_limit: limit,
      p_offset: offset,
    });

    if (error) {
      console.error(&#x27;Error calling get_available_cars RPC:&#x27;, error);
      throw error;
    }

    return (data || []) as CarWithScore[];
  }

  /**
   * Get cars within a specific radius from user location.
   * Uses the &#x60;get_cars_within_radius&#x60; Postgres function.
   */
  async getCarsWithinRadius(
    userLat: number,
    userLng: number,
    radiusKm: number,
    options: {
      startDate?: string;
      endDate?: string;
      limit?: number;
      offset?: number;
    } &#x3D; {},
  ): Promise&lt;CarWithDistance[]&gt; {
    const { startDate, endDate, limit &#x3D; 50, offset &#x3D; 0 } &#x3D; options;

    const { data, error } &#x3D; await this.supabase.rpc(&#x27;get_cars_within_radius&#x27;, {
      p_user_lat: userLat,
      p_user_lng: userLng,
      p_radius_km: radiusKm,
      p_start_date: startDate ?? null,
      p_end_date: endDate ?? null,
      p_limit: limit,
      p_offset: offset,
    });

    if (error) {
      console.error(&#x27;Error calling get_cars_within_radius RPC:&#x27;, error);
      throw error;
    }

    return (data || []) as CarWithDistance[];
  }
}

/**
 * Car with score from get_available_cars RPC
 */
export interface CarWithScore {
  id: string;
  owner_id: string;
  brand: string;
  model: string;
  year: number;
  plate: string;
  price_per_day: number;
  currency: string;
  status: string;
  location: {
    city?: string;
    state?: string;
    province?: string;
    country?: string;
    lat?: number;
    lng?: number;
  };
  images: string[];
  features: Record&lt;string, unknown&gt;;
  created_at: string;
  updated_at: string;
  total_bookings: number;
  avg_rating: number;
  score: number;
}

/**
 * Car with distance from get_cars_within_radius RPC
 */
export interface CarWithDistance {
  id: string;
  owner_id: string;
  title: string;
  brand_text_backup: string;
  model_text_backup: string;
  year: number;
  price_per_day: number;
  currency: string;
  value_usd: number;
  location_city: string;
  location_state: string;
  location_lat: number;
  location_lng: number;
  location_formatted_address: string;
  distance_km: number;
  status: string;
  photos_count: number;
  avg_rating: number;
}
</code></pre>
    </div>

</div>













                   </div><div class="search-results">
    <div class="has-results">
        <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
        <ul class="search-results-list"></ul>
    </div>
    <div class="no-results">
        <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
    </div>
</div>
</div>
               <!-- END CONTENT -->
           </div>
       </div>

          <label class="dark-mode-switch">
               <input type="checkbox">
               <span class="slider">
                    <svg class="slider-icon" viewBox="0 0 24 24" fill="none" height="20" stroke="#000" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" width="20" xmlns="http://www.w3.org/2000/svg">
                    <path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"></path>
                    </svg>
               </span>
          </label>

       <script>
            var COMPODOC_CURRENT_PAGE_DEPTH = 1;
            var COMPODOC_CURRENT_PAGE_CONTEXT = 'injectable';
            var COMPODOC_CURRENT_PAGE_URL = 'CarsService.html';
            var MAX_SEARCH_RESULTS = 15;
       </script>

       <script>
               $darkModeToggleSwitchers = document.querySelectorAll('.dark-mode-switch input');
               checkToggle(darkModeState);
               if ($darkModeToggleSwitchers.length > 0) {
                    for (var i = 0; i < $darkModeToggleSwitchers.length; i++) {
                         $darkModeToggleSwitchers[i].addEventListener('change', function (event) {
                              darkModeState = !darkModeState;
                              toggleDarkMode(darkModeState);
                         });
                    }
               }
          </script>

       <script src="../js/libs/custom-elements.min.js"></script>
       <script src="../js/libs/lit-html.js"></script>

       <script src="../js/menu-wc.js" defer></script>
       <script nomodule src="../js/menu-wc_es5.js" defer></script>

       <script src="../js/libs/bootstrap-native.js"></script>

       <script src="../js/libs/es6-shim.min.js"></script>
       <script src="../js/libs/EventDispatcher.js"></script>
       <script src="../js/libs/promise.min.js"></script>

       <script src="../js/compodoc.js"></script>

       <script src="../js/tabs.js"></script>
       <script src="../js/menu.js"></script>
       <script src="../js/libs/clipboard.min.js"></script>
       <script src="../js/libs/prism.js"></script>
       <script src="../js/sourceCode.js"></script>
          <script src="../js/search/search.js"></script>
          <script src="../js/search/lunr.min.js"></script>
          <script src="../js/search/search-lunr.js"></script>
          <script src="../js/search/search_index.js"></script>
       <script src="../js/lazy-load-graphs.js"></script>


    </body>
</html>
