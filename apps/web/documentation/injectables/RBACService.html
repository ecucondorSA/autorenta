<!doctype html>
<html class="no-js" lang="">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <title>autorenta-web documentation</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <link rel="icon" type="image/x-icon" href="../images/favicon.ico">
	   <link rel="stylesheet" href="../styles/style.css">
        <link rel="stylesheet" href="../styles/dark.css">
    </head>
    <body>
          <script>
               // Blocking script to avoid flickering dark mode
               // Dark mode toggle button
               var useDark = window.matchMedia('(prefers-color-scheme: dark)');
               var darkModeState = useDark.matches;
               var $darkModeToggleSwitchers = document.querySelectorAll('.dark-mode-switch input');
               var $darkModeToggles = document.querySelectorAll('.dark-mode-switch');
               var darkModeStateLocal = localStorage.getItem('compodoc_darkmode-state');

               function checkToggle(check) {
                    for (var i = 0; i < $darkModeToggleSwitchers.length; i++) {
                         $darkModeToggleSwitchers[i].checked = check;
                    }
               }

               function toggleDarkMode(state) {
                    if (window.localStorage) {
                         localStorage.setItem('compodoc_darkmode-state', state);
                    }

                    checkToggle(state);

                    const hasClass = document.body.classList.contains('dark');

                    if (state) {
                         for (var i = 0; i < $darkModeToggles.length; i++) {
                              $darkModeToggles[i].classList.add('dark');
                         }
                         if (!hasClass) {
                              document.body.classList.add('dark');
                         }
                    } else {
                         for (var i = 0; i < $darkModeToggles.length; i++) {
                              $darkModeToggles[i].classList.remove('dark');
                         }
                         if (hasClass) {
                              document.body.classList.remove('dark');
                         }
                    }
               }

               useDark.addEventListener('change', function (evt) {
                    toggleDarkMode(evt.matches);
               });
               if (darkModeStateLocal) {
                    darkModeState = darkModeStateLocal === 'true';
               }
               toggleDarkMode(darkModeState);
          </script>
          <script>
              // --- Iframe navigation tracking for Template Playground ---
              function sendCurrentUrlToParent() {
                  if (window.parent && window.parent !== window) {
                      window.parent.postMessage({
                          type: 'compodoc-iframe-navigate',
                          url: window.location.pathname + window.location.hash
                      }, '*');
                  }
              }
              window.addEventListener('hashchange', sendCurrentUrlToParent, false);
              window.addEventListener('popstate', sendCurrentUrlToParent, false);
              window.addEventListener('DOMContentLoaded', sendCurrentUrlToParent, false);
          </script>

        <div class="navbar navbar-default navbar-fixed-top d-md-none p-0">
               <div class="d-flex">
                    <a href="../" class="navbar-brand">autorenta-web documentation</a>
                    <button type="button" class="btn btn-default btn-menu ion-ios-menu" id="btn-menu"></button>
               </div>
        </div>

        <div class="xs-menu menu" id="mobile-menu">
                <div id="book-search-input" role="search"><input type="text" placeholder="Type to search"></div>            <compodoc-menu></compodoc-menu>
        </div>

        <div class="container-fluid main">
           <div class="row main">
               <div class="d-none d-md-block menu">
                   <compodoc-menu mode="normal"></compodoc-menu>
               </div>
               <!-- START CONTENT -->
               <div class="content injectable">
                   <div class="content-data">












<ol class="breadcrumb">
  <li class="breadcrumb-item">Injectables</li>
  <li class="breadcrumb-item" >RBACService</li>
</ol>

<ul class="nav nav-tabs" role="tablist">
        <li class="nav-item">
            <a href="#info" 
                class="nav-link"
                class="nav-link active"
                role="tab" id="info-tab" data-bs-toggle="tab" data-link="info">Info</a>
        </li>
        <li class="nav-item">
            <a href="#source" 
                class="nav-link"
                
                role="tab" id="source-tab" data-bs-toggle="tab" data-link="source">Source</a>
        </li>
</ul>

<div class="tab-content">
    <div class="tab-pane fade active in" id="info">
        <p class="comment">
            <h3>File</h3>
        </p>
        <p class="comment">
            <code>src/app/core/services/rbac.service.ts</code>
        </p>


            <p class="comment">
                <h3>Description</h3>
            </p>
            <p class="comment">
                <p>RBAC Service - Role-Based Access Control</p>
<p>Manages admin roles, permissions, and audit logging for admin operations.
Supports both new RBAC system and legacy is_admin flag for backward compatibility.</p>
<b>Example :</b><div><pre class="line-numbers"><code class="language-typescript">const rbac = inject(RBACService);


// Check if user has a specific role
if (await rbac.hasRole(&#39;super_admin&#39;)) {
  // Allow access
}


// Check if user has any admin role
if (await rbac.isAdmin()) {
  // Allow access
}


// Log an admin action
await rbac.logAction(&#39;user_view&#39;, &#39;user&#39;, userId, null, { reason: &#39;Support ticket&#39; });</code></pre></div>
            </p>



            <section data-compodoc="block-index">
    <h3 id="index">Index</h3>
    <table class="table table-sm table-bordered index-table">
        <tbody>
                <tr>
                    <td class="col-md-4">
                        <h6><b>Properties</b></h6>
                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                        <ul class="index-list">
                            <li>
                                    <span class="modifier">Private</span>
                                    <span class="modifier">Readonly</span>
                                <a href="#authService" >authService</a>
                            </li>
                            <li>
                                    <span class="modifier">Readonly</span>
                                <a href="#isAdmin" >isAdmin</a>
                            </li>
                            <li>
                                    <span class="modifier">Readonly</span>
                                <a href="#isFinance" >isFinance</a>
                            </li>
                            <li>
                                    <span class="modifier">Readonly</span>
                                <a href="#isOperations" >isOperations</a>
                            </li>
                            <li>
                                    <span class="modifier">Readonly</span>
                                <a href="#isSuperAdmin" >isSuperAdmin</a>
                            </li>
                            <li>
                                    <span class="modifier">Readonly</span>
                                <a href="#isSupport" >isSupport</a>
                            </li>
                            <li>
                                    <span class="modifier">Readonly</span>
                                <a href="#loading" >loading</a>
                            </li>
                            <li>
                                    <span class="modifier">Private</span>
                                    <span class="modifier">Readonly</span>
                                <a href="#loadingSignal" >loadingSignal</a>
                            </li>
                            <li>
                                    <span class="modifier">Private</span>
                                    <span class="modifier">Readonly</span>
                                <a href="#supabase" >supabase</a>
                            </li>
                            <li>
                                    <span class="modifier">Readonly</span>
                                <a href="#userRoles" >userRoles</a>
                            </li>
                            <li>
                                    <span class="modifier">Private</span>
                                    <span class="modifier">Readonly</span>
                                <a href="#userRolesSignal" >userRolesSignal</a>
                            </li>
                        </ul>
                    </td>
                </tr>

                <tr>
                    <td class="col-md-4">
                        <h6><b>Methods</b></h6>
                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                        <ul class="index-list">
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#checkIsAdmin" >checkIsAdmin</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#getAuditLogs" >getAuditLogs</a>
                            </li>
                            <li>
                                <a href="#getRoleDescription" >getRoleDescription</a>
                            </li>
                            <li>
                                <a href="#getRoleDisplayName" >getRoleDisplayName</a>
                            </li>
                            <li>
                                <a href="#getRolePermissions" >getRolePermissions</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#grantRole" >grantRole</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#hasAllRoles" >hasAllRoles</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#hasAnyRole" >hasAnyRole</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#hasRole" >hasRole</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#loadUserRoles" >loadUserRoles</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#logAction" >logAction</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#revokeRole" >revokeRole</a>
                            </li>
                        </ul>
                    </td>
                </tr>





        </tbody>
    </table>
</section>


            <section data-compodoc="block-methods">
    
    <h3 id="methods">
        Methods
    </h3>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="checkIsAdmin"></a>
                    <span class="name">
                            <span class="modifier">Async</span>
                        <span ><b>checkIsAdmin</b></span>
                        <a href="#checkIsAdmin"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>checkIsAdmin()</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="126"
                                    class="link-to-prism">src/app/core/services/rbac.service.ts:126</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">
                        <div class="io-description"><p>Check if current user is any type of admin (new RBAC or legacy)</p>
</div>

                        <div class="io-description">
                            <b>Returns : </b>    <code>Promise&lt;boolean&gt;</code>

                        </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="getAuditLogs"></a>
                    <span class="name">
                            <span class="modifier">Async</span>
                        <span ><b>getAuditLogs</b></span>
                        <a href="#getAuditLogs"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>getAuditLogs(params: literal type)</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="180"
                                    class="link-to-prism">src/app/core/services/rbac.service.ts:180</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">
                        <div class="io-description"><p>Get audit logs with filters</p>
</div>

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>params</td>
                                            <td>
                                                        <code>literal type</code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>    <code>Promise&lt;literal type&gt;</code>

                        </div>
                            <div class="io-description">
                                
                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="getRoleDescription"></a>
                    <span class="name">
                        <span ><b>getRoleDescription</b></span>
                        <a href="#getRoleDescription"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
<code>getRoleDescription(role: <a href="../undefineds/AdminRole.html" target="_self">AdminRole</a>)</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="326"
                                    class="link-to-prism">src/app/core/services/rbac.service.ts:326</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">
                        <div class="io-description"><p>Get role description</p>
</div>

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>role</td>
                                            <td>
                                                            <code><a href="../miscellaneous/typealiases.html#AdminRole" target="_self" >AdminRole</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>

                        </div>
                            <div class="io-description">
                                
                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="getRoleDisplayName"></a>
                    <span class="name">
                        <span ><b>getRoleDisplayName</b></span>
                        <a href="#getRoleDisplayName"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
<code>getRoleDisplayName(role: <a href="../undefineds/AdminRole.html" target="_self">AdminRole</a>)</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="313"
                                    class="link-to-prism">src/app/core/services/rbac.service.ts:313</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">
                        <div class="io-description"><p>Get role display name</p>
</div>

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>role</td>
                                            <td>
                                                            <code><a href="../miscellaneous/typealiases.html#AdminRole" target="_self" >AdminRole</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>

                        </div>
                            <div class="io-description">
                                
                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="getRolePermissions"></a>
                    <span class="name">
                        <span ><b>getRolePermissions</b></span>
                        <a href="#getRolePermissions"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
<code>getRolePermissions(role: <a href="../undefineds/AdminRole.html" target="_self">AdminRole</a>)</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="340"
                                    class="link-to-prism">src/app/core/services/rbac.service.ts:340</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">
                        <div class="io-description"><p>Get role permissions</p>
</div>

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>role</td>
                                            <td>
                                                            <code><a href="../miscellaneous/typealiases.html#AdminRole" target="_self" >AdminRole</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>    <code>string[]</code>

                        </div>
                            <div class="io-description">
                                
                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="grantRole"></a>
                    <span class="name">
                            <span class="modifier">Async</span>
                        <span ><b>grantRole</b></span>
                        <a href="#grantRole"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>grantRole(userId: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>, role: <a href="../undefineds/AdminRole.html" target="_self">AdminRole</a>, expiresAt: string | null)</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="245"
                                    class="link-to-prism">src/app/core/services/rbac.service.ts:245</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">
                        <div class="io-description"><p>Grant an admin role to a user (super_admin only)</p>
</div>

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                                <td>Default value</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>userId</td>
                                            <td>
                                                            <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>

                                            <td>
                                            </td>

                                        </tr>
                                        <tr>
                                                <td>role</td>
                                            <td>
                                                            <code><a href="../miscellaneous/typealiases.html#AdminRole" target="_self" >AdminRole</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>

                                            <td>
                                            </td>

                                        </tr>
                                        <tr>
                                                <td>expiresAt</td>
                                            <td>
                                                        <code>string | null</code>
                                            </td>

                                            <td>
                                                    No
                                            </td>

                                            <td>
                                                    <code>null</code>
                                            </td>

                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>    <code>Promise&lt;boolean&gt;</code>

                        </div>
                            <div class="io-description">
                                
                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="hasAllRoles"></a>
                    <span class="name">
                            <span class="modifier">Async</span>
                        <span ><b>hasAllRoles</b></span>
                        <a href="#hasAllRoles"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>hasAllRoles(roles: AdminRole[])</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="114"
                                    class="link-to-prism">src/app/core/services/rbac.service.ts:114</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">
                        <div class="io-description"><p>Check if current user has all of the specified roles</p>
</div>

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>roles</td>
                                            <td>
                                                        <code>AdminRole[]</code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>    <code>Promise&lt;boolean&gt;</code>

                        </div>
                            <div class="io-description">
                                
                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="hasAnyRole"></a>
                    <span class="name">
                            <span class="modifier">Async</span>
                        <span ><b>hasAnyRole</b></span>
                        <a href="#hasAnyRole"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>hasAnyRole(roles: AdminRole[])</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="102"
                                    class="link-to-prism">src/app/core/services/rbac.service.ts:102</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">
                        <div class="io-description"><p>Check if current user has any of the specified roles</p>
</div>

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>roles</td>
                                            <td>
                                                        <code>AdminRole[]</code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>    <code>Promise&lt;boolean&gt;</code>

                        </div>
                            <div class="io-description">
                                
                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="hasRole"></a>
                    <span class="name">
                            <span class="modifier">Async</span>
                        <span ><b>hasRole</b></span>
                        <a href="#hasRole"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>hasRole(role: <a href="../undefineds/AdminRole.html" target="_self">AdminRole</a>)</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="90"
                                    class="link-to-prism">src/app/core/services/rbac.service.ts:90</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">
                        <div class="io-description"><p>Check if current user has a specific admin role</p>
</div>

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>role</td>
                                            <td>
                                                            <code><a href="../miscellaneous/typealiases.html#AdminRole" target="_self" >AdminRole</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>    <code>Promise&lt;boolean&gt;</code>

                        </div>
                            <div class="io-description">
                                
                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="loadUserRoles"></a>
                    <span class="name">
                            <span class="modifier">Async</span>
                        <span ><b>loadUserRoles</b></span>
                        <a href="#loadUserRoles"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>loadUserRoles()</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="58"
                                    class="link-to-prism">src/app/core/services/rbac.service.ts:58</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">
                        <div class="io-description"><p>Load current user&#39;s admin roles</p>
</div>

                        <div class="io-description">
                            <b>Returns : </b>    <code>Promise&lt;AdminUser[]&gt;</code>

                        </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="logAction"></a>
                    <span class="name">
                            <span class="modifier">Async</span>
                        <span ><b>logAction</b></span>
                        <a href="#logAction"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>logAction(action: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>, resourceType: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>, resourceId: string | null, changes: literal type | null, metadata: Record<string | unknown> | null)</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="149"
                                    class="link-to-prism">src/app/core/services/rbac.service.ts:149</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">
                        <div class="io-description"><p>Log an admin action to the audit trail</p>
</div>

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                                <td>Default value</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>action</td>
                                            <td>
                                                            <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>

                                            <td>
                                            </td>

                                        </tr>
                                        <tr>
                                                <td>resourceType</td>
                                            <td>
                                                            <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>

                                            <td>
                                            </td>

                                        </tr>
                                        <tr>
                                                <td>resourceId</td>
                                            <td>
                                                        <code>string | null</code>
                                            </td>

                                            <td>
                                                    No
                                            </td>

                                            <td>
                                                    <code>null</code>
                                            </td>

                                        </tr>
                                        <tr>
                                                <td>changes</td>
                                            <td>
                                                        <code>literal type | null</code>
                                            </td>

                                            <td>
                                                    No
                                            </td>

                                            <td>
                                                    <code>null</code>
                                            </td>

                                        </tr>
                                        <tr>
                                                <td>metadata</td>
                                            <td>
                                                        <code>Record&lt;string | unknown&gt; | null</code>
                                            </td>

                                            <td>
                                                    No
                                            </td>

                                            <td>
                                                    <code>null</code>
                                            </td>

                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>    <code>Promise&lt;string | null&gt;</code>

                        </div>
                            <div class="io-description">
                                
                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="revokeRole"></a>
                    <span class="name">
                            <span class="modifier">Async</span>
                        <span ><b>revokeRole</b></span>
                        <a href="#revokeRole"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>revokeRole(userId: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>, role: <a href="../undefineds/AdminRole.html" target="_self">AdminRole</a>)</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="286"
                                    class="link-to-prism">src/app/core/services/rbac.service.ts:286</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">
                        <div class="io-description"><p>Revoke an admin role from a user (super_admin only)</p>
</div>

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>userId</td>
                                            <td>
                                                            <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                        </tr>
                                        <tr>
                                                <td>role</td>
                                            <td>
                                                            <code><a href="../miscellaneous/typealiases.html#AdminRole" target="_self" >AdminRole</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>    <code>Promise&lt;boolean&gt;</code>

                        </div>
                            <div class="io-description">
                                
                            </div>
                </td>
            </tr>
        </tbody>
    </table>
</section>
            <section data-compodoc="block-properties">
    
    <h3 id="inputs">
        Properties
    </h3>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="authService"></a>
                    <span class="name">
                            <span class="modifier">Private</span>
                            <span class="modifier">Readonly</span>
                        <span ><b>authService</b></span>
                        <a href="#authService"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
                <tr>
                    <td class="col-md-4">
                        <i>Type : </i>    <code>unknown</code>

                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                        <i>Default value : </i><code>inject(AuthService)</code>
                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                                <div class="io-line">Defined in <a href="" data-line="36" class="link-to-prism">src/app/core/services/rbac.service.ts:36</a></div>
                        </td>
                    </tr>


        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="isAdmin"></a>
                    <span class="name">
                            <span class="modifier">Readonly</span>
                        <span ><b>isAdmin</b></span>
                        <a href="#isAdmin"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
                <tr>
                    <td class="col-md-4">
                        <i>Type : </i>    <code>unknown</code>

                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                        <i>Default value : </i><code>computed(() &#x3D;&gt; this.userRolesSignal().length &gt; 0)</code>
                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                                <div class="io-line">Defined in <a href="" data-line="45" class="link-to-prism">src/app/core/services/rbac.service.ts:45</a></div>
                        </td>
                    </tr>


        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="isFinance"></a>
                    <span class="name">
                            <span class="modifier">Readonly</span>
                        <span ><b>isFinance</b></span>
                        <a href="#isFinance"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
                <tr>
                    <td class="col-md-4">
                        <i>Type : </i>    <code>unknown</code>

                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                        <i>Default value : </i><code>computed(() &#x3D;&gt; this.userRolesSignal().some((r) &#x3D;&gt; r.role &#x3D;&#x3D;&#x3D; &#x27;finance&#x27;))</code>
                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                                <div class="io-line">Defined in <a href="" data-line="53" class="link-to-prism">src/app/core/services/rbac.service.ts:53</a></div>
                        </td>
                    </tr>


        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="isOperations"></a>
                    <span class="name">
                            <span class="modifier">Readonly</span>
                        <span ><b>isOperations</b></span>
                        <a href="#isOperations"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
                <tr>
                    <td class="col-md-4">
                        <i>Type : </i>    <code>unknown</code>

                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                        <i>Default value : </i><code>computed(() &#x3D;&gt;
    this.userRolesSignal().some((r) &#x3D;&gt; r.role &#x3D;&#x3D;&#x3D; &#x27;operations&#x27;),
  )</code>
                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                                <div class="io-line">Defined in <a href="" data-line="49" class="link-to-prism">src/app/core/services/rbac.service.ts:49</a></div>
                        </td>
                    </tr>


        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="isSuperAdmin"></a>
                    <span class="name">
                            <span class="modifier">Readonly</span>
                        <span ><b>isSuperAdmin</b></span>
                        <a href="#isSuperAdmin"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
                <tr>
                    <td class="col-md-4">
                        <i>Type : </i>    <code>unknown</code>

                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                        <i>Default value : </i><code>computed(() &#x3D;&gt;
    this.userRolesSignal().some((r) &#x3D;&gt; r.role &#x3D;&#x3D;&#x3D; &#x27;super_admin&#x27;),
  )</code>
                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                                <div class="io-line">Defined in <a href="" data-line="46" class="link-to-prism">src/app/core/services/rbac.service.ts:46</a></div>
                        </td>
                    </tr>


        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="isSupport"></a>
                    <span class="name">
                            <span class="modifier">Readonly</span>
                        <span ><b>isSupport</b></span>
                        <a href="#isSupport"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
                <tr>
                    <td class="col-md-4">
                        <i>Type : </i>    <code>unknown</code>

                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                        <i>Default value : </i><code>computed(() &#x3D;&gt; this.userRolesSignal().some((r) &#x3D;&gt; r.role &#x3D;&#x3D;&#x3D; &#x27;support&#x27;))</code>
                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                                <div class="io-line">Defined in <a href="" data-line="52" class="link-to-prism">src/app/core/services/rbac.service.ts:52</a></div>
                        </td>
                    </tr>


        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="loading"></a>
                    <span class="name">
                            <span class="modifier">Readonly</span>
                        <span ><b>loading</b></span>
                        <a href="#loading"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
                <tr>
                    <td class="col-md-4">
                        <i>Type : </i>    <code>unknown</code>

                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                        <i>Default value : </i><code>computed(() &#x3D;&gt; this.loadingSignal())</code>
                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                                <div class="io-line">Defined in <a href="" data-line="44" class="link-to-prism">src/app/core/services/rbac.service.ts:44</a></div>
                        </td>
                    </tr>


        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="loadingSignal"></a>
                    <span class="name">
                            <span class="modifier">Private</span>
                            <span class="modifier">Readonly</span>
                        <span ><b>loadingSignal</b></span>
                        <a href="#loadingSignal"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
                <tr>
                    <td class="col-md-4">
                        <i>Type : </i>    <code>unknown</code>

                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                        <i>Default value : </i><code>signal&lt;boolean&gt;(false)</code>
                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                                <div class="io-line">Defined in <a href="" data-line="40" class="link-to-prism">src/app/core/services/rbac.service.ts:40</a></div>
                        </td>
                    </tr>


        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="supabase"></a>
                    <span class="name">
                            <span class="modifier">Private</span>
                            <span class="modifier">Readonly</span>
                        <span ><b>supabase</b></span>
                        <a href="#supabase"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
                <tr>
                    <td class="col-md-4">
                        <i>Type : </i>    <code>unknown</code>

                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                        <i>Default value : </i><code>injectSupabase()</code>
                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                                <div class="io-line">Defined in <a href="" data-line="35" class="link-to-prism">src/app/core/services/rbac.service.ts:35</a></div>
                        </td>
                    </tr>


        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="userRoles"></a>
                    <span class="name">
                            <span class="modifier">Readonly</span>
                        <span ><b>userRoles</b></span>
                        <a href="#userRoles"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
                <tr>
                    <td class="col-md-4">
                        <i>Type : </i>    <code>unknown</code>

                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                        <i>Default value : </i><code>computed(() &#x3D;&gt; this.userRolesSignal())</code>
                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                                <div class="io-line">Defined in <a href="" data-line="43" class="link-to-prism">src/app/core/services/rbac.service.ts:43</a></div>
                        </td>
                    </tr>


        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="userRolesSignal"></a>
                    <span class="name">
                            <span class="modifier">Private</span>
                            <span class="modifier">Readonly</span>
                        <span ><b>userRolesSignal</b></span>
                        <a href="#userRolesSignal"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
                <tr>
                    <td class="col-md-4">
                        <i>Type : </i>    <code>unknown</code>

                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                        <i>Default value : </i><code>signal&lt;AdminUser[]&gt;([])</code>
                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                                <div class="io-line">Defined in <a href="" data-line="39" class="link-to-prism">src/app/core/services/rbac.service.ts:39</a></div>
                        </td>
                    </tr>


        </tbody>
    </table>
</section>

    </div>


    <div class="tab-pane fade  tab-source-code" id="source">
        <pre class="line-numbers compodoc-sourcecode"><code class="language-typescript">import { Injectable, inject, signal, computed } from &#x27;@angular/core&#x27;;
import type { AdminAuditLog } from &#x27;../models&#x27;;
import type { AdminRole, AdminUser } from &#x27;../types/admin.types&#x27;;
import { injectSupabase } from &#x27;./supabase-client.service&#x27;;
import { AuthService } from &#x27;./auth.service&#x27;;

/**
 * RBAC Service - Role-Based Access Control
 *
 * Manages admin roles, permissions, and audit logging for admin operations.
 * Supports both new RBAC system and legacy is_admin flag for backward compatibility.
 *
 * @example
 * &#x60;&#x60;&#x60;typescript
 * const rbac &#x3D; inject(RBACService);
 *
 * // Check if user has a specific role
 * if (await rbac.hasRole(&#x27;super_admin&#x27;)) {
 *   // Allow access
 * }
 *
 * // Check if user has any admin role
 * if (await rbac.isAdmin()) {
 *   // Allow access
 * }
 *
 * // Log an admin action
 * await rbac.logAction(&#x27;user_view&#x27;, &#x27;user&#x27;, userId, null, { reason: &#x27;Support ticket&#x27; });
 * &#x60;&#x60;&#x60;
 */
@Injectable({
  providedIn: &#x27;root&#x27;,
})
export class RBACService {
  private readonly supabase &#x3D; injectSupabase();
  private readonly authService &#x3D; inject(AuthService);

  // Cached user roles
  private readonly userRolesSignal &#x3D; signal&lt;AdminUser[]&gt;([]);
  private readonly loadingSignal &#x3D; signal&lt;boolean&gt;(false);

  // Computed properties
  readonly userRoles &#x3D; computed(() &#x3D;&gt; this.userRolesSignal());
  readonly loading &#x3D; computed(() &#x3D;&gt; this.loadingSignal());
  readonly isAdmin &#x3D; computed(() &#x3D;&gt; this.userRolesSignal().length &gt; 0);
  readonly isSuperAdmin &#x3D; computed(() &#x3D;&gt;
    this.userRolesSignal().some((r) &#x3D;&gt; r.role &#x3D;&#x3D;&#x3D; &#x27;super_admin&#x27;),
  );
  readonly isOperations &#x3D; computed(() &#x3D;&gt;
    this.userRolesSignal().some((r) &#x3D;&gt; r.role &#x3D;&#x3D;&#x3D; &#x27;operations&#x27;),
  );
  readonly isSupport &#x3D; computed(() &#x3D;&gt; this.userRolesSignal().some((r) &#x3D;&gt; r.role &#x3D;&#x3D;&#x3D; &#x27;support&#x27;));
  readonly isFinance &#x3D; computed(() &#x3D;&gt; this.userRolesSignal().some((r) &#x3D;&gt; r.role &#x3D;&#x3D;&#x3D; &#x27;finance&#x27;));

  /**
   * Load current user&#x27;s admin roles
   */
  async loadUserRoles(): Promise&lt;AdminUser[]&gt; {
    this.loadingSignal.set(true);
    try {
      const user &#x3D; await this.authService.ensureSession();
      if (!user?.user?.id) {
        this.userRolesSignal.set([]);
        return [];
      }

      const { data, error } &#x3D; await this.supabase
        .from(&#x27;admin_user_roles&#x27;)
        .select(&#x27;*&#x27;)
        .eq(&#x27;user_id&#x27;, user.user.id)
        .eq(&#x27;is_active&#x27;, true)
        .or(&#x60;expires_at.is.null,expires_at.gt.${new Date().toISOString()}&#x60;);

      if (error) throw error;

      this.userRolesSignal.set(data as AdminUser[]);
      return data as AdminUser[];
    } catch (error) {
      console.error(&#x27;Error loading user roles:&#x27;, error);
      this.userRolesSignal.set([]);
      return [];
    } finally {
      this.loadingSignal.set(false);
    }
  }

  /**
   * Check if current user has a specific admin role
   */
  async hasRole(role: AdminRole): Promise&lt;boolean&gt; {
    const roles &#x3D; this.userRolesSignal();
    if (roles.length &#x3D;&#x3D;&#x3D; 0) {
      await this.loadUserRoles();
    }

    return this.userRolesSignal().some((r) &#x3D;&gt; r.role &#x3D;&#x3D;&#x3D; role);
  }

  /**
   * Check if current user has any of the specified roles
   */
  async hasAnyRole(roles: AdminRole[]): Promise&lt;boolean&gt; {
    const userRoles &#x3D; this.userRolesSignal();
    if (userRoles.length &#x3D;&#x3D;&#x3D; 0) {
      await this.loadUserRoles();
    }

    return this.userRolesSignal().some((r) &#x3D;&gt; roles.includes(r.role));
  }

  /**
   * Check if current user has all of the specified roles
   */
  async hasAllRoles(roles: AdminRole[]): Promise&lt;boolean&gt; {
    const userRoles &#x3D; this.userRolesSignal();
    if (userRoles.length &#x3D;&#x3D;&#x3D; 0) {
      await this.loadUserRoles();
    }

    return roles.every((role) &#x3D;&gt; this.userRolesSignal().some((r) &#x3D;&gt; r.role &#x3D;&#x3D;&#x3D; role));
  }

  /**
   * Check if current user is any type of admin (new RBAC or legacy)
   */
  async checkIsAdmin(): Promise&lt;boolean&gt; {
    // Check new RBAC first
    const roles &#x3D; this.userRolesSignal();
    if (roles.length &#x3D;&#x3D;&#x3D; 0) {
      await this.loadUserRoles();
    }

    if (this.userRolesSignal().length &gt; 0) {
      return true;
    }

    // Fallback to legacy is_admin check
    try {
      const { data } &#x3D; await this.supabase.rpc(&#x27;is_admin&#x27;);
      return data &#x3D;&#x3D;&#x3D; true;
    } catch {
      return false;
    }
  }

  /**
   * Log an admin action to the audit trail
   */
  async logAction(
    action: string,
    resourceType: string,
    resourceId: string | null &#x3D; null,
    changes: { before?: unknown; after?: unknown } | null &#x3D; null,
    metadata: Record&lt;string, unknown&gt; | null &#x3D; null,
  ): Promise&lt;string | null&gt; {
    try {
      const { data, error } &#x3D; await this.supabase.rpc(&#x27;log_admin_action&#x27;, {
        p_action: action,
        p_resource_type: resourceType,
        p_resource_id: resourceId,
        p_changes: changes as never,
        p_metadata: metadata as never,
      });

      if (error) {
        console.error(&#x27;Error logging admin action:&#x27;, error);
        return null;
      }

      return data as string;
    } catch (error) {
      console.error(&#x27;Error logging admin action:&#x27;, error);
      return null;
    }
  }

  /**
   * Get audit logs with filters
   */
  async getAuditLogs(params: {
    limit?: number;
    offset?: number;
    action?: string;
    resourceType?: string;
    resourceId?: string;
    adminUserId?: string;
    startDate?: string;
    endDate?: string;
  }): Promise&lt;{ data: AdminAuditLog[]; count: number }&gt; {
    try {
      let query &#x3D; this.supabase
        .from(&#x27;admin_audit_logs&#x27;)
        .select(&#x27;*&#x27;, { count: &#x27;exact&#x27; })
        .order(&#x27;created_at&#x27;, { ascending: false });

      if (params.action) {
        query &#x3D; query.eq(&#x27;action&#x27;, params.action);
      }

      if (params.resourceType) {
        query &#x3D; query.eq(&#x27;resource_type&#x27;, params.resourceType);
      }

      if (params.resourceId) {
        query &#x3D; query.eq(&#x27;resource_id&#x27;, params.resourceId);
      }

      if (params.adminUserId) {
        query &#x3D; query.eq(&#x27;admin_user_id&#x27;, params.adminUserId);
      }

      if (params.startDate) {
        query &#x3D; query.gte(&#x27;created_at&#x27;, params.startDate);
      }

      if (params.endDate) {
        query &#x3D; query.lte(&#x27;created_at&#x27;, params.endDate);
      }

      if (params.limit) {
        query &#x3D; query.limit(params.limit);
      }

      if (params.offset) {
        query &#x3D; query.range(params.offset, params.offset + (params.limit ?? 50) - 1);
      }

      const { data, error, count } &#x3D; await query;

      if (error) throw error;

      return {
        data: (data as AdminAuditLog[]) ?? [],
        count: count ?? 0,
      };
    } catch (error) {
      console.error(&#x27;Error fetching audit logs:&#x27;, error);
      return { data: [], count: 0 };
    }
  }

  /**
   * Grant an admin role to a user (super_admin only)
   */
  async grantRole(
    userId: string,
    role: AdminRole,
    expiresAt: string | null &#x3D; null,
  ): Promise&lt;boolean&gt; {
    if (!(await this.hasRole(&#x27;super_admin&#x27;))) {
      throw new Error(&#x27;Only super admins can grant roles&#x27;);
    }

    try {
      const user &#x3D; await this.authService.ensureSession();
      if (!user?.user?.id) {
        throw new Error(&#x27;Not authenticated&#x27;);
      }

      const { error } &#x3D; await this.supabase.from(&#x27;admin_user_roles&#x27;).insert({
        user_id: userId,
        role,
        granted_by: user.user.id,
        expires_at: expiresAt,
        is_active: true,
      });

      if (error) throw error;

      // Log the action
      await this.logAction(&#x27;role_grant&#x27;, &#x27;admin_user_role&#x27;, userId, null, {
        role,
        expires_at: expiresAt,
      });

      return true;
    } catch (error) {
      console.error(&#x27;Error granting role:&#x27;, error);
      return false;
    }
  }

  /**
   * Revoke an admin role from a user (super_admin only)
   */
  async revokeRole(userId: string, role: AdminRole): Promise&lt;boolean&gt; {
    if (!(await this.hasRole(&#x27;super_admin&#x27;))) {
      throw new Error(&#x27;Only super admins can revoke roles&#x27;);
    }

    try {
      const { error } &#x3D; await this.supabase
        .from(&#x27;admin_user_roles&#x27;)
        .update({ is_active: false })
        .eq(&#x27;user_id&#x27;, userId)
        .eq(&#x27;role&#x27;, role);

      if (error) throw error;

      // Log the action
      await this.logAction(&#x27;role_revoke&#x27;, &#x27;admin_user_role&#x27;, userId, null, { role });

      return true;
    } catch (error) {
      console.error(&#x27;Error revoking role:&#x27;, error);
      return false;
    }
  }

  /**
   * Get role display name
   */
  getRoleDisplayName(role: AdminRole): string {
    const roleNames: Record&lt;AdminRole, string&gt; &#x3D; {
      super_admin: &#x27;Super Administrator&#x27;,
      operations: &#x27;Operations Manager&#x27;,
      support: &#x27;Support Specialist&#x27;,
      finance: &#x27;Finance Manager&#x27;,
    };
    return roleNames[role];
  }

  /**
   * Get role description
   */
  getRoleDescription(role: AdminRole): string {
    const roleDescriptions: Record&lt;AdminRole, string&gt; &#x3D; {
      super_admin:
        &#x27;Full access to all admin features including user management and system configuration&#x27;,
      operations: &#x27;Manage withdrawals, verifications, bookings, and operational tasks&#x27;,
      support: &#x27;User support, content moderation, and customer service&#x27;,
      finance: &#x27;Payment investigation, refunds, accounting, and financial operations&#x27;,
    };
    return roleDescriptions[role];
  }

  /**
   * Get role permissions
   */
  getRolePermissions(role: AdminRole): string[] {
    const rolePermissions: Record&lt;AdminRole, string[]&gt; &#x3D; {
      super_admin: [&#x27;*&#x27;],
      operations: [&#x27;withdrawals:*&#x27;, &#x27;verifications:*&#x27;, &#x27;bookings:*&#x27;, &#x27;cars:*&#x27;],
      support: [&#x27;users:view&#x27;, &#x27;bookings:view&#x27;, &#x27;reviews:moderate&#x27;, &#x27;support:*&#x27;],
      finance: [&#x27;payments:*&#x27;, &#x27;refunds:*&#x27;, &#x27;accounting:*&#x27;, &#x27;reports:*&#x27;],
    };
    return rolePermissions[role];
  }
}
</code></pre>
    </div>

</div>













                   </div><div class="search-results">
    <div class="has-results">
        <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
        <ul class="search-results-list"></ul>
    </div>
    <div class="no-results">
        <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
    </div>
</div>
</div>
               <!-- END CONTENT -->
           </div>
       </div>

          <label class="dark-mode-switch">
               <input type="checkbox">
               <span class="slider">
                    <svg class="slider-icon" viewBox="0 0 24 24" fill="none" height="20" stroke="#000" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" width="20" xmlns="http://www.w3.org/2000/svg">
                    <path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"></path>
                    </svg>
               </span>
          </label>

       <script>
            var COMPODOC_CURRENT_PAGE_DEPTH = 1;
            var COMPODOC_CURRENT_PAGE_CONTEXT = 'injectable';
            var COMPODOC_CURRENT_PAGE_URL = 'RBACService.html';
            var MAX_SEARCH_RESULTS = 15;
       </script>

       <script>
               $darkModeToggleSwitchers = document.querySelectorAll('.dark-mode-switch input');
               checkToggle(darkModeState);
               if ($darkModeToggleSwitchers.length > 0) {
                    for (var i = 0; i < $darkModeToggleSwitchers.length; i++) {
                         $darkModeToggleSwitchers[i].addEventListener('change', function (event) {
                              darkModeState = !darkModeState;
                              toggleDarkMode(darkModeState);
                         });
                    }
               }
          </script>

       <script src="../js/libs/custom-elements.min.js"></script>
       <script src="../js/libs/lit-html.js"></script>

       <script src="../js/menu-wc.js" defer></script>
       <script nomodule src="../js/menu-wc_es5.js" defer></script>

       <script src="../js/libs/bootstrap-native.js"></script>

       <script src="../js/libs/es6-shim.min.js"></script>
       <script src="../js/libs/EventDispatcher.js"></script>
       <script src="../js/libs/promise.min.js"></script>

       <script src="../js/compodoc.js"></script>

       <script src="../js/tabs.js"></script>
       <script src="../js/menu.js"></script>
       <script src="../js/libs/clipboard.min.js"></script>
       <script src="../js/libs/prism.js"></script>
       <script src="../js/sourceCode.js"></script>
          <script src="../js/search/search.js"></script>
          <script src="../js/search/lunr.min.js"></script>
          <script src="../js/search/search-lunr.js"></script>
          <script src="../js/search/search_index.js"></script>
       <script src="../js/lazy-load-graphs.js"></script>


    </body>
</html>
