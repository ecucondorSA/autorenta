<!doctype html>
<html class="no-js" lang="">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <title>autorenta-web documentation</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <link rel="icon" type="image/x-icon" href="../images/favicon.ico">
	   <link rel="stylesheet" href="../styles/style.css">
        <link rel="stylesheet" href="../styles/dark.css">
    </head>
    <body>
          <script>
               // Blocking script to avoid flickering dark mode
               // Dark mode toggle button
               var useDark = window.matchMedia('(prefers-color-scheme: dark)');
               var darkModeState = useDark.matches;
               var $darkModeToggleSwitchers = document.querySelectorAll('.dark-mode-switch input');
               var $darkModeToggles = document.querySelectorAll('.dark-mode-switch');
               var darkModeStateLocal = localStorage.getItem('compodoc_darkmode-state');

               function checkToggle(check) {
                    for (var i = 0; i < $darkModeToggleSwitchers.length; i++) {
                         $darkModeToggleSwitchers[i].checked = check;
                    }
               }

               function toggleDarkMode(state) {
                    if (window.localStorage) {
                         localStorage.setItem('compodoc_darkmode-state', state);
                    }

                    checkToggle(state);

                    const hasClass = document.body.classList.contains('dark');

                    if (state) {
                         for (var i = 0; i < $darkModeToggles.length; i++) {
                              $darkModeToggles[i].classList.add('dark');
                         }
                         if (!hasClass) {
                              document.body.classList.add('dark');
                         }
                    } else {
                         for (var i = 0; i < $darkModeToggles.length; i++) {
                              $darkModeToggles[i].classList.remove('dark');
                         }
                         if (hasClass) {
                              document.body.classList.remove('dark');
                         }
                    }
               }

               useDark.addEventListener('change', function (evt) {
                    toggleDarkMode(evt.matches);
               });
               if (darkModeStateLocal) {
                    darkModeState = darkModeStateLocal === 'true';
               }
               toggleDarkMode(darkModeState);
          </script>
          <script>
              // --- Iframe navigation tracking for Template Playground ---
              function sendCurrentUrlToParent() {
                  if (window.parent && window.parent !== window) {
                      window.parent.postMessage({
                          type: 'compodoc-iframe-navigate',
                          url: window.location.pathname + window.location.hash
                      }, '*');
                  }
              }
              window.addEventListener('hashchange', sendCurrentUrlToParent, false);
              window.addEventListener('popstate', sendCurrentUrlToParent, false);
              window.addEventListener('DOMContentLoaded', sendCurrentUrlToParent, false);
          </script>

        <div class="navbar navbar-default navbar-fixed-top d-md-none p-0">
               <div class="d-flex">
                    <a href="../" class="navbar-brand">autorenta-web documentation</a>
                    <button type="button" class="btn btn-default btn-menu ion-ios-menu" id="btn-menu"></button>
               </div>
        </div>

        <div class="xs-menu menu" id="mobile-menu">
                <div id="book-search-input" role="search"><input type="text" placeholder="Type to search"></div>            <compodoc-menu></compodoc-menu>
        </div>

        <div class="container-fluid main">
           <div class="row main">
               <div class="d-none d-md-block menu">
                   <compodoc-menu mode="normal"></compodoc-menu>
               </div>
               <!-- START CONTENT -->
               <div class="content injectable">
                   <div class="content-data">












<ol class="breadcrumb">
  <li class="breadcrumb-item">Injectables</li>
  <li class="breadcrumb-item" >PhoneVerificationService</li>
</ol>

<ul class="nav nav-tabs" role="tablist">
        <li class="nav-item">
            <a href="#info" 
                class="nav-link"
                class="nav-link active"
                role="tab" id="info-tab" data-bs-toggle="tab" data-link="info">Info</a>
        </li>
        <li class="nav-item">
            <a href="#source" 
                class="nav-link"
                
                role="tab" id="source-tab" data-bs-toggle="tab" data-link="source">Source</a>
        </li>
</ul>

<div class="tab-content">
    <div class="tab-pane fade active in" id="info">
        <p class="comment">
            <h3>File</h3>
        </p>
        <p class="comment">
            <code>src/app/core/services/phone-verification.service.ts</code>
        </p>


            <p class="comment">
                <h3>Description</h3>
            </p>
            <p class="comment">
                <p>Service for managing phone number verification via SMS OTP</p>
<p>Extends VerificationBaseService with phone-specific functionality:</p>
<ul>
<li>Sending OTP codes via SMS</li>
<li>Verifying OTP codes</li>
<li>Phone-specific rate limiting (3 attempts per hour)</li>
<li>Argentina phone number validation (+54)</li>
</ul>
<p>Base class provides:</p>
<ul>
<li>Cooldown management (calculateCooldownRemaining, startCooldownTimer)</li>
<li>Auth listener initialization</li>
<li>Status updates from user object</li>
<li>Reactive state (signals)</li>
</ul>

            </p>

            <p class="comment">
                <h3>Extends</h3>
            </p>
            <p class="comment">
                            <code><a href="../classes/VerificationBaseService.html" target="_self" >VerificationBaseService</a></code>
            </p>


            <section data-compodoc="block-index">
    <h3 id="index">Index</h3>
    <table class="table table-sm table-bordered index-table">
        <tbody>
                <tr>
                    <td class="col-md-4">
                        <h6><b>Properties</b></h6>
                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                        <ul class="index-list">
                            <li>
                                    <span class="modifier">Protected</span>
                                    <span class="modifier">Readonly</span>
                                <a href="#cooldownMs" >cooldownMs</a>
                            </li>
                            <li>
                                    <span class="modifier">Private</span>
                                <a href="#logger" >logger</a>
                            </li>
                            <li>
                                    <span class="modifier">Private</span>
                                    <span class="modifier">Readonly</span>
                                <a href="#MAX_ATTEMPTS_PER_HOUR" >MAX_ATTEMPTS_PER_HOUR</a>
                            </li>
                            <li>
                                    <span class="modifier">Private</span>
                                <a href="#otpAttempts" >otpAttempts</a>
                            </li>
                            <li>
                                    <span class="modifier">Protected</span>
                                    <span class="modifier">Readonly</span>
                                <a href="#verificationType" >verificationType</a>
                            </li>
                            <li>
                                    <span class="modifier">Readonly</span>
                                <a href="#error" >error</a>
                            </li>
                            <li>
                                    <span class="modifier">Protected</span>
                                <a href="#lastSendTime" >lastSendTime</a>
                            </li>
                            <li>
                                    <span class="modifier">Readonly</span>
                                <a href="#loading" >loading</a>
                            </li>
                            <li>
                                    <span class="modifier">Readonly</span>
                                <a href="#status" >status</a>
                            </li>
                            <li>
                                    <span class="modifier">Protected</span>
                                    <span class="modifier">Readonly</span>
                                <a href="#statusSignal" >statusSignal</a>
                            </li>
                            <li>
                                    <span class="modifier">Protected</span>
                                    <span class="modifier">Readonly</span>
                                <a href="#supabase" >supabase</a>
                            </li>
                        </ul>
                    </td>
                </tr>

                <tr>
                    <td class="col-md-4">
                        <h6><b>Methods</b></h6>
                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                        <ul class="index-list">
                            <li>
                                    <span class="modifier">Private</span>
                                <a href="#canSendOTP" >canSendOTP</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#checkPhoneStatus" class="deprecated-name">checkPhoneStatus</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#checkStatus" >checkStatus</a>
                            </li>
                            <li>
                                    <span class="modifier">Private</span>
                                <a href="#cleanupOldAttempts" >cleanupOldAttempts</a>
                            </li>
                            <li>
                                <a href="#clearError" >clearError</a>
                            </li>
                            <li>
                                    <span class="modifier">Protected</span>
                                    <span class="modifier"></span>
                                <a href="#extendStatus" >extendStatus</a>
                            </li>
                            <li>
                                    <span class="modifier">Private</span>
                                <a href="#formatPhoneNumber" >formatPhoneNumber</a>
                            </li>
                            <li>
                                    <span class="modifier">Private</span>
                                <a href="#getPhoneFormatHint" >getPhoneFormatHint</a>
                            </li>
                            <li>
                                <a href="#getRemainingAttempts" >getRemainingAttempts</a>
                            </li>
                            <li>
                                    <span class="modifier">Private</span>
                                <a href="#isValidPhoneNumber" >isValidPhoneNumber</a>
                            </li>
                            <li>
                                <a href="#resetOTPSentState" >resetOTPSentState</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#sendOTP" class="deprecated-name">sendOTP</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#sendVerification" >sendVerification</a>
                            </li>
                            <li>
                                    <span class="modifier"></span>
                                <a href="#startCooldownTimer" >startCooldownTimer</a>
                            </li>
                            <li>
                                <a href="#subscribeToPhoneChanges" class="deprecated-name">subscribeToPhoneChanges</a>
                            </li>
                            <li>
                                    <span class="modifier">Protected</span>
                                    <span class="modifier"></span>
                                <a href="#updateStatusFromUser" >updateStatusFromUser</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#verifyOTP" >verifyOTP</a>
                            </li>
                            <li>
                                    <span class="modifier">Protected</span>
                                <a href="#calculateCooldownRemaining" >calculateCooldownRemaining</a>
                            </li>
                            <li>
                                    <span class="modifier">Protected</span>
                                <a href="#checkCooldown" >checkCooldown</a>
                            </li>
                            <li>
                                    <span class="modifier">Protected</span>
                                <a href="#hasPassedCooldown" >hasPassedCooldown</a>
                            </li>
                            <li>
                                    <span class="modifier">Protected</span>
                                <a href="#initializeAuthListener" >initializeAuthListener</a>
                            </li>
                            <li>
                                    <span class="modifier">Protected</span>
                                <a href="#recordSendTime" >recordSendTime</a>
                            </li>
                            <li>
                                <a href="#subscribeToChanges" >subscribeToChanges</a>
                            </li>
                        </ul>
                    </td>
                </tr>





        </tbody>
    </table>
</section>

            <section data-compodoc="block-constructor">
    <h3 id="constructor">Constructor</h3>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
<code>constructor()</code>
                    </td>
                </tr>
                        <tr>
                            <td class="col-md-4">
                                <div class="io-line">Defined in <a href="" data-line="54" class="link-to-prism">src/app/core/services/phone-verification.service.ts:54</a></div>
                            </td>
                        </tr>

            </tbody>
        </table>
</section>

            <section data-compodoc="block-methods">
    
    <h3 id="methods">
        Methods
    </h3>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="canSendOTP"></a>
                    <span class="name">
                            <span class="modifier">Private</span>
                        <span ><b>canSendOTP</b></span>
                        <a href="#canSendOTP"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>canSendOTP()</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="437"
                                    class="link-to-prism">src/app/core/services/phone-verification.service.ts:437</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">
                        <div class="io-description"><p>Check if user can send OTP (rate limiting)</p>
</div>

                        <div class="io-description">
                            <b>Returns : </b>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/boolean" target="_blank" >boolean</a></code>

                        </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="checkPhoneStatus"></a>
                    <span class="name">
                            <span class="modifier">Async</span>
                        <span class="deprecated-name"><b>checkPhoneStatus</b></span>
                        <a href="#checkPhoneStatus"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4 deprecated">
                    Use checkStatus instead
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>checkPhoneStatus()</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="491"
                                    class="link-to-prism">src/app/core/services/phone-verification.service.ts:491</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">
                        <div class="io-description"><p>Convenience method for backward compatibility</p>
</div>

                        <div class="io-description">
                            <b>Returns : </b>        <code><a href="../miscellaneous/typealiases.html#VerificationStatus" target="_self" >Promise&lt;PhoneVerificationStatus&gt;</a></code>

                        </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="checkStatus"></a>
                    <span class="name">
                            <span class="modifier">Async</span>
                        <span ><b>checkStatus</b></span>
                        <a href="#checkStatus"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>checkStatus()</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Inherited from         <code><a href="../classes/VerificationBaseService.html" target="_self" >VerificationBaseService</a></code>
</div>
                        </td>
                    </tr>
                    <tr>
                        <td class="col-md-4">
                                <div class="io-line">Defined in         <code><a href="../classes/VerificationBaseService.html#source" target="_self" >VerificationBaseService:76</a></code>
</div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">
                        <div class="io-description"><p>Check current phone verification status (implements abstract method)</p>
</div>

                        <div class="io-description">
                            <b>Returns : </b>        <code><a href="../miscellaneous/typealiases.html#VerificationStatus" target="_self" >Promise&lt;PhoneVerificationStatus&gt;</a></code>

                        </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="cleanupOldAttempts"></a>
                    <span class="name">
                            <span class="modifier">Private</span>
                        <span ><b>cleanupOldAttempts</b></span>
                        <a href="#cleanupOldAttempts"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>cleanupOldAttempts()</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="445"
                                    class="link-to-prism">src/app/core/services/phone-verification.service.ts:445</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">
                        <div class="io-description"><p>Remove attempts older than 1 hour</p>
</div>

                        <div class="io-description">
                            <b>Returns : </b>        <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >void</a></code>

                        </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="clearError"></a>
                    <span class="name">
                        <span ><b>clearError</b></span>
                        <a href="#clearError"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
<code>clearError()</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="506"
                                    class="link-to-prism">src/app/core/services/phone-verification.service.ts:506</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">
                        <div class="io-description"><p>Clear error state</p>
</div>

                        <div class="io-description">
                            <b>Returns : </b>        <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >void</a></code>

                        </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="extendStatus"></a>
                    <span class="name">
                            <span class="modifier">Protected</span>
                            <span class="modifier"></span>
                        <span ><b>extendStatus</b></span>
                        <a href="#extendStatus"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>extendStatus(baseStatus: <a href="../interfaces/VerificationStatus.html" target="_self">VerificationStatus</a>)</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Inherited from         <code><a href="../classes/VerificationBaseService.html" target="_self" >VerificationBaseService</a></code>
</div>
                        </td>
                    </tr>
                    <tr>
                        <td class="col-md-4">
                                <div class="io-line">Defined in         <code><a href="../classes/VerificationBaseService.html#source" target="_self" >VerificationBaseService:66</a></code>
</div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">
                        <div class="io-description"><p>Override extendStatus to add phone-specific fields</p>
</div>

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>baseStatus</td>
                                            <td>
                                                            <code><a href="../interfaces/VerificationStatus.html" target="_self" >VerificationStatus</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>        <code><a href="../interfaces/PhoneVerificationStatus.html" target="_self" >PhoneVerificationStatus</a></code>

                        </div>
                            <div class="io-description">
                                
                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="formatPhoneNumber"></a>
                    <span class="name">
                            <span class="modifier">Private</span>
                        <span ><b>formatPhoneNumber</b></span>
                        <a href="#formatPhoneNumber"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>formatPhoneNumber(phone: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>, countryCode: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>)</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="340"
                                    class="link-to-prism">src/app/core/services/phone-verification.service.ts:340</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">
                        <div class="io-description"><p>Format phone number to E.164 format</p>
</div>

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>phone</td>
                                            <td>
                                                            <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                        </tr>
                                        <tr>
                                                <td>countryCode</td>
                                            <td>
                                                            <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>

                        </div>
                            <div class="io-description">
                                
                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="getPhoneFormatHint"></a>
                    <span class="name">
                            <span class="modifier">Private</span>
                        <span ><b>getPhoneFormatHint</b></span>
                        <a href="#getPhoneFormatHint"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>getPhoneFormatHint(countryCode: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>)</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="375"
                                    class="link-to-prism">src/app/core/services/phone-verification.service.ts:375</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">
                        <div class="io-description"><p>Get phone format hint for a country code</p>
</div>

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>countryCode</td>
                                            <td>
                                                            <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>

                        </div>
                            <div class="io-description">
                                
                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="getRemainingAttempts"></a>
                    <span class="name">
                        <span ><b>getRemainingAttempts</b></span>
                        <a href="#getRemainingAttempts"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
<code>getRemainingAttempts()</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="498"
                                    class="link-to-prism">src/app/core/services/phone-verification.service.ts:498</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">
                        <div class="io-description"><p>Get number of remaining OTP attempts</p>
</div>

                        <div class="io-description">
                            <b>Returns : </b>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>

                        </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="isValidPhoneNumber"></a>
                    <span class="name">
                            <span class="modifier">Private</span>
                        <span ><b>isValidPhoneNumber</b></span>
                        <a href="#isValidPhoneNumber"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>isValidPhoneNumber(phone: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>, countryCode?: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>)</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="390"
                                    class="link-to-prism">src/app/core/services/phone-verification.service.ts:390</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">
                        <div class="io-description"><p>Validate phone number format (E.164)
Supports multiple countries with different digit lengths</p>
</div>

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>phone</td>
                                            <td>
                                                            <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                        </tr>
                                        <tr>
                                                <td>countryCode</td>
                                            <td>
                                                            <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                            </td>

                                            <td>
                                                    Yes
                                            </td>


                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/boolean" target="_blank" >boolean</a></code>

                        </div>
                            <div class="io-description">
                                
                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="resetOTPSentState"></a>
                    <span class="name">
                        <span ><b>resetOTPSentState</b></span>
                        <a href="#resetOTPSentState"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
<code>resetOTPSentState()</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="513"
                                    class="link-to-prism">src/app/core/services/phone-verification.service.ts:513</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">
                        <div class="io-description"><p>Reset OTP sent state (for UI)</p>
</div>

                        <div class="io-description">
                            <b>Returns : </b>        <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >void</a></code>

                        </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="sendOTP"></a>
                    <span class="name">
                            <span class="modifier">Async</span>
                        <span class="deprecated-name"><b>sendOTP</b></span>
                        <a href="#sendOTP"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4 deprecated">
                    Use sendVerification instead
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>sendOTP(phone: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>, countryCode: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>)</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="271"
                                    class="link-to-prism">src/app/core/services/phone-verification.service.ts:271</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">
                        <div class="io-description"><p>Send OTP code to phone number (convenience method, delegates to sendVerification)</p>
</div>

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                                <td>Default value</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>phone</td>
                                            <td>
                                                            <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>

                                            <td>
                                            </td>

                                        </tr>
                                        <tr>
                                                <td>countryCode</td>
                                            <td>
                                                            <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>

                                            <td>
                                                    <code>&#x27;+54&#x27;</code>
                                            </td>

                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>    <code>Promise&lt;boolean&gt;</code>

                        </div>
                            <div class="io-description">
                                
                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="sendVerification"></a>
                    <span class="name">
                            <span class="modifier">Async</span>
                        <span ><b>sendVerification</b></span>
                        <a href="#sendVerification"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>sendVerification(phone: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>, countryCode: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>)</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Inherited from         <code><a href="../classes/VerificationBaseService.html" target="_self" >VerificationBaseService</a></code>
</div>
                        </td>
                    </tr>
                    <tr>
                        <td class="col-md-4">
                                <div class="io-line">Defined in         <code><a href="../classes/VerificationBaseService.html#source" target="_self" >VerificationBaseService:131</a></code>
</div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">
                        <div class="io-description"><p>Send OTP code to phone number (implements abstract sendVerification)</p>
</div>

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                                <td>Default value</td>
                                                <td>Description</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>phone</td>
                                            <td>
                                                            <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>

                                            <td>
                                            </td>

                                            <td>
                                                    <p>Phone number in E.164 format (e.g., +5491123456789)</p>

                                            </td>
                                        </tr>
                                        <tr>
                                                <td>countryCode</td>
                                            <td>
                                                            <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>

                                            <td>
                                                    <code>&#x27;+54&#x27;</code>
                                            </td>

                                            <td>
                                                    <p>Country code (default: +54 for Argentina)</p>

                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>    <code>Promise&lt;void&gt;</code>

                        </div>
                            <div class="io-description">
                                
                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="startCooldownTimer"></a>
                    <span class="name">
                            <span class="modifier"></span>
                        <span ><b>startCooldownTimer</b></span>
                        <a href="#startCooldownTimer"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>startCooldownTimer(callback: (seconds: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank">number</a>) => void)</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Inherited from         <code><a href="../classes/VerificationBaseService.html" target="_self" >VerificationBaseService</a></code>
</div>
                        </td>
                    </tr>
                    <tr>
                        <td class="col-md-4">
                                <div class="io-line">Defined in         <code><a href="../classes/VerificationBaseService.html#source" target="_self" >VerificationBaseService:453</a></code>
</div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">
                        <div class="io-description"><p>Override startCooldownTimer to include phone-specific rate limiting</p>
</div>

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>callback</td>
                                            <td>
                                                            <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/function" target="_blank" >function</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>        <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >void</a></code>

                        </div>
                            <div class="io-description">
                                
                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="subscribeToPhoneChanges"></a>
                    <span class="name">
                        <span class="deprecated-name"><b>subscribeToPhoneChanges</b></span>
                        <a href="#subscribeToPhoneChanges"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4 deprecated">
                    Use subscribeToChanges instead
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
<code>subscribeToPhoneChanges(callback: (verified: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/boolean" target="_blank">boolean</a>) => void)</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="483"
                                    class="link-to-prism">src/app/core/services/phone-verification.service.ts:483</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">
                        <div class="io-description"><p>Subscribe to phone verification changes (convenience method, delegates to base)</p>
</div>

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>callback</td>
                                            <td>
                                                            <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/function" target="_blank" >function</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>        <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >void</a></code>

                        </div>
                            <div class="io-description">
                                
                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="updateStatusFromUser"></a>
                    <span class="name">
                            <span class="modifier">Protected</span>
                            <span class="modifier"></span>
                        <span ><b>updateStatusFromUser</b></span>
                        <a href="#updateStatusFromUser"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>updateStatusFromUser(user: Record<string | unknown>)</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Inherited from         <code><a href="../classes/VerificationBaseService.html" target="_self" >VerificationBaseService</a></code>
</div>
                        </td>
                    </tr>
                    <tr>
                        <td class="col-md-4">
                                <div class="io-line">Defined in         <code><a href="../classes/VerificationBaseService.html#source" target="_self" >VerificationBaseService:112</a></code>
</div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">
                        <div class="io-description"><p>Override updateStatusFromUser to include phone-specific logic</p>
</div>

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>user</td>
                                            <td>
                                                        <code>Record&lt;string | unknown&gt;</code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>        <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >void</a></code>

                        </div>
                            <div class="io-description">
                                
                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="verifyOTP"></a>
                    <span class="name">
                            <span class="modifier">Async</span>
                        <span ><b>verifyOTP</b></span>
                        <a href="#verifyOTP"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>verifyOTP(phone: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>, token: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>)</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="281"
                                    class="link-to-prism">src/app/core/services/phone-verification.service.ts:281</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">
                        <div class="io-description"><p>Verify OTP code</p>
</div>

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                                <td>Description</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>phone</td>
                                            <td>
                                                            <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                            <td>
                                                    <p>Phone number</p>

                                            </td>
                                        </tr>
                                        <tr>
                                                <td>token</td>
                                            <td>
                                                            <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                            <td>
                                                    <p>6-digit OTP code</p>

                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>        <code><a href="../interfaces/OTPVerificationResult.html" target="_self" >Promise&lt;OTPVerificationResult&gt;</a></code>

                        </div>
                            <div class="io-description">
                                
                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="calculateCooldownRemaining"></a>
                    <span class="name">
                            <span class="modifier">Protected</span>
                        <span ><b>calculateCooldownRemaining</b></span>
                        <a href="#calculateCooldownRemaining"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>calculateCooldownRemaining()</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Inherited from         <code><a href="../classes/VerificationBaseService.html" target="_self" >VerificationBaseService</a></code>
</div>
                        </td>
                    </tr>
                    <tr>
                        <td class="col-md-4">
                                <div class="io-line">Defined in         <code><a href="../classes/VerificationBaseService.html#source" target="_self" >VerificationBaseService:103</a></code>
</div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">
                        <div class="io-description"><p>Calculate remaining cooldown time in seconds
100% identical in both services</p>
</div>

                        <div class="io-description">
                            <b>Returns : </b>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>

                        </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="checkCooldown"></a>
                    <span class="name">
                            <span class="modifier">Protected</span>
                        <span ><b>checkCooldown</b></span>
                        <a href="#checkCooldown"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>checkCooldown(errorMessage?: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>)</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Inherited from         <code><a href="../classes/VerificationBaseService.html" target="_self" >VerificationBaseService</a></code>
</div>
                        </td>
                    </tr>
                    <tr>
                        <td class="col-md-4">
                                <div class="io-line">Defined in         <code><a href="../classes/VerificationBaseService.html#source" target="_self" >VerificationBaseService:229</a></code>
</div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">
                        <div class="io-description"><p>Check cooldown and throw error if not passed</p>
</div>

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>errorMessage</td>
                                            <td>
                                                            <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                            </td>

                                            <td>
                                                    Yes
                                            </td>


                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>        <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >void</a></code>

                        </div>
                            <div class="io-description">
                                
                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="hasPassedCooldown"></a>
                    <span class="name">
                            <span class="modifier">Protected</span>
                        <span ><b>hasPassedCooldown</b></span>
                        <a href="#hasPassedCooldown"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>hasPassedCooldown()</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Inherited from         <code><a href="../classes/VerificationBaseService.html" target="_self" >VerificationBaseService</a></code>
</div>
                        </td>
                    </tr>
                    <tr>
                        <td class="col-md-4">
                                <div class="io-line">Defined in         <code><a href="../classes/VerificationBaseService.html#source" target="_self" >VerificationBaseService:208</a></code>
</div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">
                        <div class="io-description"><p>Check if cooldown has passed</p>
</div>

                        <div class="io-description">
                            <b>Returns : </b>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/boolean" target="_blank" >boolean</a></code>

                        </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="initializeAuthListener"></a>
                    <span class="name">
                            <span class="modifier">Protected</span>
                        <span ><b>initializeAuthListener</b></span>
                        <a href="#initializeAuthListener"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>initializeAuthListener()</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Inherited from         <code><a href="../classes/VerificationBaseService.html" target="_self" >VerificationBaseService</a></code>
</div>
                        </td>
                    </tr>
                    <tr>
                        <td class="col-md-4">
                                <div class="io-line">Defined in         <code><a href="../classes/VerificationBaseService.html#source" target="_self" >VerificationBaseService:117</a></code>
</div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">
                        <div class="io-description"><p>Initialize auth listener for automatic status updates
99% identical in both services</p>
</div>

                        <div class="io-description">
                            <b>Returns : </b>        <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >void</a></code>

                        </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="recordSendTime"></a>
                    <span class="name">
                            <span class="modifier">Protected</span>
                        <span ><b>recordSendTime</b></span>
                        <a href="#recordSendTime"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>recordSendTime()</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Inherited from         <code><a href="../classes/VerificationBaseService.html" target="_self" >VerificationBaseService</a></code>
</div>
                        </td>
                    </tr>
                    <tr>
                        <td class="col-md-4">
                                <div class="io-line">Defined in         <code><a href="../classes/VerificationBaseService.html#source" target="_self" >VerificationBaseService:215</a></code>
</div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">
                        <div class="io-description"><p>Set last send time and update status</p>
</div>

                        <div class="io-description">
                            <b>Returns : </b>        <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >void</a></code>

                        </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="subscribeToChanges"></a>
                    <span class="name">
                        <span ><b>subscribeToChanges</b></span>
                        <a href="#subscribeToChanges"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
<code>subscribeToChanges(callback: (verified: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/boolean" target="_blank">boolean</a>) => void)</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Inherited from         <code><a href="../classes/VerificationBaseService.html" target="_self" >VerificationBaseService</a></code>
</div>
                        </td>
                    </tr>
                    <tr>
                        <td class="col-md-4">
                                <div class="io-line">Defined in         <code><a href="../classes/VerificationBaseService.html#source" target="_self" >VerificationBaseService:187</a></code>
</div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">
                        <div class="io-description"><p>Subscribe to verification changes (real-time)
99% identical in both services</p>
</div>

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>callback</td>
                                            <td>
                                                            <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/function" target="_blank" >function</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>        <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >void</a></code>

                        </div>
                            <div class="io-description">
                                
                            </div>
                </td>
            </tr>
        </tbody>
    </table>
</section>
            <section data-compodoc="block-properties">
    
    <h3 id="inputs">
        Properties
    </h3>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="cooldownMs"></a>
                    <span class="name">
                            <span class="modifier">Protected</span>
                            <span class="modifier">Readonly</span>
                        <span ><b>cooldownMs</b></span>
                        <a href="#cooldownMs"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
                <tr>
                    <td class="col-md-4">
                        <i>Type : </i>    <code>unknown</code>

                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                        <i>Default value : </i><code>60 * 1000</code>
                    </td>
                </tr>
                        <tr>
                            <td class="col-md-4">
                                <div class="io-line">Inherited from         <code><a href="../classes/VerificationBaseService.html" target="_self" >VerificationBaseService</a></code>
</div>
                            </td>
                        </tr>
                    <tr>
                        <td class="col-md-4">
                                <div class="io-line">Defined in         <code><a href="../classes/VerificationBaseService.html#source" target="_self" >VerificationBaseService:49</a></code>
</div>
                        </td>
                    </tr>


        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="logger"></a>
                    <span class="name">
                            <span class="modifier">Private</span>
                        <span ><b>logger</b></span>
                        <a href="#logger"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
                <tr>
                    <td class="col-md-4">
                        <i>Type : </i>    <code>unknown</code>

                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                        <i>Default value : </i><code>inject(LoggerService).createChildLogger(&#x27;PhoneVerificationService&#x27;)</code>
                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                                <div class="io-line">Defined in <a href="" data-line="54" class="link-to-prism">src/app/core/services/phone-verification.service.ts:54</a></div>
                        </td>
                    </tr>


        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="MAX_ATTEMPTS_PER_HOUR"></a>
                    <span class="name">
                            <span class="modifier">Private</span>
                            <span class="modifier">Readonly</span>
                        <span ><b>MAX_ATTEMPTS_PER_HOUR</b></span>
                        <a href="#MAX_ATTEMPTS_PER_HOUR"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
                <tr>
                    <td class="col-md-4">
                        <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>

                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                        <i>Default value : </i><code>3</code>
                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                                <div class="io-line">Defined in <a href="" data-line="52" class="link-to-prism">src/app/core/services/phone-verification.service.ts:52</a></div>
                        </td>
                    </tr>


        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="otpAttempts"></a>
                    <span class="name">
                            <span class="modifier">Private</span>
                        <span ><b>otpAttempts</b></span>
                        <a href="#otpAttempts"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
                <tr>
                    <td class="col-md-4">
                        <i>Type : </i>    <code>number[]</code>

                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                        <i>Default value : </i><code>[]</code>
                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                                <div class="io-line">Defined in <a href="" data-line="53" class="link-to-prism">src/app/core/services/phone-verification.service.ts:53</a></div>
                        </td>
                    </tr>


        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="verificationType"></a>
                    <span class="name">
                            <span class="modifier">Protected</span>
                            <span class="modifier">Readonly</span>
                        <span ><b>verificationType</b></span>
                        <a href="#verificationType"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
                <tr>
                    <td class="col-md-4">
                        <i>Type : </i>    <code>unknown</code>

                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                        <i>Default value : </i><code>&#x27;phone&#x27; as const</code>
                    </td>
                </tr>
                        <tr>
                            <td class="col-md-4">
                                <div class="io-line">Inherited from         <code><a href="../classes/VerificationBaseService.html" target="_self" >VerificationBaseService</a></code>
</div>
                            </td>
                        </tr>
                    <tr>
                        <td class="col-md-4">
                                <div class="io-line">Defined in         <code><a href="../classes/VerificationBaseService.html#source" target="_self" >VerificationBaseService:48</a></code>
</div>
                        </td>
                    </tr>


        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="error"></a>
                    <span class="name">
                            <span class="modifier">Readonly</span>
                        <span ><b>error</b></span>
                        <a href="#error"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
                <tr>
                    <td class="col-md-4">
                        <i>Type : </i>    <code>unknown</code>

                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                        <i>Default value : </i><code>signal&lt;string | null&gt;(null)</code>
                    </td>
                </tr>
                        <tr>
                            <td class="col-md-4">
                                <div class="io-line">Inherited from         <code><a href="../classes/VerificationBaseService.html" target="_self" >VerificationBaseService</a></code>
</div>
                            </td>
                        </tr>
                    <tr>
                        <td class="col-md-4">
                                <div class="io-line">Defined in         <code><a href="../classes/VerificationBaseService.html#source" target="_self" >VerificationBaseService:92</a></code>
</div>
                        </td>
                    </tr>


        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="lastSendTime"></a>
                    <span class="name">
                            <span class="modifier">Protected</span>
                        <span ><b>lastSendTime</b></span>
                        <a href="#lastSendTime"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
                <tr>
                    <td class="col-md-4">
                        <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>

                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                        <i>Default value : </i><code>0</code>
                    </td>
                </tr>
                        <tr>
                            <td class="col-md-4">
                                <div class="io-line">Inherited from         <code><a href="../classes/VerificationBaseService.html" target="_self" >VerificationBaseService</a></code>
</div>
                            </td>
                        </tr>
                    <tr>
                        <td class="col-md-4">
                                <div class="io-line">Defined in         <code><a href="../classes/VerificationBaseService.html#source" target="_self" >VerificationBaseService:55</a></code>
</div>
                        </td>
                    </tr>


        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="loading"></a>
                    <span class="name">
                            <span class="modifier">Readonly</span>
                        <span ><b>loading</b></span>
                        <a href="#loading"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
                <tr>
                    <td class="col-md-4">
                        <i>Type : </i>    <code>unknown</code>

                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                        <i>Default value : </i><code>signal(false)</code>
                    </td>
                </tr>
                        <tr>
                            <td class="col-md-4">
                                <div class="io-line">Inherited from         <code><a href="../classes/VerificationBaseService.html" target="_self" >VerificationBaseService</a></code>
</div>
                            </td>
                        </tr>
                    <tr>
                        <td class="col-md-4">
                                <div class="io-line">Defined in         <code><a href="../classes/VerificationBaseService.html#source" target="_self" >VerificationBaseService:91</a></code>
</div>
                        </td>
                    </tr>


        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="status"></a>
                    <span class="name">
                            <span class="modifier">Readonly</span>
                        <span ><b>status</b></span>
                        <a href="#status"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
                <tr>
                    <td class="col-md-4">
                        <i>Type : </i>    <code>Signal&lt;TStatus&gt;</code>

                    </td>
                </tr>
                        <tr>
                            <td class="col-md-4">
                                <div class="io-line">Inherited from         <code><a href="../classes/VerificationBaseService.html" target="_self" >VerificationBaseService</a></code>
</div>
                            </td>
                        </tr>
                    <tr>
                        <td class="col-md-4">
                                <div class="io-line">Defined in         <code><a href="../classes/VerificationBaseService.html#source" target="_self" >VerificationBaseService:88</a></code>
</div>
                        </td>
                    </tr>


        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="statusSignal"></a>
                    <span class="name">
                            <span class="modifier">Protected</span>
                            <span class="modifier">Readonly</span>
                        <span ><b>statusSignal</b></span>
                        <a href="#statusSignal"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
                <tr>
                    <td class="col-md-4">
                        <i>Type : </i>    <code>unknown</code>

                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                        <i>Default value : </i><code>signal&lt;TStatus&gt;({} as TStatus)</code>
                    </td>
                </tr>
                        <tr>
                            <td class="col-md-4">
                                <div class="io-line">Inherited from         <code><a href="../classes/VerificationBaseService.html" target="_self" >VerificationBaseService</a></code>
</div>
                            </td>
                        </tr>
                    <tr>
                        <td class="col-md-4">
                                <div class="io-line">Defined in         <code><a href="../classes/VerificationBaseService.html#source" target="_self" >VerificationBaseService:89</a></code>
</div>
                        </td>
                    </tr>


        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="supabase"></a>
                    <span class="name">
                            <span class="modifier">Protected</span>
                            <span class="modifier">Readonly</span>
                        <span ><b>supabase</b></span>
                        <a href="#supabase"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
                <tr>
                    <td class="col-md-4">
                        <i>Type : </i>    <code>SupabaseClient</code>

                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                        <i>Default value : </i><code>inject(SupabaseClientService).getClient()</code>
                    </td>
                </tr>
                        <tr>
                            <td class="col-md-4">
                                <div class="io-line">Inherited from         <code><a href="../classes/VerificationBaseService.html" target="_self" >VerificationBaseService</a></code>
</div>
                            </td>
                        </tr>
                    <tr>
                        <td class="col-md-4">
                                <div class="io-line">Defined in         <code><a href="../classes/VerificationBaseService.html#source" target="_self" >VerificationBaseService:54</a></code>
</div>
                        </td>
                    </tr>


        </tbody>
    </table>
</section>

    </div>


    <div class="tab-pane fade  tab-source-code" id="source">
        <pre class="line-numbers compodoc-sourcecode"><code class="language-typescript">import { Injectable, inject } from &#x27;@angular/core&#x27;;
import type { AuthError } from &#x27;@supabase/supabase-js&#x27;;
import { VerificationBaseService, VerificationStatus } from &#x27;./verification-base.service&#x27;;
import { LoggerService } from &#x27;./logger.service&#x27;;

/**
 * Phone Verification Status (extends base with OTP-specific fields)
 */
export interface PhoneVerificationStatus extends VerificationStatus {
  otpSent: boolean;
}

/**
 * OTP Verification Result
 */
export interface OTPVerificationResult {
  success: boolean;
  verified: boolean;
  error?: string;
  message?: string;
}

type AuthErrorWithCode &#x3D; AuthError &amp; {
  code?: string;
  error_code?: string;
};

/**
 * Service for managing phone number verification via SMS OTP
 *
 * Extends VerificationBaseService with phone-specific functionality:
 * - Sending OTP codes via SMS
 * - Verifying OTP codes
 * - Phone-specific rate limiting (3 attempts per hour)
 * - Argentina phone number validation (+54)
 *
 * Base class provides:
 * - Cooldown management (calculateCooldownRemaining, startCooldownTimer)
 * - Auth listener initialization
 * - Status updates from user object
 * - Reactive state (signals)
 */
@Injectable({
  providedIn: &#x27;root&#x27;,
})
export class PhoneVerificationService extends VerificationBaseService&lt;PhoneVerificationStatus&gt; {
  // VerificationBaseService abstract properties
  protected readonly verificationType &#x3D; &#x27;phone&#x27; as const;
  protected readonly cooldownMs &#x3D; 60 * 1000; // 60 seconds

  // Phone-specific rate limiting
  private readonly MAX_ATTEMPTS_PER_HOUR &#x3D; 3;
  private otpAttempts: number[] &#x3D; []; // Timestamps of OTP attempts
  private logger &#x3D; inject(LoggerService).createChildLogger(&#x27;PhoneVerificationService&#x27;);

  constructor() {
    super();
    this.checkStatus().catch((err) &#x3D;&gt; {
      this.logger.error(&#x27;Failed to check initial phone status&#x27;, { error: err });
    });
  }

  /**
   * Override extendStatus to add phone-specific fields
   */
  protected override extendStatus(baseStatus: VerificationStatus): PhoneVerificationStatus {
    return {
      ...baseStatus,
      otpSent: this.statusSignal().otpSent ?? false,
    };
  }

  /**
   * Check current phone verification status (implements abstract method)
   */
  async checkStatus(): Promise&lt;PhoneVerificationStatus&gt; {
    this.loading.set(true);
    this.error.set(null);

    try {
      // IMPORTANT: Refresh session first to get fresh user data from server
      // This prevents stale cache issues where phone_confirmed_at might be outdated
      await this.supabase.auth.refreshSession();

      const {
        data: { user },
      } &#x3D; await this.supabase.auth.getUser();

      if (!user) {
        throw new Error(&#x27;Usuario no autenticado&#x27;);
      }

      this.logger.info(&#x27;Fresh user data from server&#x27;, {
        isVerified: user.phone_confirmed_at !&#x3D;&#x3D; null,
      });

      this.updateStatusFromUser(user as unknown as Record&lt;string, unknown&gt;);
      return this.status();
    } catch (err) {
      const message &#x3D;
        err instanceof Error ? err.message : &#x27;No pudimos verificar el estado del telfono&#x27;;
      this.error.set(message);
      throw err;
    } finally {
      this.loading.set(false);
    }
  }

  /**
   * Override updateStatusFromUser to include phone-specific logic
   */
  protected override updateStatusFromUser(user: Record&lt;string, unknown&gt;): void {
    super.updateStatusFromUser(user); // Call base implementation

    // Add phone-specific canResend logic (includes rate limiting)
    const currentStatus &#x3D; this.statusSignal();
    const canResendWithRateLimit &#x3D; currentStatus.canResend &amp;&amp; this.canSendOTP();

    this.statusSignal.set({
      ...currentStatus,
      canResend: canResendWithRateLimit,
      otpSent: currentStatus.otpSent &amp;&amp; !currentStatus.isVerified,
    } as PhoneVerificationStatus);
  }

  /**
   * Send OTP code to phone number (implements abstract sendVerification)
   * @param phone Phone number in E.164 format (e.g., +5491123456789)
   * @param countryCode Country code (default: +54 for Argentina)
   */
  async sendVerification(phone: string, countryCode: string &#x3D; &#x27;+54&#x27;): Promise&lt;void&gt; {
    this.loading.set(true);
    this.error.set(null);

    try {
      // Early validation: check if phone is empty or too short
      const cleanedPhone &#x3D; phone?.trim() || &#x27;&#x27;;
      if (!cleanedPhone || cleanedPhone.length &lt; 7) {
        const formatHint &#x3D; this.getPhoneFormatHint(countryCode);
        throw new Error(
          &#x60;Por favor ingresa un nmero de telfono vlido. Formato esperado: ${formatHint}&#x60;,
        );
      }

      // Check cooldown (using base class method)
      this.checkCooldown();

      // Check phone-specific rate limiting
      if (!this.canSendOTP()) {
        throw new Error(
          &#x27;Has alcanzado el lmite de intentos por hora. Por favor intenta ms tarde.&#x27;,
        );
      }

      // Format phone number (E.164 format)
      const formattedPhone &#x3D; this.formatPhoneNumber(cleanedPhone, countryCode);

      this.logger.info(&#x27;Phone formatting processed&#x27;, {
        countryCode,
      });

      // Check if formatted phone is empty or invalid
      if (!formattedPhone || formattedPhone.length &lt; 8) {
        const formatHint &#x3D; this.getPhoneFormatHint(countryCode);
        throw new Error(&#x60;Nmero de telfono invlido. Formato esperado: ${formatHint}&#x60;);
      }

      // Validate phone number format
      if (!this.isValidPhoneNumber(formattedPhone, countryCode)) {
        const formatHint &#x3D; this.getPhoneFormatHint(countryCode);
        this.logger.warn(&#x27;Invalid phone format provided&#x27;, {
          countryCode,
          formatHint,
        });
        throw new Error(&#x60;Nmero de telfono invlido. Formato esperado: ${formatHint}&#x60;);
      }

      // Send OTP via Supabase Auth
      const { error } &#x3D; await this.supabase.auth.signInWithOtp({
        phone: formattedPhone,
        options: {
          channel: &#x27;sms&#x27;,
        },
      });

      if (error) {
        const extendedError &#x3D; error as AuthErrorWithCode;
        const errorCode &#x3D; extendedError.code || extendedError.error_code || &#x27;&#x27;;
        const errorMessage &#x3D; extendedError.message || &#x27;&#x27;;

        // Provide more user-friendly error messages
        // Check for phone provider errors (multiple ways Supabase can return this)
        if (
          errorCode &#x3D;&#x3D;&#x3D; &#x27;phone_provider_disabled&#x27; ||
          errorCode &#x3D;&#x3D;&#x3D; &#x27;provider_disabled&#x27; ||
          errorMessage?.includes(&#x27;phone_provider_disabled&#x27;) ||
          errorMessage?.includes(&#x27;Unsupported phone provider&#x27;) ||
          errorMessage?.includes(&#x27;phone provider&#x27;) ||
          errorMessage?.includes(&#x27;SMS provider&#x27;)
        ) {
          throw new Error(
            &#x27;El servicio de SMS no est configurado para este pas. Por favor contacta al soporte o intenta con otro nmero.&#x27;,
          );
        }

        // Handle other Supabase errors
        if (errorCode &#x3D;&#x3D;&#x3D; &#x27;phone_exists&#x27; || errorMessage?.includes(&#x27;phone_exists&#x27;)) {
          throw new Error(&#x27;Este nmero de telfono ya est registrado.&#x27;);
        }

        if (
          errorCode &#x3D;&#x3D;&#x3D; &#x27;over_sms_send_rate_limit&#x27; ||
          errorMessage?.includes(&#x27;over_sms_send_rate_limit&#x27;) ||
          errorMessage?.includes(&#x27;rate limit&#x27;)
        ) {
          throw new Error(&#x27;Has excedido el lmite de envos. Por favor intenta ms tarde.&#x27;);
        }

        // Handle invalid phone format errors from Supabase
        if (
          errorCode &#x3D;&#x3D;&#x3D; &#x27;validation_failed&#x27; ||
          errorMessage?.includes(&#x27;invalid phone&#x27;) ||
          errorMessage?.includes(&#x27;phone number&#x27;)
        ) {
          const formatHint &#x3D; this.getPhoneFormatHint(countryCode);
          throw new Error(
            &#x60;Nmero de telfono invlido segn el proveedor. Formato esperado: ${formatHint}&#x60;,
          );
        }

        // Log the full error for debugging
        this.logger.error(&#x27;Supabase authentication error&#x27;, {
          code: errorCode,
        });

        // Re-throw original error if we don&#x27;t have a specific message
        throw error;
      }

      // Update tracking (using base class method + phone-specific)
      this.recordSendTime();
      this.otpAttempts.push(Date.now());
      this.cleanupOldAttempts();

      // Call RPC function for logging
      await this.supabase.rpc(&#x27;send_phone_otp&#x27;, {
        p_phone: formattedPhone,
        p_country_code: countryCode,
      });

      // Update phone-specific status
      const currentStatus &#x3D; this.statusSignal();
      this.statusSignal.set({
        ...currentStatus,
        otpSent: true,
        value: formattedPhone,
      } as PhoneVerificationStatus);
    } catch (err) {
      const message &#x3D; err instanceof Error ? err.message : &#x27;No pudimos enviar el cdigo SMS&#x27;;
      this.error.set(message);
      throw err;
    } finally {
      this.loading.set(false);
    }
  }

  /**
   * Send OTP code to phone number (convenience method, delegates to sendVerification)
   * @deprecated Use sendVerification instead
   */
  async sendOTP(phone: string, countryCode: string &#x3D; &#x27;+54&#x27;): Promise&lt;boolean&gt; {
    await this.sendVerification(phone, countryCode);
    return true;
  }

  /**
   * Verify OTP code
   * @param phone Phone number
   * @param token 6-digit OTP code
   */
  async verifyOTP(phone: string, token: string): Promise&lt;OTPVerificationResult&gt; {
    this.loading.set(true);
    this.error.set(null);

    try {
      // Validate token format
      if (!/^\d{6}$/.test(token)) {
        throw new Error(&#x27;El cdigo debe tener 6 dgitos&#x27;);
      }

      // Verify OTP via Supabase Auth
      const {
        data: { user },
        error,
      } &#x3D; await this.supabase.auth.verifyOtp({
        phone,
        token,
        type: &#x27;sms&#x27;,
      });

      if (error) {
        throw error;
      }

      if (!user) {
        throw new Error(&#x27;Verificacin fallida. Por favor intenta nuevamente.&#x27;);
      }

      // Call RPC function for post-verification
      await this.supabase.rpc(&#x27;verify_phone_otp&#x27;, {
        p_phone: phone,
        p_token: token,
      });

      // Update status
      await this.checkStatus();

      return {
        success: true,
        verified: true,
        message: &#x27;Telfono verificado exitosamente&#x27;,
      };
    } catch (err) {
      const message &#x3D; err instanceof Error ? err.message : &#x27;Cdigo invlido o expirado&#x27;;
      this.error.set(message);

      return {
        success: false,
        verified: false,
        error: message,
      };
    } finally {
      this.loading.set(false);
    }
  }

  /**
   * Format phone number to E.164 format
   */
  private formatPhoneNumber(phone: string, countryCode: string): string {
    if (!phone || typeof phone !&#x3D;&#x3D; &#x27;string&#x27;) {
      return &#x27;&#x27;;
    }

    // Remove all non-digit characters except +
    let cleaned &#x3D; phone.trim().replace(/[^\d+]/g, &#x27;&#x27;);

    // If already starts with +, validate and return
    if (cleaned.startsWith(&#x27;+&#x27;)) {
      // If it already has a country code, use it (might be different from selected)
      // But we&#x27;ll still validate it later
      return cleaned;
    }

    // If empty after cleaning, return empty
    if (!cleaned || cleaned.length &#x3D;&#x3D;&#x3D; 0) {
      return &#x27;&#x27;;
    }

    // Remove leading zeros
    cleaned &#x3D; cleaned.replace(/^0+/, &#x27;&#x27;);

    // If empty after removing zeros, return empty
    if (!cleaned || cleaned.length &#x3D;&#x3D;&#x3D; 0) {
      return &#x27;&#x27;;
    }

    // Add country code
    return &#x60;${countryCode}${cleaned}&#x60;;
  }

  /**
   * Get phone format hint for a country code
   */
  private getPhoneFormatHint(countryCode: string): string {
    const hints: Record&lt;string, string&gt; &#x3D; {
      &#x27;+54&#x27;: &#x27;+54 seguido de 10 dgitos (ej: +5491123456789)&#x27;,
      &#x27;+1&#x27;: &#x27;+1 seguido de 10 dgitos (ej: +15551234567)&#x27;,
      &#x27;+52&#x27;: &#x27;+52 seguido de 10 dgitos (ej: +525512345678)&#x27;,
      &#x27;+55&#x27;: &#x27;+55 seguido de 10-11 dgitos (ej: +5511987654321)&#x27;,
      &#x27;+56&#x27;: &#x27;+56 seguido de 9 dgitos (ej: +56912345678)&#x27;,
    };
    return hints[countryCode] || &#x27;formato E.164 internacional&#x27;;
  }

  /**
   * Validate phone number format (E.164)
   * Supports multiple countries with different digit lengths
   */
  private isValidPhoneNumber(phone: string, countryCode?: string): boolean {
    // E.164 format: +[country code][number]
    // Must start with + and have at least 7 digits after country code
    if (!phone.startsWith(&#x27;+&#x27;)) {
      return false;
    }

    // Remove the + and validate
    const withoutPlus &#x3D; phone.substring(1);

    // Must contain only digits after the +
    if (!/^\d+$/.test(withoutPlus)) {
      return false;
    }

    // Country-specific validation
    if (phone.startsWith(&#x27;+54&#x27;)) {
      // Argentina: +54 followed by 10 digits (total 12 digits after +)
      return /^\+54\d{10}$/.test(phone);
    } else if (phone.startsWith(&#x27;+1&#x27;)) {
      // USA/Canada: +1 followed by 10 digits (total 11 digits after +)
      return /^\+1\d{10}$/.test(phone);
    } else if (phone.startsWith(&#x27;+52&#x27;)) {
      // Mexico: +52 followed by 10 digits (total 12 digits after +)
      return /^\+52\d{10}$/.test(phone);
    } else if (phone.startsWith(&#x27;+55&#x27;)) {
      // Brazil: +55 followed by 10-11 digits (total 12-13 after +)
      return /^\+55\d{10,11}$/.test(phone);
    } else if (phone.startsWith(&#x27;+56&#x27;)) {
      // Chile: +56 followed by 9 digits (total 11 digits after +)
      return /^\+56\d{9}$/.test(phone);
    }

    // If country code is provided but doesn&#x27;t match, validate against it
    if (countryCode &amp;&amp; !phone.startsWith(countryCode)) {
      return false;
    }

    // Generic validation: at least 7 digits after country code, max 15 total
    // E.164 allows 1-15 digits total (including country code)
    const totalDigits &#x3D; withoutPlus.length;
    return totalDigits &gt;&#x3D; 8 &amp;&amp; totalDigits &lt;&#x3D; 15;
  }

  /**
   * Check if user can send OTP (rate limiting)
   */
  private canSendOTP(): boolean {
    this.cleanupOldAttempts();
    return this.otpAttempts.length &lt; this.MAX_ATTEMPTS_PER_HOUR;
  }

  /**
   * Remove attempts older than 1 hour
   */
  private cleanupOldAttempts(): void {
    const oneHourAgo &#x3D; Date.now() - 60 * 60 * 1000;
    this.otpAttempts &#x3D; this.otpAttempts.filter((timestamp) &#x3D;&gt; timestamp &gt; oneHourAgo);
  }

  /**
   * Override startCooldownTimer to include phone-specific rate limiting
   */
  override startCooldownTimer(callback: (seconds: number) &#x3D;&gt; void): () &#x3D;&gt; void {
    const interval &#x3D; setInterval(() &#x3D;&gt; {
      const remaining &#x3D; this.calculateCooldownRemaining();
      const currentStatus &#x3D; this.statusSignal();

      callback(remaining);

      if (remaining &#x3D;&#x3D;&#x3D; 0 &amp;&amp; !currentStatus.isVerified) {
        // Phone-specific: check rate limiting before allowing resend
        this.statusSignal.set({
          ...currentStatus,
          canResend: this.canSendOTP(),
          cooldownSeconds: 0,
        } as PhoneVerificationStatus);
        clearInterval(interval);
      } else {
        this.statusSignal.set({
          ...currentStatus,
          cooldownSeconds: remaining,
        } as PhoneVerificationStatus);
      }
    }, 1000);

    return () &#x3D;&gt; clearInterval(interval);
  }

  /**
   * Subscribe to phone verification changes (convenience method, delegates to base)
   * @deprecated Use subscribeToChanges instead
   */
  subscribeToPhoneChanges(callback: (verified: boolean) &#x3D;&gt; void): () &#x3D;&gt; void {
    return this.subscribeToChanges(callback);
  }

  /**
   * Convenience method for backward compatibility
   * @deprecated Use checkStatus instead
   */
  async checkPhoneStatus(): Promise&lt;PhoneVerificationStatus&gt; {
    return this.checkStatus();
  }

  /**
   * Get number of remaining OTP attempts
   */
  getRemainingAttempts(): number {
    this.cleanupOldAttempts();
    return Math.max(0, this.MAX_ATTEMPTS_PER_HOUR - this.otpAttempts.length);
  }

  /**
   * Clear error state
   */
  clearError(): void {
    this.error.set(null);
  }

  /**
   * Reset OTP sent state (for UI)
   */
  resetOTPSentState(): void {
    const currentStatus &#x3D; this.status();
    this.statusSignal.set({
      ...currentStatus,
      otpSent: false,
    } as PhoneVerificationStatus);
  }
}
</code></pre>
    </div>

</div>













                   </div><div class="search-results">
    <div class="has-results">
        <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
        <ul class="search-results-list"></ul>
    </div>
    <div class="no-results">
        <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
    </div>
</div>
</div>
               <!-- END CONTENT -->
           </div>
       </div>

          <label class="dark-mode-switch">
               <input type="checkbox">
               <span class="slider">
                    <svg class="slider-icon" viewBox="0 0 24 24" fill="none" height="20" stroke="#000" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" width="20" xmlns="http://www.w3.org/2000/svg">
                    <path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"></path>
                    </svg>
               </span>
          </label>

       <script>
            var COMPODOC_CURRENT_PAGE_DEPTH = 1;
            var COMPODOC_CURRENT_PAGE_CONTEXT = 'injectable';
            var COMPODOC_CURRENT_PAGE_URL = 'PhoneVerificationService.html';
            var MAX_SEARCH_RESULTS = 15;
       </script>

       <script>
               $darkModeToggleSwitchers = document.querySelectorAll('.dark-mode-switch input');
               checkToggle(darkModeState);
               if ($darkModeToggleSwitchers.length > 0) {
                    for (var i = 0; i < $darkModeToggleSwitchers.length; i++) {
                         $darkModeToggleSwitchers[i].addEventListener('change', function (event) {
                              darkModeState = !darkModeState;
                              toggleDarkMode(darkModeState);
                         });
                    }
               }
          </script>

       <script src="../js/libs/custom-elements.min.js"></script>
       <script src="../js/libs/lit-html.js"></script>

       <script src="../js/menu-wc.js" defer></script>
       <script nomodule src="../js/menu-wc_es5.js" defer></script>

       <script src="../js/libs/bootstrap-native.js"></script>

       <script src="../js/libs/es6-shim.min.js"></script>
       <script src="../js/libs/EventDispatcher.js"></script>
       <script src="../js/libs/promise.min.js"></script>

       <script src="../js/compodoc.js"></script>

       <script src="../js/tabs.js"></script>
       <script src="../js/menu.js"></script>
       <script src="../js/libs/clipboard.min.js"></script>
       <script src="../js/libs/prism.js"></script>
       <script src="../js/sourceCode.js"></script>
          <script src="../js/search/search.js"></script>
          <script src="../js/search/lunr.min.js"></script>
          <script src="../js/search/search-lunr.js"></script>
          <script src="../js/search/search_index.js"></script>
       <script src="../js/lazy-load-graphs.js"></script>


    </body>
</html>
