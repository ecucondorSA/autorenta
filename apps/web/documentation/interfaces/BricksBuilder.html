<!doctype html>
<html class="no-js" lang="">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <title>autorenta-web documentation</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <link rel="icon" type="image/x-icon" href="../images/favicon.ico">
	   <link rel="stylesheet" href="../styles/style.css">
        <link rel="stylesheet" href="../styles/dark.css">
    </head>
    <body>
          <script>
               // Blocking script to avoid flickering dark mode
               // Dark mode toggle button
               var useDark = window.matchMedia('(prefers-color-scheme: dark)');
               var darkModeState = useDark.matches;
               var $darkModeToggleSwitchers = document.querySelectorAll('.dark-mode-switch input');
               var $darkModeToggles = document.querySelectorAll('.dark-mode-switch');
               var darkModeStateLocal = localStorage.getItem('compodoc_darkmode-state');

               function checkToggle(check) {
                    for (var i = 0; i < $darkModeToggleSwitchers.length; i++) {
                         $darkModeToggleSwitchers[i].checked = check;
                    }
               }

               function toggleDarkMode(state) {
                    if (window.localStorage) {
                         localStorage.setItem('compodoc_darkmode-state', state);
                    }

                    checkToggle(state);

                    const hasClass = document.body.classList.contains('dark');

                    if (state) {
                         for (var i = 0; i < $darkModeToggles.length; i++) {
                              $darkModeToggles[i].classList.add('dark');
                         }
                         if (!hasClass) {
                              document.body.classList.add('dark');
                         }
                    } else {
                         for (var i = 0; i < $darkModeToggles.length; i++) {
                              $darkModeToggles[i].classList.remove('dark');
                         }
                         if (hasClass) {
                              document.body.classList.remove('dark');
                         }
                    }
               }

               useDark.addEventListener('change', function (evt) {
                    toggleDarkMode(evt.matches);
               });
               if (darkModeStateLocal) {
                    darkModeState = darkModeStateLocal === 'true';
               }
               toggleDarkMode(darkModeState);
          </script>
          <script>
              // --- Iframe navigation tracking for Template Playground ---
              function sendCurrentUrlToParent() {
                  if (window.parent && window.parent !== window) {
                      window.parent.postMessage({
                          type: 'compodoc-iframe-navigate',
                          url: window.location.pathname + window.location.hash
                      }, '*');
                  }
              }
              window.addEventListener('hashchange', sendCurrentUrlToParent, false);
              window.addEventListener('popstate', sendCurrentUrlToParent, false);
              window.addEventListener('DOMContentLoaded', sendCurrentUrlToParent, false);
          </script>

        <div class="navbar navbar-default navbar-fixed-top d-md-none p-0">
               <div class="d-flex">
                    <a href="../" class="navbar-brand">autorenta-web documentation</a>
                    <button type="button" class="btn btn-default btn-menu ion-ios-menu" id="btn-menu"></button>
               </div>
        </div>

        <div class="xs-menu menu" id="mobile-menu">
                <div id="book-search-input" role="search"><input type="text" placeholder="Type to search"></div>            <compodoc-menu></compodoc-menu>
        </div>

        <div class="container-fluid main">
           <div class="row main">
               <div class="d-none d-md-block menu">
                   <compodoc-menu mode="normal"></compodoc-menu>
               </div>
               <!-- START CONTENT -->
               <div class="content interface">
                   <div class="content-data">

















<ol class="breadcrumb">
  <li class="breadcrumb-item">Interfaces</li>
  <li class="breadcrumb-item"
  >
  BricksBuilder</li>
</ol>

<ul class="nav nav-tabs" role="tablist">
        <li class="nav-item">
            <a href="#info" 
                class="nav-link"
                class="nav-link active"
                role="tab" id="info-tab" data-bs-toggle="tab" data-link="info">Info</a>
        </li>
        <li class="nav-item">
            <a href="#source" 
                class="nav-link"
                
                role="tab" id="source-tab" data-bs-toggle="tab" data-link="source">Source</a>
        </li>
</ul>

<div class="tab-content">
    <div class="tab-pane fade active in" id="info">
        <p class="comment">
            <h3>File</h3>
        </p>
        <p class="comment">
            <code>src/app/shared/components/mercadopago-payment-brick/mercadopago-payment-brick.component.ts</code>
        </p>




        <section data-compodoc="block-index">
            <h3 id="index">Index</h3>
            <table class="table table-sm table-bordered index-table">
                <tbody>
                    <tr>
                        <td class="col-md-4">
                            <h6><b>Properties</b></h6>
                        </td>
                    </tr>
                    <tr>
                        <td class="col-md-4">
                            <ul class="index-list">
                                <li>
                                        <a href="#create" 
>
                                            create
                                        </a>
                                </li>
                            </ul>
                        </td>
                    </tr>
                </tbody>
            </table>
        </section>



            <section data-compodoc="block-properties">
                <h3 id="inputs">Properties</h3>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="create"></a>
                                        <span class="name "><b>create</b>
                                            <a href="#create">
                                                <span class="icon ion-ios-link"></span>
                                            </a>
                                        </span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>create:         <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/function" target="_blank" >function</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/function" target="_blank" >function</a></code>

                                        </td>
                                    </tr>





                        </tbody>
                    </table>
            </section>
    </div>


    <div class="tab-pane fade  tab-source-code" id="source">
        <pre class="line-numbers compodoc-sourcecode"><code class="language-typescript">import {
  Component,
  OnInit,
  OnDestroy,
  AfterViewInit,
  Output,
  EventEmitter,
  signal,
  inject,
  Input,
  NgZone,
  ElementRef,
  ViewChild,
} from &#x27;@angular/core&#x27;;
import { CommonModule } from &#x27;@angular/common&#x27;;
import { environment } from &#x27;@environment&#x27;;
import { MercadoPagoScriptService } from &#x27;../../../core/services/mercado-pago-script.service&#x27;;
import { injectSupabase } from &#x27;../../../core/services/supabase-client.service&#x27;;

/**
 * Payment Brick callback data from MercadoPago SDK
 */
interface PaymentBrickFormData {
  selectedPaymentMethod: string;
  formData: {
    token?: string;
    issuer_id?: string;
    payment_method_id: string;
    transaction_amount: number;
    installments?: number;
    payer: {
      email: string;
      identification?: {
        type: string;
        number: string;
      };
    };
  };
}

/**
 * Payment result returned from backend
 */
export interface PaymentResult {
  success: boolean;
  paymentId?: string;
  status?: &#x27;approved&#x27; | &#x27;pending&#x27; | &#x27;rejected&#x27; | &#x27;in_process&#x27;;
  message?: string;
  statusDetail?: string;
}

/**
 * MercadoPago Bricks SDK interface
 */
interface MercadoPagoBricksSDK {
  bricks: () &#x3D;&gt; BricksBuilder;
}

interface BricksBuilder {
  create: (
    brick: string,
    container: string,
    settings: PaymentBrickSettings,
  ) &#x3D;&gt; Promise&lt;BrickController&gt;;
}

interface BrickController {
  unmount: () &#x3D;&gt; void;
}

interface PaymentBrickSettings {
  initialization: {
    amount: number;
    preferenceId?: string;
    payer?: {
      email?: string;
    };
  };
  customization?: {
    visual?: {
      style?: {
        theme?: &#x27;default&#x27; | &#x27;dark&#x27; | &#x27;bootstrap&#x27; | &#x27;flat&#x27;;
        customVariables?: Record&lt;string, string&gt;;
      };
      hideFormTitle?: boolean;
      hidePaymentButton?: boolean;
    };
    paymentMethods?: {
      creditCard?: string | string[];
      debitCard?: string | string[];
      mercadoPago?: string[];
      ticket?: string[];
      bankTransfer?: string[];
      maxInstallments?: number;
    };
  };
  callbacks: {
    onReady?: () &#x3D;&gt; void;
    onSubmit?: (formData: PaymentBrickFormData) &#x3D;&gt; Promise&lt;void&gt;;
    onError?: (error: unknown) &#x3D;&gt; void;
  };
}

/**
 * MercadoPago Payment Brick Component
 *
 * Componente wrapper para el Payment Brick de MercadoPago.
 * Permite pagos in-site sin redirecci√≥n, soportando m√∫ltiples m√©todos de pago.
 *
 * @example
 * &lt;app-mercadopago-payment-brick
 *   [amount]&#x3D;&quot;10000&quot;
 *   [description]&#x3D;&quot;&#x27;Dep√≥sito a wallet&#x27;&quot;
 *   [depositId]&#x3D;&quot;&#x27;deposit-123&#x27;&quot;
 *   (paymentSuccess)&#x3D;&quot;handleSuccess($event)&quot;
 *   (paymentError)&#x3D;&quot;handleError($event)&quot;
 *   (paymentPending)&#x3D;&quot;handlePending($event)&quot;
 * /&gt;
 */
@Component({
  selector: &#x27;app-mercadopago-payment-brick&#x27;,
  standalone: true,
  imports: [CommonModule],
  template: &#x60;
    &lt;div class&#x3D;&quot;payment-brick-container&quot;&gt;
      @if (isInitializing()) {
        &lt;div class&#x3D;&quot;flex flex-col items-center justify-center py-12&quot;&gt;
          &lt;svg class&#x3D;&quot;animate-spin h-10 w-10 text-primary-500 mb-4&quot; fill&#x3D;&quot;none&quot; viewBox&#x3D;&quot;0 0 24 24&quot;&gt;
            &lt;circle
              class&#x3D;&quot;opacity-25&quot;
              cx&#x3D;&quot;12&quot;
              cy&#x3D;&quot;12&quot;
              r&#x3D;&quot;10&quot;
              stroke&#x3D;&quot;currentColor&quot;
              stroke-width&#x3D;&quot;4&quot;
            &gt;&lt;/circle&gt;
            &lt;path
              class&#x3D;&quot;opacity-75&quot;
              fill&#x3D;&quot;currentColor&quot;
              d&#x3D;&quot;M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z&quot;
            &gt;&lt;/path&gt;
          &lt;/svg&gt;
          &lt;p class&#x3D;&quot;text-sm text-text-secondary&quot;&gt;Cargando opciones de pago...&lt;/p&gt;
        &lt;/div&gt;
      }

      @if (errorMessage()) {
        &lt;div class&#x3D;&quot;bg-error-bg border border-error-border rounded-lg p-4 mb-4&quot;&gt;
          &lt;div class&#x3D;&quot;flex items-start&quot;&gt;
            &lt;svg
              class&#x3D;&quot;w-5 h-5 text-error-strong mt-0.5 flex-shrink-0&quot;
              fill&#x3D;&quot;currentColor&quot;
              viewBox&#x3D;&quot;0 0 20 20&quot;
            &gt;
              &lt;path
                fill-rule&#x3D;&quot;evenodd&quot;
                d&#x3D;&quot;M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z&quot;
                clip-rule&#x3D;&quot;evenodd&quot;
              /&gt;
            &lt;/svg&gt;
            &lt;div class&#x3D;&quot;ml-3&quot;&gt;
              &lt;p class&#x3D;&quot;text-sm font-medium text-error-strong&quot;&gt;{{ errorMessage() }}&lt;/p&gt;
              &lt;button
                (click)&#x3D;&quot;retryInitialization()&quot;
                class&#x3D;&quot;mt-2 text-sm text-primary-600 hover:text-primary-800 font-medium&quot;
              &gt;
                Reintentar
              &lt;/button&gt;
            &lt;/div&gt;
          &lt;/div&gt;
        &lt;/div&gt;
      }

      &lt;!-- Payment Brick Container --&gt;
      &lt;div
        #paymentBrickContainer
        id&#x3D;&quot;paymentBrick_container&quot;
        [class.hidden]&#x3D;&quot;isInitializing() || errorMessage()&quot;
        class&#x3D;&quot;payment-brick-wrapper&quot;
      &gt;&lt;/div&gt;

      @if (isProcessingPayment()) {
        &lt;div
          class&#x3D;&quot;absolute inset-0 bg-surface-base/80 flex items-center justify-center rounded-xl&quot;
        &gt;
          &lt;div class&#x3D;&quot;flex flex-col items-center&quot;&gt;
            &lt;svg class&#x3D;&quot;animate-spin h-8 w-8 text-primary-500 mb-3&quot; fill&#x3D;&quot;none&quot; viewBox&#x3D;&quot;0 0 24 24&quot;&gt;
              &lt;circle
                class&#x3D;&quot;opacity-25&quot;
                cx&#x3D;&quot;12&quot;
                cy&#x3D;&quot;12&quot;
                r&#x3D;&quot;10&quot;
                stroke&#x3D;&quot;currentColor&quot;
                stroke-width&#x3D;&quot;4&quot;
              &gt;&lt;/circle&gt;
              &lt;path
                class&#x3D;&quot;opacity-75&quot;
                fill&#x3D;&quot;currentColor&quot;
                d&#x3D;&quot;M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z&quot;
              &gt;&lt;/path&gt;
            &lt;/svg&gt;
            &lt;p class&#x3D;&quot;text-sm text-text-secondary font-medium&quot;&gt;Procesando pago...&lt;/p&gt;
          &lt;/div&gt;
        &lt;/div&gt;
      }

      &lt;!-- Security Info --&gt;
      &lt;div
        class&#x3D;&quot;mt-4 p-3 bg-primary-50 dark:bg-primary-500/10 border border-primary-200 dark:border-primary-400/30 rounded-lg&quot;
      &gt;
        &lt;div class&#x3D;&quot;flex items-center&quot;&gt;
          &lt;svg
            class&#x3D;&quot;w-5 h-5 text-primary-600 dark:text-primary-400 flex-shrink-0&quot;
            fill&#x3D;&quot;currentColor&quot;
            viewBox&#x3D;&quot;0 0 20 20&quot;
          &gt;
            &lt;path
              fill-rule&#x3D;&quot;evenodd&quot;
              d&#x3D;&quot;M5 9V7a5 5 0 0110 0v2a2 2 0 012 2v5a2 2 0 01-2 2H5a2 2 0 01-2-2v-5a2 2 0 012-2zm8-2v2H7V7a3 3 0 016 0z&quot;
              clip-rule&#x3D;&quot;evenodd&quot;
            /&gt;
          &lt;/svg&gt;
          &lt;p class&#x3D;&quot;ml-2 text-xs text-primary-700 dark:text-primary-300&quot;&gt;
            Pago seguro procesado por MercadoPago. Tus datos est√°n protegidos.
          &lt;/p&gt;
        &lt;/div&gt;
      &lt;/div&gt;
    &lt;/div&gt;
  &#x60;,
  styles: [
    &#x60;
      .payment-brick-container {
        position: relative;
        min-height: 200px;
      }

      .payment-brick-wrapper {
        min-height: 350px;
      }

      /* MercadoPago Brick styling overrides */
      :host ::ng-deep .mercadopago-button {
        border-radius: 0.75rem !important;
        font-weight: 600 !important;
      }
    &#x60;,
  ],
})
export class MercadopagoPaymentBrickComponent implements OnInit, AfterViewInit, OnDestroy {
  /**
   * Amount in ARS cents to charge
   */
  @Input({ required: true }) amount!: number;

  /**
   * Payment description
   */
  @Input() description &#x3D; &#x27;Dep√≥sito a wallet AutoRentar&#x27;;

  /**
   * Deposit ID for tracking
   */
  @Input() depositId?: string;

  /**
   * Payer email (optional, pre-fills the form)
   */
  @Input() payerEmail?: string;

  /**
   * MercadoPago preference ID (optional, for Checkout Pro fallback)
   */
  @Input() preferenceId?: string;

  /**
   * Emitted when payment is approved
   */
  @Output() paymentSuccess &#x3D; new EventEmitter&lt;PaymentResult&gt;();

  /**
   * Emitted when payment is rejected or fails
   */
  @Output() paymentError &#x3D; new EventEmitter&lt;PaymentResult&gt;();

  /**
   * Emitted when payment is pending (offline methods)
   */
  @Output() paymentPending &#x3D; new EventEmitter&lt;PaymentResult&gt;();

  @ViewChild(&#x27;paymentBrickContainer&#x27;, { static: true }) containerRef!: ElementRef&lt;HTMLDivElement&gt;;

  readonly isInitializing &#x3D; signal(true);
  readonly isProcessingPayment &#x3D; signal(false);
  readonly errorMessage &#x3D; signal&lt;string | null&gt;(null);

  private brickController: BrickController | null &#x3D; null;
  private mp: MercadoPagoBricksSDK | null &#x3D; null;
  private mpScriptService &#x3D; inject(MercadoPagoScriptService);
  private ngZone &#x3D; inject(NgZone);
  private supabase &#x3D; injectSupabase();
  private initAttempts &#x3D; 0;
  private maxInitAttempts &#x3D; 3;

  ngOnInit(): void {
    // Preload SDK script early
    this.mpScriptService.preloadSDK().catch((err) &#x3D;&gt; {
      console.warn(&#x27;‚ö†Ô∏è MercadoPago SDK preload failed:&#x27;, err);
    });
  }

  ngAfterViewInit(): void {
    // Wait for DOM to be ready, then initialize
    this.ngZone.runOutsideAngular(() &#x3D;&gt; {
      setTimeout(() &#x3D;&gt; {
        this.ngZone.run(() &#x3D;&gt; {
          void this.initializePaymentBrick();
        });
      }, 300);
    });
  }

  ngOnDestroy(): void {
    this.unmountBrick();
  }

  /**
   * Retry initialization after error
   */
  retryInitialization(): void {
    this.errorMessage.set(null);
    this.initAttempts &#x3D; 0;
    void this.initializePaymentBrick();
  }

  /**
   * Unmount the brick instance
   */
  private unmountBrick(): void {
    if (this.brickController) {
      try {
        this.brickController.unmount();
      } catch (e) {
        console.warn(&#x27;Error unmounting Payment Brick:&#x27;, e);
      }
      this.brickController &#x3D; null;
    }
  }

  /**
   * Get public key from environment
   */
  private getPublicKey(): string {
    const globalEnv &#x3D; (globalThis as Record&lt;string, unknown&gt;).__env as
      | Record&lt;string, unknown&gt;
      | undefined;
    const windowEnvKey &#x3D; String(globalEnv?.NG_APP_MERCADOPAGO_PUBLIC_KEY ?? &#x27;&#x27;).trim();

    const envRecord &#x3D; environment as Record&lt;string, unknown&gt;;
    const buildEnvKey &#x3D; String(
      envRecord.mercadopagoPublicKey ?? envRecord.mercadoPagoPublicKey ?? &#x27;&#x27;,
    ).trim();

    return windowEnvKey || buildEnvKey;
  }

  /**
   * Initialize the Payment Brick
   */
  private async initializePaymentBrick(): Promise&lt;void&gt; {
    this.initAttempts++;
    console.log(&#x60;üîÑ Payment Brick init attempt ${this.initAttempts}/${this.maxInitAttempts}&#x60;);

    try {
      const publicKey &#x3D; this.getPublicKey();

      if (!publicKey) {
        throw new Error(&#x27;MercadoPago public key not configured&#x27;);
      }

      console.log(&#x27;üîë MercadoPago public key:&#x27;, &#x60;${publicKey.slice(0, 20)}...&#x60;);

      // Check if container exists
      const container &#x3D; document.getElementById(&#x27;paymentBrick_container&#x27;);
      if (!container) {
        if (this.initAttempts &lt; this.maxInitAttempts) {
          console.warn(&#x27;‚ö†Ô∏è Container not found, retrying...&#x27;);
          setTimeout(() &#x3D;&gt; this.initializePaymentBrick(), 300);
          return;
        }
        throw new Error(&#x27;Payment Brick container not found&#x27;);
      }

      // Load MercadoPago SDK
      const mpInstance &#x3D; await this.mpScriptService.getMercadoPago(publicKey);
      this.mp &#x3D; mpInstance as unknown as MercadoPagoBricksSDK;

      if (!this.mp || typeof this.mp.bricks !&#x3D;&#x3D; &#x27;function&#x27;) {
        throw new Error(&#x27;MercadoPago bricks method not available&#x27;);
      }

      console.log(&#x27;‚úÖ MercadoPago SDK loaded, creating Payment Brick...&#x27;);

      // Convert amount from cents to ARS (MP expects ARS, not cents)
      const amountArs &#x3D; this.amount / 100;
      console.log(&#x60;üí∞ Initializing Payment Brick with amount: ${amountArs} ARS&#x60;);

      // Create Payment Brick
      const bricksBuilder &#x3D; this.mp.bricks();

      this.brickController &#x3D; await bricksBuilder.create(&#x27;payment&#x27;, &#x27;paymentBrick_container&#x27;, {
        initialization: {
          amount: amountArs,
          preferenceId: this.preferenceId,
          payer: this.payerEmail ? { email: this.payerEmail } : undefined,
        },
        customization: {
          visual: {
            style: {
              theme: &#x27;default&#x27;,
            },
            hideFormTitle: false,
            hidePaymentButton: false,
          },
          paymentMethods: {
            creditCard: &#x27;all&#x27;,
            debitCard: &#x27;all&#x27;,
            mercadoPago: [&#x27;wallet_purchase&#x27;, &#x27;account_money&#x27;, &#x27;consumer_credits&#x27;],
            ticket: [&#x27;rapipago&#x27;, &#x27;pagofacil&#x27;],
            maxInstallments: 12,
          },
        },
        callbacks: {
          onReady: () &#x3D;&gt; {
            console.log(&#x27;‚úÖ Payment Brick ready&#x27;);
            this.ngZone.run(() &#x3D;&gt; {
              this.isInitializing.set(false);
            });
          },
          onSubmit: async (formData: PaymentBrickFormData) &#x3D;&gt; {
            console.log(&#x27;üì§ Payment Brick submit:&#x27;, formData.selectedPaymentMethod);
            await this.processPayment(formData);
          },
          onError: (error: unknown) &#x3D;&gt; {
            console.error(&#x27;‚ùå Payment Brick error:&#x27;, error);
            this.ngZone.run(() &#x3D;&gt; {
              this.handleBrickError(error);
            });
          },
        },
      });

      console.log(&#x27;‚úÖ Payment Brick created successfully&#x27;);
    } catch (error) {
      console.error(&#x27;‚ùå Payment Brick initialization error:&#x27;, error);
      this.ngZone.run(() &#x3D;&gt; {
        this.isInitializing.set(false);
        const errorDetails &#x3D; error instanceof Error ? error.message : String(error);
        this.errorMessage.set(&#x60;Error al cargar opciones de pago: ${errorDetails}&#x60;);
      });
    }
  }

  /**
   * Process the payment after form submission
   */
  private async processPayment(formData: PaymentBrickFormData): Promise&lt;void&gt; {
    this.ngZone.run(() &#x3D;&gt; {
      this.isProcessingPayment.set(true);
      this.errorMessage.set(null);
    });

    try {
      console.log(&#x27;üì§ Calling Edge Function mercadopago-process-brick-payment...&#x27;);

      // Call the Edge Function to process the payment using Supabase functions.invoke
      const { data, error } &#x3D; await this.supabase.functions.invoke&lt;PaymentResult&gt;(
        &#x27;mercadopago-process-brick-payment&#x27;,
        {
          body: {
            formData: formData.formData,
            depositId: this.depositId,
            description: this.description,
          },
        },
      );

      if (error) {
        console.error(&#x27;‚ùå Edge Function error:&#x27;, error);
        throw new Error(error.message || &#x27;Error al procesar el pago&#x27;);
      }

      if (!data) {
        throw new Error(&#x27;No se recibi√≥ respuesta del servidor&#x27;);
      }

      const result &#x3D; data;
      console.log(&#x27;‚úÖ Payment result:&#x27;, result);

      this.ngZone.run(() &#x3D;&gt; {
        this.isProcessingPayment.set(false);

        if (result.success &amp;&amp; result.status &#x3D;&#x3D;&#x3D; &#x27;approved&#x27;) {
          this.paymentSuccess.emit(result);
        } else if (result.status &#x3D;&#x3D;&#x3D; &#x27;pending&#x27; || result.status &#x3D;&#x3D;&#x3D; &#x27;in_process&#x27;) {
          this.paymentPending.emit(result);
        } else {
          this.paymentError.emit(result);
          this.errorMessage.set(result.message || &#x27;El pago fue rechazado&#x27;);
        }
      });
    } catch (error) {
      console.error(&#x27;‚ùå Payment processing error:&#x27;, error);
      this.ngZone.run(() &#x3D;&gt; {
        this.isProcessingPayment.set(false);
        const errorMessage &#x3D; error instanceof Error ? error.message : &#x27;Error al procesar el pago&#x27;;
        this.errorMessage.set(errorMessage);
        this.paymentError.emit({
          success: false,
          message: errorMessage,
        });
      });
    }
  }

  /**
   * Handle Brick errors
   */
  private handleBrickError(error: unknown): void {
    let message &#x3D; &#x27;Error en el formulario de pago&#x27;;

    if (typeof error &#x3D;&#x3D;&#x3D; &#x27;string&#x27;) {
      message &#x3D; error;
    } else if (error &amp;&amp; typeof error &#x3D;&#x3D;&#x3D; &#x27;object&#x27;) {
      const errorObj &#x3D; error as Record&lt;string, unknown&gt;;
      message &#x3D; String(errorObj.message || errorObj.description || message);
    }

    this.errorMessage.set(message);
    this.paymentError.emit({
      success: false,
      message,
    });
  }
}
</code></pre>
    </div>
</div>








                   </div><div class="search-results">
    <div class="has-results">
        <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
        <ul class="search-results-list"></ul>
    </div>
    <div class="no-results">
        <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
    </div>
</div>
</div>
               <!-- END CONTENT -->
           </div>
       </div>

          <label class="dark-mode-switch">
               <input type="checkbox">
               <span class="slider">
                    <svg class="slider-icon" viewBox="0 0 24 24" fill="none" height="20" stroke="#000" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" width="20" xmlns="http://www.w3.org/2000/svg">
                    <path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"></path>
                    </svg>
               </span>
          </label>

       <script>
            var COMPODOC_CURRENT_PAGE_DEPTH = 1;
            var COMPODOC_CURRENT_PAGE_CONTEXT = 'interface';
            var COMPODOC_CURRENT_PAGE_URL = 'BricksBuilder.html';
            var MAX_SEARCH_RESULTS = 15;
       </script>

       <script>
               $darkModeToggleSwitchers = document.querySelectorAll('.dark-mode-switch input');
               checkToggle(darkModeState);
               if ($darkModeToggleSwitchers.length > 0) {
                    for (var i = 0; i < $darkModeToggleSwitchers.length; i++) {
                         $darkModeToggleSwitchers[i].addEventListener('change', function (event) {
                              darkModeState = !darkModeState;
                              toggleDarkMode(darkModeState);
                         });
                    }
               }
          </script>

       <script src="../js/libs/custom-elements.min.js"></script>
       <script src="../js/libs/lit-html.js"></script>

       <script src="../js/menu-wc.js" defer></script>
       <script nomodule src="../js/menu-wc_es5.js" defer></script>

       <script src="../js/libs/bootstrap-native.js"></script>

       <script src="../js/libs/es6-shim.min.js"></script>
       <script src="../js/libs/EventDispatcher.js"></script>
       <script src="../js/libs/promise.min.js"></script>

       <script src="../js/compodoc.js"></script>

       <script src="../js/tabs.js"></script>
       <script src="../js/menu.js"></script>
       <script src="../js/libs/clipboard.min.js"></script>
       <script src="../js/libs/prism.js"></script>
       <script src="../js/sourceCode.js"></script>
          <script src="../js/search/search.js"></script>
          <script src="../js/search/lunr.min.js"></script>
          <script src="../js/search/search-lunr.js"></script>
          <script src="../js/search/search_index.js"></script>
       <script src="../js/lazy-load-graphs.js"></script>


    </body>
</html>
