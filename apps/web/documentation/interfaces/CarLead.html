<!doctype html>
<html class="no-js" lang="">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <title>autorenta-web documentation</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <link rel="icon" type="image/x-icon" href="../images/favicon.ico">
	   <link rel="stylesheet" href="../styles/style.css">
        <link rel="stylesheet" href="../styles/dark.css">
    </head>
    <body>
          <script>
               // Blocking script to avoid flickering dark mode
               // Dark mode toggle button
               var useDark = window.matchMedia('(prefers-color-scheme: dark)');
               var darkModeState = useDark.matches;
               var $darkModeToggleSwitchers = document.querySelectorAll('.dark-mode-switch input');
               var $darkModeToggles = document.querySelectorAll('.dark-mode-switch');
               var darkModeStateLocal = localStorage.getItem('compodoc_darkmode-state');

               function checkToggle(check) {
                    for (var i = 0; i < $darkModeToggleSwitchers.length; i++) {
                         $darkModeToggleSwitchers[i].checked = check;
                    }
               }

               function toggleDarkMode(state) {
                    if (window.localStorage) {
                         localStorage.setItem('compodoc_darkmode-state', state);
                    }

                    checkToggle(state);

                    const hasClass = document.body.classList.contains('dark');

                    if (state) {
                         for (var i = 0; i < $darkModeToggles.length; i++) {
                              $darkModeToggles[i].classList.add('dark');
                         }
                         if (!hasClass) {
                              document.body.classList.add('dark');
                         }
                    } else {
                         for (var i = 0; i < $darkModeToggles.length; i++) {
                              $darkModeToggles[i].classList.remove('dark');
                         }
                         if (hasClass) {
                              document.body.classList.remove('dark');
                         }
                    }
               }

               useDark.addEventListener('change', function (evt) {
                    toggleDarkMode(evt.matches);
               });
               if (darkModeStateLocal) {
                    darkModeState = darkModeStateLocal === 'true';
               }
               toggleDarkMode(darkModeState);
          </script>
          <script>
              // --- Iframe navigation tracking for Template Playground ---
              function sendCurrentUrlToParent() {
                  if (window.parent && window.parent !== window) {
                      window.parent.postMessage({
                          type: 'compodoc-iframe-navigate',
                          url: window.location.pathname + window.location.hash
                      }, '*');
                  }
              }
              window.addEventListener('hashchange', sendCurrentUrlToParent, false);
              window.addEventListener('popstate', sendCurrentUrlToParent, false);
              window.addEventListener('DOMContentLoaded', sendCurrentUrlToParent, false);
          </script>

        <div class="navbar navbar-default navbar-fixed-top d-md-none p-0">
               <div class="d-flex">
                    <a href="../" class="navbar-brand">autorenta-web documentation</a>
                    <button type="button" class="btn btn-default btn-menu ion-ios-menu" id="btn-menu"></button>
               </div>
        </div>

        <div class="xs-menu menu" id="mobile-menu">
                <div id="book-search-input" role="search"><input type="text" placeholder="Type to search"></div>            <compodoc-menu></compodoc-menu>
        </div>

        <div class="container-fluid main">
           <div class="row main">
               <div class="d-none d-md-block menu">
                   <compodoc-menu mode="normal"></compodoc-menu>
               </div>
               <!-- START CONTENT -->
               <div class="content interface">
                   <div class="content-data">

















<ol class="breadcrumb">
  <li class="breadcrumb-item">Interfaces</li>
  <li class="breadcrumb-item"
  >
  CarLead</li>
</ol>

<ul class="nav nav-tabs" role="tablist">
        <li class="nav-item">
            <a href="#info" 
                class="nav-link"
                class="nav-link active"
                role="tab" id="info-tab" data-bs-toggle="tab" data-link="info">Info</a>
        </li>
        <li class="nav-item">
            <a href="#source" 
                class="nav-link"
                
                role="tab" id="source-tab" data-bs-toggle="tab" data-link="source">Source</a>
        </li>
</ul>

<div class="tab-content">
    <div class="tab-pane fade active in" id="info">
        <p class="comment">
            <h3>File</h3>
        </p>
        <p class="comment">
            <code>src/app/features/bookings/owner-bookings/owner-bookings.page.ts</code>
        </p>




        <section data-compodoc="block-index">
            <h3 id="index">Index</h3>
            <table class="table table-sm table-bordered index-table">
                <tbody>
                    <tr>
                        <td class="col-md-4">
                            <h6><b>Properties</b></h6>
                        </td>
                    </tr>
                    <tr>
                        <td class="col-md-4">
                            <ul class="index-list">
                                <li>
                                        <a href="#carId" 
>
                                            carId
                                        </a>
                                </li>
                                <li>
                                        <a href="#carTitle" 
>
                                            carTitle
                                        </a>
                                </li>
                                <li>
                                        <a href="#lastMessage" 
>
                                            lastMessage
                                        </a>
                                </li>
                                <li>
                                        <a href="#participantId" 
>
                                            participantId
                                        </a>
                                </li>
                                <li>
                                        <a href="#participantName" 
>
                                            participantName
                                        </a>
                                </li>
                                <li>
                                        <a href="#unreadCount" 
>
                                            unreadCount
                                        </a>
                                </li>
                            </ul>
                        </td>
                    </tr>
                </tbody>
            </table>
        </section>



            <section data-compodoc="block-properties">
                <h3 id="inputs">Properties</h3>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="carId"></a>
                                        <span class="name "><b>carId</b>
                                            <a href="#carId">
                                                <span class="icon ion-ios-link"></span>
                                            </a>
                                        </span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>carId:         <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>

                                        </td>
                                    </tr>





                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="carTitle"></a>
                                        <span class="name "><b>carTitle</b>
                                            <a href="#carTitle">
                                                <span class="icon ion-ios-link"></span>
                                            </a>
                                        </span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>carTitle:         <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>

                                        </td>
                                    </tr>





                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="lastMessage"></a>
                                        <span class="name "><b>lastMessage</b>
                                            <a href="#lastMessage">
                                                <span class="icon ion-ios-link"></span>
                                            </a>
                                        </span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>lastMessage:         <code><a href="../interfaces/Message.html" target="_self" >Message</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="../interfaces/Message.html" target="_self" >Message</a></code>

                                        </td>
                                    </tr>





                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="participantId"></a>
                                        <span class="name "><b>participantId</b>
                                            <a href="#participantId">
                                                <span class="icon ion-ios-link"></span>
                                            </a>
                                        </span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>participantId:         <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>

                                        </td>
                                    </tr>





                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="participantName"></a>
                                        <span class="name "><b>participantName</b>
                                            <a href="#participantName">
                                                <span class="icon ion-ios-link"></span>
                                            </a>
                                        </span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>participantName:     <code>string | null</code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>    <code>string | null</code>

                                        </td>
                                    </tr>





                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="unreadCount"></a>
                                        <span class="name "><b>unreadCount</b>
                                            <a href="#unreadCount">
                                                <span class="icon ion-ios-link"></span>
                                            </a>
                                        </span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>unreadCount:         <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>

                                        </td>
                                    </tr>





                        </tbody>
                    </table>
            </section>
    </div>


    <div class="tab-pane fade  tab-source-code" id="source">
        <pre class="line-numbers compodoc-sourcecode"><code class="language-typescript">import { CommonModule } from &#x27;@angular/common&#x27;;
import { ChangeDetectionStrategy, Component, OnInit, signal } from &#x27;@angular/core&#x27;;
import { Router, RouterLink } from &#x27;@angular/router&#x27;;
import { AlertController, IonicModule, ToastController } from &#x27;@ionic/angular&#x27;;
import { TranslateModule } from &#x27;@ngx-translate/core&#x27;;
import { Booking } from &#x27;../../../core/models&#x27;;
import { AuthService } from &#x27;../../../core/services/auth.service&#x27;;
import { BookingsService } from &#x27;../../../core/services/bookings.service&#x27;;
import {
  MarketplaceOnboardingService,
  MarketplaceStatus,
} from &#x27;../../../core/services/marketplace-onboarding.service&#x27;;
import { Message, MessagesService } from &#x27;../../../core/services/messages.service&#x27;;
import { DepositStatusBadgeComponent } from &#x27;../../../shared/components/deposit-status-badge/deposit-status-badge.component&#x27;;
import { MoneyPipe } from &#x27;../../../shared/pipes/money.pipe&#x27;;
import { formatDateRange } from &#x27;../../../shared/utils/date.utils&#x27;;

interface CarLead {
  carId: string;
  carTitle: string;
  participantId: string;
  participantName: string | null;
  lastMessage: Message;
  unreadCount: number;
}

@Component({
  standalone: true,
  selector: &#x27;app-owner-bookings-page&#x27;,
  imports: [
    CommonModule,
    MoneyPipe,
    RouterLink,
    TranslateModule,
    IonicModule,
    DepositStatusBadgeComponent,
  ],
  templateUrl: &#x27;./owner-bookings.page.html&#x27;,
  styleUrl: &#x27;./owner-bookings.page.css&#x27;,
  changeDetection: ChangeDetectionStrategy.OnPush,
})
export class OwnerBookingsPage implements OnInit {
  readonly bookings &#x3D; signal&lt;Booking[]&gt;([]);
  readonly loading &#x3D; signal(false);
  readonly error &#x3D; signal&lt;string | null&gt;(null);
  readonly processingAction &#x3D; signal&lt;string | null&gt;(null);
  readonly renterContacts &#x3D; signal&lt;
    Record&lt;string, { name?: string; email?: string; phone?: string }&gt;
  &gt;({});
  readonly carLeads &#x3D; signal&lt;CarLead[]&gt;([]);
  readonly leadsLoading &#x3D; signal(false);
  readonly marketplaceStatus &#x3D; signal&lt;MarketplaceStatus | null&gt;(null);

  private currentUserId: string | null &#x3D; null;

  constructor(
    private readonly bookingsService: BookingsService,
    private readonly alertController: AlertController,
    private readonly toastController: ToastController,
    private readonly messagesService: MessagesService,
    private readonly authService: AuthService,
    private readonly router: Router,
    private readonly marketplaceService: MarketplaceOnboardingService,
  ) {}

  ngOnInit(): void {
    void this.initialize();
  }

  private async initialize(): Promise&lt;void&gt; {
    try {
      const session &#x3D; await this.authService.ensureSession();
      this.currentUserId &#x3D; session?.user?.id ?? null;
      if (this.currentUserId) {
        await this.loadMarketplaceStatus(this.currentUserId);
      } else {
        this.marketplaceStatus.set(null);
      }
    } catch {
      this.currentUserId &#x3D; null;
      this.marketplaceStatus.set(null);
    } finally {
      await this.loadBookings();
    }
  }

  async loadBookings(): Promise&lt;void&gt; {
    this.loading.set(true);
    this.error.set(null);
    this.renterContacts.set({});
    try {
      // ‚úÖ NUEVO: Obtener reservas de AUTOS DEL LOCADOR
      const { bookings } &#x3D; await this.bookingsService.getOwnerBookings();
      await this.loadRenterContacts(bookings);
      this.bookings.set(bookings);
      await this.loadCarLeads();
    } catch {
      this.error.set(&#x27;No pudimos cargar las reservas. Por favor intent√° de nuevo m√°s tarde.&#x27;);
    } finally {
      this.loading.set(false);
    }
  }

  rangeLabel(booking: Booking): string {
    return formatDateRange(booking.start_at, booking.end_at);
  }

  statusLabel(booking: Booking): string {
    switch (booking.status) {
      case &#x27;pending&#x27;:
        return &#x27;Pendiente de confirmaci√≥n&#x27;;
      case &#x27;confirmed&#x27;:
        return &#x27;Confirmada&#x27;;
      case &#x27;in_progress&#x27;:
        return &#x27;En curso&#x27;;
      case &#x27;completed&#x27;:
        return &#x27;Finalizada&#x27;;
      case &#x27;cancelled&#x27;:
        return &#x27;Cancelada&#x27;;
      case &#x27;expired&#x27;:
        return &#x27;Vencida&#x27;;
      default:
        return booking.status;
    }
  }

  statusHint(booking: Booking): string | null {
    switch (booking.status) {
      case &#x27;pending&#x27;:
        return &#x27;El locatario debe completar el pago.&#x27;;
      case &#x27;confirmed&#x27;:
        return &#x27;Coordin√° la entrega del auto con el locatario.&#x27;;
      case &#x27;in_progress&#x27;:
        return &#x27;El auto est√° siendo utilizado.&#x27;;
      case &#x27;completed&#x27;:
        return &#x27;Alquiler finalizado correctamente.&#x27;;
      case &#x27;cancelled&#x27;:
        return &#x27;Esta reserva fue cancelada.&#x27;;
      default:
        return null;
    }
  }

  statusBadgeClass(booking: Booking): string {
    switch (booking.status) {
      case &#x27;pending&#x27;:
        return &#x27;badge-warning&#x27;;
      case &#x27;confirmed&#x27;:
        return &#x27;badge-success&#x27;;
      case &#x27;in_progress&#x27;:
        return &#x27;badge-info&#x27;;
      case &#x27;completed&#x27;:
        return &#x27;badge-neutral&#x27;;
      case &#x27;cancelled&#x27;:
      case &#x27;expired&#x27;:
        return &#x27;badge-danger&#x27;;
      default:
        return &#x27;badge-neutral&#x27;;
    }
  }

  statusIcon(booking: Booking): string {
    switch (booking.status) {
      case &#x27;pending&#x27;:
        return &#x27;‚è≥&#x27;;
      case &#x27;confirmed&#x27;:
        return &#x27;‚úÖ&#x27;;
      case &#x27;in_progress&#x27;:
        return &#x27;üöó&#x27;;
      case &#x27;completed&#x27;:
        return &#x27;üèÅ&#x27;;
      case &#x27;cancelled&#x27;:
      case &#x27;expired&#x27;:
        return &#x27;‚ùå&#x27;;
      default:
        return &#x27;‚ÑπÔ∏è&#x27;;
    }
  }

  // ‚úÖ NUEVO: Acciones del locador
  canDoOwnerCheckIn(booking: Booking): boolean {
    // Check-in cuando est√° confirmed y llega la fecha
    return booking.status &#x3D;&#x3D;&#x3D; &#x27;confirmed&#x27; &amp;&amp; new Date(booking.start_at) &lt;&#x3D; new Date();
  }

  canDoOwnerCheckOut(booking: Booking): boolean {
    // Check-out cuando est√° in_progress
    return booking.status &#x3D;&#x3D;&#x3D; &#x27;in_progress&#x27;;
  }

  canStartRental(booking: Booking): boolean {
    return booking.status &#x3D;&#x3D;&#x3D; &#x27;confirmed&#x27;;
  }

  canCompleteRental(booking: Booking): boolean {
    return booking.status &#x3D;&#x3D;&#x3D; &#x27;in_progress&#x27;;
  }

  canCancelBooking(booking: Booking): boolean {
    return booking.status &#x3D;&#x3D;&#x3D; &#x27;pending&#x27; || booking.status &#x3D;&#x3D;&#x3D; &#x27;confirmed&#x27;;
  }

  async onStartRental(bookingId: string): Promise&lt;void&gt; {
    const confirmed &#x3D; await this.presentConfirmation({
      header: &#x27;Iniciar alquiler&#x27;,
      message: &#x27;Confirm√° que el locatario recibi√≥ el auto.&#x27;,
      confirmText: &#x27;Iniciar&#x27;,
    });
    if (!confirmed) return;

    this.processingAction.set(bookingId);
    try {
      await this.bookingsService.updateBooking(bookingId, { status: &#x27;in_progress&#x27; });
      await this.loadBookings();
      await this.presentToast(&#x27;Alquiler iniciado correctamente&#x27;);
    } catch (error) {
      console.error(&#x27;Error starting rental:&#x27;, error);
      await this.presentToast(&#x27;Error al iniciar el alquiler&#x27;, &#x27;danger&#x27;);
    } finally {
      this.processingAction.set(null);
    }
  }

  async onCompleteRental(bookingId: string): Promise&lt;void&gt; {
    const confirmed &#x3D; await this.presentConfirmation({
      header: &#x27;Finalizar alquiler&#x27;,
      message: &#x27;Confirm√° que el locatario devolvi√≥ el auto en buen estado.&#x27;,
      confirmText: &#x27;Finalizar&#x27;,
    });
    if (!confirmed) return;

    this.processingAction.set(bookingId);
    try {
      await this.bookingsService.updateBooking(bookingId, { status: &#x27;completed&#x27; });
      await this.loadBookings();
      await this.presentToast(&#x27;Alquiler finalizado correctamente&#x27;);
    } catch (error) {
      console.error(&#x27;Error completing rental:&#x27;, error);
      await this.presentToast(&#x27;Error al finalizar el alquiler&#x27;, &#x27;danger&#x27;);
    } finally {
      this.processingAction.set(null);
    }
  }

  async onCancelBooking(bookingId: string): Promise&lt;void&gt; {
    const confirmed &#x3D; await this.presentConfirmation({
      header: &#x27;Cancelar reserva&#x27;,
      message: &#x27;Esta acci√≥n cancelar√° la reserva actual. ¬øDese√°s continuar?&#x27;,
      confirmText: &#x27;Cancelar reserva&#x27;,
      confirmColor: &#x27;danger&#x27;,
    });
    if (!confirmed) return;

    this.processingAction.set(bookingId);
    try {
      await this.bookingsService.cancelBooking(bookingId, false);
      await this.loadBookings();
      await this.presentToast(&#x27;Reserva cancelada&#x27;);
    } catch (error) {
      console.error(&#x27;Error cancelling booking:&#x27;, error);
      await this.presentToast(&#x27;Error al cancelar la reserva&#x27;, &#x27;danger&#x27;);
    } finally {
      this.processingAction.set(null);
    }
  }

  renterDisplayName(booking: Booking): string {
    const contact &#x3D; this.renterContacts()[booking.id];
    return contact?.name || contact?.email || booking.renter_id || &#x27;Locatario&#x27;;
  }

  renterEmail(booking: Booking): string | null {
    const contact &#x3D; this.renterContacts()[booking.id];
    return contact?.email ?? null;
  }

  renterPhone(booking: Booking): string | null {
    const contact &#x3D; this.renterContacts()[booking.id];
    return contact?.phone ?? null;
  }

  async loadCarLeads(): Promise&lt;void&gt; {
    if (!this.currentUserId) {
      this.carLeads.set([]);
      return;
    }

    this.leadsLoading.set(true);

    try {
      const rows &#x3D; await this.messagesService.listCarLeadsForOwner(this.currentUserId);

      const threads &#x3D; new Map&lt;
        string,
        {
          carId: string;
          carTitle: string;
          participantId: string;
          lastMessage: Message;
          unreadCount: number;
        }
      &gt;();

      for (const row of rows) {
        if (!row.car?.id) {
          continue;
        }

        const key &#x3D; &#x60;${row.car.id}:${row.otherUserId}&#x60;;
        const existing &#x3D; threads.get(key);
        const isUnread &#x3D; row.message.recipient_id &#x3D;&#x3D;&#x3D; this.currentUserId &amp;&amp; !row.message.read_at;

        if (!existing) {
          threads.set(key, {
            carId: row.car.id,
            carTitle: row.car.title ?? &#x27;Auto sin t√≠tulo&#x27;,
            participantId: row.otherUserId,
            lastMessage: row.message,
            unreadCount: isUnread ? 1 : 0,
          });
        } else {
          const existingDate &#x3D; new Date(existing.lastMessage.created_at).getTime();
          const currentDate &#x3D; new Date(row.message.created_at).getTime();

          if (currentDate &gt; existingDate) {
            existing.lastMessage &#x3D; row.message;
          }

          if (isUnread) {
            existing.unreadCount +&#x3D; 1;
          }
        }
      }

      const leadsOrdered &#x3D; Array.from(threads.values()).sort((a, b) &#x3D;&gt; {
        const aDate &#x3D; new Date(a.lastMessage.created_at).getTime();
        const bDate &#x3D; new Date(b.lastMessage.created_at).getTime();
        return bDate - aDate;
      });

      const enriched &#x3D; await Promise.all(
        leadsOrdered.map(async (lead) &#x3D;&gt; {
          let participantName: string | null &#x3D; null;

          try {
            const contact &#x3D; await this.bookingsService.getOwnerContact(lead.participantId);
            if (contact.success) {
              participantName &#x3D; contact.name || contact.email || null;
            }
          } catch {
            // Silently ignore error, participant name is optional
          }

          return {
            ...lead,
            participantName,
          };
        }),
      );

      this.carLeads.set(enriched);
    } catch (error) {
      console.error(&#x27;Error loading car leads:&#x27;, error);
    } finally {
      this.leadsLoading.set(false);
    }
  }

  async openCarChat(lead: CarLead): Promise&lt;void&gt; {
    await this.router.navigate([&#x27;/messages&#x27;], {
      queryParams: {
        carId: lead.carId,
        userId: lead.participantId,
        carName: lead.carTitle,
        userName: lead.participantName ?? &#x27;Usuario&#x27;,
      },
    });
  }

  private async loadMarketplaceStatus(userId: string): Promise&lt;void&gt; {
    try {
      const status &#x3D; await this.marketplaceService.getMarketplaceStatus(userId);
      this.marketplaceStatus.set(status);
    } catch {
      this.marketplaceStatus.set(null);
    }
  }

  private async loadRenterContacts(bookings: Booking[]): Promise&lt;void&gt; {
    const contacts: Record&lt;string, { name?: string; email?: string; phone?: string }&gt; &#x3D; {};

    await Promise.all(
      bookings.map(async (booking) &#x3D;&gt; {
        if (!booking?.id || !booking?.renter_id) {
          return;
        }

        try {
          const contact &#x3D; await this.bookingsService.getOwnerContact(booking.renter_id);
          if (contact.success) {
            contacts[booking.id] &#x3D; {
              name: contact.name,
              email: contact.email,
              phone: contact.phone,
            };
          } else {
            // No action needed if contact is not found
          }
        } catch {
          // Silently ignore errors
        }
      }),
    );

    this.renterContacts.set(contacts);
  }

  private async presentConfirmation(options: {
    header: string;
    message: string;
    confirmText?: string;
    cancelText?: string;
    confirmColor?: &#x27;primary&#x27; | &#x27;danger&#x27;;
  }): Promise&lt;boolean&gt; {
    const alert &#x3D; await this.alertController.create({
      header: options.header,
      message: options.message,
      buttons: [
        {
          text: options.cancelText ?? &#x27;Volver&#x27;,
          role: &#x27;cancel&#x27;,
        },
        {
          text: options.confirmText ?? &#x27;Confirmar&#x27;,
          role: &#x27;confirm&#x27;,
          cssClass: options.confirmColor &#x3D;&#x3D;&#x3D; &#x27;danger&#x27; ? &#x27;alert-button-danger&#x27; : undefined,
        },
      ],
    });

    await alert.present();
    const { role } &#x3D; await alert.onDidDismiss();
    return role &#x3D;&#x3D;&#x3D; &#x27;confirm&#x27;;
  }

  private async presentToast(
    message: string,
    color: &#x27;success&#x27; | &#x27;danger&#x27; | &#x27;warning&#x27; &#x3D; &#x27;success&#x27;,
  ): Promise&lt;void&gt; {
    const toast &#x3D; await this.toastController.create({
      message,
      duration: 2500,
      position: &#x27;top&#x27;,
      color,
    });
    await toast.present();
  }
}
</code></pre>
    </div>
</div>








                   </div><div class="search-results">
    <div class="has-results">
        <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
        <ul class="search-results-list"></ul>
    </div>
    <div class="no-results">
        <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
    </div>
</div>
</div>
               <!-- END CONTENT -->
           </div>
       </div>

          <label class="dark-mode-switch">
               <input type="checkbox">
               <span class="slider">
                    <svg class="slider-icon" viewBox="0 0 24 24" fill="none" height="20" stroke="#000" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" width="20" xmlns="http://www.w3.org/2000/svg">
                    <path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"></path>
                    </svg>
               </span>
          </label>

       <script>
            var COMPODOC_CURRENT_PAGE_DEPTH = 1;
            var COMPODOC_CURRENT_PAGE_CONTEXT = 'interface';
            var COMPODOC_CURRENT_PAGE_URL = 'CarLead.html';
            var MAX_SEARCH_RESULTS = 15;
       </script>

       <script>
               $darkModeToggleSwitchers = document.querySelectorAll('.dark-mode-switch input');
               checkToggle(darkModeState);
               if ($darkModeToggleSwitchers.length > 0) {
                    for (var i = 0; i < $darkModeToggleSwitchers.length; i++) {
                         $darkModeToggleSwitchers[i].addEventListener('change', function (event) {
                              darkModeState = !darkModeState;
                              toggleDarkMode(darkModeState);
                         });
                    }
               }
          </script>

       <script src="../js/libs/custom-elements.min.js"></script>
       <script src="../js/libs/lit-html.js"></script>

       <script src="../js/menu-wc.js" defer></script>
       <script nomodule src="../js/menu-wc_es5.js" defer></script>

       <script src="../js/libs/bootstrap-native.js"></script>

       <script src="../js/libs/es6-shim.min.js"></script>
       <script src="../js/libs/EventDispatcher.js"></script>
       <script src="../js/libs/promise.min.js"></script>

       <script src="../js/compodoc.js"></script>

       <script src="../js/tabs.js"></script>
       <script src="../js/menu.js"></script>
       <script src="../js/libs/clipboard.min.js"></script>
       <script src="../js/libs/prism.js"></script>
       <script src="../js/sourceCode.js"></script>
          <script src="../js/search/search.js"></script>
          <script src="../js/search/lunr.min.js"></script>
          <script src="../js/search/search-lunr.js"></script>
          <script src="../js/search/search_index.js"></script>
       <script src="../js/lazy-load-graphs.js"></script>


    </body>
</html>
