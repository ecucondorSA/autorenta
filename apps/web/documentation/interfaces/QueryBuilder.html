<!doctype html>
<html class="no-js" lang="">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <title>autorenta-web documentation</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <link rel="icon" type="image/x-icon" href="../images/favicon.ico">
	   <link rel="stylesheet" href="../styles/style.css">
        <link rel="stylesheet" href="../styles/dark.css">
    </head>
    <body>
          <script>
               // Blocking script to avoid flickering dark mode
               // Dark mode toggle button
               var useDark = window.matchMedia('(prefers-color-scheme: dark)');
               var darkModeState = useDark.matches;
               var $darkModeToggleSwitchers = document.querySelectorAll('.dark-mode-switch input');
               var $darkModeToggles = document.querySelectorAll('.dark-mode-switch');
               var darkModeStateLocal = localStorage.getItem('compodoc_darkmode-state');

               function checkToggle(check) {
                    for (var i = 0; i < $darkModeToggleSwitchers.length; i++) {
                         $darkModeToggleSwitchers[i].checked = check;
                    }
               }

               function toggleDarkMode(state) {
                    if (window.localStorage) {
                         localStorage.setItem('compodoc_darkmode-state', state);
                    }

                    checkToggle(state);

                    const hasClass = document.body.classList.contains('dark');

                    if (state) {
                         for (var i = 0; i < $darkModeToggles.length; i++) {
                              $darkModeToggles[i].classList.add('dark');
                         }
                         if (!hasClass) {
                              document.body.classList.add('dark');
                         }
                    } else {
                         for (var i = 0; i < $darkModeToggles.length; i++) {
                              $darkModeToggles[i].classList.remove('dark');
                         }
                         if (hasClass) {
                              document.body.classList.remove('dark');
                         }
                    }
               }

               useDark.addEventListener('change', function (evt) {
                    toggleDarkMode(evt.matches);
               });
               if (darkModeStateLocal) {
                    darkModeState = darkModeStateLocal === 'true';
               }
               toggleDarkMode(darkModeState);
          </script>
          <script>
              // --- Iframe navigation tracking for Template Playground ---
              function sendCurrentUrlToParent() {
                  if (window.parent && window.parent !== window) {
                      window.parent.postMessage({
                          type: 'compodoc-iframe-navigate',
                          url: window.location.pathname + window.location.hash
                      }, '*');
                  }
              }
              window.addEventListener('hashchange', sendCurrentUrlToParent, false);
              window.addEventListener('popstate', sendCurrentUrlToParent, false);
              window.addEventListener('DOMContentLoaded', sendCurrentUrlToParent, false);
          </script>

        <div class="navbar navbar-default navbar-fixed-top d-md-none p-0">
               <div class="d-flex">
                    <a href="../" class="navbar-brand">autorenta-web documentation</a>
                    <button type="button" class="btn btn-default btn-menu ion-ios-menu" id="btn-menu"></button>
               </div>
        </div>

        <div class="xs-menu menu" id="mobile-menu">
                <div id="book-search-input" role="search"><input type="text" placeholder="Type to search"></div>            <compodoc-menu></compodoc-menu>
        </div>

        <div class="container-fluid main">
           <div class="row main">
               <div class="d-none d-md-block menu">
                   <compodoc-menu mode="normal"></compodoc-menu>
               </div>
               <!-- START CONTENT -->
               <div class="content interface">
                   <div class="content-data">

















<ol class="breadcrumb">
  <li class="breadcrumb-item">Interfaces</li>
  <li class="breadcrumb-item"
  >
  QueryBuilder</li>
</ol>

<ul class="nav nav-tabs" role="tablist">
        <li class="nav-item">
            <a href="#info" 
                class="nav-link"
                class="nav-link active"
                role="tab" id="info-tab" data-bs-toggle="tab" data-link="info">Info</a>
        </li>
        <li class="nav-item">
            <a href="#source" 
                class="nav-link"
                
                role="tab" id="source-tab" data-bs-toggle="tab" data-link="source">Source</a>
        </li>
</ul>

<div class="tab-content">
    <div class="tab-pane fade active in" id="info">
        <p class="comment">
            <h3>File</h3>
        </p>
        <p class="comment">
            <code>src/testing/mocks/supabase-mock.ts</code>
        </p>




        <section data-compodoc="block-index">
            <h3 id="index">Index</h3>
            <table class="table table-sm table-bordered index-table">
                <tbody>
                    <tr>
                        <td class="col-md-4">
                            <h6><b>Properties</b></h6>
                        </td>
                    </tr>
                    <tr>
                        <td class="col-md-4">
                            <ul class="index-list">
                                <li>
                                        <a href="#eq" 
>
                                            eq
                                        </a>
                                </li>
                                <li>
                                        <a href="#gt" 
>
                                            gt
                                        </a>
                                </li>
                                <li>
                                        <a href="#gte" 
>
                                            gte
                                        </a>
                                </li>
                                <li>
                                        <a href="#ilike" 
>
                                            ilike
                                        </a>
                                </li>
                                <li>
                                        <a href="#in" 
>
                                            in
                                        </a>
                                </li>
                                <li>
                                        <a href="#is" 
>
                                            is
                                        </a>
                                </li>
                                <li>
                                        <a href="#like" 
>
                                            like
                                        </a>
                                </li>
                                <li>
                                        <a href="#limit" 
>
                                            limit
                                        </a>
                                </li>
                                <li>
                                        <a href="#lt" 
>
                                            lt
                                        </a>
                                </li>
                                <li>
                                        <a href="#lte" 
>
                                            lte
                                        </a>
                                </li>
                                <li>
                                        <a href="#maybeSingle" 
>
                                            maybeSingle
                                        </a>
                                </li>
                                <li>
                                        <a href="#neq" 
>
                                            neq
                                        </a>
                                </li>
                                <li>
                                        <a href="#order" 
>
                                            order
                                        </a>
                                </li>
                                <li>
                                        <a href="#range" 
>
                                            range
                                        </a>
                                </li>
                                <li>
                                        <a href="#select" 
>
                                            select
                                        </a>
                                </li>
                                <li>
                                        <a href="#single" 
>
                                            single
                                        </a>
                                </li>
                                <li>
                                        <a href="#then" 
>
                                            then
                                        </a>
                                </li>
                            </ul>
                        </td>
                    </tr>
                </tbody>
            </table>
        </section>



            <section data-compodoc="block-properties">
                <h3 id="inputs">Properties</h3>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="eq"></a>
                                        <span class="name "><b>eq</b>
                                            <a href="#eq">
                                                <span class="icon ion-ios-link"></span>
                                            </a>
                                        </span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>eq:     <code>jasmine.Spy</code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>    <code>jasmine.Spy</code>

                                        </td>
                                    </tr>





                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="gt"></a>
                                        <span class="name "><b>gt</b>
                                            <a href="#gt">
                                                <span class="icon ion-ios-link"></span>
                                            </a>
                                        </span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>gt:     <code>jasmine.Spy</code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>    <code>jasmine.Spy</code>

                                        </td>
                                    </tr>





                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="gte"></a>
                                        <span class="name "><b>gte</b>
                                            <a href="#gte">
                                                <span class="icon ion-ios-link"></span>
                                            </a>
                                        </span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>gte:     <code>jasmine.Spy</code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>    <code>jasmine.Spy</code>

                                        </td>
                                    </tr>





                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="ilike"></a>
                                        <span class="name "><b>ilike</b>
                                            <a href="#ilike">
                                                <span class="icon ion-ios-link"></span>
                                            </a>
                                        </span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>ilike:     <code>jasmine.Spy</code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>    <code>jasmine.Spy</code>

                                        </td>
                                    </tr>





                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="in"></a>
                                        <span class="name "><b>in</b>
                                            <a href="#in">
                                                <span class="icon ion-ios-link"></span>
                                            </a>
                                        </span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>in:     <code>jasmine.Spy</code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>    <code>jasmine.Spy</code>

                                        </td>
                                    </tr>





                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="is"></a>
                                        <span class="name "><b>is</b>
                                            <a href="#is">
                                                <span class="icon ion-ios-link"></span>
                                            </a>
                                        </span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>is:     <code>jasmine.Spy</code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>    <code>jasmine.Spy</code>

                                        </td>
                                    </tr>





                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="like"></a>
                                        <span class="name "><b>like</b>
                                            <a href="#like">
                                                <span class="icon ion-ios-link"></span>
                                            </a>
                                        </span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>like:     <code>jasmine.Spy</code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>    <code>jasmine.Spy</code>

                                        </td>
                                    </tr>





                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="limit"></a>
                                        <span class="name "><b>limit</b>
                                            <a href="#limit">
                                                <span class="icon ion-ios-link"></span>
                                            </a>
                                        </span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>limit:     <code>jasmine.Spy</code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>    <code>jasmine.Spy</code>

                                        </td>
                                    </tr>





                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="lt"></a>
                                        <span class="name "><b>lt</b>
                                            <a href="#lt">
                                                <span class="icon ion-ios-link"></span>
                                            </a>
                                        </span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>lt:     <code>jasmine.Spy</code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>    <code>jasmine.Spy</code>

                                        </td>
                                    </tr>





                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="lte"></a>
                                        <span class="name "><b>lte</b>
                                            <a href="#lte">
                                                <span class="icon ion-ios-link"></span>
                                            </a>
                                        </span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>lte:     <code>jasmine.Spy</code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>    <code>jasmine.Spy</code>

                                        </td>
                                    </tr>





                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="maybeSingle"></a>
                                        <span class="name "><b>maybeSingle</b>
                                            <a href="#maybeSingle">
                                                <span class="icon ion-ios-link"></span>
                                            </a>
                                        </span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>maybeSingle:     <code>jasmine.Spy</code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>    <code>jasmine.Spy</code>

                                        </td>
                                    </tr>





                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="neq"></a>
                                        <span class="name "><b>neq</b>
                                            <a href="#neq">
                                                <span class="icon ion-ios-link"></span>
                                            </a>
                                        </span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>neq:     <code>jasmine.Spy</code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>    <code>jasmine.Spy</code>

                                        </td>
                                    </tr>





                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="order"></a>
                                        <span class="name "><b>order</b>
                                            <a href="#order">
                                                <span class="icon ion-ios-link"></span>
                                            </a>
                                        </span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>order:     <code>jasmine.Spy</code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>    <code>jasmine.Spy</code>

                                        </td>
                                    </tr>





                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="range"></a>
                                        <span class="name "><b>range</b>
                                            <a href="#range">
                                                <span class="icon ion-ios-link"></span>
                                            </a>
                                        </span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>range:     <code>jasmine.Spy</code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>    <code>jasmine.Spy</code>

                                        </td>
                                    </tr>





                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="select"></a>
                                        <span class="name "><b>select</b>
                                            <a href="#select">
                                                <span class="icon ion-ios-link"></span>
                                            </a>
                                        </span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>select:     <code>jasmine.Spy</code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>    <code>jasmine.Spy</code>

                                        </td>
                                    </tr>





                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="single"></a>
                                        <span class="name "><b>single</b>
                                            <a href="#single">
                                                <span class="icon ion-ios-link"></span>
                                            </a>
                                        </span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>single:     <code>jasmine.Spy</code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>    <code>jasmine.Spy</code>

                                        </td>
                                    </tr>





                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="then"></a>
                                        <span class="name "><b>then</b>
                                            <a href="#then">
                                                <span class="icon ion-ios-link"></span>
                                            </a>
                                        </span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>then:         <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/function" target="_blank" >function</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/function" target="_blank" >function</a></code>

                                        </td>
                                    </tr>





                        </tbody>
                    </table>
            </section>
    </div>


    <div class="tab-pane fade  tab-source-code" id="source">
        <pre class="line-numbers compodoc-sourcecode"><code class="language-typescript">interface SupabaseResponse&lt;T &#x3D; unknown&gt; {
  data: T | null;
  error: { message: string; code?: string } | null;
}

interface QueryBuilder {
  select: jasmine.Spy;
  eq: jasmine.Spy;
  neq: jasmine.Spy;
  gt: jasmine.Spy;
  gte: jasmine.Spy;
  lt: jasmine.Spy;
  lte: jasmine.Spy;
  like: jasmine.Spy;
  ilike: jasmine.Spy;
  in: jasmine.Spy;
  is: jasmine.Spy;
  order: jasmine.Spy;
  limit: jasmine.Spy;
  range: jasmine.Spy;
  single: jasmine.Spy;
  maybeSingle: jasmine.Spy;
  then: &lt;T&gt;(resolve: (value: SupabaseResponse&lt;T[]&gt;) &#x3D;&gt; void) &#x3D;&gt; Promise&lt;SupabaseResponse&lt;T[]&gt;&gt;;
}

/**
 * Mock factory for Supabase client used in tests
 * Provides pre-configured mocks for common RPC calls
 */
export function createSupabaseMock() {
  const rpcSpy &#x3D; jasmine.createSpy(&#x27;rpc&#x27;);
  const authSpy &#x3D; jasmine.createSpyObj(&#x27;auth&#x27;, [&#x27;getUser&#x27;]);
  const fromSpy &#x3D; jasmine.createSpy(&#x27;from&#x27;);
  const storageSpy &#x3D; jasmine.createSpyObj(&#x27;storage&#x27;, [&#x27;from&#x27;]);

  // Create a chainable query builder mock
  const createQueryBuilder &#x3D; (): QueryBuilder &#x3D;&gt; {
    const builder &#x3D; {} as QueryBuilder;

    // Define methods that return builder
    builder.select &#x3D; jasmine.createSpy(&#x27;select&#x27;).and.returnValue(builder);
    builder.eq &#x3D; jasmine.createSpy(&#x27;eq&#x27;).and.returnValue(builder);
    builder.neq &#x3D; jasmine.createSpy(&#x27;neq&#x27;).and.returnValue(builder);
    builder.gt &#x3D; jasmine.createSpy(&#x27;gt&#x27;).and.returnValue(builder);
    builder.gte &#x3D; jasmine.createSpy(&#x27;gte&#x27;).and.returnValue(builder);
    builder.lt &#x3D; jasmine.createSpy(&#x27;lt&#x27;).and.returnValue(builder);
    builder.lte &#x3D; jasmine.createSpy(&#x27;lte&#x27;).and.returnValue(builder);
    builder.like &#x3D; jasmine.createSpy(&#x27;like&#x27;).and.returnValue(builder);
    builder.ilike &#x3D; jasmine.createSpy(&#x27;ilike&#x27;).and.returnValue(builder);
    builder.in &#x3D; jasmine.createSpy(&#x27;in&#x27;).and.returnValue(builder);
    builder.is &#x3D; jasmine.createSpy(&#x27;is&#x27;).and.returnValue(builder);
    builder.order &#x3D; jasmine.createSpy(&#x27;order&#x27;).and.returnValue(builder);
    builder.limit &#x3D; jasmine.createSpy(&#x27;limit&#x27;).and.returnValue(builder);
    builder.range &#x3D; jasmine.createSpy(&#x27;range&#x27;).and.returnValue(builder);
    builder.single &#x3D; jasmine
      .createSpy(&#x27;single&#x27;)
      .and.returnValue(Promise.resolve({ data: null, error: null }));
    builder.maybeSingle &#x3D; jasmine
      .createSpy(&#x27;maybeSingle&#x27;)
      .and.returnValue(Promise.resolve({ data: null, error: null }));

    // Make builder thenable for awaiting
    builder.then &#x3D; &lt;T&gt;(resolve: (value: SupabaseResponse&lt;T[]&gt;) &#x3D;&gt; void) &#x3D;&gt; {
      resolve({ data: [] as T[], error: null });
      return Promise.resolve({ data: [] as T[], error: null });
    };

    return builder;
  };

  // Configure from() to return query builder
  fromSpy.and.callFake((_table: string) &#x3D;&gt; createQueryBuilder());

  const mock &#x3D; {
    rpc: rpcSpy,
    auth: authSpy,
    from: fromSpy,
    storage: storageSpy,
    createQueryBuilder, // Export for custom configurations
  };

  return mock;
}

// Type for RPC parameters (varies by function)
type RPCParams &#x3D; Record&lt;string, unknown&gt;;

/**
 * Configure RPC responses for availability tests
 */
export function mockAvailabilityRPCs(supabaseMock: ReturnType&lt;typeof createSupabaseMock&gt;) {
  // Mock get_available_cars RPC
  supabaseMock.rpc.and.callFake((functionName: string, params?: RPCParams) &#x3D;&gt; {
    if (functionName &#x3D;&#x3D;&#x3D; &#x27;get_available_cars&#x27;) {
      // Define mock car data - match actual RPC response structure
      const allCars &#x3D; [
        {
          id: &#x27;8a854591-3fec-4425-946e-c7bb764a7333&#x27;,
          title: &#x27;Chevrolet Onix 2025&#x27;,
          brand: &#x27;Chevrolet&#x27;,
          model: &#x27;Onix&#x27;,
          year: 2025,
          location_city: &#x27;Buenos Aires&#x27;,
          location: { city: &#x27;Buenos Aires&#x27; }, // Also for filtering
          price_per_day: 15000,
          currency: &#x27;ARS&#x27;,
          status: &#x27;available&#x27;,
          photos: [],
        },
        {
          id: &#x27;9b965692-4fed-5536-a57f-d8cc875b8444&#x27;,
          title: &#x27;Toyota Corolla 2024&#x27;,
          brand: &#x27;Toyota&#x27;,
          model: &#x27;Corolla&#x27;,
          year: 2024,
          location_city: &#x27;Córdoba&#x27;,
          location: { city: &#x27;Córdoba&#x27; }, // Also for filtering
          price_per_day: 18000,
          currency: &#x27;ARS&#x27;,
          status: &#x27;available&#x27;,
          photos: [],
        },
      ];

      let filtered &#x3D; [...allCars];

      // Filter by city (case-insensitive) - RPC doesn&#x27;t filter by city
      // The service filters after getting results
      const cityRaw &#x3D; params?.[&#x27;p_city&#x27;];
      const cityFilter &#x3D; typeof cityRaw &#x3D;&#x3D;&#x3D; &#x27;string&#x27; ? cityRaw.toLowerCase() : undefined;
      if (cityFilter) {
        filtered &#x3D; filtered.filter((car) &#x3D;&gt; car.location?.city?.toLowerCase() &#x3D;&#x3D;&#x3D; cityFilter);
      }

      // Apply pagination
      const limitRaw &#x3D; params?.[&#x27;p_limit&#x27;];
      const offsetRaw &#x3D; params?.[&#x27;p_offset&#x27;];
      const limit &#x3D; typeof limitRaw &#x3D;&#x3D;&#x3D; &#x27;number&#x27; ? limitRaw : 100;
      const offset &#x3D; typeof offsetRaw &#x3D;&#x3D;&#x3D; &#x27;number&#x27; ? offsetRaw : 0;
      filtered &#x3D; filtered.slice(offset, offset + limit);

      return Promise.resolve({ data: filtered, error: null });
    }

    if (functionName &#x3D;&#x3D;&#x3D; &#x27;is_car_available&#x27;) {
      // Return boolean directly
      return Promise.resolve({
        data: true,
        error: null,
      });
    }

    return Promise.resolve({ data: null, error: { message: &#x27;Function not mocked&#x27; } });
  });
}

/**
 * Configure RPC responses for booking logic tests
 */
export function mockBookingRPCs(supabaseMock: ReturnType&lt;typeof createSupabaseMock&gt;) {
  supabaseMock.rpc.and.callFake((functionName: string, params?: RPCParams) &#x3D;&gt; {
    if (functionName &#x3D;&#x3D;&#x3D; &#x27;request_booking&#x27; || functionName &#x3D;&#x3D;&#x3D; &#x27;create_booking_with_payment&#x27;) {
      // Validate UUID format
      const carIdRaw &#x3D; params?.[&#x27;p_car_id&#x27;] ?? params?.[&#x27;car_id&#x27;];
      if (carIdRaw &amp;&amp; typeof carIdRaw &#x3D;&#x3D;&#x3D; &#x27;string&#x27; &amp;&amp; !isValidUUID(carIdRaw)) {
        return Promise.resolve({
          data: null,
          error: { message: &#x60;invalid input syntax for type uuid: &quot;${carIdRaw}&quot;&#x60;, code: &#x27;22P02&#x27; },
        });
      }

      // Validate dates
      const startRaw &#x3D; params?.[&#x27;p_start&#x27;] ?? params?.[&#x27;start_at&#x27;];
      const endRaw &#x3D; params?.[&#x27;p_end&#x27;] ?? params?.[&#x27;end_at&#x27;];

      if (typeof startRaw &#x3D;&#x3D;&#x3D; &#x27;string&#x27; &amp;&amp; typeof endRaw &#x3D;&#x3D;&#x3D; &#x27;string&#x27;) {
        const start &#x3D; new Date(startRaw);
        const end &#x3D; new Date(endRaw);
        const now &#x3D; new Date();

        // Check if start is in the past
        if (start &lt; now) {
          return Promise.resolve({
            data: null,
            error: {
              message: &#x27;La fecha de inicio debe ser posterior a la fecha actual&#x27;,
              code: &#x27;INVALID_DATE&#x27;,
            },
          });
        }

        // Check if end is before start
        if (end &lt; start) {
          return Promise.resolve({
            data: null,
            error: {
              message: &#x27;La fecha de fin debe ser posterior a la fecha de inicio&#x27;,
              code: &#x27;INVALID_DATE_RANGE&#x27;,
            },
          });
        }

        // Check if booking is longer than 30 days
        const diffDays &#x3D; Math.ceil((end.getTime() - start.getTime()) / (1000 * 60 * 60 * 24));
        if (diffDays &gt; 30) {
          return Promise.resolve({
            data: null,
            error: {
              message: &#x27;Las reservas no pueden exceder los 30 días&#x27;,
              code: &#x27;BOOKING_TOO_LONG&#x27;,
            },
          });
        }
      }

      return Promise.resolve({
        data: &#x27;test-booking-&#x27; + Date.now(),
        error: null,
      });
    }

    if (functionName &#x3D;&#x3D;&#x3D; &#x27;check_booking_conflicts&#x27;) {
      return Promise.resolve({
        data: { has_conflicts: false, conflicting_bookings: [] },
        error: null,
      });
    }

    if (functionName &#x3D;&#x3D;&#x3D; &#x27;pricing_recalculate&#x27;) {
      return Promise.resolve({
        data: null,
        error: null,
      });
    }

    return Promise.resolve({ data: null, error: { message: &#x27;Function not mocked&#x27; } });
  });
}

// Helper to validate UUID format
function isValidUUID(uuid: string): boolean {
  const uuidRegex &#x3D; /^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i;
  return uuidRegex.test(uuid);
}

/**
 * Configure RPC responses for payments tests
 */
export function mockPaymentRPCs(supabaseMock: ReturnType&lt;typeof createSupabaseMock&gt;) {
  supabaseMock.rpc.and.callFake((functionName: string) &#x3D;&gt; {
    if (functionName &#x3D;&#x3D;&#x3D; &#x27;process_payment&#x27;) {
      return Promise.resolve({
        data: {
          payment_id: &#x27;test-payment-123&#x27;,
          status: &#x27;completed&#x27;,
        },
        error: null,
      });
    }

    if (functionName &#x3D;&#x3D;&#x3D; &#x27;create_payment_intent&#x27;) {
      return Promise.resolve({
        data: {
          intent_id: &#x27;test-intent-123&#x27;,
          client_secret: &#x27;test-secret&#x27;,
        },
        error: null,
      });
    }

    return Promise.resolve({ data: null, error: { message: &#x27;Function not mocked&#x27; } });
  });
}

/**
 * Create a comprehensive mock with all scenarios
 * Use this for most tests that need full coverage
 */
export function mockAllRPCs(supabaseMock: ReturnType&lt;typeof createSupabaseMock&gt;) {
  supabaseMock.rpc.and.callFake((functionName: string, params?: RPCParams) &#x3D;&gt; {
    // Availability RPCs
    if (functionName &#x3D;&#x3D;&#x3D; &#x27;get_available_cars&#x27;) {
      const allCars &#x3D; [
        {
          id: &#x27;8a854591-3fec-4425-946e-c7bb764a7333&#x27;,
          title: &#x27;Chevrolet Onix 2025&#x27;,
          brand: &#x27;Chevrolet&#x27;,
          model: &#x27;Onix&#x27;,
          year: 2025,
          location_city: &#x27;Buenos Aires&#x27;,
          price_per_day: 15000,
          currency: &#x27;ARS&#x27;,
          status: &#x27;available&#x27;,
          photos: [],
        },
      ];

      let filtered &#x3D; [...allCars];
      const cityRaw &#x3D; params?.[&#x27;p_city&#x27;];
      const cityFilter &#x3D; typeof cityRaw &#x3D;&#x3D;&#x3D; &#x27;string&#x27; ? cityRaw.toLowerCase() : undefined;
      if (cityFilter) {
        filtered &#x3D; filtered.filter((car) &#x3D;&gt; car.location_city.toLowerCase() &#x3D;&#x3D;&#x3D; cityFilter);
      }

      return Promise.resolve({ data: filtered, error: null });
    }

    if (functionName &#x3D;&#x3D;&#x3D; &#x27;is_car_available&#x27;) {
      return Promise.resolve({ data: true, error: null });
    }

    // Booking RPCs
    if (functionName &#x3D;&#x3D;&#x3D; &#x27;request_booking&#x27; || functionName &#x3D;&#x3D;&#x3D; &#x27;create_booking_with_payment&#x27;) {
      const carIdRaw &#x3D; params?.[&#x27;p_car_id&#x27;] ?? params?.[&#x27;car_id&#x27;];
      if (carIdRaw &amp;&amp; typeof carIdRaw &#x3D;&#x3D;&#x3D; &#x27;string&#x27; &amp;&amp; !isValidUUID(carIdRaw)) {
        return Promise.resolve({
          data: null,
          error: { message: &#x60;invalid input syntax for type uuid: &quot;${carIdRaw}&quot;&#x60;, code: &#x27;22P02&#x27; },
        });
      }

      const startRaw &#x3D; params?.[&#x27;p_start&#x27;] ?? params?.[&#x27;start_at&#x27;];
      const endRaw &#x3D; params?.[&#x27;p_end&#x27;] ?? params?.[&#x27;end_at&#x27;];

      if (typeof startRaw &#x3D;&#x3D;&#x3D; &#x27;string&#x27; &amp;&amp; typeof endRaw &#x3D;&#x3D;&#x3D; &#x27;string&#x27;) {
        const start &#x3D; new Date(startRaw);
        const end &#x3D; new Date(endRaw);
        const now &#x3D; new Date();

        if (start &lt; now) {
          return Promise.resolve({
            data: null,
            error: {
              message: &#x27;La fecha de inicio debe ser posterior a la fecha actual&#x27;,
              code: &#x27;INVALID_DATE&#x27;,
            },
          });
        }

        if (end &lt; start) {
          return Promise.resolve({
            data: null,
            error: {
              message: &#x27;La fecha de fin debe ser posterior a la fecha de inicio&#x27;,
              code: &#x27;INVALID_DATE_RANGE&#x27;,
            },
          });
        }

        const diffDays &#x3D; Math.ceil((end.getTime() - start.getTime()) / (1000 * 60 * 60 * 24));
        if (diffDays &gt; 30) {
          return Promise.resolve({
            data: null,
            error: {
              message: &#x27;Las reservas no pueden exceder los 30 días&#x27;,
              code: &#x27;BOOKING_TOO_LONG&#x27;,
            },
          });
        }
      }

      return Promise.resolve({
        data: &#x27;test-booking-&#x27; + Date.now(),
        error: null,
      });
    }

    if (functionName &#x3D;&#x3D;&#x3D; &#x27;pricing_recalculate&#x27;) {
      return Promise.resolve({ data: null, error: null });
    }

    if (functionName &#x3D;&#x3D;&#x3D; &#x27;check_booking_conflicts&#x27;) {
      return Promise.resolve({
        data: { has_conflicts: false, conflicting_bookings: [] },
        error: null,
      });
    }

    // Payment RPCs
    if (functionName &#x3D;&#x3D;&#x3D; &#x27;process_payment&#x27;) {
      return Promise.resolve({
        data: { payment_id: &#x27;test-payment-123&#x27;, status: &#x27;completed&#x27; },
        error: null,
      });
    }

    if (functionName &#x3D;&#x3D;&#x3D; &#x27;create_payment_intent&#x27;) {
      return Promise.resolve({
        data: { intent_id: &#x27;test-intent-123&#x27;, client_secret: &#x27;test-secret&#x27; },
        error: null,
      });
    }

    // Default: function not mocked
    return Promise.resolve({
      data: null,
      error: { message: &#x60;RPC function &#x27;${functionName}&#x27; not mocked&#x60;, code: &#x27;FUNCTION_NOT_MOCKED&#x27; },
    });
  });
}
</code></pre>
    </div>
</div>








                   </div><div class="search-results">
    <div class="has-results">
        <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
        <ul class="search-results-list"></ul>
    </div>
    <div class="no-results">
        <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
    </div>
</div>
</div>
               <!-- END CONTENT -->
           </div>
       </div>

          <label class="dark-mode-switch">
               <input type="checkbox">
               <span class="slider">
                    <svg class="slider-icon" viewBox="0 0 24 24" fill="none" height="20" stroke="#000" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" width="20" xmlns="http://www.w3.org/2000/svg">
                    <path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"></path>
                    </svg>
               </span>
          </label>

       <script>
            var COMPODOC_CURRENT_PAGE_DEPTH = 1;
            var COMPODOC_CURRENT_PAGE_CONTEXT = 'interface';
            var COMPODOC_CURRENT_PAGE_URL = 'QueryBuilder.html';
            var MAX_SEARCH_RESULTS = 15;
       </script>

       <script>
               $darkModeToggleSwitchers = document.querySelectorAll('.dark-mode-switch input');
               checkToggle(darkModeState);
               if ($darkModeToggleSwitchers.length > 0) {
                    for (var i = 0; i < $darkModeToggleSwitchers.length; i++) {
                         $darkModeToggleSwitchers[i].addEventListener('change', function (event) {
                              darkModeState = !darkModeState;
                              toggleDarkMode(darkModeState);
                         });
                    }
               }
          </script>

       <script src="../js/libs/custom-elements.min.js"></script>
       <script src="../js/libs/lit-html.js"></script>

       <script src="../js/menu-wc.js" defer></script>
       <script nomodule src="../js/menu-wc_es5.js" defer></script>

       <script src="../js/libs/bootstrap-native.js"></script>

       <script src="../js/libs/es6-shim.min.js"></script>
       <script src="../js/libs/EventDispatcher.js"></script>
       <script src="../js/libs/promise.min.js"></script>

       <script src="../js/compodoc.js"></script>

       <script src="../js/tabs.js"></script>
       <script src="../js/menu.js"></script>
       <script src="../js/libs/clipboard.min.js"></script>
       <script src="../js/libs/prism.js"></script>
       <script src="../js/sourceCode.js"></script>
          <script src="../js/search/search.js"></script>
          <script src="../js/search/lunr.min.js"></script>
          <script src="../js/search/search-lunr.js"></script>
          <script src="../js/search/search_index.js"></script>
       <script src="../js/lazy-load-graphs.js"></script>


    </body>
</html>
