<!doctype html>
<html class="no-js" lang="">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <title>autorenta-web documentation</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <link rel="icon" type="image/x-icon" href="../images/favicon.ico">
	   <link rel="stylesheet" href="../styles/style.css">
        <link rel="stylesheet" href="../styles/dark.css">
    </head>
    <body>
          <script>
               // Blocking script to avoid flickering dark mode
               // Dark mode toggle button
               var useDark = window.matchMedia('(prefers-color-scheme: dark)');
               var darkModeState = useDark.matches;
               var $darkModeToggleSwitchers = document.querySelectorAll('.dark-mode-switch input');
               var $darkModeToggles = document.querySelectorAll('.dark-mode-switch');
               var darkModeStateLocal = localStorage.getItem('compodoc_darkmode-state');

               function checkToggle(check) {
                    for (var i = 0; i < $darkModeToggleSwitchers.length; i++) {
                         $darkModeToggleSwitchers[i].checked = check;
                    }
               }

               function toggleDarkMode(state) {
                    if (window.localStorage) {
                         localStorage.setItem('compodoc_darkmode-state', state);
                    }

                    checkToggle(state);

                    const hasClass = document.body.classList.contains('dark');

                    if (state) {
                         for (var i = 0; i < $darkModeToggles.length; i++) {
                              $darkModeToggles[i].classList.add('dark');
                         }
                         if (!hasClass) {
                              document.body.classList.add('dark');
                         }
                    } else {
                         for (var i = 0; i < $darkModeToggles.length; i++) {
                              $darkModeToggles[i].classList.remove('dark');
                         }
                         if (hasClass) {
                              document.body.classList.remove('dark');
                         }
                    }
               }

               useDark.addEventListener('change', function (evt) {
                    toggleDarkMode(evt.matches);
               });
               if (darkModeStateLocal) {
                    darkModeState = darkModeStateLocal === 'true';
               }
               toggleDarkMode(darkModeState);
          </script>
          <script>
              // --- Iframe navigation tracking for Template Playground ---
              function sendCurrentUrlToParent() {
                  if (window.parent && window.parent !== window) {
                      window.parent.postMessage({
                          type: 'compodoc-iframe-navigate',
                          url: window.location.pathname + window.location.hash
                      }, '*');
                  }
              }
              window.addEventListener('hashchange', sendCurrentUrlToParent, false);
              window.addEventListener('popstate', sendCurrentUrlToParent, false);
              window.addEventListener('DOMContentLoaded', sendCurrentUrlToParent, false);
          </script>

        <div class="navbar navbar-default navbar-fixed-top d-md-none p-0">
               <div class="d-flex">
                    <a href="../" class="navbar-brand">autorenta-web documentation</a>
                    <button type="button" class="btn btn-default btn-menu ion-ios-menu" id="btn-menu"></button>
               </div>
        </div>

        <div class="xs-menu menu" id="mobile-menu">
                <div id="book-search-input" role="search"><input type="text" placeholder="Type to search"></div>            <compodoc-menu></compodoc-menu>
        </div>

        <div class="container-fluid main">
           <div class="row main">
               <div class="d-none d-md-block menu">
                   <compodoc-menu mode="normal"></compodoc-menu>
               </div>
               <!-- START CONTENT -->
               <div class="content interface">
                   <div class="content-data">

















<ol class="breadcrumb">
  <li class="breadcrumb-item">Interfaces</li>
  <li class="breadcrumb-item"
  >
  UserConsents</li>
</ol>

<ul class="nav nav-tabs" role="tablist">
        <li class="nav-item">
            <a href="#info" 
                class="nav-link"
                class="nav-link active"
                role="tab" id="info-tab" data-bs-toggle="tab" data-link="info">Info</a>
        </li>
        <li class="nav-item">
            <a href="#source" 
                class="nav-link"
                
                role="tab" id="source-tab" data-bs-toggle="tab" data-link="source">Source</a>
        </li>
</ul>

<div class="tab-content">
    <div class="tab-pane fade active in" id="info">
        <p class="comment">
            <h3>File</h3>
        </p>
        <p class="comment">
            <code>src/app/core/models/booking-detail-payment.model.ts</code>
        </p>


            <p class="comment">
                <h3>Description</h3>
            </p>
            <p class="comment">
                <p>Consentimientos del usuario</p>

            </p>


        <section data-compodoc="block-index">
            <h3 id="index">Index</h3>
            <table class="table table-sm table-bordered index-table">
                <tbody>
                    <tr>
                        <td class="col-md-4">
                            <h6><b>Properties</b></h6>
                        </td>
                    </tr>
                    <tr>
                        <td class="col-md-4">
                            <ul class="index-list">
                                <li>
                                        <a href="#cardOnFileAccepted" 
>
                                            cardOnFileAccepted
                                        </a>
                                </li>
                                <li>
                                            <span class="modifier">Optional</span>
                                        <a href="#cardOnFileAcceptedAt" 
>
                                            cardOnFileAcceptedAt
                                        </a>
                                </li>
                                <li>
                                        <a href="#privacyPolicyAccepted" 
>
                                            privacyPolicyAccepted
                                        </a>
                                </li>
                                <li>
                                            <span class="modifier">Optional</span>
                                        <a href="#privacyPolicyAcceptedAt" 
>
                                            privacyPolicyAcceptedAt
                                        </a>
                                </li>
                                <li>
                                        <a href="#termsAccepted" 
>
                                            termsAccepted
                                        </a>
                                </li>
                                <li>
                                            <span class="modifier">Optional</span>
                                        <a href="#termsAcceptedAt" 
>
                                            termsAcceptedAt
                                        </a>
                                </li>
                            </ul>
                        </td>
                    </tr>
                </tbody>
            </table>
        </section>



            <section data-compodoc="block-properties">
                <h3 id="inputs">Properties</h3>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="cardOnFileAccepted"></a>
                                        <span class="name "><b>cardOnFileAccepted</b>
                                            <a href="#cardOnFileAccepted">
                                                <span class="icon ion-ios-link"></span>
                                            </a>
                                        </span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>cardOnFileAccepted:         <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/boolean" target="_blank" >boolean</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/boolean" target="_blank" >boolean</a></code>

                                        </td>
                                    </tr>





                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="cardOnFileAcceptedAt"></a>
                                        <span class="name "><b>cardOnFileAcceptedAt</b>
                                            <a href="#cardOnFileAcceptedAt">
                                                <span class="icon ion-ios-link"></span>
                                            </a>
                                        </span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>cardOnFileAcceptedAt:         <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Date" target="_blank" >Date</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Date" target="_blank" >Date</a></code>

                                        </td>
                                    </tr>

                                    <tr>
                                        <td class="col-md-4">
                                            <i>Optional</i>
                                        </td>
                                    </tr>




                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="privacyPolicyAccepted"></a>
                                        <span class="name "><b>privacyPolicyAccepted</b>
                                            <a href="#privacyPolicyAccepted">
                                                <span class="icon ion-ios-link"></span>
                                            </a>
                                        </span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>privacyPolicyAccepted:         <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/boolean" target="_blank" >boolean</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/boolean" target="_blank" >boolean</a></code>

                                        </td>
                                    </tr>





                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="privacyPolicyAcceptedAt"></a>
                                        <span class="name "><b>privacyPolicyAcceptedAt</b>
                                            <a href="#privacyPolicyAcceptedAt">
                                                <span class="icon ion-ios-link"></span>
                                            </a>
                                        </span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>privacyPolicyAcceptedAt:         <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Date" target="_blank" >Date</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Date" target="_blank" >Date</a></code>

                                        </td>
                                    </tr>

                                    <tr>
                                        <td class="col-md-4">
                                            <i>Optional</i>
                                        </td>
                                    </tr>




                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="termsAccepted"></a>
                                        <span class="name "><b>termsAccepted</b>
                                            <a href="#termsAccepted">
                                                <span class="icon ion-ios-link"></span>
                                            </a>
                                        </span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>termsAccepted:         <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/boolean" target="_blank" >boolean</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/boolean" target="_blank" >boolean</a></code>

                                        </td>
                                    </tr>





                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="termsAcceptedAt"></a>
                                        <span class="name "><b>termsAcceptedAt</b>
                                            <a href="#termsAcceptedAt">
                                                <span class="icon ion-ios-link"></span>
                                            </a>
                                        </span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>termsAcceptedAt:         <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Date" target="_blank" >Date</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Date" target="_blank" >Date</a></code>

                                        </td>
                                    </tr>

                                    <tr>
                                        <td class="col-md-4">
                                            <i>Optional</i>
                                        </td>
                                    </tr>




                        </tbody>
                    </table>
            </section>
    </div>


    <div class="tab-pane fade  tab-source-code" id="source">
        <pre class="line-numbers compodoc-sourcecode"><code class="language-typescript">export type PaymentMode &#x3D; &#x27;card&#x27; | &#x27;wallet&#x27;;

export type CoverageUpgrade &#x3D; &#x27;standard&#x27; | &#x27;premium50&#x27; | &#x27;zero&#x27;;

export type BucketType &#x3D; &#x27;economy&#x27; | &#x27;standard&#x27; | &#x27;premium&#x27; | &#x27;luxury&#x27;;

export type CountryCode &#x3D; &#x27;AR&#x27; | &#x27;CO&#x27; | &#x27;MX&#x27;;

export type CurrencyCode &#x3D; &#x27;USD&#x27; | &#x27;ARS&#x27; | &#x27;COP&#x27; | &#x27;MXN&#x27;;

// &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;
// INPUT DE BOOKING
// &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;

/**
 * Input inicial del usuario para crear la reserva
 */
export interface BookingInput {
  carId: string;
  startDate: Date;
  endDate: Date;
  bucket: BucketType;
  vehicleValueUsd: number;
  country: CountryCode;
  userId?: string;
}

/**
 * Cálculo de días y fechas
 */
export interface BookingDates {
  startDate: Date;
  endDate: Date;
  totalDays: number;
  totalHours: number;
}

// &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;
// FX SNAPSHOT
// &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;

/**
 * Snapshot del tipo de cambio en un momento específico
 */
export interface FxSnapshot {
  rate: number; // ej: 1000.00 (1 USD &#x3D; 1000 ARS)
  timestamp: Date;
  fromCurrency: CurrencyCode; // USD
  toCurrency: CurrencyCode; // ARS
  expiresAt: Date; // timestamp + 7 días
  isExpired: boolean;
  variationThreshold: number; // 0.10 (±10%)
}

/**
 * Versión DB del FX snapshot
 */
export interface FxSnapshotDb {
  rate: number;
  timestamp: string;
  from_currency: string;
  to_currency: string;
  expires_at: string;
}

// &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;
// RISK SNAPSHOT
// &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;

/**
 * Snapshot de riesgo calculado para Argentina
 */
export interface RiskSnapshot {
  // Franquicias base (USD)
  deductibleUsd: number; // Franquicia estándar por daño/robo
  rolloverDeductibleUsd: number; // Franquicia por vuelco (2× estándar)

  // Modalidad con tarjeta
  holdEstimatedArs: number; // Hold/preautorización estimado en ARS
  holdEstimatedUsd: number; // Hold en USD (referencia)

  // Modalidad sin tarjeta
  creditSecurityUsd: number; // Crédito de Seguridad requerido (300 o 500)

  // Metadata
  bucket: BucketType;
  vehicleValueUsd: number;
  country: CountryCode;
  fxRate: number;
  calculatedAt: Date;

  // Upgrade de cobertura aplicado
  coverageUpgrade: CoverageUpgrade;
}

/**
 * Parámetros para calcular risk snapshot
 */
export interface CalculateRiskSnapshotParams {
  vehicleValueUsd: number;
  bucket: BucketType;
  country: CountryCode;
  fxRate: number;
  coverageUpgrade?: CoverageUpgrade;
  distanceKm?: number; // ✅ NEW: Distance for distance-based guarantees
}

/**
 * Versión persistida en DB
 */
export interface BookingRiskSnapshotDb {
  id: string;
  booking_id: string;
  country_code: string;
  bucket: string;

  // FX
  fx_snapshot: number;
  currency: string;

  // Garantías estimadas
  estimated_hold_amount_ars?: number;
  estimated_credit_security_usd?: number;

  // Franquicias (USD)
  deductible_usd: number;
  rollover_deductible_usd: number;

  // Flags
  payment_mode: string;
  coverage_upgrade: string;

  // Metadata
  meta?: Record&lt;string, unknown&gt;;
  created_at: string;
}

// &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;
// PRICE BREAKDOWN
// &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;

/**
 * Desglose de precios de la reserva
 */
export interface PriceBreakdown {
  // Tarifa base
  dailyRateUsd: number;
  totalDays: number;
  subtotalUsd: number;

  // Fees y cargos
  fgoContributionUsd: number; // α% (ej: 15% del subtotal)
  platformFeeUsd: number; // Fee de plataforma
  insuranceFeeUsd: number; // Seguro (si aplica)

  // Upgrades
  coverageUpgradeUsd: number; // Costo del upgrade de cobertura

  // ✅ NEW: Distance-based pricing
  deliveryFeeUsd?: number; // Fee de entrega/delivery
  distanceKm?: number; // Distancia al auto
  distanceTier?: &#x27;local&#x27; | &#x27;regional&#x27; | &#x27;long_distance&#x27;; // Tier de distancia

  // Total
  totalUsd: number;
  totalArs: number;

  // FX
  fxRate: number;
}

/**
 * Parámetros para calcular pricing
 */
export interface CalculatePricingParams {
  carId: string;
  dailyRateUsd: number;
  startDate: Date;
  endDate: Date;
  bucket: BucketType;
  coverageUpgrade: CoverageUpgrade;
  fxRate: number;
}

// &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;
// PAYMENT AUTHORIZATION
// &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;

/**
 * Autorización de pago (preautorización/hold)
 */
export interface PaymentAuthorization {
  authorizedPaymentId: string;
  amountArs: number;
  amountUsd: number;
  currency: CurrencyCode;
  expiresAt: Date;
  status: &#x27;pending&#x27; | &#x27;authorized&#x27; | &#x27;expired&#x27; | &#x27;failed&#x27;;
  paymentMethodId?: string;
  cardLast4?: string;
  createdAt: Date;
}

/**
 * Resultado de autorización
 */
export interface AuthorizePaymentResult {
  ok: boolean;
  authorizedPaymentId?: string;
  expiresAt?: Date;
  error?: string;
}

// &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;
// WALLET LOCK
// &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;

/**
 * Bloqueo de fondos en wallet (Crédito de Seguridad)
 */
export interface WalletLock {
  lockId: string;
  userId: string;
  amountUsd: number;
  reason: string;
  status: &#x27;locked&#x27; | &#x27;released&#x27; | &#x27;captured&#x27;;
  isWithdrawable: boolean; // false para Crédito de Seguridad
  createdAt: Date;
  expiresAt?: Date;
}

/**
 * Resultado de lock de wallet
 */
export interface WalletLockResult {
  ok: boolean;
  lockId?: string;
  currentBalance?: number;
  requiredAmount?: number;
  error?: string;
}

// &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;
// CONSENTS
// &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;

/**
 * Consentimientos del usuario
 */
export interface UserConsents {
  termsAccepted: boolean;
  termsAcceptedAt?: Date;
  cardOnFileAccepted: boolean; // Solo para paymentMode&#x3D;&#x27;card&#x27;
  cardOnFileAcceptedAt?: Date;
  privacyPolicyAccepted: boolean;
  privacyPolicyAcceptedAt?: Date;
}

// &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;
// UI STATE
// &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;

/**
 * Estado de UI global de la página
 */
export interface BookingDetailPaymentState {
  // Input del usuario
  bookingInput: BookingInput | null;

  // Snapshots
  fxSnapshot: FxSnapshot | null;
  riskSnapshot: RiskSnapshot | null;

  // Pricing
  priceBreakdown: PriceBreakdown | null;

  // Modalidad de pago
  paymentMode: PaymentMode;

  // Upgrade de cobertura
  coverageUpgrade: CoverageUpgrade;

  // Autorizaciones
  paymentAuthorization: PaymentAuthorization | null;
  walletLock: WalletLock | null;

  // Consentimientos
  consents: UserConsents;

  // UI
  loading: boolean;
  error: string | null;
  step: &#x27;input&#x27; | &#x27;authorization&#x27; | &#x27;confirmation&#x27; | &#x27;complete&#x27;;

  // Validaciones
  canProceed: boolean;
}

// &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;
// BOOKING CREATION
// &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;

/**
 * Parámetros para crear booking
 */
export interface CreateBookingParams {
  bookingInput: BookingInput;
  riskSnapshotId: string;
  paymentMode: PaymentMode;

  // Si paymentMode&#x3D;&#x27;card&#x27;
  authorizedPaymentId?: string;

  // Si paymentMode&#x3D;&#x27;wallet&#x27;
  walletLockId?: string;

  // Pricing
  priceBreakdownUsd: number;
  priceBreakdownArs: number;

  // Upgrades
  coverageUpgrade: CoverageUpgrade;

  // Consents
  consents: UserConsents;

  // Idempotencia
  idempotencyKey: string;
}

/**
 * Resultado de creación de booking
 */
export interface CreateBookingResult {
  ok: boolean;
  bookingId?: string;
  riskSnapshotId?: string;
  paymentRef?: string;
  error?: string;
  voucher?: BookingVoucher;
}

/**
 * Voucher de confirmación
 */
export interface BookingVoucher {
  bookingId: string;
  confirmationCode: string;
  carName: string;
  startDate: Date;
  endDate: Date;
  totalAmountUsd: number;
  totalAmountArs: number;
  paymentMode: PaymentMode;
  deductibleUsd: number;
  createdAt: Date;
}

// &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;
// VALIDATION ERRORS
// &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;

/**
 * Errores de validación
 */
export interface ValidationError {
  field: string;
  message: string;
  code: string;
}

/**
 * Tipos de errores comunes
 */
export const ValidationErrorCodes &#x3D; {
  FX_EXPIRED: &#x27;fx_expired&#x27;,
  FX_VARIATION_EXCEEDED: &#x27;fx_variation_exceeded&#x27;,
  PAYMENT_NOT_AUTHORIZED: &#x27;payment_not_authorized&#x27;,
  WALLET_INSUFFICIENT: &#x27;wallet_insufficient&#x27;,
  TERMS_NOT_ACCEPTED: &#x27;terms_not_accepted&#x27;,
  CARD_ON_FILE_NOT_ACCEPTED: &#x27;card_on_file_not_accepted&#x27;,
  AUTHORIZATION_EXPIRED: &#x27;authorization_expired&#x27;,
} as const;

// &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;
// HELPERS
// &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;

/**
 * Calcula franquicia estándar por valor de vehículo (Argentina)
 */
export function calculateDeductibleUsd(vehicleValueUsd: number): number {
  if (vehicleValueUsd &lt;&#x3D; 10000) return 1000;
  if (vehicleValueUsd &lt;&#x3D; 20000) return 1500;
  if (vehicleValueUsd &lt;&#x3D; 40000) return 2000;
  return 2500;
}

/**
 * Aplica upgrade de cobertura a la franquicia
 */
export function applyUpgradeToDeductible(baseDeductible: number, upgrade: CoverageUpgrade): number {
  switch (upgrade) {
    case &#x27;premium50&#x27;:
      return baseDeductible * 0.5; // -50%
    case &#x27;zero&#x27;:
      return 0; // Franquicia cero
    case &#x27;standard&#x27;:
    default:
      return baseDeductible;
  }
}

/**
 * Calcula hold estimado para Argentina (modalidad con tarjeta)
 */
export function calculateHoldEstimatedArs(
  rolloverDeductibleUsd: number,
  fxRate: number,
  bucket: BucketType,
): number {
  // Mínimo por bucket (en USD, se convierte a ARS)
  const minBucketUsd: Record&lt;BucketType, number&gt; &#x3D; {
    economy: 750, // USD 750 mínimo para economy
    standard: 900, // USD 900 mínimo para standard
    premium: 1200, // USD 1200 mínimo para premium
    luxury: 1800, // USD 1800 mínimo para luxury
  };

  // Hold calculado: 35% del rollover deductible
  const calculatedHoldUsd &#x3D; 0.35 * rolloverDeductibleUsd;

  // Tomar el mayor entre el mínimo del bucket y el calculado
  const finalHoldUsd &#x3D; Math.max(minBucketUsd[bucket], calculatedHoldUsd);

  // Convertir a ARS
  return finalHoldUsd * fxRate;
}

/**
 * Calcula Crédito de Seguridad requerido (modalidad sin tarjeta)
 */
export function calculateCreditSecurityUsd(_vehicleValueUsd: number): number {
  return 600;
}

/**
 * Verifica si FX está expirado
 */
export function isFxExpired(fxSnapshot: FxSnapshot): boolean {
  return fxSnapshot.isExpired || new Date() &gt; fxSnapshot.expiresAt;
}

/**
 * Verifica si la variación de FX excede el umbral
 */
export function isFxVariationExceeded(
  oldRate: number,
  newRate: number,
  threshold: number &#x3D; 0.1,
): boolean {
  const variation &#x3D; Math.abs((newRate - oldRate) / oldRate);
  return variation &gt; threshold;
}

/**
 * Calcula días totales de una reserva
 */
export function calculateTotalDays(startDate: Date, endDate: Date): number {
  const diffMs &#x3D; endDate.getTime() - startDate.getTime();
  return Math.ceil(diffMs / (1000 * 60 * 60 * 24));
}

/**
 * Formatea monto en ARS
 */
export function formatArs(amount: number): string {
  return new Intl.NumberFormat(&#x27;es-AR&#x27;, {
    style: &#x27;currency&#x27;,
    currency: &#x27;ARS&#x27;,
    minimumFractionDigits: 0,
    maximumFractionDigits: 0,
  }).format(amount);
}

/**
 * Formatea monto en USD
 */
export function formatUsd(amount: number): string {
  return new Intl.NumberFormat(&#x27;es-AR&#x27;, {
    style: &#x27;currency&#x27;,
    currency: &#x27;USD&#x27;,
    minimumFractionDigits: 2,
    maximumFractionDigits: 2,
  }).format(amount);
}

/**
 * Genera idempotency key único
 */
export function generateIdempotencyKey(): string {
  return &#x60;booking_${Date.now()}_${Math.random().toString(36).substr(2, 9)}&#x60;;
}

/**
 * Obtiene nombre legible del upgrade
 */
export function getCoverageUpgradeName(upgrade: CoverageUpgrade): string {
  const names: Record&lt;CoverageUpgrade, string&gt; &#x3D; {
    standard: &#x27;Estándar&#x27;,
    premium50: &#x27;Seguro Premium (-50% franquicia)&#x27;,
    zero: &#x27;Franquicia Cero&#x27;,
  };
  return names[upgrade];
}

/**
 * Obtiene costo del upgrade (% del subtotal)
 */
export function getCoverageUpgradeCost(upgrade: CoverageUpgrade, subtotalUsd: number): number {
  switch (upgrade) {
    case &#x27;premium50&#x27;:
      return subtotalUsd * 0.1; // +10%
    case &#x27;zero&#x27;:
      return subtotalUsd * 0.2; // +20%
    case &#x27;standard&#x27;:
    default:
      return 0;
  }
}

/**
 * Valida que todos los consentimientos estén aceptados
 */
export function validateConsents(
  consents: UserConsents,
  paymentMode: PaymentMode,
): ValidationError[] {
  const errors: ValidationError[] &#x3D; [];

  if (!consents.termsAccepted) {
    errors.push({
      field: &#x27;termsAccepted&#x27;,
      message: &#x27;Debe aceptar los Términos y Condiciones&#x27;,
      code: ValidationErrorCodes.TERMS_NOT_ACCEPTED,
    });
  }

  if (paymentMode &#x3D;&#x3D;&#x3D; &#x27;card&#x27; &amp;&amp; !consents.cardOnFileAccepted) {
    errors.push({
      field: &#x27;cardOnFileAccepted&#x27;,
      message: &#x27;Debe aceptar guardar la tarjeta para cargos diferidos&#x27;,
      code: ValidationErrorCodes.CARD_ON_FILE_NOT_ACCEPTED,
    });
  }

  return errors;
}

/**
 * Valida que la autorización de pago sea válida
 */
export function validatePaymentAuthorization(
  authorization: PaymentAuthorization | null,
): ValidationError[] {
  const errors: ValidationError[] &#x3D; [];

  if (!authorization) {
    errors.push({
      field: &#x27;paymentAuthorization&#x27;,
      message: &#x27;No se ha autorizado el pago con tarjeta&#x27;,
      code: ValidationErrorCodes.PAYMENT_NOT_AUTHORIZED,
    });
    return errors;
  }

  if (authorization.status !&#x3D;&#x3D; &#x27;authorized&#x27;) {
    errors.push({
      field: &#x27;paymentAuthorization&#x27;,
      message: &#x27;La autorización de pago no está activa&#x27;,
      code: ValidationErrorCodes.PAYMENT_NOT_AUTHORIZED,
    });
  }

  if (new Date() &gt; authorization.expiresAt) {
    errors.push({
      field: &#x27;paymentAuthorization&#x27;,
      message: &#x27;La autorización de pago ha expirado&#x27;,
      code: ValidationErrorCodes.AUTHORIZATION_EXPIRED,
    });
  }

  return errors;
}

/**
 * Valida que el wallet tenga saldo suficiente
 */
export function validateWalletBalance(
  currentBalance: number,
  requiredAmount: number,
): ValidationError[] {
  const errors: ValidationError[] &#x3D; [];

  if (currentBalance &lt; requiredAmount) {
    errors.push({
      field: &#x27;walletBalance&#x27;,
      message: &#x60;Saldo insuficiente. Necesita ${formatUsd(requiredAmount)} pero tiene ${formatUsd(currentBalance)}&#x60;,
      code: ValidationErrorCodes.WALLET_INSUFFICIENT,
    });
  }

  return errors;
}
</code></pre>
    </div>
</div>








                   </div><div class="search-results">
    <div class="has-results">
        <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
        <ul class="search-results-list"></ul>
    </div>
    <div class="no-results">
        <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
    </div>
</div>
</div>
               <!-- END CONTENT -->
           </div>
       </div>

          <label class="dark-mode-switch">
               <input type="checkbox">
               <span class="slider">
                    <svg class="slider-icon" viewBox="0 0 24 24" fill="none" height="20" stroke="#000" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" width="20" xmlns="http://www.w3.org/2000/svg">
                    <path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"></path>
                    </svg>
               </span>
          </label>

       <script>
            var COMPODOC_CURRENT_PAGE_DEPTH = 1;
            var COMPODOC_CURRENT_PAGE_CONTEXT = 'interface';
            var COMPODOC_CURRENT_PAGE_URL = 'UserConsents.html';
            var MAX_SEARCH_RESULTS = 15;
       </script>

       <script>
               $darkModeToggleSwitchers = document.querySelectorAll('.dark-mode-switch input');
               checkToggle(darkModeState);
               if ($darkModeToggleSwitchers.length > 0) {
                    for (var i = 0; i < $darkModeToggleSwitchers.length; i++) {
                         $darkModeToggleSwitchers[i].addEventListener('change', function (event) {
                              darkModeState = !darkModeState;
                              toggleDarkMode(darkModeState);
                         });
                    }
               }
          </script>

       <script src="../js/libs/custom-elements.min.js"></script>
       <script src="../js/libs/lit-html.js"></script>

       <script src="../js/menu-wc.js" defer></script>
       <script nomodule src="../js/menu-wc_es5.js" defer></script>

       <script src="../js/libs/bootstrap-native.js"></script>

       <script src="../js/libs/es6-shim.min.js"></script>
       <script src="../js/libs/EventDispatcher.js"></script>
       <script src="../js/libs/promise.min.js"></script>

       <script src="../js/compodoc.js"></script>

       <script src="../js/tabs.js"></script>
       <script src="../js/menu.js"></script>
       <script src="../js/libs/clipboard.min.js"></script>
       <script src="../js/libs/prism.js"></script>
       <script src="../js/sourceCode.js"></script>
          <script src="../js/search/search.js"></script>
          <script src="../js/search/lunr.min.js"></script>
          <script src="../js/search/search-lunr.js"></script>
          <script src="../js/search/search_index.js"></script>
       <script src="../js/lazy-load-graphs.js"></script>


    </body>
</html>
