<!doctype html>
<html class="no-js" lang="">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <title>autorenta-web documentation</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <link rel="icon" type="image/x-icon" href="../images/favicon.ico">
	   <link rel="stylesheet" href="../styles/style.css">
        <link rel="stylesheet" href="../styles/dark.css">
    </head>
    <body>
          <script>
               // Blocking script to avoid flickering dark mode
               // Dark mode toggle button
               var useDark = window.matchMedia('(prefers-color-scheme: dark)');
               var darkModeState = useDark.matches;
               var $darkModeToggleSwitchers = document.querySelectorAll('.dark-mode-switch input');
               var $darkModeToggles = document.querySelectorAll('.dark-mode-switch');
               var darkModeStateLocal = localStorage.getItem('compodoc_darkmode-state');

               function checkToggle(check) {
                    for (var i = 0; i < $darkModeToggleSwitchers.length; i++) {
                         $darkModeToggleSwitchers[i].checked = check;
                    }
               }

               function toggleDarkMode(state) {
                    if (window.localStorage) {
                         localStorage.setItem('compodoc_darkmode-state', state);
                    }

                    checkToggle(state);

                    const hasClass = document.body.classList.contains('dark');

                    if (state) {
                         for (var i = 0; i < $darkModeToggles.length; i++) {
                              $darkModeToggles[i].classList.add('dark');
                         }
                         if (!hasClass) {
                              document.body.classList.add('dark');
                         }
                    } else {
                         for (var i = 0; i < $darkModeToggles.length; i++) {
                              $darkModeToggles[i].classList.remove('dark');
                         }
                         if (hasClass) {
                              document.body.classList.remove('dark');
                         }
                    }
               }

               useDark.addEventListener('change', function (evt) {
                    toggleDarkMode(evt.matches);
               });
               if (darkModeStateLocal) {
                    darkModeState = darkModeStateLocal === 'true';
               }
               toggleDarkMode(darkModeState);
          </script>
          <script>
              // --- Iframe navigation tracking for Template Playground ---
              function sendCurrentUrlToParent() {
                  if (window.parent && window.parent !== window) {
                      window.parent.postMessage({
                          type: 'compodoc-iframe-navigate',
                          url: window.location.pathname + window.location.hash
                      }, '*');
                  }
              }
              window.addEventListener('hashchange', sendCurrentUrlToParent, false);
              window.addEventListener('popstate', sendCurrentUrlToParent, false);
              window.addEventListener('DOMContentLoaded', sendCurrentUrlToParent, false);
          </script>

        <div class="navbar navbar-default navbar-fixed-top d-md-none p-0">
               <div class="d-flex">
                    <a href="../" class="navbar-brand">autorenta-web documentation</a>
                    <button type="button" class="btn btn-default btn-menu ion-ios-menu" id="btn-menu"></button>
               </div>
        </div>

        <div class="xs-menu menu" id="mobile-menu">
                <div id="book-search-input" role="search"><input type="text" placeholder="Type to search"></div>            <compodoc-menu></compodoc-menu>
        </div>

        <div class="container-fluid main">
           <div class="row main">
               <div class="d-none d-md-block menu">
                   <compodoc-menu mode="normal"></compodoc-menu>
               </div>
               <!-- START CONTENT -->
               <div class="content interface">
                   <div class="content-data">

















<ol class="breadcrumb">
  <li class="breadcrumb-item">Interfaces</li>
  <li class="breadcrumb-item"
  >
  TimelineStep</li>
</ol>

<ul class="nav nav-tabs" role="tablist">
        <li class="nav-item">
            <a href="#info" 
                class="nav-link"
                class="nav-link active"
                role="tab" id="info-tab" data-bs-toggle="tab" data-link="info">Info</a>
        </li>
        <li class="nav-item">
            <a href="#source" 
                class="nav-link"
                
                role="tab" id="source-tab" data-bs-toggle="tab" data-link="source">Source</a>
        </li>
</ul>

<div class="tab-content">
    <div class="tab-pane fade active in" id="info">
        <p class="comment">
            <h3>File</h3>
        </p>
        <p class="comment">
            <code>src/app/shared/components/booking-confirmation-timeline/booking-confirmation-timeline.component.ts</code>
        </p>


            <p class="comment">
                <h3>Description</h3>
            </p>
            <p class="comment">
                <p>Timeline step interface</p>

            </p>


        <section data-compodoc="block-index">
            <h3 id="index">Index</h3>
            <table class="table table-sm table-bordered index-table">
                <tbody>
                    <tr>
                        <td class="col-md-4">
                            <h6><b>Properties</b></h6>
                        </td>
                    </tr>
                    <tr>
                        <td class="col-md-4">
                            <ul class="index-list">
                                <li>
                                            <span class="modifier">Optional</span>
                                        <a href="#actionDescription" 
>
                                            actionDescription
                                        </a>
                                </li>
                                <li>
                                            <span class="modifier">Optional</span>
                                        <a href="#actionLabel" 
>
                                            actionLabel
                                        </a>
                                </li>
                                <li>
                                        <a href="#actor" 
>
                                            actor
                                        </a>
                                </li>
                                <li>
                                        <a href="#actorId" 
>
                                            actorId
                                        </a>
                                </li>
                                <li>
                                        <a href="#completed" 
>
                                            completed
                                        </a>
                                </li>
                                <li>
                                        <a href="#description" 
>
                                            description
                                        </a>
                                </li>
                                <li>
                                            <span class="modifier">Optional</span>
                                        <a href="#isConditional" 
>
                                            isConditional
                                        </a>
                                </li>
                                <li>
                                        <a href="#key" 
>
                                            key
                                        </a>
                                </li>
                                <li>
                                        <a href="#label" 
>
                                            label
                                        </a>
                                </li>
                                <li>
                                            <span class="modifier">Optional</span>
                                        <a href="#metadata" 
>
                                            metadata
                                        </a>
                                </li>
                                <li>
                                            <span class="modifier">Optional</span>
                                        <a href="#requiresAction" 
>
                                            requiresAction
                                        </a>
                                </li>
                                <li>
                                        <a href="#timestamp" 
>
                                            timestamp
                                        </a>
                                </li>
                            </ul>
                        </td>
                    </tr>
                </tbody>
            </table>
        </section>



            <section data-compodoc="block-properties">
                <h3 id="inputs">Properties</h3>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="actionDescription"></a>
                                        <span class="name "><b>actionDescription</b>
                                            <a href="#actionDescription">
                                                <span class="icon ion-ios-link"></span>
                                            </a>
                                        </span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>actionDescription:         <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>

                                        </td>
                                    </tr>

                                    <tr>
                                        <td class="col-md-4">
                                            <i>Optional</i>
                                        </td>
                                    </tr>




                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="actionLabel"></a>
                                        <span class="name "><b>actionLabel</b>
                                            <a href="#actionLabel">
                                                <span class="icon ion-ios-link"></span>
                                            </a>
                                        </span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>actionLabel:         <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>

                                        </td>
                                    </tr>

                                    <tr>
                                        <td class="col-md-4">
                                            <i>Optional</i>
                                        </td>
                                    </tr>




                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="actor"></a>
                                        <span class="name "><b>actor</b>
                                            <a href="#actor">
                                                <span class="icon ion-ios-link"></span>
                                            </a>
                                        </span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>actor:     <code>string | null</code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>    <code>string | null</code>

                                        </td>
                                    </tr>





                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="actorId"></a>
                                        <span class="name "><b>actorId</b>
                                            <a href="#actorId">
                                                <span class="icon ion-ios-link"></span>
                                            </a>
                                        </span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>actorId:     <code>string | null</code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>    <code>string | null</code>

                                        </td>
                                    </tr>





                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="completed"></a>
                                        <span class="name "><b>completed</b>
                                            <a href="#completed">
                                                <span class="icon ion-ios-link"></span>
                                            </a>
                                        </span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>completed:         <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/boolean" target="_blank" >boolean</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/boolean" target="_blank" >boolean</a></code>

                                        </td>
                                    </tr>





                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="description"></a>
                                        <span class="name "><b>description</b>
                                            <a href="#description">
                                                <span class="icon ion-ios-link"></span>
                                            </a>
                                        </span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>description:         <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>

                                        </td>
                                    </tr>





                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="isConditional"></a>
                                        <span class="name "><b>isConditional</b>
                                            <a href="#isConditional">
                                                <span class="icon ion-ios-link"></span>
                                            </a>
                                        </span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>isConditional:         <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/boolean" target="_blank" >boolean</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/boolean" target="_blank" >boolean</a></code>

                                        </td>
                                    </tr>

                                    <tr>
                                        <td class="col-md-4">
                                            <i>Optional</i>
                                        </td>
                                    </tr>




                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="key"></a>
                                        <span class="name "><b>key</b>
                                            <a href="#key">
                                                <span class="icon ion-ios-link"></span>
                                            </a>
                                        </span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>key:         <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>

                                        </td>
                                    </tr>





                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="label"></a>
                                        <span class="name "><b>label</b>
                                            <a href="#label">
                                                <span class="icon ion-ios-link"></span>
                                            </a>
                                        </span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>label:         <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>

                                        </td>
                                    </tr>





                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="metadata"></a>
                                        <span class="name "><b>metadata</b>
                                            <a href="#metadata">
                                                <span class="icon ion-ios-link"></span>
                                            </a>
                                        </span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>metadata:     <code>literal type</code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>    <code>literal type</code>

                                        </td>
                                    </tr>

                                    <tr>
                                        <td class="col-md-4">
                                            <i>Optional</i>
                                        </td>
                                    </tr>




                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="requiresAction"></a>
                                        <span class="name "><b>requiresAction</b>
                                            <a href="#requiresAction">
                                                <span class="icon ion-ios-link"></span>
                                            </a>
                                        </span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>requiresAction:         <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/boolean" target="_blank" >boolean</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/boolean" target="_blank" >boolean</a></code>

                                        </td>
                                    </tr>

                                    <tr>
                                        <td class="col-md-4">
                                            <i>Optional</i>
                                        </td>
                                    </tr>




                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="timestamp"></a>
                                        <span class="name "><b>timestamp</b>
                                            <a href="#timestamp">
                                                <span class="icon ion-ios-link"></span>
                                            </a>
                                        </span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>timestamp:     <code>string | null</code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>    <code>string | null</code>

                                        </td>
                                    </tr>





                        </tbody>
                    </table>
            </section>
    </div>


    <div class="tab-pane fade  tab-source-code" id="source">
        <pre class="line-numbers compodoc-sourcecode"><code class="language-typescript">import { CommonModule } from &#x27;@angular/common&#x27;;
import { Component, computed, inject, input, output, Signal } from &#x27;@angular/core&#x27;;
import { TranslateModule } from &#x27;@ngx-translate/core&#x27;;
import { Booking } from &#x27;../../../core/models&#x27;;
import { AuthService } from &#x27;../../../core/services/auth.service&#x27;;
import { BookingConfirmationService } from &#x27;../../../core/services/booking-confirmation.service&#x27;;

/**
 * Timeline step interface
 */
export interface TimelineStep {
  key: string;
  label: string;
  description: string;
  completed: boolean;
  timestamp: string | null;
  actor: string | null;
  actorId: string | null;
  isConditional?: boolean;
  requiresAction?: boolean;
  actionLabel?: string;
  actionDescription?: string;
  metadata?: {
    damageAmount?: number;
    damageDescription?: string;
  };
}

/**
 * BookingConfirmationTimelineComponent
 *
 * Displays the bilateral confirmation timeline for a booking showing:
 * - All 9 stages of the booking lifecycle
 * - Completion status, timestamps, and actors for each step
 * - Action buttons for pending confirmations (role-based)
 * - Real-time updates via signals
 * - Mobile responsive design
 *
 * Usage:
 * &#x60;&#x60;&#x60;html
 * &lt;app-booking-confirmation-timeline
 *   [booking]&#x3D;&quot;booking()&quot;
 *   (confirmationRequested)&#x3D;&quot;handleConfirmation($event)&quot;
 * /&gt;
 * &#x60;&#x60;&#x60;
 */
@Component({
  selector: &#x27;app-booking-confirmation-timeline&#x27;,
  standalone: true,
  imports: [CommonModule, TranslateModule],
  templateUrl: &#x27;./booking-confirmation-timeline.component.html&#x27;,
  styleUrl: &#x27;./booking-confirmation-timeline.component.css&#x27;,
})
export class BookingConfirmationTimelineComponent {
  private readonly authService &#x3D; inject(AuthService);
  private readonly confirmationService &#x3D; inject(BookingConfirmationService);

  // &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D; INPUTS &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;
  /**
   * Booking data with all confirmation fields
   */
  booking &#x3D; input.required&lt;Booking&gt;();

  /**
   * Car owner name for display
   */
  ownerName &#x3D; input&lt;string&gt;(&#x27;el anfitrión&#x27;);

  /**
   * Renter name for display
   */
  renterName &#x3D; input&lt;string&gt;(&#x27;el locatario&#x27;);

  // &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D; OUTPUTS &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;
  /**
   * Emitted when user clicks an action button
   * Parent component handles the actual confirmation logic
   */
  confirmationRequested &#x3D; output&lt;{
    action: &#x27;owner_confirm&#x27; | &#x27;renter_confirm&#x27; | &#x27;mark_returned&#x27;;
    bookingId: string;
  }&gt;();

  // &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D; COMPUTED SIGNALS &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;

  /**
   * Current authenticated user
   */
  private readonly currentUser &#x3D; computed(() &#x3D;&gt; this.authService.session$()?.user);

  /**
   * Is current user the booking renter
   */
  readonly isRenter &#x3D; computed(() &#x3D;&gt; {
    const booking &#x3D; this.booking();
    const user &#x3D; this.currentUser();
    return booking?.renter_id &#x3D;&#x3D;&#x3D; user?.id;
  });

  /**
   * Is current user the car owner
   */
  readonly isOwner &#x3D; computed(() &#x3D;&gt; {
    const booking &#x3D; this.booking();
    const user &#x3D; this.currentUser();
    return booking?.owner_id &#x3D;&#x3D;&#x3D; user?.id;
  });

  /**
   * Timeline steps with completion status and metadata
   */
  readonly timelineSteps: Signal&lt;TimelineStep[]&gt; &#x3D; computed(() &#x3D;&gt; {
    const booking &#x3D; this.booking();
    if (!booking) return [];

    const steps: TimelineStep[] &#x3D; [
      // 1. Booking Created
      {
        key: &#x27;booking_created&#x27;,
        label: &#x27;Reserva Creada&#x27;,
        description: &#x27;El locatario solicitó la reserva&#x27;,
        completed: !!booking.created_at,
        timestamp: booking.created_at || null,
        actor: this.renterName(),
        actorId: booking.renter_id,
      },

      // 2. Payment Locked
      {
        key: &#x27;payment_locked&#x27;,
        label: &#x27;Pago Bloqueado&#x27;,
        description: &#x27;Fondos bloqueados en wallet o tarjeta autorizada&#x27;,
        completed: !!booking.paid_at || !!booking.wallet_lock_id,
        timestamp: booking.paid_at || booking.wallet_charged_at || null,
        actor: this.renterName(),
        actorId: booking.renter_id,
      },

      // 3. Car Delivered/Picked Up
      {
        key: &#x27;car_delivered&#x27;,
        label: &#x27;Vehículo Entregado&#x27;,
        description: &#x27;Check-in completado, alquiler iniciado&#x27;,
        completed:
          booking.status &#x3D;&#x3D;&#x3D; &#x27;in_progress&#x27; ||
          booking.status &#x3D;&#x3D;&#x3D; &#x27;completed&#x27; ||
          !!booking.returned_at,
        timestamp: booking.start_at,
        actor: &#x27;Ambas partes&#x27;,
        actorId: null,
      },

      // 4. Car Returned
      {
        key: &#x27;car_returned&#x27;,
        label: &#x27;Vehículo Devuelto&#x27;,
        description: &#x27;Auto devuelto físicamente&#x27;,
        completed: !!booking.returned_at,
        timestamp: booking.returned_at || null,
        actor: booking.returned_at
          ? this.isRenter()
            ? this.renterName()
            : this.ownerName()
          : null,
        actorId: booking.returned_at ? booking.renter_id : null,
        requiresAction: !booking.returned_at &amp;&amp; booking.status &#x3D;&#x3D;&#x3D; &#x27;in_progress&#x27; &amp;&amp; this.isRenter(),
        actionLabel: &#x27;Marcar como devuelto&#x27;,
        actionDescription: &#x27;Confirmar que devolviste el vehículo al propietario&#x27;,
      },

      // 5. Owner Confirms Return
      {
        key: &#x27;owner_confirms&#x27;,
        label: &#x27;Propietario Confirma&#x27;,
        description: booking.owner_reported_damages
          ? &#x60;Confirmado con daños reportados ($${booking.owner_damage_amount || 0} USD)&#x60;
          : &#x27;Vehículo recibido en buenas condiciones&#x27;,
        completed: !!booking.owner_confirmed_delivery,
        timestamp: booking.owner_confirmation_at || null,
        actor: this.ownerName(),
        actorId: booking.owner_id || null,
        requiresAction:
          !!booking.returned_at &amp;&amp; !booking.owner_confirmed_delivery &amp;&amp; this.isOwner(),
        actionLabel: &#x27;Confirmar recepción&#x27;,
        actionDescription: &#x27;Confirmar que recibiste el vehículo (con o sin daños)&#x27;,
        metadata: booking.owner_reported_damages
          ? {
              damageAmount: booking.owner_damage_amount || 0,
              damageDescription: booking.owner_damage_description || undefined,
            }
          : undefined,
      },

      // 6. Damage Report (conditional)
      {
        key: &#x27;damage_report&#x27;,
        label: &#x27;Reporte de Daños&#x27;,
        description: booking.owner_damage_description || &#x27;No se reportaron daños&#x27;,
        completed: true, // Always shown if we reach this step
        timestamp: booking.owner_confirmation_at || null,
        actor: this.ownerName(),
        actorId: booking.owner_id || null,
        isConditional: true, // Only show if damages reported
        metadata: {
          damageAmount: booking.owner_damage_amount || 0,
          damageDescription: booking.owner_damage_description || undefined,
        },
      },

      // 7. Renter Confirms Payment
      {
        key: &#x27;renter_confirms&#x27;,
        label: &#x27;Locatario Confirma&#x27;,
        description: &#x27;Confirma liberar el pago al propietario&#x27;,
        completed: !!booking.renter_confirmed_payment,
        timestamp: booking.renter_confirmation_at || null,
        actor: this.renterName(),
        actorId: booking.renter_id,
        requiresAction:
          !!booking.returned_at &amp;&amp; !booking.renter_confirmed_payment &amp;&amp; this.isRenter(),
        actionLabel: &#x27;Confirmar pago&#x27;,
        actionDescription: &#x27;Autorizar la liberación de fondos al propietario&#x27;,
      },

      // 8. Funds Released
      {
        key: &#x27;funds_released&#x27;,
        label: &#x27;Fondos Liberados&#x27;,
        description: &#x27;Pago transferido al propietario y depósito devuelto&#x27;,
        completed: !!booking.funds_released_at,
        timestamp: booking.funds_released_at || null,
        actor: &#x27;Sistema automático&#x27;,
        actorId: null,
      },

      // 9. Completed
      {
        key: &#x27;completed&#x27;,
        label: &#x27;Completado&#x27;,
        description: &#x27;Reserva finalizada exitosamente&#x27;,
        completed: booking.status &#x3D;&#x3D;&#x3D; &#x27;completed&#x27;,
        timestamp: booking.funds_released_at || booking.updated_at || null,
        actor: null,
        actorId: null,
      },
    ];

    // Filter out conditional steps if not applicable
    return steps.filter((step) &#x3D;&gt; {
      if (step.key &#x3D;&#x3D;&#x3D; &#x27;damage_report&#x27;) {
        return booking.owner_reported_damages &#x3D;&#x3D;&#x3D; true;
      }
      return true;
    });
  });

  /**
   * Current active step index
   */
  readonly currentStepIndex &#x3D; computed(() &#x3D;&gt; {
    const steps &#x3D; this.timelineSteps();
    let lastCompletedIndex &#x3D; -1;
    for (let i &#x3D; steps.length - 1; i &gt;&#x3D; 0; i--) {
      if (steps[i].completed) {
        lastCompletedIndex &#x3D; i;
        break;
      }
    }
    return lastCompletedIndex + 1; // Next step is current
  });

  /**
   * Is timeline complete
   */
  readonly isTimelineComplete &#x3D; computed(() &#x3D;&gt; {
    const booking &#x3D; this.booking();
    return booking?.status &#x3D;&#x3D;&#x3D; &#x27;completed&#x27; &amp;&amp; !!booking.funds_released_at;
  });

  /**
   * Pending action message for current user
   */
  readonly pendingActionMessage &#x3D; computed(() &#x3D;&gt; {
    const booking &#x3D; this.booking();
    const isOwner &#x3D; this.isOwner();
    const isRenter &#x3D; this.isRenter();

    if (booking?.completion_status &#x3D;&#x3D;&#x3D; &#x27;pending_owner&#x27; &amp;&amp; isOwner) {
      return &#x27;Esperando tu confirmación como propietario&#x27;;
    }
    if (booking?.completion_status &#x3D;&#x3D;&#x3D; &#x27;pending_renter&#x27; &amp;&amp; isRenter) {
      return &#x27;Esperando tu confirmación como locatario&#x27;;
    }
    if (booking?.completion_status &#x3D;&#x3D;&#x3D; &#x27;pending_both&#x27;) {
      if (isOwner &amp;&amp; !booking.owner_confirmed_delivery) {
        return &#x27;Esperando tu confirmación como propietario&#x27;;
      }
      if (isRenter &amp;&amp; !booking.renter_confirmed_payment) {
        return &#x27;Esperando tu confirmación como locatario&#x27;;
      }
    }
    return null;
  });

  // &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D; PUBLIC METHODS &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;

  /**
   * Format timestamp to human readable date
   */
  formatTimestamp(timestamp: string | null): string {
    if (!timestamp) return &#x27;Pendiente&#x27;;

    const date &#x3D; new Date(timestamp);
    return new Intl.DateTimeFormat(&#x27;es-AR&#x27;, {
      day: &#x27;2-digit&#x27;,
      month: &#x27;short&#x27;,
      year: &#x27;numeric&#x27;,
      hour: &#x27;2-digit&#x27;,
      minute: &#x27;2-digit&#x27;,
    }).format(date);
  }

  /**
   * Handle action button click
   */
  handleAction(step: TimelineStep): void {
    const booking &#x3D; this.booking();
    if (!booking) return;

    let action: &#x27;owner_confirm&#x27; | &#x27;renter_confirm&#x27; | &#x27;mark_returned&#x27;;

    switch (step.key) {
      case &#x27;car_returned&#x27;:
        action &#x3D; &#x27;mark_returned&#x27;;
        break;
      case &#x27;owner_confirms&#x27;:
        action &#x3D; &#x27;owner_confirm&#x27;;
        break;
      case &#x27;renter_confirms&#x27;:
        action &#x3D; &#x27;renter_confirm&#x27;;
        break;
      default:
        return;
    }

    this.confirmationRequested.emit({
      action,
      bookingId: booking.id,
    });
  }

  /**
   * Check if step is completed
   */
  isStepCompleted(index: number): boolean {
    const currentIndex &#x3D; this.currentStepIndex();
    return index &lt; currentIndex;
  }

  /**
   * Check if step is current
   */
  isStepCurrent(index: number): boolean {
    return index &#x3D;&#x3D;&#x3D; this.currentStepIndex();
  }

  /**
   * Check if step is upcoming
   */
  isStepUpcoming(index: number): boolean {
    const currentIndex &#x3D; this.currentStepIndex();
    return index &gt; currentIndex;
  }
}
</code></pre>
    </div>
</div>








                   </div><div class="search-results">
    <div class="has-results">
        <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
        <ul class="search-results-list"></ul>
    </div>
    <div class="no-results">
        <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
    </div>
</div>
</div>
               <!-- END CONTENT -->
           </div>
       </div>

          <label class="dark-mode-switch">
               <input type="checkbox">
               <span class="slider">
                    <svg class="slider-icon" viewBox="0 0 24 24" fill="none" height="20" stroke="#000" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" width="20" xmlns="http://www.w3.org/2000/svg">
                    <path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"></path>
                    </svg>
               </span>
          </label>

       <script>
            var COMPODOC_CURRENT_PAGE_DEPTH = 1;
            var COMPODOC_CURRENT_PAGE_CONTEXT = 'interface';
            var COMPODOC_CURRENT_PAGE_URL = 'TimelineStep.html';
            var MAX_SEARCH_RESULTS = 15;
       </script>

       <script>
               $darkModeToggleSwitchers = document.querySelectorAll('.dark-mode-switch input');
               checkToggle(darkModeState);
               if ($darkModeToggleSwitchers.length > 0) {
                    for (var i = 0; i < $darkModeToggleSwitchers.length; i++) {
                         $darkModeToggleSwitchers[i].addEventListener('change', function (event) {
                              darkModeState = !darkModeState;
                              toggleDarkMode(darkModeState);
                         });
                    }
               }
          </script>

       <script src="../js/libs/custom-elements.min.js"></script>
       <script src="../js/libs/lit-html.js"></script>

       <script src="../js/menu-wc.js" defer></script>
       <script nomodule src="../js/menu-wc_es5.js" defer></script>

       <script src="../js/libs/bootstrap-native.js"></script>

       <script src="../js/libs/es6-shim.min.js"></script>
       <script src="../js/libs/EventDispatcher.js"></script>
       <script src="../js/libs/promise.min.js"></script>

       <script src="../js/compodoc.js"></script>

       <script src="../js/tabs.js"></script>
       <script src="../js/menu.js"></script>
       <script src="../js/libs/clipboard.min.js"></script>
       <script src="../js/libs/prism.js"></script>
       <script src="../js/sourceCode.js"></script>
          <script src="../js/search/search.js"></script>
          <script src="../js/search/lunr.min.js"></script>
          <script src="../js/search/search-lunr.js"></script>
          <script src="../js/search/search_index.js"></script>
       <script src="../js/lazy-load-graphs.js"></script>


    </body>
</html>
